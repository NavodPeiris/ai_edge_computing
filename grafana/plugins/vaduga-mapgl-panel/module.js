/*! For license information please see module.js.LICENSE.txt */
define(["@grafana/data","react","@grafana/ui","react-dom","@emotion/css","@grafana/runtime","lodash","@emotion/react"],((e,t,n,i,r,o,s,a)=>(()=>{var l,c,u={7219:(e,t,n)=>{"use strict";var i=n(9343)("ArrayBuffer.prototype.byteLength",!0),r=n(2658);e.exports=function(e){return r(e)?i?i(e):e.byteLength:NaN}},9343:(e,t,n)=>{"use strict";var i=n(8897),r=n(8179),o=r(i("String.prototype.indexOf"));e.exports=function(e,t){var n=i(e,!!t);return"function"==typeof n&&o(e,".prototype.")>-1?r(n):n}},8179:(e,t,n)=>{"use strict";var i=n(4499),r=n(8897),o=n(8973),s=n(1711),a=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),c=r("%Reflect.apply%",!0)||i.call(l,a),u=n(7539),h=r("%Math.max%");e.exports=function(e){if("function"!=typeof e)throw new s("a function is required");var t=c(i,l,arguments);return o(t,1+h(0,e.length-(arguments.length-1)),!0)};var d=function(){return c(i,a,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d},5114:(e,t,n)=>{"use strict";var i=n(6481),r=n(922),o=n(4440),s=n(1247).orient2d;function a(e,t,n){t=Math.max(0,void 0===t?2:t),n=n||0;var r=function(e){for(var t=e[0],n=e[0],i=e[0],r=e[0],s=0;s<e.length;s++){var a=e[s];a[0]<t[0]&&(t=a),a[0]>i[0]&&(i=a),a[1]<n[1]&&(n=a),a[1]>r[1]&&(r=a)}var l=[t,n,i,r],c=l.slice();for(s=0;s<e.length;s++)o(e[s],l)||c.push(e[s]);return function(e){e.sort(v);for(var t=[],n=0;n<e.length;n++){for(;t.length>=2&&p(t[t.length-2],t[t.length-1],e[n])<=0;)t.pop();t.push(e[n])}for(var i=[],r=e.length-1;r>=0;r--){for(;i.length>=2&&p(i[i.length-2],i[i.length-1],e[r])<=0;)i.pop();i.push(e[r])}return i.pop(),t.pop(),t.concat(i)}(c)}(e),s=new i(16);s.toBBox=function(e){return{minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]}},s.compareMinX=function(e,t){return e[0]-t[0]},s.compareMinY=function(e,t){return e[1]-t[1]},s.load(e);for(var a,c=[],u=0;u<r.length;u++){var h=r[u];s.remove(h),a=m(h,a),c.push(a)}var d=new i(16);for(u=0;u<c.length;u++)d.insert(f(c[u]));for(var _=t*t,y=n*n;c.length;){var b=c.shift(),x=b.p,w=b.next.p,E=g(x,w);if(!(E<y)){var S=E/_;(h=l(s,b.prev.p,x,w,b.next.next.p,S,d))&&Math.min(g(h,x),g(h,w))<=S&&(c.push(b),c.push(m(h,b)),s.remove(h),d.remove(b),d.insert(f(b)),d.insert(f(b.next)))}}b=a;var T=[];do{T.push(b.p),b=b.next}while(b!==a);return T.push(b.p),T}function l(e,t,n,i,o,s,a){for(var l=new r([],c),h=e.data;h;){for(var p=0;p<h.children.length;p++){var f=h.children[p],m=h.leaf?_(f,n,i):u(n,i,f);m>s||l.push({node:f,dist:m})}for(;l.length&&!l.peek().node.children;){var g=l.pop(),y=g.node,v=_(y,t,n),b=_(y,i,o);if(g.dist<v&&g.dist<b&&d(n,y,a)&&d(i,y,a))return y}(h=l.pop())&&(h=h.node)}return null}function c(e,t){return e.dist-t.dist}function u(e,t,n){if(h(e,n)||h(t,n))return 0;var i=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.maxX,n.minY);if(0===i)return 0;var r=y(e[0],e[1],t[0],t[1],n.minX,n.minY,n.minX,n.maxY);if(0===r)return 0;var o=y(e[0],e[1],t[0],t[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=y(e[0],e[1],t[0],t[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(i,r,o,s)}function h(e,t){return e[0]>=t.minX&&e[0]<=t.maxX&&e[1]>=t.minY&&e[1]<=t.maxY}function d(e,t,n){for(var i,r,o,s,a=Math.min(e[0],t[0]),l=Math.min(e[1],t[1]),c=Math.max(e[0],t[0]),u=Math.max(e[1],t[1]),h=n.search({minX:a,minY:l,maxX:c,maxY:u}),d=0;d<h.length;d++)if(i=h[d].p,r=h[d].next.p,o=e,i!==(s=t)&&r!==o&&p(i,r,o)>0!=p(i,r,s)>0&&p(o,s,i)>0!=p(o,s,r)>0)return!1;return!0}function p(e,t,n){return s(e[0],e[1],t[0],t[1],n[0],n[1])}function f(e){var t=e.p,n=e.next.p;return e.minX=Math.min(t[0],n[0]),e.minY=Math.min(t[1],n[1]),e.maxX=Math.max(t[0],n[0]),e.maxY=Math.max(t[1],n[1]),e}function m(e,t){var n={p:e,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return t?(n.next=t.next,n.prev=t,t.next.prev=n,t.next=n):(n.prev=n,n.next=n),n}function g(e,t){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function _(e,t,n){var i=t[0],r=t[1],o=n[0]-i,s=n[1]-r;if(0!==o||0!==s){var a=((e[0]-i)*o+(e[1]-r)*s)/(o*o+s*s);a>1?(i=n[0],r=n[1]):a>0&&(i+=o*a,r+=s*a)}return(o=e[0]-i)*o+(s=e[1]-r)*s}function y(e,t,n,i,r,o,s,a){var l,c,u,h,d=n-e,p=i-t,f=s-r,m=a-o,g=e-r,_=t-o,y=d*d+p*p,v=d*f+p*m,b=f*f+m*m,x=d*g+p*_,w=f*g+m*_,E=y*b-v*v,S=E,T=E;0===E?(c=0,S=1,h=w,T=b):(h=y*w-v*x,(c=v*w-b*x)<0?(c=0,h=w,T=b):c>S&&(c=S,h=w+v,T=b)),h<0?(h=0,-x<0?c=0:-x>y?c=S:(c=-x,S=y)):h>T&&(h=T,-x+v<0?c=0:-x+v>y?c=S:(c=-x+v,S=y));var A=(1-(u=0===h?0:h/T))*r+u*s-((1-(l=0===c?0:c/S))*e+l*n),C=(1-u)*o+u*a-((1-l)*t+l*i);return A*A+C*C}function v(e,t){return e[0]===t[0]?e[1]-t[1]:e[0]-t[0]}r.default&&(r=r.default),e.exports=a,e.exports.default=a},5489:(e,t,n)=>{"use strict";var i=n(62),r={"text/plain":"Text","text/html":"Url",default:"Text"};e.exports=function(e,t){var n,o,s,a,l,c,u=!1;t||(t={}),n=t.debug||!1;try{if(s=i(),a=document.createRange(),l=document.getSelection(),(c=document.createElement("span")).textContent=e,c.ariaHidden="true",c.style.all="unset",c.style.position="fixed",c.style.top=0,c.style.clip="rect(0, 0, 0, 0)",c.style.whiteSpace="pre",c.style.webkitUserSelect="text",c.style.MozUserSelect="text",c.style.msUserSelect="text",c.style.userSelect="text",c.addEventListener("copy",(function(i){if(i.stopPropagation(),t.format)if(i.preventDefault(),void 0===i.clipboardData){n&&console.warn("unable to use e.clipboardData"),n&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var o=r[t.format]||r.default;window.clipboardData.setData(o,e)}else i.clipboardData.clearData(),i.clipboardData.setData(t.format,e);t.onCopy&&(i.preventDefault(),t.onCopy(i.clipboardData))})),document.body.appendChild(c),a.selectNodeContents(c),l.addRange(a),!document.execCommand("copy"))throw new Error("copy command was unsuccessful");u=!0}catch(i){n&&console.error("unable to copy using execCommand: ",i),n&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(t.format||"text",e),t.onCopy&&t.onCopy(window.clipboardData),u=!0}catch(i){n&&console.error("unable to copy using clipboardData: ",i),n&&console.error("falling back to prompt"),o=function(e){var t=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return e.replace(/#{\s*key\s*}/g,t)}("message"in t?t.message:"Copy to clipboard: #{key}, Enter"),window.prompt(o,e)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(a):l.removeAllRanges()),c&&document.body.removeChild(c),s()}return u}},2190:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(4942),r=n.n(i),o=n(278),s=n.n(o)()(r());s.push([e.id,'.deck-widget {\n  margin: var(--widget-margin, 12px);\n}\n\n/* Common button container styles */\n.deck-widget-button,\n.deck-widget-button-group {\n  background: var(--button-stroke, rgba(255, 255, 255, 0.3));\n  border-radius: var(--button-corner-radius, 8px);\n  box-shadow: var(--button-shadow, 0px 0px 8px 0px rgba(0, 0, 0, 0.25));\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Single button */\n.deck-widget-button {\n  width: var(--button-size, 28px);\n  height: var(--button-size, 28px);\n}\n\n/* Button group */\n.deck-widget-button-group {\n  width: calc(var(--button-size, 28px) - 2);\n  height: calc((var(--button-size, 28px) * 2) - 1);\n\n  flex-direction: row;\n  padding: 1px;\n  gap: 1px;\n}\n\n.deck-widget-button-group.vertical {\n  display: inline-flex;\n  flex-direction: column;\n}\n\n/* Common button styles */\n.deck-widget-button-group button,\n.deck-widget-button button {\n  width: calc(var(--button-size, 28px) - 2px);\n  height: calc(var(--button-size, 28px) - 2px);\n\n  box-sizing: border-box;\n  background: var(--button-background, #fff);\n  backdrop-filter: var(--button-backdrop-filter, unset);\n  border: var(--button-inner-stroke, unset);\n  border-radius: calc(var(--button-corner-radius, 8px) - 1px);\n\n  pointer-events: auto;\n  cursor: pointer;\n  outline: none;\n  padding: 0;\n}\n\n/* Border radius adjustments for grouped buttons */\n.deck-widget-button-group.vertical > *:not(:last-child),\n.deck-widget-button-group.vertical > *:not(:last-child) > button {\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.vertical > *:not(:first-child),\n.deck-widget-button-group.vertical > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n}\n\n\n.deck-widget-button-group.horizontal > *:not(:last-child),\n.deck-widget-button-group.horizontal > *:not(:last-child) > button {\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.horizontal > *:not(:first-child),\n.deck-widget-button-group.horizontal > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n/* Icon button styles */\n.deck-widget button .deck-widget-icon {\n  background-color: var(--button-icon-idle, #616166);\n  background-position: 50%;\n  background-repeat: no-repeat;\n  display: block;\n  height: 100%;\n  width: 100%;\n}\n\n.deck-widget button .deck-widget-icon:hover {\n  background-color: var(--button-icon-hover, rgb(24, 24, 26));\n}\n\n/* Fullscreen styles */\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-enter .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-exit .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n}\n\n.deck-pseudo-fullscreen {\n  height: 50% !important;\n  left: 0 !important;\n  position: fixed !important;\n  top: 0 !important;\n  width: 100% !important;\n  z-index: -1;\n}\n\n/* Zoom styles */\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-in .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-out .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n}\n',"",{version:3,sources:["webpack://./img/stylesheet.css"],names:[],mappings:"AAAA;EACE,kCAAkC;AACpC;;AAEA,mCAAmC;AACnC;;EAEE,0DAA0D;EAC1D,+CAA+C;EAC/C,qEAAqE;;EAErE,aAAa;EACb,mBAAmB;EACnB,uBAAuB;AACzB;;AAEA,kBAAkB;AAClB;EACE,+BAA+B;EAC/B,gCAAgC;AAClC;;AAEA,iBAAiB;AACjB;EACE,yCAAyC;EACzC,gDAAgD;;EAEhD,mBAAmB;EACnB,YAAY;EACZ,QAAQ;AACV;;AAEA;EACE,oBAAoB;EACpB,sBAAsB;AACxB;;AAEA,yBAAyB;AACzB;;EAEE,2CAA2C;EAC3C,4CAA4C;;EAE5C,sBAAsB;EACtB,0CAA0C;EAC1C,qDAAqD;EACrD,yCAAyC;EACzC,2DAA2D;;EAE3D,oBAAoB;EACpB,eAAe;EACf,aAAa;EACb,UAAU;AACZ;;AAEA,kDAAkD;AAClD;;EAEE,4BAA4B;EAC5B,6BAA6B;AAC/B;;AAEA;;EAEE,yBAAyB;EACzB,0BAA0B;AAC5B;;;AAGA;;EAEE,0BAA0B;EAC1B,6BAA6B;AAC/B;;AAEA;;EAEE,yBAAyB;EACzB,4BAA4B;AAC9B;;AAEA,uBAAuB;AACvB;EACE,kDAAkD;EAClD,wBAAwB;EACxB,4BAA4B;EAC5B,cAAc;EACd,YAAY;EACZ,WAAW;AACb;;AAEA;EACE,2DAA2D;AAC7D;;AAEA,sBAAsB;AACtB;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE,sBAAsB;EACtB,kBAAkB;EAClB,0BAA0B;EAC1B,iBAAiB;EACjB,sBAAsB;EACtB,WAAW;AACb;;AAEA,gBAAgB;AAChB;EACE;;;GAGC;EACD;;;GAGC;AACH;;AAEA;EACE;;;GAGC;EACD;;;GAGC;AACH",sourcesContent:['.deck-widget {\n  margin: var(--widget-margin, 12px);\n}\n\n/* Common button container styles */\n.deck-widget-button,\n.deck-widget-button-group {\n  background: var(--button-stroke, rgba(255, 255, 255, 0.3));\n  border-radius: var(--button-corner-radius, 8px);\n  box-shadow: var(--button-shadow, 0px 0px 8px 0px rgba(0, 0, 0, 0.25));\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Single button */\n.deck-widget-button {\n  width: var(--button-size, 28px);\n  height: var(--button-size, 28px);\n}\n\n/* Button group */\n.deck-widget-button-group {\n  width: calc(var(--button-size, 28px) - 2);\n  height: calc((var(--button-size, 28px) * 2) - 1);\n\n  flex-direction: row;\n  padding: 1px;\n  gap: 1px;\n}\n\n.deck-widget-button-group.vertical {\n  display: inline-flex;\n  flex-direction: column;\n}\n\n/* Common button styles */\n.deck-widget-button-group button,\n.deck-widget-button button {\n  width: calc(var(--button-size, 28px) - 2px);\n  height: calc(var(--button-size, 28px) - 2px);\n\n  box-sizing: border-box;\n  background: var(--button-background, #fff);\n  backdrop-filter: var(--button-backdrop-filter, unset);\n  border: var(--button-inner-stroke, unset);\n  border-radius: calc(var(--button-corner-radius, 8px) - 1px);\n\n  pointer-events: auto;\n  cursor: pointer;\n  outline: none;\n  padding: 0;\n}\n\n/* Border radius adjustments for grouped buttons */\n.deck-widget-button-group.vertical > *:not(:last-child),\n.deck-widget-button-group.vertical > *:not(:last-child) > button {\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.vertical > *:not(:first-child),\n.deck-widget-button-group.vertical > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n}\n\n\n.deck-widget-button-group.horizontal > *:not(:last-child),\n.deck-widget-button-group.horizontal > *:not(:last-child) > button {\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n.deck-widget-button-group.horizontal > *:not(:first-child),\n.deck-widget-button-group.horizontal > *:not(:first-child) > button {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n/* Icon button styles */\n.deck-widget button .deck-widget-icon {\n  background-color: var(--button-icon-idle, #616166);\n  background-position: 50%;\n  background-repeat: no-repeat;\n  display: block;\n  height: 100%;\n  width: 100%;\n}\n\n.deck-widget button .deck-widget-icon:hover {\n  background-color: var(--button-icon-hover, rgb(24, 24, 26));\n}\n\n/* Fullscreen styles */\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-enter .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-enter,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M7.90474 20.0953H10.6286C10.8984 20.0953 11.1246 20.1868 11.3071 20.37C11.4897 20.5532 11.5809 20.7802 11.5809 21.051C11.5809 21.3218 11.4897 21.5476 11.3071 21.7286C11.1246 21.9095 10.8984 22 10.6286 22H6.95237C6.68254 22 6.45635 21.9087 6.2738 21.7262C6.09127 21.5436 6 21.3175 6 21.0476V17.3714C6 17.1016 6.09159 16.8754 6.27477 16.6929C6.45795 16.5103 6.68493 16.4191 6.95571 16.4191C7.2265 16.4191 7.45236 16.5103 7.63331 16.6929C7.81427 16.8754 7.90474 17.1016 7.90474 17.3714V20.0953ZM7.90474 7.90474V10.6286C7.90474 10.8984 7.81315 11.1246 7.62997 11.3071C7.44679 11.4897 7.21981 11.5809 6.94903 11.5809C6.67825 11.5809 6.45238 11.4897 6.27143 11.3071C6.09048 11.1246 6 10.8984 6 10.6286V6.95237C6 6.68254 6.09127 6.45635 6.2738 6.2738C6.45635 6.09127 6.68254 6 6.95237 6H10.6286C10.8984 6 11.1246 6.09159 11.3071 6.27477C11.4897 6.45795 11.5809 6.68493 11.5809 6.95571C11.5809 7.2265 11.4897 7.45236 11.3071 7.63331C11.1246 7.81427 10.8984 7.90474 10.6286 7.90474H7.90474ZM20.0953 20.0953V17.3714C20.0953 17.1016 20.1868 16.8754 20.37 16.6929C20.5532 16.5103 20.7802 16.4191 21.051 16.4191C21.3218 16.4191 21.5476 16.5103 21.7286 16.6929C21.9095 16.8754 22 17.1016 22 17.3714V21.0476C22 21.3175 21.9087 21.5436 21.7262 21.7262C21.5436 21.9087 21.3175 22 21.0476 22H17.3714C17.1016 22 16.8754 21.9084 16.6929 21.7252C16.5103 21.542 16.4191 21.3151 16.4191 21.0443C16.4191 20.7735 16.5103 20.5476 16.6929 20.3667C16.8754 20.1857 17.1016 20.0953 17.3714 20.0953H20.0953ZM20.0953 7.90474H17.3714C17.1016 7.90474 16.8754 7.81315 16.6929 7.62997C16.5103 7.44679 16.4191 7.21981 16.4191 6.94903C16.4191 6.67825 16.5103 6.45238 16.6929 6.27143C16.8754 6.09048 17.1016 6 17.3714 6H21.0476C21.3175 6 21.5436 6.09127 21.7262 6.2738C21.9087 6.45635 22 6.68254 22 6.95237V10.6286C22 10.8984 21.9084 11.1246 21.7252 11.3071C21.542 11.4897 21.3151 11.5809 21.0443 11.5809C20.7735 11.5809 20.5476 11.4897 20.3667 11.3071C20.1857 11.1246 20.0953 10.8984 20.0953 10.6286V7.90474Z" /></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-fullscreen button.deck-widget-fullscreen-exit .deck-widget-icon {\n  mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-fullscreen-exit,\n    url(\'data:image/svg+xml,<svg fill="black" height="100%" viewBox="0 0 28 28" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M9.6762 18.3238H6.95237C6.68254 18.3238 6.45635 18.2322 6.2738 18.049C6.09127 17.8658 6 17.6389 6 17.3681C6 17.0973 6.09127 16.8714 6.2738 16.6905C6.45635 16.5095 6.68254 16.4191 6.95237 16.4191H10.6286C10.8984 16.4191 11.1246 16.5103 11.3071 16.6929C11.4897 16.8754 11.5809 17.1016 11.5809 17.3714V21.0476C11.5809 21.3175 11.4894 21.5436 11.3062 21.7262C11.123 21.9087 10.896 22 10.6252 22C10.3544 22 10.1286 21.9087 9.94763 21.7262C9.76668 21.5436 9.6762 21.3175 9.6762 21.0476V18.3238ZM18.3238 18.3238V21.0476C18.3238 21.3175 18.2322 21.5436 18.049 21.7262C17.8658 21.9087 17.6389 22 17.3681 22C17.0973 22 16.8714 21.9087 16.6905 21.7262C16.5095 21.5436 16.4191 21.3175 16.4191 21.0476V17.3714C16.4191 17.1016 16.5103 16.8754 16.6929 16.6929C16.8754 16.5103 17.1016 16.4191 17.3714 16.4191H21.0476C21.3175 16.4191 21.5436 16.5106 21.7262 16.6938C21.9087 16.877 22 17.104 22 17.3748C22 17.6456 21.9087 17.8714 21.7262 18.0524C21.5436 18.2333 21.3175 18.3238 21.0476 18.3238H18.3238ZM9.6762 9.6762V6.95237C9.6762 6.68254 9.76779 6.45635 9.95097 6.2738C10.1342 6.09127 10.3611 6 10.6319 6C10.9027 6 11.1286 6.09127 11.3095 6.2738C11.4905 6.45635 11.5809 6.68254 11.5809 6.95237V10.6286C11.5809 10.8984 11.4897 11.1246 11.3071 11.3071C11.1246 11.4897 10.8984 11.5809 10.6286 11.5809H6.95237C6.68254 11.5809 6.45635 11.4894 6.2738 11.3062C6.09127 11.123 6 10.896 6 10.6252C6 10.3544 6.09127 10.1286 6.2738 9.94763C6.45635 9.76668 6.68254 9.6762 6.95237 9.6762H9.6762ZM18.3238 9.6762H21.0476C21.3175 9.6762 21.5436 9.76779 21.7262 9.95097C21.9087 10.1342 22 10.3611 22 10.6319C22 10.9027 21.9087 11.1286 21.7262 11.3095C21.5436 11.4905 21.3175 11.5809 21.0476 11.5809H17.3714C17.1016 11.5809 16.8754 11.4897 16.6929 11.3071C16.5103 11.1246 16.4191 10.8984 16.4191 10.6286V6.95237C16.4191 6.68254 16.5106 6.45635 16.6938 6.2738C16.877 6.09127 17.104 6 17.3748 6C17.6456 6 17.8714 6.09127 18.0524 6.2738C18.2333 6.45635 18.3238 6.68254 18.3238 6.95237V9.6762Z" /></svg>\')\n  );\n}\n\n.deck-pseudo-fullscreen {\n  height: 50% !important;\n  left: 0 !important;\n  position: fixed !important;\n  top: 0 !important;\n  width: 100% !important;\n  z-index: -1;\n}\n\n/* Zoom styles */\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-in .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-in,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"><path d="M12.1029 13.8971H7.89332C7.64334 13.8971 7.43196 13.8105 7.25918 13.6373C7.08639 13.4641 7 13.2521 7 13.0014C7 12.7508 7.08639 12.5396 7.25918 12.368C7.43196 12.1963 7.64334 12.1105 7.89332 12.1105H12.1029V7.90097C12.1029 7.65161 12.1895 7.43912 12.3627 7.26348C12.5359 7.08783 12.7479 7 12.9986 7C13.2492 7 13.4604 7.08783 13.632 7.26348C13.8037 7.43912 13.8895 7.65161 13.8895 7.90097V12.1105H18.099C18.3484 12.1105 18.5609 12.1971 18.7365 12.3703C18.9122 12.5436 19 12.7555 19 13.0062C19 13.2569 18.9122 13.468 18.7365 13.6397C18.5609 13.8113 18.3484 13.8971 18.099 13.8971H13.8895V18.1067C13.8895 18.3567 13.8029 18.568 13.6297 18.7408C13.4564 18.9136 13.2445 19 12.9938 19C12.7431 19 12.532 18.9136 12.3603 18.7408C12.1887 18.568 12.1029 18.3567 12.1029 18.1067V13.8971Z"/></svg>\')\n  );\n}\n\n.deck-widget.deck-widget-zoom button.deck-widget-zoom-out .deck-widget-icon {\n  mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n  -webkit-mask-image: var(\n    --icon-zoom-out,\n    url(\'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 26 26" fill="black"> wBox="0 0 26 26" fill="none"><path d="M7.89332 13.8866C7.64334 13.8866 7.43196 13.8 7.25918 13.6268C7.08639 13.4535 7 13.2416 7 12.9909C7 12.7403 7.08639 12.5291 7.25918 12.3575C7.43196 12.1858 7.64334 12.1 7.89332 12.1H18.099C18.349 12.1 18.5617 12.1866 18.737 12.3598C18.9123 12.5331 19 12.745 19 12.9957C19 13.2463 18.9123 13.4575 18.737 13.6291C18.5617 13.8008 18.349 13.8866 18.099 13.8866H7.89332Z"/></svg>\')\n  );\n}\n'],sourceRoot:""}]);const a=s},278:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);i&&s[u[0]]||(void 0!==o&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=o),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),t.push(u))}},t}},4942:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */");return[t].concat([o]).join("\n")}return[t].join("\n")}},3498:(e,t,n)=>{"use strict";var i=n(7745),r=n(9343),o=n(9353),s=n(8897),a=n(8418),l=n(588),c=n(9513),u=n(5456),h=n(6143),d=n(2658),p=n(228),f=n(7647),m=n(6050),g=n(3425),_=n(9767),y=n(5493),v=n(6059),b=n(7219),x=r("SharedArrayBuffer.prototype.byteLength",!0),w=r("Date.prototype.getTime"),E=Object.getPrototypeOf,S=r("Object.prototype.toString"),T=s("%Set%",!0),A=r("Map.prototype.has",!0),C=r("Map.prototype.get",!0),P=r("Map.prototype.size",!0),I=r("Set.prototype.add",!0),M=r("Set.prototype.delete",!0),R=r("Set.prototype.has",!0),O=r("Set.prototype.size",!0);function k(e,t,n,i){for(var r,o=a(e);(r=o.next())&&!r.done;)if(B(t,r.value,n,i))return M(e,r.value),!0;return!1}function L(e){return void 0===e?null:"object"!=typeof e?"symbol"!=typeof e&&("string"!=typeof e&&"number"!=typeof e||+e==+e):void 0}function D(e,t,n,r,o,s){var a=L(n);if(null!=a)return a;var l=C(t,a),c=i({},o,{strict:!1});return!(void 0===l&&!A(t,a)||!B(r,l,c,s))&&!A(e,a)&&B(r,l,c,s)}function F(e,t,n){var i=L(n);return null!=i?i:R(t,i)&&!R(e,i)}function N(e,t,n,i,r,o){for(var s,l,c=a(e);(s=c.next())&&!s.done;)if(B(n,l=s.value,r,o)&&B(i,C(t,l),r,o))return M(e,l),!0;return!1}function B(e,t,n,r){var s=n||{};if(s.strict?c(e,t):e===t)return!0;if(_(e)!==_(t))return!1;if(!e||!t||"object"!=typeof e&&"object"!=typeof t)return s.strict?c(e,t):e==t;var l,M=r.has(e),L=r.has(t);if(M&&L){if(r.get(e)===r.get(t))return!0}else l={};return M||r.set(e,l),L||r.set(t,l),function(e,t,n,r){var s,l;if(typeof e!=typeof t)return!1;if(null==e||null==t)return!1;if(S(e)!==S(t))return!1;if(u(e)!==u(t))return!1;if(h(e)!==h(t))return!1;var c=e instanceof Error,_=t instanceof Error;if(c!==_)return!1;if((c||_)&&(e.name!==t.name||e.message!==t.message))return!1;var M=f(e),L=f(t);if(M!==L)return!1;if((M||L)&&(e.source!==t.source||o(e)!==o(t)))return!1;var j=p(e),U=p(t);if(j!==U)return!1;if((j||U)&&w(e)!==w(t))return!1;if(n.strict&&E&&E(e)!==E(t))return!1;var V=v(e),G=v(t);if(V!==G)return!1;if(V||G){if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}var $=z(e),W=z(t);if($!==W)return!1;if($||W){if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}var H=d(e),q=d(t);if(H!==q)return!1;if(H||q)return b(e)===b(t)&&"function"==typeof Uint8Array&&B(new Uint8Array(e),new Uint8Array(t),n,r);var X=m(e),Z=m(t);if(X!==Z)return!1;if(X||Z)return x(e)===x(t)&&"function"==typeof Uint8Array&&B(new Uint8Array(e),new Uint8Array(t),n,r);if(typeof e!=typeof t)return!1;var Y=g(e),K=g(t);if(Y.length!==K.length)return!1;for(Y.sort(),K.sort(),s=Y.length-1;s>=0;s--)if(Y[s]!=K[s])return!1;for(s=Y.length-1;s>=0;s--)if(!B(e[l=Y[s]],t[l],n,r))return!1;var J=y(e),Q=y(t);return J===Q&&("Set"===J||"Set"===Q?function(e,t,n,i){if(O(e)!==O(t))return!1;for(var r,o,s,l=a(e),c=a(t);(r=l.next())&&!r.done;)if(r.value&&"object"==typeof r.value)s||(s=new T),I(s,r.value);else if(!R(t,r.value)){if(n.strict)return!1;if(!F(e,t,r.value))return!1;s||(s=new T),I(s,r.value)}if(s){for(;(o=c.next())&&!o.done;)if(o.value&&"object"==typeof o.value){if(!k(s,o.value,n.strict,i))return!1}else if(!n.strict&&!R(e,o.value)&&!k(s,o.value,n.strict,i))return!1;return 0===O(s)}return!0}(e,t,n,r):"Map"!==J||function(e,t,n,r){if(P(e)!==P(t))return!1;for(var o,s,l,c,u,h,d=a(e),p=a(t);(o=d.next())&&!o.done;)if(c=o.value[0],u=o.value[1],c&&"object"==typeof c)l||(l=new T),I(l,c);else if(void 0===(h=C(t,c))&&!A(t,c)||!B(u,h,n,r)){if(n.strict)return!1;if(!D(e,t,c,u,n,r))return!1;l||(l=new T),I(l,c)}if(l){for(;(s=p.next())&&!s.done;)if(c=s.value[0],h=s.value[1],c&&"object"==typeof c){if(!N(l,e,c,h,n,r))return!1}else if(!(n.strict||e.has(c)&&B(C(e,c),h,n,r)||N(l,e,c,h,i({},n,{strict:!1}),r)))return!1;return 0===O(l)}return!0}(e,t,n,r))}(e,t,s,r)}function z(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length||"function"!=typeof e.copy||"function"!=typeof e.slice||e.length>0&&"number"!=typeof e[0]||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}e.exports=function(e,t,n){return B(e,t,n,l())}},6143:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},9381:(e,t,n)=>{"use strict";var i=n(7539),r=n(6296),o=n(1711),s=n(1399);e.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new o("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,l=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!s&&s(e,t);if(i)i(e,t,{configurable:null===c&&h?h.configurable:!c,enumerable:null===a&&h?h.enumerable:!a,value:n,writable:null===l&&h?h.writable:!l});else{if(!u&&(a||l||c))throw new r("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},5144:(e,t,n)=>{"use strict";var i=n(3425),r="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),o=Object.prototype.toString,s=Array.prototype.concat,a=n(9381),l=n(6900)(),c=function(e,t,n,i){if(t in e)if(!0===i){if(e[t]===n)return}else if("function"!=typeof(r=i)||"[object Function]"!==o.call(r)||!i())return;var r;l?a(e,t,n,!0):a(e,t,n)},u=function(e,t){var n=arguments.length>2?arguments[2]:{},o=i(t);r&&(o=s.call(o,Object.getOwnPropertySymbols(t)));for(var a=0;a<o.length;a+=1)c(e,o[a],t[o[a]],n[o[a]])};u.supportsDescriptors=!!l,e.exports=u},5230:e=>{"use strict";function t(e,t,i){i=i||2;var o,s,a,l,h,d,f,m=t&&t.length,g=m?t[0]*i:e.length,_=n(e,0,g,i,!0),y=[];if(!_||_.next===_.prev)return y;if(m&&(_=function(e,t,i,r){var o,s,a,l=[];for(o=0,s=t.length;o<s;o++)(a=n(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),l.push(p(a));for(l.sort(c),o=0;o<l.length;o++)i=u(l[o],i);return i}(e,t,_,i)),e.length>80*i){o=a=e[0],s=l=e[1];for(var v=i;v<g;v+=i)(h=e[v])<o&&(o=h),(d=e[v+1])<s&&(s=d),h>a&&(a=h),d>l&&(l=d);f=0!==(f=Math.max(a-o,l-s))?32767/f:0}return r(_,y,i,o,s,f,0),y}function n(e,t,n,i,r){var o,s;if(r===A(e,t,n,i)>0)for(o=t;o<n;o+=i)s=E(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=E(o,e[o],e[o+1],s);return s&&_(s,s.next)&&(S(s),s=s.next),s}function i(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!_(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{if(S(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function r(e,t,n,c,u,h,p){if(e){!p&&h&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=d(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,c,u,h);for(var f,m,g=e;e.prev!==e.next;)if(f=e.prev,m=e.next,h?s(e,c,u,h):o(e))t.push(f.i/n|0),t.push(e.i/n|0),t.push(m.i/n|0),S(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?r(e=a(i(e),t,n),t,n,c,u,h,2):2===p&&l(e,t,n,c,u,h):r(i(e),t,n,c,u,h,1);break}}}function o(e){var t=e.prev,n=e,i=e.next;if(g(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,m=i.next;m!==t;){if(m.x>=u&&m.x<=d&&m.y>=h&&m.y<=p&&f(r,a,o,l,s,c,m.x,m.y)&&g(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function s(e,t,n,i){var r=e.prev,o=e,s=e.next;if(g(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,p=s.y,m=a<l?a<c?a:c:l<c?l:c,_=u<h?u<p?u:p:h<p?h:p,y=a>l?a>c?a:c:l>c?l:c,v=u>h?u>p?u:p:h>p?h:p,b=d(m,_,t,n,i),x=d(y,v,t,n,i),w=e.prevZ,E=e.nextZ;w&&w.z>=b&&E&&E.z<=x;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;if(w=w.prevZ,E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;w&&w.z>=b;){if(w.x>=m&&w.x<=y&&w.y>=_&&w.y<=v&&w!==r&&w!==s&&f(a,u,l,h,c,p,w.x,w.y)&&g(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=x;){if(E.x>=m&&E.x<=y&&E.y>=_&&E.y<=v&&E!==r&&E!==s&&f(a,u,l,h,c,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function a(e,t,n){var r=e;do{var o=r.prev,s=r.next.next;!_(o,s)&&y(o,r,r.next,s)&&x(o,s)&&x(s,o)&&(t.push(o.i/n|0),t.push(r.i/n|0),t.push(s.i/n|0),S(r),S(r.next),r=e=s),r=r.next}while(r!==e);return i(r)}function l(e,t,n,o,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=w(l,c);return l=i(l,l.next),u=i(u,u.next),r(l,t,n,o,s,a,0),void r(u,t,n,o,s,a,0)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,d=n.y,p=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&f(o<d?r:s,o,u,d,o<d?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),x(i,e)&&(l<p||l===p&&(i.x>n.x||i.x===n.x&&h(n,i)))&&(n=i,p=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var r=w(n,e);return i(r,r.next),i(n,n.next)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function d(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function f(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||_(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,i){var r=b(g(e,t,n)),o=b(g(e,t,i)),s=b(g(n,i,e)),a=b(g(n,i,t));return r!==o&&s!==a||!(0!==r||!v(e,n,t))||!(0!==o||!v(e,i,t))||!(0!==s||!v(n,e,i))||!(0!==a||!v(n,t,i))}function v(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b(e){return e>0?1:e<0?-1:0}function x(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function w(e,t){var n=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function E(e,t,n,i){var r=new T(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,i){var r=t&&t.length,o=r?t[0]*n:e.length,s=Math.abs(A(e,0,o,n));if(r)for(var a=0,l=t.length;a<l;a++){var c=t[a]*n,u=a<l-1?t[a+1]*n:e.length;s-=Math.abs(A(e,c,u,n))}var h=0;for(a=0;a<i.length;a+=3){var d=i[a]*n,p=i[a+1]*n,f=i[a+2]*n;h+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&(i+=e[r-1].length,n.holes.push(i))}return n}},7539:(e,t,n)=>{"use strict";var i=n(8897)("%Object.defineProperty%",!0)||!1;if(i)try{i({},"a",{value:1})}catch(e){i=!1}e.exports=i},3841:e=>{"use strict";e.exports=EvalError},219:e=>{"use strict";e.exports=Error},6190:e=>{"use strict";e.exports=RangeError},3950:e=>{"use strict";e.exports=ReferenceError},6296:e=>{"use strict";e.exports=SyntaxError},1711:e=>{"use strict";e.exports=TypeError},3221:e=>{"use strict";e.exports=URIError},8030:e=>{var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},7270:(e,t,n)=>{"use strict";var i=n(9916),r=Object.prototype.toString,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){if(!i(t))throw new TypeError("iterator must be a function");var s;arguments.length>=3&&(s=n),"[object Array]"===r.call(e)?function(e,t,n){for(var i=0,r=e.length;i<r;i++)o.call(e,i)&&(null==n?t(e[i],i,e):t.call(n,e[i],i,e))}(e,t,s):"string"==typeof e?function(e,t,n){for(var i=0,r=e.length;i<r;i++)null==n?t(e.charAt(i),i,e):t.call(n,e.charAt(i),i,e)}(e,t,s):function(e,t,n){for(var i in e)o.call(e,i)&&(null==n?t(e[i],i,e):t.call(n,e[i],i,e))}(e,t,s)}},5845:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,i=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var r=0;r<t.length;r+=1)n[r+e.length]=t[r];return n};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==t.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var o,s=function(e,t){for(var n=[],i=1,r=0;i<e.length;i+=1,r+=1)n[r]=e[i];return n}(arguments),a=n(0,r.length-s.length),l=[],c=0;c<a;c++)l[c]="$"+c;if(o=Function("binder","return function ("+function(e,t){for(var n="",i=0;i<e.length;i+=1)n+=e[i],i+1<e.length&&(n+=",");return n}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof o){var t=r.apply(this,i(s,arguments));return Object(t)===t?t:this}return r.apply(e,i(s,arguments))})),r.prototype){var u=function(){};u.prototype=r.prototype,o.prototype=new u,u.prototype=null}return o}},4499:(e,t,n)=>{"use strict";var i=n(5845);e.exports=Function.prototype.bind||i},1442:e=>{"use strict";var t=function(){return"string"==typeof function(){}.name},n=Object.getOwnPropertyDescriptor;if(n)try{n([],"length")}catch(e){n=null}t.functionsHaveConfigurableNames=function(){if(!t()||!n)return!1;var e=n((function(){}),"name");return!!e&&!!e.configurable};var i=Function.prototype.bind;t.boundFunctionsHaveNames=function(){return t()&&"function"==typeof i&&""!==function(){}.bind().name},e.exports=t},8897:(e,t,n)=>{"use strict";var i,r=n(219),o=n(3841),s=n(6190),a=n(3950),l=n(6296),c=n(1711),u=n(3221),h=Function,d=function(e){try{return h('"use strict"; return ('+e+").constructor;")()}catch(e){}},p=Object.getOwnPropertyDescriptor;if(p)try{p({},"")}catch(e){p=null}var f=function(){throw new c},m=p?function(){try{return f}catch(e){try{return p(arguments,"callee").get}catch(e){return f}}}():f,g=n(4923)(),_=n(9372)(),y=Object.getPrototypeOf||(_?function(e){return e.__proto__}:null),v={},b="undefined"!=typeof Uint8Array&&y?y(Uint8Array):i,x={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":g&&y?y([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":v,"%AsyncGenerator%":v,"%AsyncGeneratorFunction%":v,"%AsyncIteratorPrototype%":v,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":r,"%eval%":eval,"%EvalError%":o,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":h,"%GeneratorFunction%":v,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":g&&y?y(y([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&g&&y?y((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":s,"%ReferenceError%":a,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&g&&y?y((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":g&&y?y(""[Symbol.iterator]()):i,"%Symbol%":g?Symbol:i,"%SyntaxError%":l,"%ThrowTypeError%":m,"%TypedArray%":b,"%TypeError%":c,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":u,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(y)try{null.error}catch(e){var w=y(y(e));x["%Error.prototype%"]=w}var E=function e(t){var n;if("%AsyncFunction%"===t)n=d("async function () {}");else if("%GeneratorFunction%"===t)n=d("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=d("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(n=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&y&&(n=y(r.prototype))}return x[t]=n,n},S={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},T=n(4499),A=n(4313),C=T.call(Function.call,Array.prototype.concat),P=T.call(Function.apply,Array.prototype.splice),I=T.call(Function.call,String.prototype.replace),M=T.call(Function.call,String.prototype.slice),R=T.call(Function.call,RegExp.prototype.exec),O=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,L=function(e,t){var n,i=e;if(A(S,i)&&(i="%"+(n=S[i])[0]+"%"),A(x,i)){var r=x[i];if(r===v&&(r=E(i)),void 0===r&&!t)throw new c("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:r}}throw new l("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new c('"allowMissing" argument must be a boolean');if(null===R(/^%?[^%]*%?$/,e))throw new l("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=M(e,0,1),n=M(e,-1);if("%"===t&&"%"!==n)throw new l("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new l("invalid intrinsic syntax, expected opening `%`");var i=[];return I(e,O,(function(e,t,n,r){i[i.length]=n?I(r,k,"$1"):t||e})),i}(e),i=n.length>0?n[0]:"",r=L("%"+i+"%",t),o=r.name,s=r.value,a=!1,u=r.alias;u&&(i=u[0],P(n,C([0,1],u)));for(var h=1,d=!0;h<n.length;h+=1){var f=n[h],m=M(f,0,1),g=M(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new l("property names with quotes must have matching quotes");if("constructor"!==f&&d||(a=!0),A(x,o="%"+(i+="."+f)+"%"))s=x[o];else if(null!=s){if(!(f in s)){if(!t)throw new c("base intrinsic for "+e+" exists, but the property is not available.");return}if(p&&h+1>=n.length){var _=p(s,f);s=(d=!!_)&&"get"in _&&!("originalValue"in _.get)?_.get:s[f]}else d=A(s,f),s=s[f];d&&!a&&(x[o]=s)}}return s}},1399:(e,t,n)=>{"use strict";var i=n(8897)("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch(e){i=null}e.exports=i},2332:(e,t,n)=>{var i;!function(r,o,s,a){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],u=o.createElement("div"),h="function",d=Math.round,p=Math.abs,f=Date.now;function m(e,t,n){return setTimeout(w(e,n),t)}function g(e,t,n){return!!Array.isArray(e)&&(_(e,n[t],n),!0)}function _(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==a)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function y(e,t,n){var i="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===a||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==a&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign;var v=y((function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===a)&&(e[i[r]]=t[i[r]]),r++;return e}),"extend","Use `assign`."),b=y((function(e,t){return v(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&l(i,n)}function w(e,t){return function(){return e.apply(t,arguments)}}function E(e,t){return typeof e==h?e.apply(t&&t[0]||a,t):e}function S(e,t){return e===a?t:e}function T(e,t,n){_(I(t),(function(t){e.addEventListener(t,n,!1)}))}function A(e,t,n){_(I(t),(function(t){e.removeEventListener(t,n,!1)}))}function C(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function P(e,t){return e.indexOf(t)>-1}function I(e){return e.trim().split(/\s+/g)}function M(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function R(e){return Array.prototype.slice.call(e,0)}function O(e,t,n){for(var i=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];M(r,s)<0&&i.push(e[o]),r[o]=s,o++}return n&&(i=t?i.sort((function(e,n){return e[t]>n[t]})):i.sort()),i}function k(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((i=(n=c[o])?n+r:t)in e)return i;o++}return a}var L=1;function D(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||r}var F="ontouchstart"in r,N=k(r,"PointerEvent")!==a,B=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),z="touch",j="mouse",U=25,V=1,G=4,$=8,W=1,H=2,q=4,X=8,Z=16,Y=H|q,K=X|Z,J=Y|K,Q=["x","y"],ee=["clientX","clientY"];function te(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){E(e.options.enable,[e])&&n.handler(t)},this.init()}function ne(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,o=t&V&&i-r==0,s=t&(G|$)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=ie(t)),r>1&&!n.firstMultiple?n.firstMultiple=ie(t):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,l=s?s.center:o.center,c=t.center=re(i);t.timeStamp=f(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=le(l,c),t.distance=ae(l,c),function(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==V&&o.eventType!==G||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}(n,t),t.offsetDirection=se(t.deltaX,t.deltaY);var u,h,d=oe(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=d.x,t.overallVelocityY=d.y,t.overallVelocity=p(d.x)>p(d.y)?d.x:d.y,t.scale=s?(u=s.pointers,ae((h=i)[0],h[1],ee)/ae(u[0],u[1],ee)):1,t.rotation=s?function(e,t){return le(t[1],t[0],ee)+le(e[1],e[0],ee)}(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,i,r,o,s=e.lastInterval||t,l=t.timeStamp-s.timeStamp;if(t.eventType!=$&&(l>U||s.velocity===a)){var c=t.deltaX-s.deltaX,u=t.deltaY-s.deltaY,h=oe(l,c,u);i=h.x,r=h.y,n=p(h.x)>p(h.y)?h.x:h.y,o=se(c,u),e.lastInterval=t}else n=s.velocity,i=s.velocityX,r=s.velocityY,o=s.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=o}(n,t);var m=e.element;C(t.srcEvent.target,m)&&(m=t.srcEvent.target),t.target=m}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function ie(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:d(e.pointers[n].clientX),clientY:d(e.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:t,center:re(t),deltaX:e.deltaX,deltaY:e.deltaY}}function re(e){var t=e.length;if(1===t)return{x:d(e[0].clientX),y:d(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:d(n/t),y:d(i/t)}}function oe(e,t,n){return{x:t/e||0,y:n/e||0}}function se(e,t){return e===t?W:p(e)>=p(t)?e<0?H:q:t<0?X:Z}function ae(e,t,n){n||(n=Q);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function le(e,t,n){n||(n=Q);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}te.prototype={handler:function(){},init:function(){this.evEl&&T(this.element,this.evEl,this.domHandler),this.evTarget&&T(this.target,this.evTarget,this.domHandler),this.evWin&&T(D(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&A(this.element,this.evEl,this.domHandler),this.evTarget&&A(this.target,this.evTarget,this.domHandler),this.evWin&&A(D(this.element),this.evWin,this.domHandler)}};var ce={mousedown:V,mousemove:2,mouseup:G},ue="mousedown",he="mousemove mouseup";function de(){this.evEl=ue,this.evWin=he,this.pressed=!1,te.apply(this,arguments)}x(de,te,{handler:function(e){var t=ce[e.type];t&V&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=G),this.pressed&&(t&G&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:j,srcEvent:e}))}});var pe={pointerdown:V,pointermove:2,pointerup:G,pointercancel:$,pointerout:$},fe={2:z,3:"pen",4:j,5:"kinect"},me="pointerdown",ge="pointermove pointerup pointercancel";function _e(){this.evEl=me,this.evWin=ge,te.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(me="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel"),x(_e,te,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=pe[i],o=fe[e.pointerType]||e.pointerType,s=o==z,a=M(t,e.pointerId,"pointerId");r&V&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):r&(G|$)&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(a,1))}});var ye={touchstart:V,touchmove:2,touchend:G,touchcancel:$};function ve(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,te.apply(this,arguments)}function be(e,t){var n=R(e.touches),i=R(e.changedTouches);return t&(G|$)&&(n=O(n.concat(i),"identifier",!0)),[n,i]}x(ve,te,{handler:function(e){var t=ye[e.type];if(t===V&&(this.started=!0),this.started){var n=be.call(this,e,t);t&(G|$)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}}});var xe={touchstart:V,touchmove:2,touchend:G,touchcancel:$},we="touchstart touchmove touchend touchcancel";function Ee(){this.evTarget=we,this.targetIds={},te.apply(this,arguments)}function Se(e,t){var n=R(e.touches),i=this.targetIds;if(t&(2|V)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=R(e.changedTouches),a=[],l=this.target;if(o=n.filter((function(e){return C(e.target,l)})),t===V)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),t&(G|$)&&delete i[s[r].identifier],r++;return a.length?[O(o.concat(a),"identifier",!0),a]:void 0}x(Ee,te,{handler:function(e){var t=xe[e.type],n=Se.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:z,srcEvent:e})}});var Te=2500;function Ae(){te.apply(this,arguments);var e=w(this.handler,this);this.touch=new Ee(this.manager,e),this.mouse=new de(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function Ce(e,t){e&V?(this.primaryTouch=t.changedPointers[0].identifier,Pe.call(this,t)):e&(G|$)&&Pe.call(this,t)}function Pe(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)}),Te)}}function Ie(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),s=Math.abs(n-r.y);if(o<=25&&s<=25)return!0}return!1}x(Ae,te,{handler:function(e,t,n){var i=n.pointerType==z,r=n.pointerType==j;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)Ce.call(this,t,n);else if(r&&Ie.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Me=k(u.style,"touchAction"),Re=Me!==a,Oe="compute",ke="auto",Le="manipulation",De="none",Fe="pan-x",Ne="pan-y",Be=function(){if(!Re)return!1;var e={},t=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||r.CSS.supports("touch-action",n)})),e}();function ze(e,t){this.manager=e,this.set(t)}ze.prototype={set:function(e){e==Oe&&(e=this.compute()),Re&&this.manager.element.style&&Be[e]&&(this.manager.element.style[Me]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return _(this.manager.recognizers,(function(t){E(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(P(e,De))return De;var t=P(e,Fe),n=P(e,Ne);return t&&n?De:t||n?t?Fe:Ne:P(e,Le)?Le:ke}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=P(i,De)&&!Be[De],o=P(i,Ne)&&!Be[Ne],s=P(i,Fe)&&!Be[Fe];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return r||o&&n&Y||s&&n&K?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var je=1,Ue=32;function Ve(e){this.options=l({},this.defaults,e||{}),this.id=L++,this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=je,this.simultaneous={},this.requireFail=[]}function Ge(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function $e(e){return e==Z?"down":e==X?"up":e==H?"left":e==q?"right":""}function We(e,t){var n=t.manager;return n?n.get(e):e}function He(){Ve.apply(this,arguments)}function qe(){He.apply(this,arguments),this.pX=null,this.pY=null}function Xe(){He.apply(this,arguments)}function Ze(){Ve.apply(this,arguments),this._timer=null,this._input=null}function Ye(){He.apply(this,arguments)}function Ke(){He.apply(this,arguments)}function Je(){Ve.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Qe(e,t){return(t=t||{}).recognizers=S(t.recognizers,Qe.defaults.preset),new et(e,t)}function et(e,t){this.options=l({},Qe.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new(this.options.inputClass||(N?_e:B?Ee:F?Ae:de))(this,ne),this.touchAction=new ze(this,this.options.touchAction),tt(this,!0),_(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function tt(e,t){var n,i=e.element;i.style&&(_(e.options.cssProps,(function(r,o){n=k(i.style,o),t?(e.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}Ve.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=We(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)||(e=We(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===M(t,e=We(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=We(e,this);var t=M(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function i(n){t.manager.emit(n,e)}n<8&&i(t.options.event+Ge(n)),i(t.options.event),e.additionalEvent&&i(e.additionalEvent),n>=8&&i(t.options.event+Ge(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=Ue},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ue|je)))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!E(this.options.enable,[this,t]))return this.reset(),void(this.state=Ue);56&this.state&&(this.state=je),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(He,Ve,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=6&t,r=this.attrTest(e);return i&&(n&$||!r)?16|t:i||r?n&G?8|t:2&t?4|t:2:Ue}}),x(qe,He,{defaults:{event:"pan",threshold:10,pointers:1,direction:J},getTouchAction:function(){var e=this.options.direction,t=[];return e&Y&&t.push(Ne),e&K&&t.push(Fe),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&Y?(r=0===o?W:o<0?H:q,n=o!=this.pX,i=Math.abs(e.deltaX)):(r=0===s?W:s<0?X:Z,n=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return He.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=$e(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(Xe,He,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Ze,Ve,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ke]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(G|$)&&!r)this.reset();else if(e.eventType&V)this.reset(),this._timer=m((function(){this.state=8,this.tryEmit()}),t.time,this);else if(e.eventType&G)return 8;return Ue},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&e.eventType&G?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),x(Ye,He,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[De]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(Ke,He,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Y|K,pointers:1},getTouchAction:function(){return qe.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Y|K)?t=e.overallVelocity:n&Y?t=e.overallVelocityX:n&K&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&e.eventType&G},emit:function(e){var t=$e(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Je,Ve,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Le]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,r=e.deltaTime<t.time;if(this.reset(),e.eventType&V&&0===this.count)return this.failTimeout();if(i&&r&&n){if(e.eventType!=G)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||ae(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&o?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=m((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return Ue},failTimeout:function(){return this._timer=m((function(){this.state=Ue}),this.options.interval,this),Ue},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Qe.VERSION="2.0.7",Qe.defaults={domEvents:!1,touchAction:Oe,enable:!0,inputTarget:null,inputClass:null,preset:[[Ye,{enable:!1}],[Xe,{enable:!1},["rotate"]],[Ke,{direction:Y}],[qe,{direction:Y},["swipe"]],[Je],[Je,{event:"doubletap",taps:2},["tap"]],[Ze]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},et.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var i=this.recognizers,r=t.curRecognizer;(!r||r&&8&r.state)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&14&n.state&&(r=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Ve)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=M(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==a&&t!==a){var n=this.handlers;return _(I(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==a){var n=this.handlers;return _(I(e),(function(e){t?n[e]&&n[e].splice(M(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=o.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&tt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Qe,{INPUT_START:V,INPUT_MOVE:2,INPUT_END:G,INPUT_CANCEL:$,STATE_POSSIBLE:je,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:Ue,DIRECTION_NONE:W,DIRECTION_LEFT:H,DIRECTION_RIGHT:q,DIRECTION_UP:X,DIRECTION_DOWN:Z,DIRECTION_HORIZONTAL:Y,DIRECTION_VERTICAL:K,DIRECTION_ALL:J,Manager:et,Input:te,TouchAction:ze,TouchInput:Ee,MouseInput:de,PointerEventInput:_e,TouchMouseInput:Ae,SingleTouchInput:ve,Recognizer:Ve,AttrRecognizer:He,Tap:Je,Pan:qe,Swipe:Ke,Pinch:Xe,Rotate:Ye,Press:Ze,on:T,off:A,each:_,merge:b,extend:v,assign:l,inherit:x,bindFn:w,prefixed:k}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=Qe,(i=function(){return Qe}.call(t,n,t,e))===a||(e.exports=i)}(window,document)},6626:e=>{"use strict";var t="undefined"!=typeof BigInt&&BigInt;e.exports=function(){return"function"==typeof t&&"function"==typeof BigInt&&"bigint"==typeof t(42)&&"bigint"==typeof BigInt(42)}},6900:(e,t,n)=>{"use strict";var i=n(7539),r=function(){return!!i};r.hasArrayLengthDefineBug=function(){if(!i)return null;try{return 1!==i([],"length",{value:1}).length}catch(e){return!0}},e.exports=r},9372:e=>{"use strict";var t={__proto__:null,foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!(t instanceof n)}},4923:(e,t,n)=>{"use strict";var i="undefined"!=typeof Symbol&&Symbol,r=n(4361);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4361:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},1432:(e,t,n)=>{"use strict";var i=n(4361);e.exports=function(){return i()&&!!Symbol.toStringTag}},4313:(e,t,n)=>{"use strict";var i=Function.prototype.call,r=Object.prototype.hasOwnProperty,o=n(4499);e.exports=o.call(i,r)},8347:(e,t,n)=>{"use strict";var i=n(4313),r=n(588)(),o=n(1711),s={assert:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`O` is not an object");if("string"!=typeof t)throw new o("`slot` must be a string");if(r.assert(e),!s.has(e,t))throw new o("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`O` is not an object");if("string"!=typeof t)throw new o("`slot` must be a string");var n=r.get(e);return n&&n["$"+t]},has:function(e,t){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`O` is not an object");if("string"!=typeof t)throw new o("`slot` must be a string");var n=r.get(e);return!!n&&i(n,"$"+t)},set:function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`O` is not an object");if("string"!=typeof t)throw new o("`slot` must be a string");var i=r.get(e);i||(i={},r.set(e,i)),i["$"+t]=n}};Object.freeze&&Object.freeze(s),e.exports=s},5456:(e,t,n)=>{"use strict";var i=n(1432)(),r=n(9343)("Object.prototype.toString"),o=function(e){return!(i&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===r(e)},s=function(e){return!!o(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==r(e)&&"[object Function]"===r(e.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,e.exports=a?o:s},2658:(e,t,n)=>{"use strict";var i=n(8179),r=n(9343),o=n(8897)("%ArrayBuffer%",!0),s=r("ArrayBuffer.prototype.byteLength",!0),a=r("Object.prototype.toString"),l=!!o&&!s&&new o(0).slice,c=!!l&&i(l);e.exports=s||c?function(e){if(!e||"object"!=typeof e)return!1;try{return s?s(e):c(e,0),!0}catch(e){return!1}}:o?function(e){return"[object ArrayBuffer]"===a(e)}:function(e){return!1}},8959:(e,t,n)=>{"use strict";if(n(6626)()){var i=BigInt.prototype.valueOf;e.exports=function(e){return null!=e&&"boolean"!=typeof e&&"string"!=typeof e&&"number"!=typeof e&&"symbol"!=typeof e&&"function"!=typeof e&&("bigint"==typeof e||function(e){try{return i.call(e),!0}catch(e){}return!1}(e))}}else e.exports=function(e){return!1}},8092:(e,t,n)=>{"use strict";var i=n(9343),r=i("Boolean.prototype.toString"),o=i("Object.prototype.toString"),s=n(1432)();e.exports=function(e){return"boolean"==typeof e||null!==e&&"object"==typeof e&&(s&&Symbol.toStringTag in e?function(e){try{return r(e),!0}catch(e){return!1}}(e):"[object Boolean]"===o(e))}},9916:e=>{"use strict";var t,n,i=Function.prototype.toString,r="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof r&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw n}}),n={},r((function(){throw 42}),null,t)}catch(e){e!==n&&(r=null)}else r=null;var o=/^\s*class\b/,s=function(e){try{var t=i.call(e);return o.test(t)}catch(e){return!1}},a=function(e){try{return!s(e)&&(i.call(e),!0)}catch(e){return!1}},l=Object.prototype.toString,c="function"==typeof Symbol&&!!Symbol.toStringTag,u=!(0 in[,]),h=function(){return!1};if("object"==typeof document){var d=document.all;l.call(d)===l.call(document.all)&&(h=function(e){if((u||!e)&&(void 0===e||"object"==typeof e))try{var t=l.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=r?function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{r(e,null,t)}catch(e){if(e!==n)return!1}return!s(e)&&a(e)}:function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(c)return a(e);if(s(e))return!1;var t=l.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&a(e)}},228:(e,t,n)=>{"use strict";var i=Date.prototype.getDay,r=Object.prototype.toString,o=n(1432)();e.exports=function(e){return"object"==typeof e&&null!==e&&(o?function(e){try{return i.call(e),!0}catch(e){return!1}}(e):"[object Date]"===r.call(e))}},7174:e=>{"use strict";var t,n="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;n||(t=function(e){return!1});var r=n?Map.prototype.has:null,o=i?Set.prototype.has:null;t||r||(t=function(e){return!1}),e.exports=t||function(e){if(!e||"object"!=typeof e)return!1;try{if(r.call(e),o)try{o.call(e)}catch(e){return!0}return e instanceof n}catch(e){}return!1}},4267:(e,t,n)=>{"use strict";var i=Number.prototype.toString,r=Object.prototype.toString,o=n(1432)();e.exports=function(e){return"number"==typeof e||"object"==typeof e&&(o?function(e){try{return i.call(e),!0}catch(e){return!1}}(e):"[object Number]"===r.call(e))}},7647:(e,t,n)=>{"use strict";var i,r,o,s,a=n(9343),l=n(1432)();if(l){i=a("Object.prototype.hasOwnProperty"),r=a("RegExp.prototype.exec"),o={};var c=function(){throw o};s={toString:c,valueOf:c},"symbol"==typeof Symbol.toPrimitive&&(s[Symbol.toPrimitive]=c)}var u=a("Object.prototype.toString"),h=Object.getOwnPropertyDescriptor;e.exports=l?function(e){if(!e||"object"!=typeof e)return!1;var t=h(e,"lastIndex");if(!t||!i(t,"value"))return!1;try{r(e,s)}catch(e){return e===o}}:function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&"[object RegExp]"===u(e)}},1620:e=>{"use strict";var t,n="function"==typeof Map&&Map.prototype?Map:null,i="function"==typeof Set&&Set.prototype?Set:null;i||(t=function(e){return!1});var r=n?Map.prototype.has:null,o=i?Set.prototype.has:null;t||o||(t=function(e){return!1}),e.exports=t||function(e){if(!e||"object"!=typeof e)return!1;try{if(o.call(e),r)try{r.call(e)}catch(e){return!0}return e instanceof i}catch(e){}return!1}},6050:(e,t,n)=>{"use strict";var i=n(9343)("SharedArrayBuffer.prototype.byteLength",!0);e.exports=i?function(e){if(!e||"object"!=typeof e)return!1;try{return i(e),!0}catch(e){return!1}}:function(e){return!1}},9453:(e,t,n)=>{"use strict";var i=String.prototype.valueOf,r=Object.prototype.toString,o=n(1432)();e.exports=function(e){return"string"==typeof e||"object"==typeof e&&(o?function(e){try{return i.call(e),!0}catch(e){return!1}}(e):"[object String]"===r.call(e))}},8832:(e,t,n)=>{"use strict";var i=Object.prototype.toString;if(n(4923)()){var r=Symbol.prototype.toString,o=/^Symbol\(.*\)$/;e.exports=function(e){if("symbol"==typeof e)return!0;if("[object Symbol]"!==i.call(e))return!1;try{return function(e){return"symbol"==typeof e.valueOf()&&o.test(r.call(e))}(e)}catch(e){return!1}}}else e.exports=function(e){return!1}},8014:e=>{"use strict";var t,n="function"==typeof WeakMap&&WeakMap.prototype?WeakMap:null,i="function"==typeof WeakSet&&WeakSet.prototype?WeakSet:null;n||(t=function(e){return!1});var r=n?n.prototype.has:null,o=i?i.prototype.has:null;t||r||(t=function(e){return!1}),e.exports=t||function(e){if(!e||"object"!=typeof e)return!1;try{if(r.call(e,r),o)try{o.call(e,o)}catch(e){return!0}return e instanceof n}catch(e){}return!1}},5692:(e,t,n)=>{"use strict";var i=n(8897),r=n(9343),o=i("%WeakSet%",!0),s=r("WeakSet.prototype.has",!0);if(s){var a=r("WeakMap.prototype.has",!0);e.exports=function(e){if(!e||"object"!=typeof e)return!1;try{if(s(e,s),a)try{a(e,a)}catch(e){return!0}return e instanceof o}catch(e){}return!1}}else e.exports=function(e){return!1}},8527:(e,t,n)=>{var i="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,o=i&&r&&"function"==typeof r.get?r.get:null,s=i&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,g=Function.prototype.toString,_=String.prototype.match,y=String.prototype.slice,v=String.prototype.replace,b=String.prototype.toUpperCase,x=String.prototype.toLowerCase,w=RegExp.prototype.test,E=Array.prototype.concat,S=Array.prototype.join,T=Array.prototype.slice,A=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,P=Object.getOwnPropertySymbols,I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,M="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,O=Object.prototype.propertyIsEnumerable,k=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function L(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||w.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var i=e<0?-A(-e):A(e);if(i!==e){var r=String(i),o=y.call(t,r.length+1);return v.call(r,n,"$&_")+"."+v.call(v.call(o,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,n,"$&_")}var D=n(3966),F=D.custom,N=V(F)?F:null;function B(e,t,n){var i="double"===(n.quoteStyle||t)?'"':"'";return i+e+i}function z(e){return v.call(String(e),/"/g,"&quot;")}function j(e){return!("[object Array]"!==W(e)||R&&"object"==typeof e&&R in e)}function U(e){return!("[object RegExp]"!==W(e)||R&&"object"==typeof e&&R in e)}function V(e){if(M)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!I)return!1;try{return I.call(e),!0}catch(e){}return!1}e.exports=function e(t,i,r,a){var l=i||{};if($(l,"quoteStyle")&&"single"!==l.quoteStyle&&"double"!==l.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if($(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!$(l,"customInspect")||l.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if($(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if($(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var b=l.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return q(t,l);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var w=String(t);return b?L(t,w):w}if("bigint"==typeof t){var A=String(t)+"n";return b?L(t,A):A}var P=void 0===l.depth?5:l.depth;if(void 0===r&&(r=0),r>=P&&P>0&&"object"==typeof t)return j(t)?"[Array]":"[Object]";var F,G=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=S.call(Array(e.indent+1)," ")}return{base:n,prev:S.call(Array(t+1),n)}}(l,r);if(void 0===a)a=[];else if(H(a,t)>=0)return"[Circular]";function X(t,n,i){if(n&&(a=T.call(a)).push(n),i){var o={depth:l.depth};return $(l,"quoteStyle")&&(o.quoteStyle=l.quoteStyle),e(t,o,r+1,a)}return e(t,l,r+1,a)}if("function"==typeof t&&!U(t)){var ee=function(e){if(e.name)return e.name;var t=_.call(g.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=Q(t,X);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+S.call(te,", ")+" }":"")}if(V(t)){var ne=M?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!=typeof t||M?ne:Z(ne)}if((F=t)&&"object"==typeof F&&("undefined"!=typeof HTMLElement&&F instanceof HTMLElement||"string"==typeof F.nodeName&&"function"==typeof F.getAttribute)){for(var ie="<"+x.call(String(t.nodeName)),re=t.attributes||[],oe=0;oe<re.length;oe++)ie+=" "+re[oe].name+"="+B(z(re[oe].value),"double",l);return ie+=">",t.childNodes&&t.childNodes.length&&(ie+="..."),ie+"</"+x.call(String(t.nodeName))+">"}if(j(t)){if(0===t.length)return"[]";var se=Q(t,X);return G&&!function(e){for(var t=0;t<e.length;t++)if(H(e[t],"\n")>=0)return!1;return!0}(se)?"["+J(se,G)+"]":"[ "+S.call(se,", ")+" ]"}if(function(e){return!("[object Error]"!==W(e)||R&&"object"==typeof e&&R in e)}(t)){var ae=Q(t,X);return"cause"in Error.prototype||!("cause"in t)||O.call(t,"cause")?0===ae.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(ae,", ")+" }":"{ ["+String(t)+"] "+S.call(E.call("[cause]: "+X(t.cause),ae),", ")+" }"}if("object"==typeof t&&m){if(N&&"function"==typeof t[N]&&D)return D(t,{depth:P-r});if("symbol"!==m&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!o||!e||"object"!=typeof e)return!1;try{o.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var le=[];return s&&s.call(t,(function(e,n){le.push(X(n,t,!0)+" => "+X(e,t))})),K("Map",o.call(t),le,G)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{o.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ce=[];return u&&u.call(t,(function(e){ce.push(X(e,t))})),K("Set",c.call(t),ce,G)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return Y("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return Y("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return Y("WeakRef");if(function(e){return!("[object Number]"!==W(e)||R&&"object"==typeof e&&R in e)}(t))return Z(X(Number(t)));if(function(e){if(!e||"object"!=typeof e||!C)return!1;try{return C.call(e),!0}catch(e){}return!1}(t))return Z(X(C.call(t)));if(function(e){return!("[object Boolean]"!==W(e)||R&&"object"==typeof e&&R in e)}(t))return Z(f.call(t));if(function(e){return!("[object String]"!==W(e)||R&&"object"==typeof e&&R in e)}(t))return Z(X(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===n.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==W(e)||R&&"object"==typeof e&&R in e)}(t)&&!U(t)){var ue=Q(t,X),he=k?k(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",pe=!he&&R&&Object(t)===t&&R in t?y.call(W(t),8,-1):de?"Object":"",fe=(he||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||de?"["+S.call(E.call([],pe||[],de||[]),": ")+"] ":"");return 0===ue.length?fe+"{}":G?fe+"{"+J(ue,G)+"}":fe+"{ "+S.call(ue,", ")+" }"}return String(t)};var G=Object.prototype.hasOwnProperty||function(e){return e in this};function $(e,t){return G.call(e,t)}function W(e){return m.call(e)}function H(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function q(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,i="... "+n+" more character"+(n>1?"s":"");return q(y.call(e,0,t.maxStringLength),t)+i}return B(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,X),"single",t)}function X(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+b.call(t.toString(16))}function Z(e){return"Object("+e+")"}function Y(e){return e+" { ? }"}function K(e,t,n,i){return e+" ("+t+") {"+(i?J(n,i):S.call(n,", "))+"}"}function J(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+S.call(e,","+n)+"\n"+t.prev}function Q(e,t){var n=j(e),i=[];if(n){i.length=e.length;for(var r=0;r<e.length;r++)i[r]=$(e,r)?t(e[r],e):""}var o,s="function"==typeof P?P(e):[];if(M){o={};for(var a=0;a<s.length;a++)o["$"+s[a]]=s[a]}for(var l in e)$(e,l)&&(n&&String(Number(l))===l&&l<e.length||M&&o["$"+l]instanceof Symbol||(w.call(/[^\w$]/,l)?i.push(t(l,e)+": "+t(e[l],e)):i.push(l+": "+t(e[l],e))));if("function"==typeof P)for(var c=0;c<s.length;c++)O.call(e,s[c])&&i.push("["+t(s[c])+"]: "+t(e[s[c]],e));return i}},6223:e=>{"use strict";var t=function(e){return e!=e};e.exports=function(e,n){return 0===e&&0===n?1/e==1/n:e===n||!(!t(e)||!t(n))}},9513:(e,t,n)=>{"use strict";var i=n(5144),r=n(8179),o=n(6223),s=n(3809),a=n(2700),l=r(s(),Object);i(l,{getPolyfill:s,implementation:o,shim:a}),e.exports=l},3809:(e,t,n)=>{"use strict";var i=n(6223);e.exports=function(){return"function"==typeof Object.is?Object.is:i}},2700:(e,t,n)=>{"use strict";var i=n(3809),r=n(5144);e.exports=function(){var e=i();return r(Object,{is:e},{is:function(){return Object.is!==e}}),e}},1895:(e,t,n)=>{"use strict";var i;if(!Object.keys){var r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,s=n(8825),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!d["$"+e]&&r.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();i=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===o.call(e),i=s(e),a=t&&"[object String]"===o.call(e),d=[];if(!t&&!n&&!i)throw new TypeError("Object.keys called on a non-object");var f=c&&n;if(a&&e.length>0&&!r.call(e,0))for(var m=0;m<e.length;++m)d.push(String(m));if(i&&e.length>0)for(var g=0;g<e.length;++g)d.push(String(g));else for(var _ in e)f&&"prototype"===_||!r.call(e,_)||d.push(String(_));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return h(e);try{return h(e)}catch(e){return!1}}(e),v=0;v<u.length;++v)y&&"constructor"===u[v]||!r.call(e,u[v])||d.push(u[v]);return d}}e.exports=i},3425:(e,t,n)=>{"use strict";var i=Array.prototype.slice,r=n(8825),o=Object.keys,s=o?function(e){return o(e)}:n(1895),a=Object.keys;s.shim=function(){if(Object.keys){var e=function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2);e||(Object.keys=function(e){return r(e)?a(i.call(e)):a(e)})}else Object.keys=s;return Object.keys||s},e.exports=s},8825:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var n=t.call(e),i="[object Arguments]"===n;return i||(i="[object Array]"!==n&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),i}},8599:(e,t,n)=>{"use strict";var i=n(3425),r=n(4361)(),o=n(9343),s=Object,a=o("Array.prototype.push"),l=o("Object.prototype.propertyIsEnumerable"),c=r?Object.getOwnPropertySymbols:null;e.exports=function(e,t){if(null==e)throw new TypeError("target must be an object");var n=s(e);if(1===arguments.length)return n;for(var o=1;o<arguments.length;++o){var u=s(arguments[o]),h=i(u),d=r&&(Object.getOwnPropertySymbols||c);if(d)for(var p=d(u),f=0;f<p.length;++f){var m=p[f];l(u,m)&&a(h,m)}for(var g=0;g<h.length;++g){var _=h[g];if(l(u,_)){var y=u[_];n[_]=y}}}return n}},7745:(e,t,n)=>{"use strict";var i=n(5144),r=n(8179),o=n(8599),s=n(8662),a=n(3700),l=r.apply(s()),c=function(e,t){return l(Object,arguments)};i(c,{getPolyfill:s,implementation:o,shim:a}),e.exports=c},8662:(e,t,n)=>{"use strict";var i=n(8599);e.exports=function(){return Object.assign?function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),n={},i=0;i<t.length;++i)n[t[i]]=t[i];var r=Object.assign({},n),o="";for(var s in r)o+=s;return e!==o}()||function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return"y"===e[1]}return!1}()?i:Object.assign:i}},3700:(e,t,n)=>{"use strict";var i=n(5144),r=n(8662);e.exports=function(){var e=r();return i(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e}},5021:e=>{e.exports=function(e,t,n,i){var r=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=t.length);for(var a=(i-n)/2,l=0,c=a-1;l<a;c=l++){var u=t[n+2*l+0],h=t[n+2*l+1],d=t[n+2*c+0],p=t[n+2*c+1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},4440:(e,t,n)=>{var i=n(5021),r=n(4141);e.exports=function(e,t,n,o){return t.length>0&&Array.isArray(t[0])?r(e,t,n,o):i(e,t,n,o)},e.exports.nested=r,e.exports.flat=i},4141:e=>{e.exports=function(e,t,n,i){var r=e[0],o=e[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=t.length);for(var a=i-n,l=0,c=a-1;l<a;c=l++){var u=t[l+n][0],h=t[l+n][1],d=t[c+n][0],p=t[c+n][1];h>o!=p>o&&r<(d-u)*(o-h)/(p-h)+u&&(s=!s)}return s}},6350:e=>{"use strict";e.exports=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]},6481:function(e){e.exports=function(){"use strict";function e(e,i,r,o,s){!function e(n,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,l=i-r+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);e(n,i,Math.max(r,Math.floor(i-l*u/a+h)),Math.min(o,Math.floor(i+(a-l)*u/a+h)),s)}var d=n[i],p=r,f=o;for(t(n,r,i),s(n[o],d)>0&&t(n,r,o);p<f;){for(t(n,p,f),p++,f--;s(n[p],d)<0;)p++;for(;s(n[f],d)>0;)f--}0===s(n[r],d)?t(n,r,f):t(n,++f,o),f<=i&&(r=f+1),i<=f&&(o=f-1)}}(e,i,r||0,o||e.length-1,s||n)}function t(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function n(e,t){return e<t?-1:e>t?1:0}var i=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(e,t,n){if(!n)return t.indexOf(e);for(var i=0;i<t.length;i++)if(n(e,t[i]))return i;return-1}function o(e,t){s(e,0,e.children.length,t,e)}function s(e,t,n,i,r){r||(r=f(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o=t;o<n;o++){var s=e.children[o];a(r,e.leaf?i(s):s)}return r}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function u(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function p(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function m(t,n,i,r,o){for(var s=[n,i];s.length;)if(!((i=s.pop())-(n=s.pop())<=r)){var a=n+Math.ceil((i-n)/r/2)*r;e(t,a,n,i,o),s.push(n,a,a,i)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(e){var t=this.data,n=[];if(!p(e,t))return n;for(var i=this.toBBox,r=[];t;){for(var o=0;o<t.children.length;o++){var s=t.children[o],a=t.leaf?i(s):s;p(e,a)&&(t.leaf?n.push(s):d(e,a)?this._all(s,n):r.push(s))}t=r.pop()}return n},i.prototype.collides=function(e){var t=this.data;if(!p(e,t))return!1;for(var n=[];t;){for(var i=0;i<t.children.length;i++){var r=t.children[i],o=t.leaf?this.toBBox(r):r;if(p(e,o)){if(t.leaf||d(e,o))return!0;n.push(r)}}t=n.pop()}return!1},i.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var i=this.data;this.data=n,n=i}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},i.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},i.prototype.clear=function(){return this.data=f([]),this},i.prototype.remove=function(e,t){if(!e)return this;for(var n,i,o,s=this.data,a=this.toBBox(e),l=[],c=[];s||l.length;){if(s||(s=l.pop(),i=l[l.length-1],n=c.pop(),o=!0),s.leaf){var u=r(e,s.children,t);if(-1!==u)return s.children.splice(u,1),l.push(s),this._condense(l),this}o||s.leaf||!d(s,a)?i?(n++,s=i.children[n],o=!1):s=null:(l.push(s),c.push(n),n=0,i=s,s=s.children[0])}return this},i.prototype.toBBox=function(e){return e},i.prototype.compareMinX=function(e,t){return e.minX-t.minX},i.prototype.compareMinY=function(e,t){return e.minY-t.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(e){return this.data=e,this},i.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},i.prototype._build=function(e,t,n,i){var r,s=n-t+1,a=this._maxEntries;if(s<=a)return o(r=f(e.slice(t,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,i-1))),(r=f([])).leaf=!1,r.height=i;var l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(e,t,n,c,this.compareMinX);for(var u=t;u<=n;u+=c){var h=Math.min(u+c-1,n);m(e,u,h,l,this.compareMinY);for(var d=u;d<=h;d+=l){var p=Math.min(d+l-1,h);r.children.push(this._build(e,d,p,i-1))}}return o(r,this.toBBox),r},i.prototype._chooseSubtree=function(e,t,n,i){for(;i.push(t),!t.leaf&&i.length-1!==n;){for(var r=1/0,o=1/0,s=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=u(l),h=(d=e,p=l,(Math.max(p.maxX,d.maxX)-Math.min(p.minX,d.minX))*(Math.max(p.maxY,d.maxY)-Math.min(p.minY,d.minY))-c);h<o?(o=h,r=c<r?c:r,s=l):h===o&&c<r&&(r=c,s=l)}t=s||t.children[0]}var d,p;return t},i.prototype._insert=function(e,t,n){var i=n?e:this.toBBox(e),r=[],o=this._chooseSubtree(i,this.data,t,r);for(o.children.push(e),a(o,i);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(i,r,t)},i.prototype._split=function(e,t){var n=e[t],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var s=this._chooseSplitIndex(n,r,i),a=f(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,o(n,this.toBBox),o(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)},i.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(e,t,n){for(var i,r,o,a,l,c,h,d=1/0,p=1/0,f=t;f<=n-t;f++){var m=s(e,0,f,this.toBBox),g=s(e,f,n,this.toBBox),_=(r=m,o=g,void 0,void 0,void 0,void 0,a=Math.max(r.minX,o.minX),l=Math.max(r.minY,o.minY),c=Math.min(r.maxX,o.maxX),h=Math.min(r.maxY,o.maxY),Math.max(0,c-a)*Math.max(0,h-l)),y=u(m)+u(g);_<d?(d=_,i=f,p=y<p?y:p):_===d&&y<p&&(p=y,i=f)}return i||n-t},i.prototype._chooseSplitAxis=function(e,t,n){var i=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,n,i)<this._allDistMargin(e,t,n,r)&&e.children.sort(i)},i.prototype._allDistMargin=function(e,t,n,i){e.children.sort(i);for(var r=this.toBBox,o=s(e,0,t,r),l=s(e,n-t,n,r),c=h(o)+h(l),u=t;u<n-t;u++){var d=e.children[u];a(o,e.leaf?r(d):d),c+=h(o)}for(var p=n-t-1;p>=t;p--){var f=e.children[p];a(l,e.leaf?r(f):f),c+=h(l)}return c},i.prototype._adjustParentBBoxes=function(e,t,n){for(var i=n;i>=0;i--)a(t[i],e)},i.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():o(e[t],this.toBBox)},i}()},3516:(e,t,n)=>{"use strict";function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.CopyToClipboard=void 0;var r=a(n(5959)),o=a(n(5489)),s=["text","onCopy","options","children"];function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}(g,e);var t,n,a,l,m=(a=g,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(a);if(l){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,e)});function g(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return f(d(e=m.call.apply(m,[this].concat(n))),"onClick",(function(t){var n=e.props,i=n.text,s=n.onCopy,a=n.children,l=n.options,c=r.default.Children.only(a),u=(0,o.default)(i,l);s&&s(i,u),c&&c.props&&"function"==typeof c.props.onClick&&c.props.onClick(t)})),e}return t=g,(n=[{key:"render",value:function(){var e=this.props,t=(e.text,e.onCopy,e.options,e.children),n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,s),i=r.default.Children.only(t);return r.default.cloneElement(i,c(c({},n),{},{onClick:this.onClick}))}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),g}(r.default.PureComponent);t.CopyToClipboard=m,f(m,"defaultProps",{onCopy:void 0,options:void 0})},5731:(e,t,n)=>{"use strict";var i=n(3516).CopyToClipboard;i.CopyToClipboard=i,e.exports=i},2341:(e,t,n)=>{e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=(i=n(2))&&i.__esModule?i:{default:i};t.default=r.default,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function r(e){return e&&e.__esModule?e:{default:e}}t.default=c;var o=n(3),s=r(n(4)),a=n(14),l=r(n(15));function c(e){var t=e.activeClassName,n=void 0===t?"":t,r=e.activeIndex,s=void 0===r?-1:r,c=e.activeStyle,u=e.autoEscape,h=e.caseSensitive,d=void 0!==h&&h,p=e.className,f=e.findChunks,m=e.highlightClassName,g=void 0===m?"":m,_=e.highlightStyle,y=void 0===_?{}:_,v=e.highlightTag,b=void 0===v?"mark":v,x=e.sanitize,w=e.searchWords,E=e.textToHighlight,S=e.unhighlightTag,T=void 0===S?"span":S,A=e.unhighlightClassName,C=void 0===A?"":A,P=e.unhighlightStyle,I=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["activeClassName","activeIndex","activeStyle","autoEscape","caseSensitive","className","findChunks","highlightClassName","highlightStyle","highlightTag","sanitize","searchWords","textToHighlight","unhighlightTag","unhighlightClassName","unhighlightStyle"]),M=(0,o.findAll)({autoEscape:u,caseSensitive:d,findChunks:f,sanitize:x,searchWords:w,textToHighlight:E}),R=b,O=-1,k="",L=void 0,D=(0,l.default)((function(e){var t={};for(var n in e)t[n.toLowerCase()]=e[n];return t}));return(0,a.createElement)("span",i({className:p},I,{children:M.map((function(e,t){var i=E.substr(e.start,e.end-e.start);if(e.highlight){O++;var r;r="object"==typeof g?d?g[i]:(g=D(g))[i.toLowerCase()]:g;var o=O===+s;k=r+" "+(o?n:""),L=!0===o&&null!=c?Object.assign({},y,c):y;var l={children:i,className:k,key:t,style:L};return"string"!=typeof R&&(l.highlightIndex=O),(0,a.createElement)(R,l)}return(0,a.createElement)(T,{children:i,className:C,key:t,style:P})}))}))}c.propTypes={activeClassName:s.default.string,activeIndex:s.default.number,activeStyle:s.default.object,autoEscape:s.default.bool,className:s.default.string,findChunks:s.default.func,highlightClassName:s.default.oneOfType([s.default.object,s.default.string]),highlightStyle:s.default.object,highlightTag:s.default.oneOfType([s.default.node,s.default.func,s.default.string]),sanitize:s.default.func,searchWords:s.default.arrayOf(s.default.oneOfType([s.default.string,s.default.instanceOf(RegExp)])).isRequired,textToHighlight:s.default.string.isRequired,unhighlightTag:s.default.oneOfType([s.default.node,s.default.func,s.default.string]),unhighlightClassName:s.default.string,unhighlightStyle:s.default.object},e.exports=t.default},function(e,t){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2);Object.defineProperty(t,"combineChunks",{enumerable:!0,get:function(){return i.combineChunks}}),Object.defineProperty(t,"fillInChunks",{enumerable:!0,get:function(){return i.fillInChunks}}),Object.defineProperty(t,"findAll",{enumerable:!0,get:function(){return i.findAll}}),Object.defineProperty(t,"findChunks",{enumerable:!0,get:function(){return i.findChunks}})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findAll=function(e){var t=e.autoEscape,o=e.caseSensitive,s=void 0!==o&&o,a=e.findChunks,l=void 0===a?i:a,c=e.sanitize,u=e.searchWords,h=e.textToHighlight;return r({chunksToHighlight:n({chunks:l({autoEscape:t,caseSensitive:s,sanitize:c,searchWords:u,textToHighlight:h})}),totalLength:h?h.length:0})};var n=t.combineChunks=function(e){var t=e.chunks;return t.sort((function(e,t){return e.start-t.start})).reduce((function(e,t){if(0===e.length)return[t];var n=e.pop();if(t.start<=n.end){var i=Math.max(n.end,t.end);e.push({start:n.start,end:i})}else e.push(n,t);return e}),[])},i=function(e){var t=e.autoEscape,n=e.caseSensitive,i=e.sanitize,r=void 0===i?o:i,s=e.searchWords,a=e.textToHighlight;return a=r(a),s.filter((function(e){return e})).reduce((function(e,i){i=r(i),t&&(i=i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"));for(var o=new RegExp(i,n?"g":"gi"),s=void 0;s=o.exec(a);){var l=s.index,c=o.lastIndex;c>l&&e.push({start:l,end:c}),s.index==o.lastIndex&&o.lastIndex++}return e}),[])};t.findChunks=i;var r=t.fillInChunks=function(e){var t=e.chunksToHighlight,n=e.totalLength,i=[],r=function(e,t,n){t-e>0&&i.push({start:e,end:t,highlight:n})};if(0===t.length)r(0,n,!1);else{var o=0;t.forEach((function(e){r(o,e.start,!1),r(e.start,e.end,!0),o=e.end})),r(o,n,!1)}return i};function o(e){return e}}])},function(e,t,n){(function(t){if("production"!==t.env.NODE_ENV){var i="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=n(6)((function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}),!0)}else e.exports=n(13)()}).call(t,n(5))},function(e,t){var n,i,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,c=[],u=!1,h=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&p())}function p(){if(!u){var e=a(d);u=!0;for(var t=c.length;t;){for(l=c,c=[];++h<t;)l&&l[h].run();h=-1,t=c.length}l=null,u=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){(function(t){"use strict";var i=n(7),r=n(8),o=n(9),s=n(10),a=n(11),l=n(12);e.exports=function(e,n){var c="function"==typeof Symbol&&Symbol.iterator,u="<<anonymous>>",h={array:f("array"),bool:f("boolean"),func:f("function"),number:f("number"),object:f("object"),string:f("string"),symbol:f("symbol"),any:p(i.thatReturnsNull),arrayOf:function(e){return p((function(t,n,i,r,o){if("function"!=typeof e)return new d("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside arrayOf.");var s=t[n];if(!Array.isArray(s))return new d("Invalid "+r+" `"+o+"` of type `"+g(s)+"` supplied to `"+i+"`, expected an array.");for(var l=0;l<s.length;l++){var c=e(s,l,i,r,o+"["+l+"]",a);if(c instanceof Error)return c}return null}))},element:p((function(t,n,i,r,o){var s=t[n];return e(s)?null:new d("Invalid "+r+" `"+o+"` of type `"+g(s)+"` supplied to `"+i+"`, expected a single ReactElement.")})),instanceOf:function(e){return p((function(t,n,i,r,o){if(!(t[n]instanceof e)){var s=e.name||u;return new d("Invalid "+r+" `"+o+"` of type `"+((a=t[n]).constructor&&a.constructor.name?a.constructor.name:u)+"` supplied to `"+i+"`, expected instance of `"+s+"`.")}var a;return null}))},node:p((function(e,t,n,i,r){return m(e[t])?null:new d("Invalid "+i+" `"+r+"` supplied to `"+n+"`, expected a ReactNode.")})),objectOf:function(e){return p((function(t,n,i,r,o){if("function"!=typeof e)return new d("Property `"+o+"` of component `"+i+"` has invalid PropType notation inside objectOf.");var s=t[n],l=g(s);if("object"!==l)return new d("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected an object.");for(var c in s)if(s.hasOwnProperty(c)){var u=e(s,c,i,r,o+"."+c,a);if(u instanceof Error)return u}return null}))},oneOf:function(e){return Array.isArray(e)?p((function(t,n,i,r,o){for(var s=t[n],a=0;a<e.length;a++)if(l=s,c=e[a],l===c?0!==l||1/l==1/c:l!=l&&c!=c)return null;var l,c;return new d("Invalid "+r+" `"+o+"` of value `"+s+"` supplied to `"+i+"`, expected one of "+JSON.stringify(e)+".")})):("production"!==t.env.NODE_ENV&&o(!1,"Invalid argument supplied to oneOf, expected an instance of array."),i.thatReturnsNull)},oneOfType:function(e){if(!Array.isArray(e))return"production"!==t.env.NODE_ENV&&o(!1,"Invalid argument supplied to oneOfType, expected an instance of array."),i.thatReturnsNull;for(var n=0;n<e.length;n++){var r=e[n];if("function"!=typeof r)return o(!1,"Invalid argument supplied to oneOfType. Expected an array of check functions, but received %s at index %s.",y(r),n),i.thatReturnsNull}return p((function(t,n,i,r,o){for(var s=0;s<e.length;s++)if(null==(0,e[s])(t,n,i,r,o,a))return null;return new d("Invalid "+r+" `"+o+"` supplied to `"+i+"`.")}))},shape:function(e){return p((function(t,n,i,r,o){var s=t[n],l=g(s);if("object"!==l)return new d("Invalid "+r+" `"+o+"` of type `"+l+"` supplied to `"+i+"`, expected `object`.");for(var c in e){var u=e[c];if(u){var h=u(s,c,i,r,o+"."+c,a);if(h)return h}}return null}))},exact:function(e){return p((function(t,n,i,r,o){var l=t[n],c=g(l);if("object"!==c)return new d("Invalid "+r+" `"+o+"` of type `"+c+"` supplied to `"+i+"`, expected `object`.");var u=s({},t[n],e);for(var h in u){var p=e[h];if(!p)return new d("Invalid "+r+" `"+o+"` key `"+h+"` supplied to `"+i+"`.\nBad object: "+JSON.stringify(t[n],null,"  ")+"\nValid keys: "+JSON.stringify(Object.keys(e),null,"  "));var f=p(l,h,i,r,o+"."+h,a);if(f)return f}return null}))}};function d(e){this.message=e,this.stack=""}function p(e){if("production"!==t.env.NODE_ENV)var i={},s=0;function l(l,c,h,p,f,m,g){if(p=p||u,m=m||h,g!==a)if(n)r(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else if("production"!==t.env.NODE_ENV&&"undefined"!=typeof console){var _=p+":"+h;!i[_]&&s<3&&(o(!1,"You are manually calling a React.PropTypes validation function for the `%s` prop on `%s`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details.",m,p),i[_]=!0,s++)}return null==c[h]?l?null===c[h]?new d("The "+f+" `"+m+"` is marked as required in `"+p+"`, but its value is `null`."):new d("The "+f+" `"+m+"` is marked as required in `"+p+"`, but its value is `undefined`."):null:e(c,h,p,f,m)}var c=l.bind(null,!1);return c.isRequired=l.bind(null,!0),c}function f(e){return p((function(t,n,i,r,o,s){var a=t[n];return g(a)!==e?new d("Invalid "+r+" `"+o+"` of type `"+_(a)+"` supplied to `"+i+"`, expected `"+e+"`."):null}))}function m(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(m);if(null===t||e(t))return!0;var n=function(e){var t=e&&(c&&e[c]||e["@@iterator"]);if("function"==typeof t)return t}(t);if(!n)return!1;var i,r=n.call(t);if(n!==t.entries){for(;!(i=r.next()).done;)if(!m(i.value))return!1}else for(;!(i=r.next()).done;){var o=i.value;if(o&&!m(o[1]))return!1}return!0;default:return!1}}function g(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function _(e){if(null==e)return""+e;var t=g(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function y(e){var t=_(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}return d.prototype=Error.prototype,h.checkPropTypes=l,h.PropTypes=h,h}}).call(t,n(5))},function(e,t){"use strict";function n(e){return function(){return e}}var i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},function(e,t,n){(function(t){"use strict";var n=function(e){};"production"!==t.env.NODE_ENV&&(n=function(e){if(void 0===e)throw new Error("invariant requires an error message argument")}),e.exports=function(e,t,i,r,o,s,a,l){if(n(t),!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[i,r,o,s,a,l],h=0;(c=new Error(t.replace(/%s/g,(function(){return u[h++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}}).call(t,n(5))},function(e,t,n){(function(t){"use strict";var i=n(7);if("production"!==t.env.NODE_ENV){var r=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=0,o="Warning: "+e.replace(/%s/g,(function(){return n[r++]}));"undefined"!=typeof console&&console.error(o);try{throw new Error(o)}catch(e){}};i=function(e,t){if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){for(var n=arguments.length,i=Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];r.apply(void 0,[t].concat(i))}}}e.exports=i}).call(t,n(5))},function(e,t){"use strict";var n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var o,s,a=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var c in o=Object(arguments[l]))i.call(o,c)&&(a[c]=o[c]);if(n){s=n(o);for(var u=0;u<s.length;u++)r.call(o,s[u])&&(a[s[u]]=o[s[u]])}}return a}},function(e,t){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){(function(t){"use strict";if("production"!==t.env.NODE_ENV)var i=n(8),r=n(9),o=n(11),s={};e.exports=function(e,n,a,l,c){if("production"!==t.env.NODE_ENV)for(var u in e)if(e.hasOwnProperty(u)){var h;try{i("function"==typeof e[u],"%s: %s type `%s` is invalid; it must be a function, usually from the `prop-types` package, but received `%s`.",l||"React class",a,u,typeof e[u]),h=e[u](n,u,l,a,null,o)}catch(e){h=e}if(r(!h||h instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",l||"React class",a,u,typeof h),h instanceof Error&&!(h.message in s)){s[h.message]=!0;var d=c?c():"";r(!1,"Failed %s type: %s%s",a,h.message,null!=d?d:"")}}}}).call(t,n(5))},function(e,t,n){"use strict";var i=n(7),r=n(8),o=n(11);e.exports=function(){function e(e,t,n,i,s,a){a!==o&&r(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=i,n.PropTypes=n,n}},function(e,t){e.exports=n(5959)},function(e,t){"use strict";var n=function(e,t){return e===t};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,i=void 0,r=[],o=void 0,s=!1,a=function(e,n){return t(e,r[n])};return function(){for(var t=arguments.length,n=Array(t),l=0;l<t;l++)n[l]=arguments[l];return s&&i===this&&n.length===r.length&&n.every(a)?o:(s=!0,i=this,r=n,o=e.apply(this,n))}}}])},2192:(e,t,n)=>{"use strict";var i=n(5959),r=Symbol.for("react.element"),o=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,n){var i,l={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!a.hasOwnProperty(i)&&(l[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===l[i]&&(l[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:l,_owner:s.current}}},2540:(e,t,n)=>{"use strict";e.exports=n(2192)},4207:(e,t,n)=>{"use strict";var i=n(3426),r=n(1711),o=Object;e.exports=i((function(){if(null==this||this!==o(this))throw new r("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e}),"get flags",!0)},9353:(e,t,n)=>{"use strict";var i=n(5144),r=n(8179),o=n(4207),s=n(2318),a=n(2156),l=r(s());i(l,{getPolyfill:s,implementation:o,shim:a}),e.exports=l},2318:(e,t,n)=>{"use strict";var i=n(4207),r=n(5144).supportsDescriptors,o=Object.getOwnPropertyDescriptor;e.exports=function(){if(r&&"gim"===/a/gim.flags){var e=o(RegExp.prototype,"flags");if(e&&"function"==typeof e.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),"dy"===t)return e.get}}return i}},2156:(e,t,n)=>{"use strict";var i=n(5144).supportsDescriptors,r=n(2318),o=Object.getOwnPropertyDescriptor,s=Object.defineProperty,a=TypeError,l=Object.getPrototypeOf,c=/a/;e.exports=function(){if(!i||!l)throw new a("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=r(),t=l(c),n=o(t,"flags");return n&&n.get===e||s(t,"flags",{configurable:!0,enumerable:!1,get:e}),e}},1247:function(e,t){!function(e){"use strict";const t=134217729;function n(e,t,n,i,r){let o,s,a,l,c=t[0],u=i[0],h=0,d=0;u>c==u>-c?(o=c,c=t[++h]):(o=u,u=i[++d]);let p=0;if(h<e&&d<n)for(u>c==u>-c?(a=o-((s=c+o)-c),c=t[++h]):(a=o-((s=u+o)-u),u=i[++d]),o=s,0!==a&&(r[p++]=a);h<e&&d<n;)u>c==u>-c?(a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h]):(a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d]),o=s,0!==a&&(r[p++]=a);for(;h<e;)a=o-((s=o+c)-(l=s-o))+(c-l),c=t[++h],o=s,0!==a&&(r[p++]=a);for(;d<n;)a=o-((s=o+u)-(l=s-o))+(u-l),u=i[++d],o=s,0!==a&&(r[p++]=a);return 0===o&&0!==p||(r[p++]=o),p}function i(e){return new Float64Array(e)}const r=i(4),o=i(8),s=i(12),a=i(16),l=i(4);e.orient2d=function(e,i,c,u,h,d){const p=(i-d)*(c-h),f=(e-h)*(u-d),m=p-f;if(0===p||0===f||p>0!=f>0)return m;const g=Math.abs(p+f);return Math.abs(m)>=33306690738754716e-32*g?m:-function(e,i,c,u,h,d,p){let f,m,g,_,y,v,b,x,w,E,S,T,A,C,P,I,M,R;const O=e-h,k=c-h,L=i-d,D=u-d;y=(P=(x=O-(b=(v=t*O)-(v-O)))*(E=D-(w=(v=t*D)-(v-D)))-((C=O*D)-b*w-x*w-b*E))-(S=P-(M=(x=L-(b=(v=t*L)-(v-L)))*(E=k-(w=(v=t*k)-(v-k)))-((I=L*k)-b*w-x*w-b*E))),r[0]=P-(S+y)+(y-M),y=(A=C-((T=C+S)-(y=T-C))+(S-y))-(S=A-I),r[1]=A-(S+y)+(y-I),y=(R=T+S)-T,r[2]=T-(R-y)+(S-y),r[3]=R;let F=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,r),N=22204460492503146e-32*p;if(F>=N||-F>=N)return F;if(f=e-(O+(y=e-O))+(y-h),g=c-(k+(y=c-k))+(y-h),m=i-(L+(y=i-L))+(y-d),_=u-(D+(y=u-D))+(y-d),0===f&&0===m&&0===g&&0===_)return F;if(N=11093356479670487e-47*p+33306690738754706e-32*Math.abs(F),(F+=O*_+D*f-(L*g+k*m))>=N||-F>=N)return F;y=(P=(x=f-(b=(v=t*f)-(v-f)))*(E=D-(w=(v=t*D)-(v-D)))-((C=f*D)-b*w-x*w-b*E))-(S=P-(M=(x=m-(b=(v=t*m)-(v-m)))*(E=k-(w=(v=t*k)-(v-k)))-((I=m*k)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(A=C-((T=C+S)-(y=T-C))+(S-y))-(S=A-I),l[1]=A-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const B=n(4,r,4,l,o);y=(P=(x=O-(b=(v=t*O)-(v-O)))*(E=_-(w=(v=t*_)-(v-_)))-((C=O*_)-b*w-x*w-b*E))-(S=P-(M=(x=L-(b=(v=t*L)-(v-L)))*(E=g-(w=(v=t*g)-(v-g)))-((I=L*g)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(A=C-((T=C+S)-(y=T-C))+(S-y))-(S=A-I),l[1]=A-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const z=n(B,o,4,l,s);y=(P=(x=f-(b=(v=t*f)-(v-f)))*(E=_-(w=(v=t*_)-(v-_)))-((C=f*_)-b*w-x*w-b*E))-(S=P-(M=(x=m-(b=(v=t*m)-(v-m)))*(E=g-(w=(v=t*g)-(v-g)))-((I=m*g)-b*w-x*w-b*E))),l[0]=P-(S+y)+(y-M),y=(A=C-((T=C+S)-(y=T-C))+(S-y))-(S=A-I),l[1]=A-(S+y)+(y-I),y=(R=T+S)-T,l[2]=T-(R-y)+(S-y),l[3]=R;const j=n(z,s,4,l,a);return a[j-1]}(e,i,c,u,h,d,g)},e.orient2dfast=function(e,t,n,i,r,o){return(t-o)*(n-r)-(e-r)*(i-o)},Object.defineProperty(e,"__esModule",{value:!0})}(t)},8973:(e,t,n)=>{"use strict";var i=n(8897),r=n(9381),o=n(6900)(),s=n(1399),a=n(1711),l=i("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||l(t)!==t)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,c=!0;if("length"in e&&s){var u=s(e,"length");u&&!u.configurable&&(i=!1),u&&!u.writable&&(c=!1)}return(i||c||!n)&&(o?r(e,"length",t,!0,!0):r(e,"length",t)),e}},3426:(e,t,n)=>{"use strict";var i=n(9381),r=n(6900)(),o=n(1442).functionsHaveConfigurableNames(),s=n(1711);e.exports=function(e,t){if("function"!=typeof e)throw new s("`fn` is not a function");return arguments.length>2&&!!arguments[2]&&!o||(r?i(e,"name",t,!0,!0):i(e,"name",t)),e}},588:(e,t,n)=>{"use strict";var i=n(8897),r=n(9343),o=n(8527),s=n(1711),a=i("%WeakMap%",!0),l=i("%Map%",!0),c=r("WeakMap.prototype.get",!0),u=r("WeakMap.prototype.set",!0),h=r("WeakMap.prototype.has",!0),d=r("Map.prototype.get",!0),p=r("Map.prototype.set",!0),f=r("Map.prototype.has",!0),m=function(e,t){for(var n,i=e;null!==(n=i.next);i=n)if(n.key===t)return i.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,i={assert:function(e){if(!i.has(e))throw new s("Side channel does not contain "+o(e))},get:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return c(e,i)}else if(l){if(t)return d(t,i)}else if(n)return function(e,t){var n=m(e,t);return n&&n.value}(n,i)},has:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return h(e,i)}else if(l){if(t)return f(t,i)}else if(n)return function(e,t){return!!m(e,t)}(n,i);return!1},set:function(i,r){a&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new a),u(e,i,r)):l?(t||(t=new l),p(t,i,r)):(n||(n={key:{},next:null}),function(e,t,n){var i=m(e,t);i?i.value=n:e.next={key:t,next:e.next,value:n}}(n,i,r))}};return i}},2824:(e,t,n)=>{"use strict";var i=n(8347),r=SyntaxError,o="object"==typeof StopIteration?StopIteration:null;e.exports=function(e){if(!o)throw new r("this environment lacks StopIteration");i.set(e,"[[Done]]",!1);var t={next:function(){var e=i.get(this,"[[Iterator]]"),t=i.get(e,"[[Done]]");try{return{done:t,value:t?void 0:e.next()}}catch(t){if(i.set(e,"[[Done]]",!0),t!==o)throw t;return{done:!0,value:void 0}}}};return i.set(t,"[[Iterator]]",e),t}},5292:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},s=[],a=0;a<e.length;a++){var l=e[a],c=i.base?l[0]+i.base:l[0],u=o[c]||0,h="".concat(c," ").concat(u);o[c]=u+1;var d=n(h),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==d)t[d].references++,t[d].updater(p);else{var f=r(p,i);i.byIndex=a,t.splice(a,0,{identifier:h,updater:f,references:1})}s.push(h)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var l=i(e,r),c=0;c<o.length;c++){var u=n(o[c]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}o=l}}},9383:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},9088:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},6884:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},9893:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,r&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7997:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},922:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});class i{constructor(e=[],t=r){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),o=t[i];const s=i+1;if(s<this.length&&n(t[s],o)<0&&(i=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=i}t[e]=r}}function r(e,t){return e<t?-1:e>t?1:0}},62:e=>{e.exports=function(){var e=document.getSelection();if(!e.rangeCount)return function(){};for(var t=document.activeElement,n=[],i=0;i<e.rangeCount;i++)n.push(e.getRangeAt(i));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null}return e.removeAllRanges(),function(){"Caret"===e.type&&e.removeAllRanges(),e.rangeCount||n.forEach((function(t){e.addRange(t)})),t&&t.focus()}}},2794:e=>{e.exports=function(e,t){if(!e)throw new Error("No coordinates passed");return{type:"Feature",geometry:{type:"LineString",coordinates:e},properties:t||{}}}},8779:(e,t,n)=>{"use strict";var i=n(5959),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=i.useState,s=i.useEffect,a=i.useLayoutEffect,l=i.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),i=o({inst:{value:n,getSnapshot:t}}),r=i[0].inst,u=i[1];return a((function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})}),[e,n,t]),s((function(){return c(r)&&u({inst:r}),e((function(){c(r)&&u({inst:r})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==i.useSyncExternalStore?i.useSyncExternalStore:u},3676:(e,t,n)=>{"use strict";e.exports=n(8779)},9767:(e,t,n)=>{"use strict";var i=n(9453),r=n(4267),o=n(8092),s=n(8832),a=n(8959);e.exports=function(e){return null==e||"object"!=typeof e&&"function"!=typeof e?null:i(e)?"String":r(e)?"Number":o(e)?"Boolean":s(e)?"Symbol":a(e)?"BigInt":void 0}},5493:(e,t,n)=>{"use strict";var i=n(7174),r=n(1620),o=n(8014),s=n(5692);e.exports=function(e){if(e&&"object"==typeof e){if(i(e))return"Map";if(r(e))return"Set";if(o(e))return"WeakMap";if(s(e))return"WeakSet"}return!1}},6059:(e,t,n)=>{"use strict";var i=n(7270),r=n(2847),o=n(8179),s=n(9343),a=n(1399),l=s("Object.prototype.toString"),c=n(1432)(),u="undefined"==typeof globalThis?n.g:globalThis,h=r(),d=s("String.prototype.slice"),p=Object.getPrototypeOf,f=s("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},m={__proto__:null};i(h,c&&a&&p?function(e){var t=new u[e];if(Symbol.toStringTag in t){var n=p(t),i=a(n,Symbol.toStringTag);if(!i){var r=p(n);i=a(r,Symbol.toStringTag)}m["$"+e]=o(i.get)}}:function(e){var t=new u[e],n=t.slice||t.set;n&&(m["$"+e]=o(n))}),e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!c){var t=d(l(e),8,-1);return f(h,t)>-1?t:"Object"===t&&function(e){var t=!1;return i(m,(function(n,i){if(!t)try{n(e),t=d(i,1)}catch(e){}})),t}(e)}return a?function(e){var t=!1;return i(m,(function(n,i){if(!t)try{"$"+n(e)===i&&(t=d(i,1))}catch(e){}})),t}(e):null}},6089:e=>{"use strict";e.exports=r},9089:e=>{"use strict";e.exports=a},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=o},2007:e=>{"use strict";e.exports=n},3241:e=>{"use strict";e.exports=s},5959:e=>{"use strict";e.exports=t},8398:e=>{"use strict";e.exports=i},3966:()=>{},2847:(e,t,n)=>{"use strict";var i=n(6350),r="undefined"==typeof globalThis?n.g:globalThis;e.exports=function(){for(var e=[],t=0;t<i.length;t++)"function"==typeof r[i[t]]&&(e[e.length]=i[t]);return e}},4452:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=s(e,o(n)))}return e}function o(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)i.call(e,n)&&e[n]&&(t=s(t,n));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},8418:(e,t,n)=>{"use strict";var i=n(5456),r=n(2824);if(n(4923)()||n(4361)()){var o=Symbol.iterator;e.exports=function(e){return null!=e&&void 0!==e[o]?e[o]():i(e)?Array.prototype[o].call(e):void 0}}else{var s=n(8030),a=n(9453),l=n(8897),c=l("%Map%",!0),u=l("%Set%",!0),h=n(9343),d=h("Array.prototype.push"),p=h("String.prototype.charCodeAt"),f=h("String.prototype.slice"),m=function(e){var t=0;return{next:function(){var n,i=t>=e.length;return i||(n=e[t],t+=1),{done:i,value:n}}}},g=function(e,t){if(s(e)||i(e))return m(e);if(a(e)){var n=0;return{next:function(){var t=function(e,t){if(t+1>=e.length)return t+1;var n=p(e,t);if(n<55296||n>56319)return t+1;var i=p(e,t+1);return i<56320||i>57343?t+1:t+2}(e,n),i=f(e,n,t);return n=t,{done:t>e.length,value:i}}}}return t&&void 0!==e["_es6-shim iterator_"]?e["_es6-shim iterator_"]():void 0};if(c||u){var _=n(7174),y=n(1620),v=h("Map.prototype.forEach",!0),b=h("Set.prototype.forEach",!0);if("undefined"==typeof process||!process.versions||!process.versions.node)var x=h("Map.prototype.iterator",!0),w=h("Set.prototype.iterator",!0);var E=h("Map.prototype.@@iterator",!0)||h("Map.prototype._es6-shim iterator_",!0),S=h("Set.prototype.@@iterator",!0)||h("Set.prototype._es6-shim iterator_",!0);e.exports=function(e){return function(e){if(_(e)){if(x)return r(x(e));if(E)return E(e);if(v){var t=[];return v(e,(function(e,n){d(t,[n,e])})),m(t)}}if(y(e)){if(w)return r(w(e));if(S)return S(e);if(b){var n=[];return b(e,(function(e){d(n,e)})),m(n)}}}(e)||g(e)}}else e.exports=function(e){if(null!=e)return g(e,!0)}}},6505:function(e){e.exports=function(){"use strict";var e={},t={};function n(n,i,r){if(t[n]=r,"index"===n){var o="var sharedModule = {}; ("+t.shared+")(sharedModule); ("+t.worker+")(sharedModule);",s={};return t.shared(s),t.index(e,s),"undefined"!=typeof window&&e.setWorkerUrl(window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))),e}}return n("shared",0,(function(e){function t(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}"function"==typeof SuppressedError&&SuppressedError;var i=r;function r(e,t){this.x=e,this.y=t}r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),i=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),i=Math.sin(e),r=t.y+i*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-i*(this.y-t.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e};var o=n(i),s=a;function a(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var l=n(s);let c,u;function h(){return null==c&&(c="undefined"!=typeof OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof createImageBitmap),c}function d(){if(null==u&&(u=!1,h())){const e=5,t=new OffscreenCanvas(e,e).getContext("2d",{willReadFrequently:!0});if(t){for(let n=0;n<e*e;n++){const i=4*n;t.fillStyle=`rgb(${i},${i+1},${i+2})`,t.fillRect(n%e,Math.floor(n/e),1,1)}const n=t.getImageData(0,0,e,e).data;for(let t=0;t<e*e*4;t++)if(t%4!=3&&n[t]!==t){u=!0;break}}}return u||!1}function p(e,t,n,i){const r=new l(e,t,n,i);return e=>r.solve(e)}const f=p(.25,.1,.25,1);function m(e,t,n){return Math.min(n,Math.max(t,e))}function g(e,t,n){const i=n-t,r=((e-t)%i+i)%i+t;return r===t?n:r}function _(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}let y=1;function v(e,t,n){const i={};for(const n in e)i[n]=t.call(this,e[n],n,e);return i}function b(e,t,n){const i={};for(const n in e)t.call(this,e[n],n,e)&&(i[n]=e[n]);return i}function x(e){return Array.isArray(e)?e.map(x):"object"==typeof e&&e?v(e,x):e}const w={};function E(e){w[e]||("undefined"!=typeof console&&console.warn(e),w[e]=!0)}function S(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function T(e){return"undefined"!=typeof WorkerGlobalScope&&void 0!==e&&e instanceof WorkerGlobalScope}let A=null;function C(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}const P="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function I(e,n,i,r,o){return t(this,void 0,void 0,(function*(){if("undefined"==typeof VideoFrame)throw new Error("VideoFrame not supported");const t=new VideoFrame(e,{timestamp:0});try{const s=null==t?void 0:t.format;if(!s||!s.startsWith("BGR")&&!s.startsWith("RGB"))throw new Error(`Unrecognized format ${s}`);const a=s.startsWith("BGR"),l=new Uint8ClampedArray(r*o*4);if(yield t.copyTo(l,function(e,t,n,i,r){const o=4*Math.max(-t,0),s=(Math.max(0,n)-n)*i*4+o,a=4*i,l=Math.max(0,t),c=Math.max(0,n);return{rect:{x:l,y:c,width:Math.min(e.width,t+i)-l,height:Math.min(e.height,n+r)-c},layout:[{offset:s,stride:a}]}}(e,n,i,r,o)),a)for(let e=0;e<l.length;e+=4){const t=l[e];l[e]=l[e+2],l[e+2]=t}return l}finally{t.close()}}))}let M,R;const O="AbortError";function k(){return new Error(O)}const L={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function D(e){return L.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]}const F="global-dispatcher";class N extends Error{constructor(e,t,n,i){super(`AJAXError: ${t} (${e}): ${n}`),this.status=e,this.statusText=t,this.url=n,this.body=i}}const B=()=>T(self)?self.worker&&self.worker.referrer:("blob:"===window.location.protocol?window.parent:window).location.href,z=function(e,n){if(/:\/\//.test(e.url)&&!/^https?:|^file:/.test(e.url)){const t=D(e.url);if(t)return t(e,n);if(T(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,targetMapId:F},n)}if(!(/^file:/.test(i=e.url)||/^file:/.test(B())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(e,n){return t(this,void 0,void 0,(function*(){const t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,cache:e.cache,referrer:B(),signal:n.signal});"json"===e.type&&t.headers.set("Accept","application/json");const i=yield fetch(t);if(!i.ok){const t=yield i.blob();throw new N(i.status,i.statusText,e.url,t)}let r;r="arrayBuffer"===e.type||"image"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text();const o=yield r;if(n.signal.aborted)throw k();return{data:o,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires")}}))}(e,n);if(T(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:e,mustQueue:!0,targetMapId:F},n)}var i;return function(e,t){return new Promise(((n,i)=>{const r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"!==e.type&&"image"!==e.type||(r.responseType="arraybuffer");for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{i(new Error(r.statusText))},r.onload=()=>{if(!t.signal.aborted)if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let t=r.response;if("json"===e.type)try{t=JSON.parse(r.response)}catch(e){return void i(e)}n({data:t,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")})}else{const t=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});i(new N(r.status,r.statusText,e.url,t))}},t.signal.addEventListener("abort",(()=>{r.abort(),i(k())})),r.send(e.body)}))}(e,n)};function j(e){if(!e||e.indexOf("://")<=0||0===e.indexOf("data:image/")||0===e.indexOf("blob:"))return!0;const t=new URL(e),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function U(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function V(e,t,n){if(n&&n[e]){const i=n[e].indexOf(t);-1!==i&&n[e].splice(i,1)}}class G{constructor(e,t={}){_(this,t),this.type=e}}class $ extends G{constructor(e,t={}){super("error",_({error:e},t))}}class W{on(e,t){return this._listeners=this._listeners||{},U(e,t,this._listeners),this}off(e,t){return V(e,t,this._listeners),V(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},U(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new G(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const t=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of t)n.call(this,e);const i=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const t of i)V(n,t,this._oneTimeListeners),t.call(this,e);const r=this._eventedParent;r&&(_(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),r.fire(e))}else e instanceof $&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}var H={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const q=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function X(e,t){const n={};for(const t in e)"ref"!==t&&(n[t]=e[t]);return q.forEach((e=>{e in t&&(n[e]=t[e])})),n}function Z(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Z(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!Z(e[n],t[n]))return!1;return!0}return e===t}function Y(e,t){e.push(t)}function K(e,t,n){Y(n,{command:"addSource",args:[e,t[e]]})}function J(e,t,n){Y(t,{command:"removeSource",args:[e]}),n[e]=!0}function Q(e,t,n,i){J(e,n,i),K(e,t,n)}function ee(e,t,n){let i;for(i in e[n])if(Object.prototype.hasOwnProperty.call(e[n],i)&&"data"!==i&&!Z(e[n][i],t[n][i]))return!1;for(i in t[n])if(Object.prototype.hasOwnProperty.call(t[n],i)&&"data"!==i&&!Z(e[n][i],t[n][i]))return!1;return!0}function te(e,t,n,i,r,o){e=e||{},t=t||{};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(Z(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}));for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(Z(e[s],t[s])||n.push({command:o,args:[i,s,t[s],r]}))}function ne(e){return e.id}function ie(e,t){return e[t.id]=t,e}class re{constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function oe(e,...t){for(const n of t)for(const t in n)e[t]=n[t];return e}class se extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class ae{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,n]of t)this.bindings[e]=n}concat(e){return new ae(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const le={kind:"null"},ce={kind:"number"},ue={kind:"string"},he={kind:"boolean"},de={kind:"color"},pe={kind:"object"},fe={kind:"value"},me={kind:"collator"},ge={kind:"formatted"},_e={kind:"padding"},ye={kind:"resolvedImage"},ve={kind:"variableAnchorOffsetCollection"};function be(e,t){return{kind:"array",itemType:e,N:t}}function xe(e){if("array"===e.kind){const t=xe(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const we=[le,ce,ue,he,de,ge,pe,be(fe),_e,ye,ve];function Ee(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ee(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of we)if(!Ee(e,t))return null}return`Expected ${xe(e)} but found ${xe(t)} instead.`}function Se(e,t){return t.some((t=>t.kind===e.kind))}function Te(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function Ae(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const Ce=.96422,Pe=.82521,Ie=4/29,Me=6/29,Re=3*Me*Me,Oe=Me*Me*Me,ke=Math.PI/180,Le=180/Math.PI;function De(e){return(e%=360)<0&&(e+=360),e}function Fe([e,t,n,i]){let r,o;const s=Be((.2225045*(e=Ne(e))+.7168786*(t=Ne(t))+.0606169*(n=Ne(n)))/1);e===t&&t===n?r=o=s:(r=Be((.4360747*e+.3850649*t+.1430804*n)/Ce),o=Be((.0139322*e+.0971045*t+.7141733*n)/Pe));const a=116*s-16;return[a<0?0:a,500*(r-s),200*(s-o),i]}function Ne(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Be(e){return e>Oe?Math.pow(e,1/3):e/Re+Ie}function ze([e,t,n,i]){let r=(e+16)/116,o=isNaN(t)?r:r+t/500,s=isNaN(n)?r:r-n/200;return r=1*Ue(r),o=Ce*Ue(o),s=Pe*Ue(s),[je(3.1338561*o-1.6168667*r-.4906146*s),je(-.9787684*o+1.9161415*r+.033454*s),je(.0719453*o-.2289914*r+1.4052427*s),i]}function je(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function Ue(e){return e>Me?e*e*e:Re*(e-Ie)}function Ve(e){return parseInt(e.padEnd(2,e),16)/255}function Ge(e,t){return $e(t?e/100:e,0,1)}function $e(e,t,n){return Math.min(Math.max(t,e),n)}function We(e){return!e.some(Number.isNaN)}const He={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class qe{constructor(e,t,n,i=1,r=!0){this.r=e,this.g=t,this.b=n,this.a=i,r||(this.r*=i,this.g*=i,this.b*=i,i||this.overwriteGetter("rgb",[e,t,n,i]))}static parse(e){if(e instanceof qe)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=He[e];if(t){const[e,n,i]=t;return[e/255,n/255,i/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let n=1;return[Ve(e.slice(n,n+=t)),Ve(e.slice(n,n+=t)),Ve(e.slice(n,n+=t)),Ve(e.slice(n,n+t)||"ff")]}if(e.startsWith("rgb")){const t=e.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(t){const[e,n,i,r,o,s,a,l,c,u,h,d]=t,p=[r||" ",a||" ",u].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[i,s,c].join(""),t="%%%"===e?100:""===e?255:0;if(t){const e=[$e(+n/t,0,1),$e(+o/t,0,1),$e(+l/t,0,1),h?Ge(+h,d):1];if(We(e))return e}}return}}const n=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(n){const[e,t,i,r,o,s,a,l,c]=n,u=[i||" ",o||" ",a].join("");if("  "===u||"  /"===u||",,"===u||",,,"===u){const e=[+t,$e(+r,0,100),$e(+s,0,100),l?Ge(+l,c):1];if(We(e))return function([e,t,n,i]){function r(i){const r=(i+e/30)%12,o=t*Math.min(n,1-n);return n-o*Math.max(-1,Math.min(r-3,9-r,1))}return e=De(e),t/=100,n/=100,[r(0),r(8),r(4),i]}(e)}}}(e);return t?new qe(...t,!1):void 0}get rgb(){const{r:e,g:t,b:n,a:i}=this,r=i||1/0;return this.overwriteGetter("rgb",[e/r,t/r,n/r,i])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,n,i,r]=Fe(e),o=Math.sqrt(n*n+i*i);return[Math.round(1e4*o)?De(Math.atan2(i,n)*Le):NaN,o,t,r]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Fe(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,n,i]=this.rgb;return`rgba(${[e,t,n].map((e=>Math.round(255*e))).join(",")},${i})`}}qe.black=new qe(0,0,0,1),qe.white=new qe(1,1,1,1),qe.transparent=new qe(0,0,0,0),qe.red=new qe(1,0,0,1);class Xe{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ze{constructor(e,t,n,i,r){this.text=e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=r}}class Ye{constructor(e){this.sections=e}static fromString(e){return new Ye([new Ze(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof Ye?e:Ye.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class Ke{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ke)return e;if("number"==typeof e)return new Ke([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Ke(e)}}toString(){return JSON.stringify(this.values)}}const Je=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qe{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Qe)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const n=e[t],i=e[t+1];if("string"!=typeof n||!Je.has(n))return;if(!Array.isArray(i)||2!==i.length||"number"!=typeof i[0]||"number"!=typeof i[1])return}return new Qe(e)}}toString(){return JSON.stringify(this.values)}}class et{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new et({name:e,available:!1}):null}}function tt(e,t,n,i){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[e,t,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[e,t,n,i]:[e,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nt(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof qe||e instanceof Xe||e instanceof Ye||e instanceof Ke||e instanceof Qe||e instanceof et)return!0;if(Array.isArray(e)){for(const t of e)if(!nt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!nt(e[t]))return!1;return!0}return!1}function it(e){if(null===e)return le;if("string"==typeof e)return ue;if("boolean"==typeof e)return he;if("number"==typeof e)return ce;if(e instanceof qe)return de;if(e instanceof Xe)return me;if(e instanceof Ye)return ge;if(e instanceof Ke)return _e;if(e instanceof Qe)return ve;if(e instanceof et)return ye;if(Array.isArray(e)){const t=e.length;let n;for(const t of e){const e=it(t);if(n){if(n===e)continue;n=fe;break}n=e}return be(n||fe,t)}return pe}function rt(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof qe||e instanceof Ye||e instanceof Ke||e instanceof Qe||e instanceof et?e.toString():JSON.stringify(e)}class ot{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!nt(e[1]))return t.error("invalid value");const n=e[1];let i=it(n);const r=t.expectedType;return"array"!==i.kind||0!==i.N||!r||"array"!==r.kind||"number"==typeof r.N&&0!==r.N||(i=r),new ot(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class st{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const at={string:ue,number:ce,boolean:he,object:pe};class lt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const r=e[0];if("array"===r){let r,o;if(e.length>2){const n=e[1];if("string"!=typeof n||!(n in at)||"object"===n)return t.error('The item type argument of "array" must be one of string, number, boolean',1);r=at[n],i++}else r=fe;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],i++}n=be(r,o)}else{if(!at[r])throw new Error(`Types doesn't contain name = ${r}`);n=at[r]}const o=[];for(;i<e.length;i++){const n=t.parse(e[i],i,fe);if(!n)return null;o.push(n)}return new lt(n,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!Ee(this.type,it(n)))return n;if(t===this.args.length-1)throw new st(`Expected value to be of type ${xe(this.type)}, but found ${xe(it(n))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ct={"to-boolean":he,"to-color":de,"to-number":ce,"to-string":ue};class ut{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(!ct[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const i=ct[n],r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],n,fe);if(!i)return null;r.push(i)}return new ut(i,r)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof qe)return t;if("string"==typeof t){const n=e.parseColor(t);if(n)return n}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:tt(t[0],t[1],t[2],t[3]),!n))return new qe(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new st(n||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const n of this.args){t=n.evaluate(e);const i=Ke.parse(t);if(i)return i}throw new st(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const n of this.args){t=n.evaluate(e);const i=Qe.parse(t);if(i)return i}throw new st(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new st(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return Ye.fromString(rt(this.args[0].evaluate(e)));case"resolvedImage":return et.fromString(rt(this.args[0].evaluate(e)));default:return rt(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ht=["Unknown","Point","LineString","Polygon"];class dt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ht[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=qe.parse(e)),t}}class pt{constructor(e,t,n=[],i,r=new ae,o=[]){this.registry=e,this.path=n,this.key=n.map((e=>`[${e}]`)).join(""),this.scope=r,this.errors=o,this.expectedType=i,this._isConstant=t}parse(e,t,n,i,r={}){return t?this.concat(t,n,i)._parse(e,r):this._parse(e,r)}_parse(e,t){function n(e,t,n){return"assert"===n?new lt(t,[e]):"coerce"===n?new ut(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const r=this.registry[i];if(r){let i=r.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,r=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind)if("padding"!==e.kind||"value"!==r.kind&&"number"!==r.kind&&"array"!==r.kind)if("variableAnchorOffsetCollection"!==e.kind||"value"!==r.kind&&"array"!==r.kind){if(this.checkSubtype(e,r))return null}else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"coerce");else i=n(i,e,t.typeAnnotation||"assert")}if(!(i instanceof ot)&&"resolvedImage"!==i.type.kind&&this._isConstant(i)){const t=new dt;try{i=new ot(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,r=n?this.scope.concat(n):this.scope;return new pt(this.registry,this._isConstant,i,t||null,r,this.errors)}error(e,...t){const n=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new se(n,e))}checkSubtype(e,t){const n=Ee(e,t);return n&&this.error(n),n}}class ft{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let i=1;i<e.length-1;i+=2){const r=e[i];if("string"!=typeof r)return t.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;n.push([r,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new ft(n,i):null}outputDefined(){return this.result.outputDefined()}}class mt{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new mt(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class gt{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,ce),i=t.parse(e[2],2,be(t.expectedType||fe));return n&&i?new gt(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new st(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new st(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new st(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class _t{constructor(e,t){this.type=he,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,fe),i=t.parse(e[2],2,fe);return n&&i?Se(n.type,[he,ue,ce,le,fe])?new _t(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!Te(t,["boolean","string","number","null"]))throw new st(`Expected first argument to be of type boolean, string, number or null, but found ${xe(it(t))} instead.`);if(!Te(n,["string","array"]))throw new st(`Expected second argument to be of type array or string, but found ${xe(it(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class yt{constructor(e,t,n){this.type=ce,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,fe),i=t.parse(e[2],2,fe);if(!n||!i)return null;if(!Se(n.type,[he,ue,ce,le,fe]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ce);return r?new yt(n,i,r):null}return new yt(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!Te(t,["boolean","string","number","null"]))throw new st(`Expected first argument to be of type boolean, string, number or null, but found ${xe(it(t))} instead.`);if(!Te(n,["string","array"]))throw new st(`Expected second argument to be of type array or string, but found ${xe(it(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class vt{constructor(e,t,n,i,r,o){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r={},o=[];for(let s=2;s<e.length-1;s+=2){let a=e[s];const l=e[s+1];Array.isArray(a)||(a=[a]);const c=t.concat(s);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,it(e)))return null}else n=it(e);if(void 0!==r[String(e)])return c.error("Branch labels must be unique.");r[String(e)]=o.length}const u=t.parse(l,s,i);if(!u)return null;i=i||u.type,o.push(u)}const s=t.parse(e[1],1,fe);if(!s)return null;const a=t.parse(e[e.length-1],e.length-1,i);return a?"value"!==s.type.kind&&t.concat(1).checkSubtype(n,s.type)?null:new vt(n,i,s,r,o,a):null}evaluate(e){const t=this.input.evaluate(e);return(it(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class bt{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let r=1;r<e.length-1;r+=2){const o=t.parse(e[r],r,he);if(!o)return null;const s=t.parse(e[r+1],r+1,n);if(!s)return null;i.push([o,s]),n=n||s.type}const r=t.parse(e[e.length-1],e.length-1,n);if(!r)return null;if(!n)throw new Error("Can't infer output type");return new bt(n,i,r)}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class xt{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,fe),i=t.parse(e[2],2,ce);if(!n||!i)return null;if(!Se(n.type,[be(fe),ue,fe]))return t.error(`Expected first argument to be of type array or string, but found ${xe(n.type)} instead`);if(4===e.length){const r=t.parse(e[3],3,ce);return r?new xt(n.type,n,i,r):null}return new xt(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!Te(t,["string","array"]))throw new st(`Expected first argument to be of type array or string, but found ${xe(it(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function wt(e,t){const n=e.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=e[a],r=e[a+1],i<=t){if(a===n||t<r)return a;o=a+1}else{if(!(i>t))throw new st("Input is not a number.");s=a-1}return 0}class Et{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of n)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,ce);if(!n)return null;const i=[];let r=null;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(let n=1;n<e.length;n+=2){const o=1===n?-1/0:e[n],s=e[n+1],a=n,l=n+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(i.length&&i[i.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(s,l,r);if(!c)return null;r=r||c.type,i.push([o,c])}return new Et(r,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;return i>=t[r-1]?n[r-1].evaluate(e):n[wt(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}var St=Tt;function Tt(e,t,n,i){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(i-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=i}Tt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,i=0;i<8;i++){var r=this.sampleCurveX(n)-e;if(Math.abs(r)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=e,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-e)<t));i++)e>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var At=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(St);function Ct(e,t,n){return e+n*(t-e)}function Pt(e,t,n){return e.map(((e,i)=>Ct(e,t[i],n)))}const It={number:Ct,color:function(e,t,n,i="rgb"){switch(i){case"rgb":{const[i,r,o,s]=Pt(e.rgb,t.rgb,n);return new qe(i,r,o,s,!1)}case"hcl":{const[i,r,o,s]=e.hcl,[a,l,c,u]=t.hcl;let h,d;if(isNaN(i)||isNaN(a))isNaN(i)?isNaN(a)?h=NaN:(h=a,1!==o&&0!==o||(d=l)):(h=i,1!==c&&0!==c||(d=r));else{let e=a-i;a>i&&e>180?e-=360:a<i&&i-a>180&&(e+=360),h=i+n*e}const[p,f,m,g]=function([e,t,n,i]){return e=isNaN(e)?0:e*ke,ze([n,Math.cos(e)*t,Math.sin(e)*t,i])}([h,null!=d?d:Ct(r,l,n),Ct(o,c,n),Ct(s,u,n)]);return new qe(p,f,m,g,!1)}case"lab":{const[i,r,o,s]=ze(Pt(e.lab,t.lab,n));return new qe(i,r,o,s,!1)}}},array:Pt,padding:function(e,t,n){return new Ke(Pt(e.values,t.values,n))},variableAnchorOffsetCollection:function(e,t,n){const i=e.values,r=t.values;if(i.length!==r.length)throw new st(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const o=[];for(let e=0;e<i.length;e+=2){if(i[e]!==r[e])throw new st(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${i[e]}, to[${e}]: ${r[e]}`);o.push(i[e]);const[t,s]=i[e+1],[a,l]=r[e+1];o.push([Ct(t,a,n),Ct(s,l,n)])}return new Qe(o)}};class Mt{constructor(e,t,n,i,r){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,n,i){let r=0;if("exponential"===e.name)r=Rt(t,e.base,n,i);else if("linear"===e.name)r=Rt(t,1,n,i);else if("cubic-bezier"===e.name){const o=e.controlPoints;r=new At(o[0],o[1],o[2],o[3]).solve(Rt(t,1,n,i))}return r}static parse(e,t){let[n,i,r,...o]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const e=i[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:e}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const e=i.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(r=t.parse(r,2,ce),!r)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=de:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<o.length;e+=2){const n=o[e],i=o[e+1],r=e+3,l=e+4;if("number"!=typeof n)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=n)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(i,l,a);if(!c)return null;a=a||c.type,s.push([n,c])}return Ae(a,ce)||Ae(a,de)||Ae(a,_e)||Ae(a,ve)||Ae(a,be(ce))?new Mt(a,n,i,r,s):t.error(`Type ${xe(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const r=t.length;if(i>=t[r-1])return n[r-1].evaluate(e);const o=wt(t,i),s=Mt.interpolationFactor(this.interpolation,i,t[o],t[o+1]),a=n[o].evaluate(e),l=n[o+1].evaluate(e);switch(this.operator){case"interpolate":return It[this.type.kind](a,l,s);case"interpolate-hcl":return It.color(a,l,s,"hcl");case"interpolate-lab":return It.color(a,l,s,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Rt(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}class Ot{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const r=[];for(const i of e.slice(1)){const e=t.parse(i,1+r.length,n,void 0,{typeAnnotation:"omit"});if(!e)return null;n=n||e.type,r.push(e)}if(!n)throw new Error("No output type");const o=i&&r.some((e=>Ee(i,e.type)));return new Ot(o?fe:n,r)}evaluate(e){let t,n=null,i=0;for(const r of this.args)if(i++,n=r.evaluate(e),n&&n instanceof et&&!n.available&&(t||(t=n.name),n=null,i===this.args.length&&(n=t)),null!==n)break;return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function kt(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Lt(e,t,n,i){return 0===i.compare(t,n)}function Dt(e,t,n){const i="=="!==e&&"!="!==e;return class r{constructor(e,t,n){this.type=he,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const n=e[0];let o=t.parse(e[1],1,fe);if(!o)return null;if(!kt(n,o.type))return t.concat(1).error(`"${n}" comparisons are not supported for type '${xe(o.type)}'.`);let s=t.parse(e[2],2,fe);if(!s)return null;if(!kt(n,s.type))return t.concat(2).error(`"${n}" comparisons are not supported for type '${xe(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error(`Cannot compare types '${xe(o.type)}' and '${xe(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new lt(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new lt(o.type,[s])));let a=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,me),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const t=it(o),n=it(s);if(t.kind!==n.kind||"string"!==t.kind&&"number"!==t.kind)throw new st(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const e=it(o),n=it(s);if("string"!==e.kind||"string"!==n.kind)return t(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):t(r,o,s)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const Ft=Dt("==",(function(e,t,n){return t===n}),Lt),Nt=Dt("!=",(function(e,t,n){return t!==n}),(function(e,t,n,i){return!Lt(0,t,n,i)})),Bt=Dt("<",(function(e,t,n){return t<n}),(function(e,t,n,i){return i.compare(t,n)<0})),zt=Dt(">",(function(e,t,n){return t>n}),(function(e,t,n,i){return i.compare(t,n)>0})),jt=Dt("<=",(function(e,t,n){return t<=n}),(function(e,t,n,i){return i.compare(t,n)<=0})),Ut=Dt(">=",(function(e,t,n){return t>=n}),(function(e,t,n,i){return i.compare(t,n)>=0}));class Vt{constructor(e,t,n){this.type=me,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,he);if(!i)return null;const r=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,he);if(!r)return null;let o=null;return n.locale&&(o=t.parse(n.locale,1,ue),!o)?null:new Vt(i,r,o)}evaluate(e){return new Xe(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class Gt{constructor(e,t,n,i,r){this.type=ue,this.number=e,this.locale=t,this.currency=n,this.minFractionDigits=i,this.maxFractionDigits=r}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ce);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let r=null;if(i.locale&&(r=t.parse(i.locale,1,ue),!r))return null;let o=null;if(i.currency&&(o=t.parse(i.currency,1,ue),!o))return null;let s=null;if(i["min-fraction-digits"]&&(s=t.parse(i["min-fraction-digits"],1,ce),!s))return null;let a=null;return i["max-fraction-digits"]&&(a=t.parse(i["max-fraction-digits"],1,ce),!a)?null:new Gt(n,r,o,s,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class $t{constructor(e){this.type=ge,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let r=!1;for(let n=1;n<=e.length-1;++n){const o=e[n];if(r&&"object"==typeof o&&!Array.isArray(o)){r=!1;let e=null;if(o["font-scale"]&&(e=t.parse(o["font-scale"],1,ce),!e))return null;let n=null;if(o["text-font"]&&(n=t.parse(o["text-font"],1,be(ue)),!n))return null;let s=null;if(o["text-color"]&&(s=t.parse(o["text-color"],1,de),!s))return null;const a=i[i.length-1];a.scale=e,a.font=n,a.textColor=s}else{const o=t.parse(e[n],1,fe);if(!o)return null;const s=o.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");r=!0,i.push({content:o,scale:null,font:null,textColor:null})}}return new $t(i)}evaluate(e){return new Ye(this.sections.map((t=>{const n=t.content.evaluate(e);return it(n)===ye?new Ze("",n,null,null,null):new Ze(rt(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}}class Wt{constructor(e){this.type=ye,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ue);return n?new Wt(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=et.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}}class Ht{constructor(e){this.type=ce,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${xe(n.type)} instead.`):new Ht(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new st(`Expected value to be of type string or array, but found ${xe(it(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const qt=8192;function Xt(e,t){const n=(180+e[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,r=Math.pow(2,t.z);return[Math.round(n*r*qt),Math.round(i*r*qt)]}function Zt(e,t){const n=Math.pow(2,t.z);return[(r=(e[0]/qt+t.x)/n,360*r-180),(i=(e[1]/qt+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function Yt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Kt(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Jt(e,t,n){const i=e[0]-t[0],r=e[1]-t[1],o=e[0]-n[0],s=e[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Qt(e,t,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-r[1]*o[0]&&!(!sn(e,t,n,i)||!sn(n,i,e,t));var r,o}function en(e,t,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(Qt(e,t,i[n],i[n+1]))return!0;return!1}function tn(e,t,n=!1){let i=!1;for(const a of t)for(let t=0;t<a.length-1;t++){if(Jt(e,a[t],a[t+1]))return n;(o=a[t])[1]>(r=e)[1]!=(s=a[t+1])[1]>r[1]&&r[0]<(s[0]-o[0])*(r[1]-o[1])/(s[1]-o[1])+o[0]&&(i=!i)}var r,o,s;return i}function nn(e,t){for(const n of t)if(tn(e,n))return!0;return!1}function rn(e,t){for(const n of e)if(!tn(n,t))return!1;for(let n=0;n<e.length-1;++n)if(en(e[n],e[n+1],t))return!1;return!0}function on(e,t){for(const n of t)if(rn(e,n))return!0;return!1}function sn(e,t,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(e[0]-n[0])*o-r*(e[1]-n[1]),a=(t[0]-n[0])*o-r*(t[1]-n[1]);return s>0&&a<0||s<0&&a>0}function an(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=[];for(let i=0;i<e[r].length;i++){const s=Xt(e[r][i],n);Yt(t,s),o.push(s)}i.push(o)}return i}function ln(e,t,n){const i=[];for(let r=0;r<e.length;r++){const o=an(e[r],t,n);i.push(o)}return i}function cn(e,t,n,i){if(e[0]<n[0]||e[0]>n[2]){const t=.5*i;let r=e[0]-n[0]>t?-i:n[0]-e[0]>t?i:0;0===r&&(r=e[0]-n[2]>t?-i:n[2]-e[0]>t?i:0),e[0]+=r}Yt(t,e)}function un(e,t,n,i){const r=Math.pow(2,i.z)*qt,o=[i.x*qt,i.y*qt],s=[];for(const i of e)for(const e of i){const i=[e.x+o[0],e.y+o[1]];cn(i,t,n,r),s.push(i)}return s}function hn(e,t,n,i){const r=Math.pow(2,i.z)*qt,o=[i.x*qt,i.y*qt],s=[];for(const n of e){const e=[];for(const i of n){const n=[i.x+o[0],i.y+o[1]];Yt(t,n),e.push(n)}s.push(e)}if(t[2]-t[0]<=r/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of s)for(const i of e)cn(i,t,n,r)}var a;return s}class dn{constructor(e,t){this.type=he,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(nt(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const n of t.features){const{type:t,coordinates:i}=n.geometry;"Polygon"===t&&e.push(i),"MultiPolygon"===t&&e.push(...i)}if(e.length)return new dn(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new dn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new dn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=an(t.coordinates,i,r),s=un(e.geometry(),n,i,r);if(!Kt(n,i))return!1;for(const e of s)if(!tn(e,o))return!1}if("MultiPolygon"===t.type){const o=ln(t.coordinates,i,r),s=un(e.geometry(),n,i,r);if(!Kt(n,i))return!1;for(const e of s)if(!nn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=e.canonicalID();if("Polygon"===t.type){const o=an(t.coordinates,i,r),s=hn(e.geometry(),n,i,r);if(!Kt(n,i))return!1;for(const e of s)if(!rn(e,o))return!1}if("MultiPolygon"===t.type){const o=ln(t.coordinates,i,r),s=hn(e.geometry(),n,i,r);if(!Kt(n,i))return!1;for(const e of s)if(!on(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let pn=class{constructor(e=[],t=fn){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),o=t[i];const s=i+1;if(s<this.length&&n(t[s],o)<0&&(i=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=i}t[e]=r}};function fn(e,t){return e<t?-1:e>t?1:0}function mn(e,t,n,i,r){gn(e,t,n,i||e.length-1,r||yn)}function gn(e,t,n,i,r){for(;i>n;){if(i-n>600){var o=i-n+1,s=t-n+1,a=Math.log(o),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(o-l)/o)*(s-o/2<0?-1:1);gn(e,t,Math.max(n,Math.floor(t-s*l/o+c)),Math.min(i,Math.floor(t+(o-s)*l/o+c)),r)}var u=e[t],h=n,d=i;for(_n(e,n,t),r(e[i],u)>0&&_n(e,n,i);h<d;){for(_n(e,h,d),h++,d--;r(e[h],u)<0;)h++;for(;r(e[d],u)>0;)d--}0===r(e[n],u)?_n(e,n,d):_n(e,++d,i),d<=t&&(n=d+1),t<=d&&(i=d-1)}}function _n(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function yn(e,t){return e<t?-1:e>t?1:0}function vn(e,t){if(e.length<=1)return[e];const n=[];let i,r;for(const t of e){const e=xn(t);0!==e&&(t.area=Math.abs(e),void 0===r&&(r=e<0),r===e<0?(i&&n.push(i),i=[t]):i.push(t))}if(i&&n.push(i),t>1)for(let e=0;e<n.length;e++)n[e].length<=t||(mn(n[e],t,1,n[e].length-1,bn),n[e]=n[e].slice(0,t));return n}function bn(e,t){return t.area-e.area}function xn(e){let t=0;for(let n,i,r=0,o=e.length,s=o-1;r<o;s=r++)n=e[r],i=e[s],t+=(i.x-n.x)*(n.y+i.y);return t}const wn=1/298.257223563,En=wn*(2-wn),Sn=Math.PI/180;class Tn{constructor(e){const t=6378.137*Sn*1e3,n=Math.cos(e*Sn),i=1/(1-En*(1-n*n)),r=Math.sqrt(i);this.kx=t*r*n,this.ky=t*r*i*(1-En)}distance(e,t){const n=this.wrap(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;return Math.sqrt(n*n+i*i)}pointOnLine(e,t){let n,i,r,o,s=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=this.wrap(e[a+1][0]-l)*this.kx,h=(e[a+1][1]-c)*this.ky,d=0;0===u&&0===h||(d=(this.wrap(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*h)/(u*u+h*h),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=u/this.kx*d,c+=h/this.ky*d)),u=this.wrap(t[0]-l)*this.kx,h=(t[1]-c)*this.ky;const p=u*u+h*h;p<s&&(s=p,n=l,i=c,r=a,o=d)}return{point:[n,i],index:r,t:Math.max(0,Math.min(1,o))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function An(e,t){return t[0]-e[0]}function Cn(e){return e[1]-e[0]+1}function Pn(e,t){return e[1]>=e[0]&&e[1]<t}function In(e,t){if(e[0]>e[1])return[null,null];const n=Cn(e);if(t){if(2===n)return[e,null];const t=Math.floor(n/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===n)return[e,null];const i=Math.floor(n/2)-1;return[[e[0],e[0]+i],[e[0]+i+1,e[1]]]}function Mn(e,t){if(!Pn(t,e.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let i=t[0];i<=t[1];++i)Yt(n,e[i]);return n}function Rn(e){const t=[1/0,1/0,-1/0,-1/0];for(const n of e)for(const e of n)Yt(t,e);return t}function On(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function kn(e,t,n){if(!On(e)||!On(t))return NaN;let i=0,r=0;return e[2]<t[0]&&(i=t[0]-e[2]),e[0]>t[2]&&(i=e[0]-t[2]),e[1]>t[3]&&(r=e[1]-t[3]),e[3]<t[1]&&(r=t[1]-e[3]),n.distance([0,0],[i,r])}function Ln(e,t,n){const i=n.pointOnLine(t,e);return n.distance(e,i.point)}function Dn(e,t,n,i,r){const o=Math.min(Ln(e,[n,i],r),Ln(t,[n,i],r)),s=Math.min(Ln(n,[e,t],r),Ln(i,[e,t],r));return Math.min(o,s)}function Fn(e,t,n,i,r){if(!Pn(t,e.length)||!Pn(i,n.length))return 1/0;let o=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],a=e[s+1];for(let e=i[0];e<i[1];++e){const i=n[e],s=n[e+1];if(Qt(t,a,i,s))return 0;o=Math.min(o,Dn(t,a,i,s,r))}}return o}function Nn(e,t,n,i,r){if(!Pn(t,e.length)||!Pn(i,n.length))return NaN;let o=1/0;for(let s=t[0];s<=t[1];++s)for(let t=i[0];t<=i[1];++t)if(o=Math.min(o,r.distance(e[s],n[t])),0===o)return o;return o}function Bn(e,t,n){if(tn(e,t,!0))return 0;let i=1/0;for(const r of t){const t=r[0],o=r[r.length-1];if(t!==o&&(i=Math.min(i,Ln(e,[o,t],n)),0===i))return i;const s=n.pointOnLine(r,e);if(i=Math.min(i,n.distance(e,s.point)),0===i)return i}return i}function zn(e,t,n,i){if(!Pn(t,e.length))return NaN;for(let i=t[0];i<=t[1];++i)if(tn(e[i],n,!0))return 0;let r=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],s=e[o+1];for(const e of n)for(let n=0,o=e.length,a=o-1;n<o;a=n++){const o=e[a],l=e[n];if(Qt(t,s,o,l))return 0;r=Math.min(r,Dn(t,s,o,l,i))}}return r}function jn(e,t){for(const n of e)for(const e of n)if(tn(e,t,!0))return!0;return!1}function Un(e,t,n,i=1/0){const r=Rn(e),o=Rn(t);if(i!==1/0&&kn(r,o,n)>=i)return i;if(Kt(r,o)){if(jn(e,t))return 0}else if(jn(t,e))return 0;let s=1/0;for(const i of e)for(let e=0,r=i.length,o=r-1;e<r;o=e++){const r=i[o],a=i[e];for(const e of t)for(let t=0,i=e.length,o=i-1;t<i;o=t++){const i=e[o],l=e[t];if(Qt(r,a,i,l))return 0;s=Math.min(s,Dn(r,a,i,l,n))}}return s}function Vn(e,t,n,i,r,o){if(!o)return;const s=kn(Mn(i,o),r,n);s<t&&e.push([s,o,[0,0]])}function Gn(e,t,n,i,r,o,s){if(!o||!s)return;const a=kn(Mn(i,o),Mn(r,s),n);a<t&&e.push([a,o,s])}function $n(e,t,n,i,r=1/0){let o=Math.min(i.distance(e[0],n[0][0]),r);if(0===o)return o;const s=new pn([[0,[0,e.length-1],[0,0]]],An),a=Rn(n);for(;s.length>0;){const r=s.pop();if(r[0]>=o)continue;const l=r[1],c=t?50:100;if(Cn(l)<=c){if(!Pn(l,e.length))return NaN;if(t){const t=zn(e,l,n,i);if(isNaN(t)||0===t)return t;o=Math.min(o,t)}else for(let t=l[0];t<=l[1];++t){const r=Bn(e[t],n,i);if(o=Math.min(o,r),0===o)return 0}}else{const n=In(l,t);Vn(s,o,i,e,a,n[0]),Vn(s,o,i,e,a,n[1])}}return o}function Wn(e,t,n,i,r,o=1/0){let s=Math.min(o,r.distance(e[0],n[0]));if(0===s)return s;const a=new pn([[0,[0,e.length-1],[0,n.length-1]]],An);for(;a.length>0;){const o=a.pop();if(o[0]>=s)continue;const l=o[1],c=o[2],u=t?50:100,h=i?50:100;if(Cn(l)<=u&&Cn(c)<=h){if(!Pn(l,e.length)&&Pn(c,n.length))return NaN;let o;if(t&&i)o=Fn(e,l,n,c,r),s=Math.min(s,o);else if(t&&!i){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(o=Ln(n[e],t,r),s=Math.min(s,o),0===s)return s}else if(!t&&i){const t=n.slice(c[0],c[1]+1);for(let n=l[0];n<=l[1];++n)if(o=Ln(e[n],t,r),s=Math.min(s,o),0===s)return s}else o=Nn(e,l,n,c,r),s=Math.min(s,o)}else{const o=In(l,t),u=In(c,i);Gn(a,s,r,e,n,o[0],u[0]),Gn(a,s,r,e,n,o[0],u[1]),Gn(a,s,r,e,n,o[1],u[0]),Gn(a,s,r,e,n,o[1],u[1])}}return s}function Hn(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class qn{constructor(e,t){this.type=ce,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(nt(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new qn(t,t.features.map((e=>Hn(e.geometry))).flat());if("Feature"===t.type)return new qn(t,Hn(t.geometry));if("type"in t&&"coordinates"in t)return new qn(t,Hn(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const n=e.geometry(),i=n.flat().map((t=>Zt([t.x,t.y],e.canonical)));if(0===n.length)return NaN;const r=new Tn(i[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Wn(i,!1,[e.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Wn(i,!1,e.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,$n(i,!1,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const n=e.geometry(),i=n.flat().map((t=>Zt([t.x,t.y],e.canonical)));if(0===n.length)return NaN;const r=new Tn(i[0][1]);let o=1/0;for(const e of t){switch(e.type){case"Point":o=Math.min(o,Wn(i,!0,[e.coordinates],!1,r,o));break;case"LineString":o=Math.min(o,Wn(i,!0,e.coordinates,!0,r,o));break;case"Polygon":o=Math.min(o,$n(i,!0,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const n=e.geometry();if(0===n.length||0===n[0].length)return NaN;const i=vn(n,0).map((t=>t.map((t=>t.map((t=>Zt([t.x,t.y],e.canonical))))))),r=new Tn(i[0][0][0][1]);let o=1/0;for(const e of t)for(const t of i){switch(e.type){case"Point":o=Math.min(o,$n([e.coordinates],!1,t,r,o));break;case"LineString":o=Math.min(o,$n(e.coordinates,!0,t,r,o));break;case"Polygon":o=Math.min(o,Un(t,e.coordinates,r,o))}if(0===o)return o}return o}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Xn={"==":Ft,"!=":Nt,">":zt,"<":Bt,">=":Ut,"<=":jt,array:lt,at:gt,boolean:lt,case:bt,coalesce:Ot,collator:Vt,format:$t,image:Wt,in:_t,"index-of":yt,interpolate:Mt,"interpolate-hcl":Mt,"interpolate-lab":Mt,length:Ht,let:ft,literal:ot,match:vt,number:lt,"number-format":Gt,object:lt,slice:xt,step:Et,string:lt,"to-boolean":ut,"to-color":ut,"to-number":ut,"to-string":ut,var:mt,within:dn,distance:qn};class Zn{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const n=e[0],i=Zn.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const r=Array.isArray(i)?i[0]:i.type,o=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=o.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[i,o]of s){a=new pt(t.registry,ei,t.path,null,t.scope);const s=[];let l=!1;for(let t=1;t<e.length;t++){const n=e[t],r=Array.isArray(i)?i[t-1]:i.type,o=a.parse(n,1+s.length,r);if(!o){l=!0;break}s.push(o)}if(!l)if(Array.isArray(i)&&i.length!==s.length)a.error(`Expected ${i.length} arguments, but found ${s.length} instead.`);else{for(let e=0;e<s.length;e++){const t=Array.isArray(i)?i[e]:i.type,n=s[e];a.concat(e+1).checkSubtype(t,n.type)}if(0===a.errors.length)return new Zn(n,r,o,s)}}if(1===s.length)t.errors.push(...a.errors);else{const n=(s.length?s:o).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map(xe).join(", ")})`:`(${xe(t.type)}...)`;var t})).join(" | "),i=[];for(let n=1;n<e.length;n++){const r=t.parse(e[n],1+i.length);if(!r)return null;i.push(xe(r.type))}t.error(`Expected arguments of type ${n}, but found (${i.join(", ")}) instead.`)}return null}static register(e,t){Zn.definitions=t;for(const n in t)e[n]=Zn}}function Yn(e,[t,n,i,r]){t=t.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const o=r?r.evaluate(e):1,s=tt(t,n,i,o);if(s)throw new st(s);return new qe(t/255,n/255,i/255,o,!1)}function Kn(e,t){return e in t}function Jn(e,t){const n=t[e];return void 0===n?null:n}function Qn(e){return{type:e}}function ei(e){if(e instanceof mt)return ei(e.boundExpression);if(e instanceof Zn&&"error"===e.name)return!1;if(e instanceof Vt)return!1;if(e instanceof dn)return!1;if(e instanceof qn)return!1;const t=e instanceof ut||e instanceof lt;let n=!0;return e.eachChild((e=>{n=t?n&&ei(e):n&&e instanceof ot})),!!n&&ti(e)&&ii(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ti(e){if(e instanceof Zn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof dn)return!1;if(e instanceof qn)return!1;let t=!0;return e.eachChild((e=>{t&&!ti(e)&&(t=!1)})),t}function ni(e){if(e instanceof Zn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!ni(e)&&(t=!1)})),t}function ii(e,t){if(e instanceof Zn&&t.indexOf(e.name)>=0)return!1;let n=!0;return e.eachChild((e=>{n&&!ii(e,t)&&(n=!1)})),n}function ri(e){return{result:"success",value:e}}function oi(e){return{result:"error",value:e}}function si(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function ai(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function li(e){return!!e.expression&&e.expression.interpolated}function ci(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function ui(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function hi(e){return e}function di(e,t){const n="color"===t.type,i=e.stops&&"object"==typeof e.stops[0][0],r=i||!(i||void 0!==e.property),o=e.type||(li(t)?"exponential":"interval");if(n||"padding"===t.type){const i=n?qe.parse:Ke.parse;(e=oe({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],i(e[1])]))),e.default=i(e.default?e.default:t.default)}if(e.colorSpace&&"rgb"!==(s=e.colorSpace)&&"hcl"!==s&&"lab"!==s)throw new Error(`Unknown color space: "${e.colorSpace}"`);var s;let a,l,c;if("exponential"===o)a=gi;else if("interval"===o)a=mi;else if("categorical"===o){a=fi,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];c=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=_i}if(i){const n={},i=[];for(let t=0;t<e.stops.length;t++){const r=e.stops[t],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const e of i)r.push([n[e].zoom,di(n[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Mt.interpolationFactor.bind(void 0,o),zoomStops:r.map((e=>e[0])),evaluate:({zoom:n},i)=>gi({stops:r,base:e.base},t,n).evaluate(n,i)}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:Mt.interpolationFactor.bind(void 0,n),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:n})=>a(e,t,n,l,c)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[e.property]:void 0;return void 0===r?pi(e.default,t.default):a(e,t,r,l,c)}}}function pi(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function fi(e,t,n,i,r){return pi(typeof n===r?i[n]:void 0,e.default,t.default)}function mi(e,t,n){if("number"!==ci(n))return pi(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];const r=wt(e.stops.map((e=>e[0])),n);return e.stops[r][1]}function gi(e,t,n){const i=void 0!==e.base?e.base:1;if("number"!==ci(n))return pi(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];const o=wt(e.stops.map((e=>e[0])),n),s=function(e,t,n,i){const r=i-n,o=e-n;return 0===r?0:1===t?o/r:(Math.pow(t,o)-1)/(Math.pow(t,r)-1)}(n,i,e.stops[o][0],e.stops[o+1][0]),a=e.stops[o][1],l=e.stops[o+1][1],c=It[t.type]||hi;return"function"==typeof a.evaluate?{evaluate(...t){const n=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return c(n,i,s,e.colorSpace)}}:c(a,l,s,e.colorSpace)}function _i(e,t,n){switch(t.type){case"color":n=qe.parse(n);break;case"formatted":n=Ye.fromString(n.toString());break;case"resolvedImage":n=et.fromString(n.toString());break;case"padding":n=Ke.parse(n);break;default:ci(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0)}return pi(n,e.default,t.default)}Zn.register(Xn,{error:[{kind:"error"},[ue],(e,[t])=>{throw new st(t.evaluate(e))}],typeof:[ue,[fe],(e,[t])=>xe(it(t.evaluate(e)))],"to-rgba":[be(ce,4),[de],(e,[t])=>{const[n,i,r,o]=t.evaluate(e).rgb;return[255*n,255*i,255*r,o]}],rgb:[de,[ce,ce,ce],Yn],rgba:[de,[ce,ce,ce,ce],Yn],has:{type:he,overloads:[[[ue],(e,[t])=>Kn(t.evaluate(e),e.properties())],[[ue,pe],(e,[t,n])=>Kn(t.evaluate(e),n.evaluate(e))]]},get:{type:fe,overloads:[[[ue],(e,[t])=>Jn(t.evaluate(e),e.properties())],[[ue,pe],(e,[t,n])=>Jn(t.evaluate(e),n.evaluate(e))]]},"feature-state":[fe,[ue],(e,[t])=>Jn(t.evaluate(e),e.featureState||{})],properties:[pe,[],e=>e.properties()],"geometry-type":[ue,[],e=>e.geometryType()],id:[fe,[],e=>e.id()],zoom:[ce,[],e=>e.globals.zoom],"heatmap-density":[ce,[],e=>e.globals.heatmapDensity||0],"line-progress":[ce,[],e=>e.globals.lineProgress||0],accumulated:[fe,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ce,Qn(ce),(e,t)=>{let n=0;for(const i of t)n+=i.evaluate(e);return n}],"*":[ce,Qn(ce),(e,t)=>{let n=1;for(const i of t)n*=i.evaluate(e);return n}],"-":{type:ce,overloads:[[[ce,ce],(e,[t,n])=>t.evaluate(e)-n.evaluate(e)],[[ce],(e,[t])=>-t.evaluate(e)]]},"/":[ce,[ce,ce],(e,[t,n])=>t.evaluate(e)/n.evaluate(e)],"%":[ce,[ce,ce],(e,[t,n])=>t.evaluate(e)%n.evaluate(e)],ln2:[ce,[],()=>Math.LN2],pi:[ce,[],()=>Math.PI],e:[ce,[],()=>Math.E],"^":[ce,[ce,ce],(e,[t,n])=>Math.pow(t.evaluate(e),n.evaluate(e))],sqrt:[ce,[ce],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ce,[ce],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ce,[ce],(e,[t])=>Math.log(t.evaluate(e))],log2:[ce,[ce],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ce,[ce],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ce,[ce],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ce,[ce],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ce,[ce],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ce,[ce],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ce,[ce],(e,[t])=>Math.atan(t.evaluate(e))],min:[ce,Qn(ce),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ce,Qn(ce),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ce,[ce],(e,[t])=>Math.abs(t.evaluate(e))],round:[ce,[ce],(e,[t])=>{const n=t.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[ce,[ce],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ce,[ce],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[he,[ue,fe],(e,[t,n])=>e.properties()[t.value]===n.value],"filter-id-==":[he,[fe],(e,[t])=>e.id()===t.value],"filter-type-==":[he,[ue],(e,[t])=>e.geometryType()===t.value],"filter-<":[he,[ue,fe],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[he,[fe],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<i}],"filter->":[he,[ue,fe],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[he,[fe],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>i}],"filter-<=":[he,[ue,fe],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[he,[fe],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n<=i}],"filter->=":[he,[ue,fe],(e,[t,n])=>{const i=e.properties()[t.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[he,[fe],(e,[t])=>{const n=e.id(),i=t.value;return typeof n==typeof i&&n>=i}],"filter-has":[he,[fe],(e,[t])=>t.value in e.properties()],"filter-has-id":[he,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[he,[be(ue)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[he,[be(fe)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[he,[ue,be(fe)],(e,[t,n])=>n.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[he,[ue,be(fe)],(e,[t,n])=>function(e,t,n,i){for(;n<=i;){const r=n+i>>1;if(t[r]===e)return!0;t[r]>e?i=r-1:n=r+1}return!1}(e.properties()[t.value],n.value,0,n.value.length-1)],all:{type:he,overloads:[[[he,he],(e,[t,n])=>t.evaluate(e)&&n.evaluate(e)],[Qn(he),(e,t)=>{for(const n of t)if(!n.evaluate(e))return!1;return!0}]]},any:{type:he,overloads:[[[he,he],(e,[t,n])=>t.evaluate(e)||n.evaluate(e)],[Qn(he),(e,t)=>{for(const n of t)if(n.evaluate(e))return!0;return!1}]]},"!":[he,[he],(e,[t])=>!t.evaluate(e)],"is-supported-script":[he,[ue],(e,[t])=>{const n=e.globals&&e.globals.isSupportedScript;return!n||n(t.evaluate(e))}],upcase:[ue,[ue],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[ue,[ue],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[ue,Qn(fe),(e,t)=>t.map((t=>rt(t.evaluate(e)))).join("")],"resolved-locale":[ue,[me],(e,[t])=>t.evaluate(e).resolvedLocale()]});class yi{constructor(e,t){var n;this.expression=e,this._warningHistory={},this._evaluator=new dt,this._defaultValue=t?"color"===(n=t).type&&ui(n.default)?new qe(0,0,0,0):"color"===n.type?qe.parse(n.default)||null:"padding"===n.type?Ke.parse(n.default)||null:"variableAnchorOffsetCollection"===n.type?Qe.parse(n.default)||null:void 0===n.default?null:n.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,r,o){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i,this._evaluator.availableImages=r||null,this._evaluator.formattedSection=o||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new st(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function vi(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Xn}function bi(e,t){const n=new pt(Xn,ei,[],t?function(e){const t={color:de,string:ue,number:ce,enum:ue,boolean:he,formatted:ge,padding:_e,resolvedImage:ye,variableAnchorOffsetCollection:ve};return"array"===e.type?be(t[e.value]||fe,e.length):t[e.type]}(t):void 0),i=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return i?ri(new yi(i,t)):oi(n.errors)}class xi{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!ni(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}}class wi{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!ni(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,r,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,r,o)}evaluate(e,t,n,i,r,o){return this._styleExpression.evaluate(e,t,n,i,r,o)}interpolationFactor(e,t,n){return this.interpolationType?Mt.interpolationFactor(this.interpolationType,e,t,n):0}}function Ei(e,t){const n=bi(e,t);if("error"===n.result)return n;const i=n.value.expression,r=ti(i);if(!r&&!si(t))return oi([new se("","data expressions not supported")]);const o=ii(i,["zoom"]);if(!o&&!ai(t))return oi([new se("","zoom expressions not supported")]);const s=Ti(i);return s||o?s instanceof se?oi([s]):s instanceof Mt&&!li(t)?oi([new se("",'"interpolate" expressions cannot be used with this property')]):ri(s?new wi(r?"camera":"composite",n.value,s.labels,s instanceof Mt?s.interpolation:void 0):new xi(r?"constant":"source",n.value)):oi([new se("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Si{constructor(e,t){this._parameters=e,this._specification=t,oe(this,di(this._parameters,this._specification))}static deserialize(e){return new Si(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ti(e){let t=null;if(e instanceof ft)t=Ti(e.result);else if(e instanceof Ot){for(const n of e.args)if(t=Ti(n),t)break}else(e instanceof Et||e instanceof Mt)&&e.input instanceof Zn&&"zoom"===e.input.name&&(t=e);return t instanceof se||e.eachChild((e=>{const n=Ti(e);n instanceof se?t=n:!t&&n?t=new se("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&n&&t!==n&&(t=new se("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Ai(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Ai(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const Ci={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pi(e){if(null==e)return{filter:()=>!0,needGeometry:!1};Ai(e)||(e=Ri(e));const t=bi(e,Ci);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,n,i)=>t.value.evaluate(e,n,{},i),needGeometry:Mi(e)}}function Ii(e,t){return e<t?-1:e>t?1:0}function Mi(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Mi(e[t]))return!0;return!1}function Ri(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Oi(e[1],e[2],"=="):"!="===t?Di(Oi(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Oi(e[1],e[2],t):"any"===t?(n=e.slice(1),["any"].concat(n.map(Ri))):"all"===t?["all"].concat(e.slice(1).map(Ri)):"none"===t?["all"].concat(e.slice(1).map(Ri).map(Di)):"in"===t?ki(e[1],e.slice(2)):"!in"===t?Di(ki(e[1],e.slice(2))):"has"===t?Li(e[1]):"!has"!==t||Di(Li(e[1]));var n}function Oi(e,t,n){switch(e){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,e,t]}}function ki(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Ii)]]:["filter-in-small",e,["literal",t]]}}function Li(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Di(e){return["!",e]}function Fi(e){const t=typeof e;if("number"===t||"boolean"===t||"string"===t||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+=`${Fi(n)},`;return`${t}]`}const n=Object.keys(e).sort();let i="{";for(let t=0;t<n.length;t++)i+=`${JSON.stringify(n[t])}:${Fi(e[n[t]])},`;return`${i}}`}function Ni(e){let t="";for(const n of q)t+=`/${Fi(e[n])}`;return t}function Bi(e){const t=e.value;return t?[new re(e.key,t,"constants have been deprecated as of v8")]:[]}function zi(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function ji(e){if(Array.isArray(e))return e.map(ji);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const n in e)t[n]=ji(e[n]);return t}return zi(e)}function Ui(e){const t=e.key,n=e.value,i=e.valueSpec||{},r=e.objectElementValidators||{},o=e.style,s=e.styleSpec,a=e.validateSpec;let l=[];const c=ci(n);if("object"!==c)return[new re(t,n,`object expected, ${c} found`)];for(const e in n){const c=e.split(".")[0],u=i[c]||i["*"];let h;if(r[c])h=r[c];else if(i[c])h=a;else if(r["*"])h=r["*"];else{if(!i["*"]){l.push(new re(t,n[e],`unknown property "${e}"`));continue}h=a}l=l.concat(h({key:(t?`${t}.`:t)+e,value:n[e],valueSpec:u,style:o,styleSpec:s,object:n,objectKey:e,validateSpec:a},n))}for(const e in i)r[e]||i[e].required&&void 0===i[e].default&&void 0===n[e]&&l.push(new re(t,n,`missing required property "${e}"`));return l}function Vi(e){const t=e.value,n=e.valueSpec,i=e.style,r=e.styleSpec,o=e.key,s=e.arrayElementValidator||e.validateSpec;if("array"!==ci(t))return[new re(o,t,`array expected, ${ci(t)} found`)];if(n.length&&t.length!==n.length)return[new re(o,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new re(o,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let a={type:n.value,values:n.values};r.$version<7&&(a.function=n.function),"object"===ci(n.value)&&(a=n.value);let l=[];for(let n=0;n<t.length;n++)l=l.concat(s({array:t,arrayIndex:n,value:t[n],valueSpec:a,validateSpec:e.validateSpec,style:i,styleSpec:r,key:`${o}[${n}]`}));return l}function Gi(e){const t=e.key,n=e.value,i=e.valueSpec;let r=ci(n);return"number"===r&&n!=n&&(r="NaN"),"number"!==r?[new re(t,n,`number expected, ${r} found`)]:"minimum"in i&&n<i.minimum?[new re(t,n,`${n} is less than the minimum value ${i.minimum}`)]:"maximum"in i&&n>i.maximum?[new re(t,n,`${n} is greater than the maximum value ${i.maximum}`)]:[]}function $i(e){const t=e.valueSpec,n=zi(e.value.type);let i,r,o,s={};const a="categorical"!==n&&void 0===e.value.property,l=!a,c="array"===ci(e.value.stops)&&"array"===ci(e.value.stops[0])&&"object"===ci(e.value.stops[0][0]),u=Ui({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===n)return[new re(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const i=e.value;return t=t.concat(Vi({key:e.key,value:i,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===ci(i)&&0===i.length&&t.push(new re(e.key,i,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===n&&a&&u.push(new re(e.key,e.value,'missing required property "property"')),"identity"===n||e.value.stops||u.push(new re(e.key,e.value,'missing required property "stops"')),"exponential"===n&&e.valueSpec.expression&&!li(e.valueSpec)&&u.push(new re(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!si(e.valueSpec)?u.push(new re(e.key,e.value,"property functions not supported")):a&&!ai(e.valueSpec)&&u.push(new re(e.key,e.value,"zoom functions not supported"))),"categorical"!==n&&!c||void 0!==e.value.property||u.push(new re(e.key,e.value,'"property" property is required')),u;function h(e){let n=[];const i=e.value,a=e.key;if("array"!==ci(i))return[new re(a,i,`array expected, ${ci(i)} found`)];if(2!==i.length)return[new re(a,i,`array length 2 expected, length ${i.length} found`)];if(c){if("object"!==ci(i[0]))return[new re(a,i,`object expected, ${ci(i[0])} found`)];if(void 0===i[0].zoom)return[new re(a,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new re(a,i,"object stop key must have value")];if(o&&o>zi(i[0].zoom))return[new re(a,i[0].zoom,"stop zoom values must appear in ascending order")];zi(i[0].zoom)!==o&&(o=zi(i[0].zoom),r=void 0,s={}),n=n.concat(Ui({key:`${a}[0]`,value:i[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Gi,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:i[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},i));return vi(ji(i[1]))?n.concat([new re(`${a}[1]`,i[1],"expressions are not allowed in function stops.")]):n.concat(e.validateSpec({key:`${a}[1]`,value:i[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,o){const a=ci(e.value),l=zi(e.value),c=null!==e.value?e.value:o;if(i){if(a!==i)return[new re(e.key,c,`${a} stop domain type must match previous stop domain type ${i}`)]}else i=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new re(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let i=`number expected, ${a} found`;return si(t)&&void 0===n&&(i+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new re(e.key,c,i)]}return"categorical"!==n||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==n&&"number"===a&&void 0!==r&&l<r?[new re(e.key,c,"stop domain values must appear in ascending order")]:(r=l,"categorical"===n&&l in s?[new re(e.key,c,"stop domain values must be unique")]:(s[l]=!0,[])):[new re(e.key,c,`integer expected, found ${l}`)]}}function Wi(e){const t=("property"===e.expressionContext?Ei:bi)(ji(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new re(`${e.key}${t.key}`,e.value,t.message)));const n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new re(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ni(n))return[new re(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!ni(n))return[new re(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!ii(n,["zoom","feature-state"]))return[new re(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!ti(n))return[new re(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hi(e){const t=e.key,n=e.value,i=e.valueSpec,r=[];return Array.isArray(i.values)?-1===i.values.indexOf(zi(n))&&r.push(new re(t,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(i.values).indexOf(zi(n))&&r.push(new re(t,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function qi(e){return Ai(ji(e.value))?Wi(oe({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Xi(e)}function Xi(e){const t=e.value,n=e.key;if("array"!==ci(t))return[new re(n,t,`array expected, ${ci(t)} found`)];const i=e.styleSpec;let r,o=[];if(t.length<1)return[new re(n,t,"filter array must have at least 1 element")];switch(o=o.concat(Hi({key:`${n}[0]`,value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),zi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===zi(t[1])&&o.push(new re(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&o.push(new re(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r=ci(t[1]),"string"!==r&&o.push(new re(`${n}[1]`,t[1],`string expected, ${r} found`)));for(let s=2;s<t.length;s++)r=ci(t[s]),"$type"===zi(t[1])?o=o.concat(Hi({key:`${n}[${s}]`,value:t[s],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==r&&"number"!==r&&"boolean"!==r&&o.push(new re(`${n}[${s}]`,t[s],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let i=1;i<t.length;i++)o=o.concat(Xi({key:`${n}[${i}]`,value:t[i],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":r=ci(t[1]),2!==t.length?o.push(new re(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==r&&o.push(new re(`${n}[1]`,t[1],`string expected, ${r} found`))}return o}function Zi(e,t){const n=e.key,i=e.validateSpec,r=e.style,o=e.styleSpec,s=e.value,a=e.objectKey,l=o[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return i({key:n,value:s,valueSpec:o.transition,style:r,styleSpec:o});const u=e.valueSpec||l[a];if(!u)return[new re(n,s,`unknown property "${a}"`)];let h;if("string"===ci(s)&&si(u)&&!u.tokens&&(h=/^{([^}]+)}$/.exec(s)))return[new re(n,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(h[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&r&&!r.glyphs&&d.push(new re(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&ui(ji(s))&&"identity"===zi(s.type)&&d.push(new re(n,s,'"text-font" does not support identity functions'))),d.concat(i({key:e.key,value:s,valueSpec:u,style:r,styleSpec:o,expressionContext:"property",propertyType:t,propertyKey:a}))}function Yi(e){return Zi(e,"paint")}function Ki(e){return Zi(e,"layout")}function Ji(e){let t=[];const n=e.value,i=e.key,r=e.style,o=e.styleSpec;n.type||n.ref||t.push(new re(i,n,'either "type" or "ref" is required'));let s=zi(n.type);const a=zi(n.ref);if(n.id){const o=zi(n.id);for(let s=0;s<e.arrayIndex;s++){const e=r.layers[s];zi(e.id)===o&&t.push(new re(i,n.id,`duplicate layer id "${n.id}", previously used at line ${e.id.__line__}`))}}if("ref"in n){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in n&&t.push(new re(i,n[e],`"${e}" is prohibited for ref layers`))})),r.layers.forEach((t=>{zi(t.id)===a&&(e=t)})),e?e.ref?t.push(new re(i,n.ref,"ref cannot reference another ref layer")):s=zi(e.type):t.push(new re(i,n.ref,`ref layer "${a}" not found`))}else if("background"!==s)if(n.source){const e=r.sources&&r.sources[n.source],o=e&&zi(e.type);e?"vector"===o&&"raster"===s?t.push(new re(i,n.source,`layer "${n.id}" requires a raster source`)):"raster-dem"!==o&&"hillshade"===s?t.push(new re(i,n.source,`layer "${n.id}" requires a raster-dem source`)):"raster"===o&&"raster"!==s?t.push(new re(i,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?t.push(new re(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&e.lineMetrics||t.push(new re(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new re(i,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new re(i,n.source,`source "${n.source}" not found`))}else t.push(new re(i,n,'missing required property "source"'));return t=t.concat(Ui({key:i,value:n,valueSpec:o.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${i}.type`,value:n.type,valueSpec:o.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:n,objectKey:"type"}),filter:qi,layout:e=>Ui({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Ki(oe({layerType:s},e))}}),paint:e=>Ui({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>Yi(oe({layerType:s},e))}})}})),t}function Qi(e){const t=e.value,n=e.key,i=ci(t);return"string"!==i?[new re(n,t,`string expected, ${i} found`)]:[]}const er={promoteId:function({key:e,value:t}){if("string"===ci(t))return Qi({key:e,value:t});{const n=[];for(const i in t)n.push(...Qi({key:`${e}.${i}`,value:t[i]}));return n}}};function tr(e){const t=e.value,n=e.key,i=e.styleSpec,r=e.style,o=e.validateSpec;if(!t.type)return[new re(n,t,'"type" is required')];const s=zi(t.type);let a;switch(s){case"vector":case"raster":return a=Ui({key:n,value:t,valueSpec:i[`source_${s.replace("-","_")}`],style:e.style,styleSpec:i,objectElementValidators:er,validateSpec:o}),a;case"raster-dem":return a=function(e){var t;const n=null!==(t=e.sourceName)&&void 0!==t?t:"",i=e.value,r=e.styleSpec,o=r.source_raster_dem,s=e.style;let a=[];const l=ci(i);if(void 0===i)return a;if("object"!==l)return a.push(new re("source_raster_dem",i,`object expected, ${l} found`)),a;const c="custom"===zi(i.encoding),u=["redFactor","greenFactor","blueFactor","baseShift"],h=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in i)!c&&u.includes(t)?a.push(new re(t,i[t],`In "${n}": "${t}" is only valid when "encoding" is set to "custom". ${h} encoding found`)):o[t]?a=a.concat(e.validateSpec({key:t,value:i[t],valueSpec:o[t],validateSpec:e.validateSpec,style:s,styleSpec:r})):a.push(new re(t,i[t],`unknown property "${t}"`));return a}({sourceName:n,value:t,style:e.style,styleSpec:i,validateSpec:o}),a;case"geojson":if(a=Ui({key:n,value:t,valueSpec:i.source_geojson,style:r,styleSpec:i,validateSpec:o,objectElementValidators:er}),t.cluster)for(const e in t.clusterProperties){const[i,r]=t.clusterProperties[e],s="string"==typeof i?[i,["accumulated"],["get",e]]:i;a.push(...Wi({key:`${n}.${e}.map`,value:r,validateSpec:o,expressionContext:"cluster-map"})),a.push(...Wi({key:`${n}.${e}.reduce`,value:s,validateSpec:o,expressionContext:"cluster-reduce"}))}return a;case"video":return Ui({key:n,value:t,valueSpec:i.source_video,style:r,validateSpec:o,styleSpec:i});case"image":return Ui({key:n,value:t,valueSpec:i.source_image,style:r,validateSpec:o,styleSpec:i});case"canvas":return[new re(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hi({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:r,validateSpec:o,styleSpec:i})}}function nr(e){const t=e.value,n=e.styleSpec,i=n.light,r=e.style;let o=[];const s=ci(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new re("light",t,`object expected, ${s} found`)]),o;for(const s in t){const a=s.match(/^(.*)-transition$/);o=o.concat(a&&i[a[1]]&&i[a[1]].transition?e.validateSpec({key:s,value:t[s],valueSpec:n.transition,validateSpec:e.validateSpec,style:r,styleSpec:n}):i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:r,styleSpec:n}):[new re(s,t[s],`unknown property "${s}"`)])}return o}function ir(e){const t=e.value,n=e.styleSpec,i=n.sky,r=e.style,o=ci(t);if(void 0===t)return[];if("object"!==o)return[new re("sky",t,`object expected, ${o} found`)];let s=[];for(const o in t)s=s.concat(i[o]?e.validateSpec({key:o,value:t[o],valueSpec:i[o],style:r,styleSpec:n}):[new re(o,t[o],`unknown property "${o}"`)]);return s}function rr(e){const t=e.value,n=e.styleSpec,i=n.terrain,r=e.style;let o=[];const s=ci(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new re("terrain",t,`object expected, ${s} found`)]),o;for(const s in t)o=o.concat(i[s]?e.validateSpec({key:s,value:t[s],valueSpec:i[s],validateSpec:e.validateSpec,style:r,styleSpec:n}):[new re(s,t[s],`unknown property "${s}"`)]);return o}function or(e){let t=[];const n=e.value,i=e.key;if(Array.isArray(n)){const r=[],o=[];for(const s in n)n[s].id&&r.includes(n[s].id)&&t.push(new re(i,n,`all the sprites' ids must be unique, but ${n[s].id} is duplicated`)),r.push(n[s].id),n[s].url&&o.includes(n[s].url)&&t.push(new re(i,n,`all the sprites' URLs must be unique, but ${n[s].url} is duplicated`)),o.push(n[s].url),t=t.concat(Ui({key:`${i}[${s}]`,value:n[s],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:e.validateSpec}));return t}return Qi({key:i,value:n})}const sr={"*":()=>[],array:Vi,boolean:function(e){const t=e.value,n=e.key,i=ci(t);return"boolean"!==i?[new re(n,t,`boolean expected, ${i} found`)]:[]},number:Gi,color:function(e){const t=e.key,n=e.value,i=ci(n);return"string"!==i?[new re(t,n,`color expected, ${i} found`)]:qe.parse(String(n))?[]:[new re(t,n,`color expected, "${n}" found`)]},constants:Bi,enum:Hi,filter:qi,function:$i,layer:Ji,object:Ui,source:tr,light:nr,sky:ir,terrain:rr,string:Qi,formatted:function(e){return 0===Qi(e).length?[]:Wi(e)},resolvedImage:function(e){return 0===Qi(e).length?[]:Wi(e)},padding:function(e){const t=e.key,n=e.value;if("array"===ci(n)){if(n.length<1||n.length>4)return[new re(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const i={type:"number"};let r=[];for(let o=0;o<n.length;o++)r=r.concat(e.validateSpec({key:`${t}[${o}]`,value:n[o],validateSpec:e.validateSpec,valueSpec:i}));return r}return Gi({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(e){const t=e.key,n=e.value,i=ci(n),r=e.styleSpec;if("array"!==i||n.length<1||n.length%2!=0)return[new re(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let o=[];for(let i=0;i<n.length;i+=2)o=o.concat(Hi({key:`${t}[${i}]`,value:n[i],valueSpec:r.layout_symbol["text-anchor"]})),o=o.concat(Vi({key:`${t}[${i+1}]`,value:n[i+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:r}));return o},sprite:or};function ar(e){const t=e.value,n=e.valueSpec,i=e.styleSpec;return e.validateSpec=ar,n.expression&&ui(zi(t))?$i(e):n.expression&&vi(ji(t))?Wi(e):n.type&&sr[n.type]?sr[n.type](e):Ui(oe({},e,{valueSpec:n.type?i[n.type]:n}))}function lr(e){const t=e.value,n=e.key,i=Qi(e);return i.length||(-1===t.indexOf("{fontstack}")&&i.push(new re(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&i.push(new re(n,t,'"glyphs" url must include a "{range}" token'))),i}function cr(e,t=H){let n=[];return n=n.concat(ar({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:ar,objectElementValidators:{glyphs:lr,"*":()=>[]}})),e.constants&&(n=n.concat(Bi({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:ar}))),hr(n)}function ur(e){return function(t){return e({...t,validateSpec:ar})}}function hr(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function dr(e){return function(...t){return hr(e.apply(this,t))}}cr.source=dr(ur(tr)),cr.sprite=dr(ur(or)),cr.glyphs=dr(ur(lr)),cr.light=dr(ur(nr)),cr.sky=dr(ur(ir)),cr.terrain=dr(ur(rr)),cr.layer=dr(ur(Ji)),cr.filter=dr(ur(qi)),cr.paintProperty=dr(ur(Yi)),cr.layoutProperty=dr(ur(Ki));const pr=cr,fr=pr.light,mr=pr.paintProperty,gr=pr.layoutProperty;function _r(e,t){let n=!1;if(t&&t.length)for(const i of t)e.fire(new $(new Error(i.message))),n=!0;return n}class yr{constructor(e,t,n){const i=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const r=new Int32Array(this.arrayBuffer);e=r[0],this.d=(t=r[1])+2*(n=r[2]);for(let e=0;e<this.d*this.d;e++){const t=r[3+e],n=r[3+e+1];i.push(t===n?null:r.subarray(t,n))}const o=r[3+i.length+1];this.keys=r.subarray(r[3+i.length],o),this.bboxes=r.subarray(o),this.insert=this._insertReadonly}else{this.d=t+2*n;for(let e=0;e<this.d*this.d;e++)i.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;const r=n/t*e;this.min=-r,this.max=e+r}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,t,n,i,r,o){this.cells[r].push(o)}query(e,t,n,i,r){const o=this.min,s=this.max;if(e<=o&&t<=o&&s<=n&&s<=i&&!r)return Array.prototype.slice.call(this.keys);{const o=[];return this._forEachCell(e,t,n,i,this._queryCell,o,{},r),o}}_queryCell(e,t,n,i,r,o,s,a){const l=this.cells[r];if(null!==l){const r=this.keys,c=this.bboxes;for(let u=0;u<l.length;u++){const h=l[u];if(void 0===s[h]){const l=4*h;(a?a(c[l+0],c[l+1],c[l+2],c[l+3]):e<=c[l+2]&&t<=c[l+3]&&n>=c[l+0]&&i>=c[l+1])?(s[h]=!0,o.push(r[h])):s[h]=!1}}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(n),h=this._convertToCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++){const c=this.d*l+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(l),this._convertFromCellCoord(d+1),this._convertFromCellCoord(l+1)))&&r.call(this,e,t,n,i,c,o,s,a))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,t=3+this.cells.length+1+1;let n=0;for(let e=0;e<this.cells.length;e++)n+=this.cells[e].length;const i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;let r=t;for(let t=0;t<e.length;t++){const n=e[t];i[3+t]=r,i.set(n,r),r+=n.length}return i[3+e.length]=r,i.set(this.keys,r),r+=this.keys.length,i[3+e.length+1]=r,i.set(this.bboxes,r),r+=this.bboxes.length,i.buffer}static serialize(e,t){const n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}}static deserialize(e){return new yr(e.buffer)}}const vr={};function br(e,t,n={}){if(vr[e])throw new Error(`${e} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),vr[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}br("Object",Object),br("TransferableGridIndex",yr),br("Color",qe),br("Error",Error),br("AJAXError",N),br("ResolvedImage",et),br("StylePropertyFunction",Si),br("StyleExpression",yi,{omit:["_evaluator"]}),br("ZoomDependentExpression",wi),br("ZoomConstantExpression",xi),br("CompoundExpression",Zn,{omit:["_evaluate"]});for(const e in Xn)Xn[e]._classRegistryKey||br(`Expression_${e}`,Xn[e]);function xr(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function wr(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error)return e;if(xr(e))return t&&t.push(e),e;if(C(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const n=e;return t&&t.push(n.buffer),n}if(e instanceof ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const n=[];for(const i of e)n.push(wr(i,t));return n}if("object"==typeof e){const n=e.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${n.name}`);if(!vr[i])throw new Error(`${i} is not registered.`);const r=n.serialize?n.serialize(e,t):{};if(n.serialize){if(t&&r===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const n in e){if(!e.hasOwnProperty(n))continue;if(vr[i].omit.indexOf(n)>=0)continue;const o=e[n];r[n]=vr[i].shallow.indexOf(n)>=0?o:wr(o,t)}e instanceof Error&&(r.message=e.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==i&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof e)}function Er(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof Blob||e instanceof Error||xr(e)||C(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(Er);if("object"==typeof e){const t=e.$name||"Object";if(!vr[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=vr[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(e);const i=Object.create(n.prototype);for(const n of Object.keys(e)){if("$name"===n)continue;const r=e[n];i[n]=vr[t].shallow.indexOf(n)>=0?r:Er(r)}return i}throw new Error("can't deserialize object of type "+typeof e)}class Sr{constructor(){this.first=!0}update(e,t){const n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}const Tr={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function Ar(e){for(const t of e)if(Ir(t.charCodeAt(0)))return!0;return!1}function Cr(e){for(const t of e)if(!Pr(t.charCodeAt(0)))return!1;return!0}function Pr(e){return!(Tr.Arabic(e)||Tr["Arabic Supplement"](e)||Tr["Arabic Extended-A"](e)||Tr["Arabic Presentation Forms-A"](e)||Tr["Arabic Presentation Forms-B"](e))}function Ir(e){return!(746!==e&&747!==e&&(e<4352||!(Tr["Bopomofo Extended"](e)||Tr.Bopomofo(e)||Tr["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Tr["CJK Compatibility Ideographs"](e)||Tr["CJK Compatibility"](e)||Tr["CJK Radicals Supplement"](e)||Tr["CJK Strokes"](e)||!(!Tr["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Tr["CJK Unified Ideographs Extension A"](e)||Tr["CJK Unified Ideographs"](e)||Tr["Enclosed CJK Letters and Months"](e)||Tr["Hangul Compatibility Jamo"](e)||Tr["Hangul Jamo Extended-A"](e)||Tr["Hangul Jamo Extended-B"](e)||Tr["Hangul Jamo"](e)||Tr["Hangul Syllables"](e)||Tr.Hiragana(e)||Tr["Ideographic Description Characters"](e)||Tr.Kanbun(e)||Tr["Kangxi Radicals"](e)||Tr["Katakana Phonetic Extensions"](e)||Tr.Katakana(e)&&12540!==e||!(!Tr["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!Tr["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Tr["Unified Canadian Aboriginal Syllabics"](e)||Tr["Unified Canadian Aboriginal Syllabics Extended"](e)||Tr["Vertical Forms"](e)||Tr["Yijing Hexagram Symbols"](e)||Tr["Yi Syllables"](e)||Tr["Yi Radicals"](e))))}function Mr(e){return!(Ir(e)||function(e){return!!(Tr["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||Tr["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||Tr["Letterlike Symbols"](e)||Tr["Number Forms"](e)||Tr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||Tr["Control Pictures"](e)&&9251!==e||Tr["Optical Character Recognition"](e)||Tr["Enclosed Alphanumerics"](e)||Tr["Geometric Shapes"](e)||Tr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Tr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Tr["CJK Symbols and Punctuation"](e)||Tr.Katakana(e)||Tr["Private Use Area"](e)||Tr["CJK Compatibility Forms"](e)||Tr["Small Form Variants"](e)||Tr["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Rr(e){return e>=1424&&e<=2303||Tr["Arabic Presentation Forms-A"](e)||Tr["Arabic Presentation Forms-B"](e)}function Or(e,t){return!(!t&&Rr(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Tr.Khmer(e))}function kr(e){for(const t of e)if(Rr(t.charCodeAt(0)))return!0;return!1}const Lr=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(e){this.pluginStatus=e.pluginStatus,this.pluginURL=e.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(e){this.applyArabicShaping=e.applyArabicShaping,this.processBidirectionalText=e.processBidirectionalText,this.processStyledBidirectionalText=e.processStyledBidirectionalText}isParsed(){return null!=this.applyArabicShaping&&null!=this.processBidirectionalText&&null!=this.processStyledBidirectionalText}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Dr{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Sr,this.transition={})}isSupportedScript(e){return function(e,t){for(const n of e)if(!Or(n.charCodeAt(0),t))return!1;return!0}(e,"loaded"===Lr.getRTLTextPluginStatus())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}class Fr{constructor(e,t){this.property=e,this.value=t,this.expression=function(e,t){if(ui(e))return new Si(e,t);if(vi(e)){const n=Ei(e,t);if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return n.value}{let n=e;return"color"===t.type&&"string"==typeof e?n=qe.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)&&(n=Qe.parse(e)):n=Ke.parse(e),{kind:"constant",evaluate:()=>n}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class Nr{constructor(e){this.property=e,this.value=new Fr(e,void 0)}transitioned(e,t){return new zr(this.property,this.value,t,_({},e.transition,this.transition),e.now)}untransitioned(){return new zr(this.property,this.value,null,{},0)}}class Br{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return x(this._values[e].value.value)}setValue(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nr(this._values[e].property)),this._values[e].value=new Fr(this._values[e].property,null===t?void 0:x(t))}getTransition(e){return x(this._values[e].transition)}setTransition(e,t){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nr(this._values[e].property)),this._values[e].transition=x(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new jr(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new jr(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class zr{constructor(e,t,n,i,r){this.property=e,this.value=t,this.begin=r+i.delay||0,this.end=this.begin+i.duration||0,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,r=this.value.possiblyEvaluate(e,t,n),o=this.prior;if(o){if(i>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(i<this.begin)return o.possiblyEvaluate(e,t,n);{const s=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,n),r,function(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}(s))}}return r}}class jr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Gr(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ur{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}hasValue(e){return void 0!==this._values[e].value}getValue(e){return x(this._values[e].value)}setValue(e,t){this._values[e]=new Fr(this._values[e].property,null===t?void 0:x(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Gr(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].possiblyEvaluate(e,t,n);return i}}class Vr{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Gr{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $r{constructor(e){this.specification=e}possiblyEvaluate(e,t){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(t)}interpolate(e,t,n){const i=It[this.specification.type];return i?i(e,t,n):e}}class Wr{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Vr(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Vr(this,{kind:"constant",value:void 0},e.parameters);const i=It[this.specification.type];if(i){const r=i(e.value.value,t.value.value,n);return new Vr(this,{kind:"constant",value:r},e.parameters)}return e}evaluate(e,t,n,i,r,o){return"constant"===e.kind?e.value:e.evaluate(t,n,i,r,o)}}class Hr extends Wr{possiblyEvaluate(e,t,n,i){if(void 0===e.value)return new Vr(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i),o="resolvedImage"===e.property.specification.type&&"string"!=typeof r?r.name:r,s=this._calculate(o,o,o,t);return new Vr(this,{kind:"constant",value:s},t)}if("camera"===e.expression.kind){const n=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new Vr(this,{kind:"constant",value:n},t)}return new Vr(this,e.expression,t)}evaluate(e,t,n,i,r,o){if("source"===e.kind){const s=e.evaluate(t,n,i,r,o);return this._calculate(s,s,s,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,i),e.evaluate({zoom:Math.floor(t.zoom)},n,i),e.evaluate({zoom:Math.floor(t.zoom)+1},n,i),t):e.value}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class qr{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){if(void 0!==e.value){if("constant"===e.expression.kind){const r=e.expression.evaluate(t,null,{},n,i);return this._calculate(r,r,r,t)}return this._calculate(e.expression.evaluate(new Dr(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Dr(Math.floor(t.zoom),t)),e.expression.evaluate(new Dr(Math.floor(t.zoom+1),t)),t)}}_calculate(e,t,n,i){return i.zoom>i.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}interpolate(e){return e}}class Xr{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class Zr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const t in e){const n=e[t];n.specification.overridable&&this.overridableProperties.push(t);const i=this.defaultPropertyValues[t]=new Fr(n,void 0),r=this.defaultTransitionablePropertyValues[t]=new Nr(n);this.defaultTransitioningPropertyValues[t]=r.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=i.possiblyEvaluate({})}}}br("DataDrivenProperty",Wr),br("DataConstantProperty",$r),br("CrossFadedDataDrivenProperty",Hr),br("CrossFadedProperty",qr),br("ColorRampProperty",Xr);const Yr="-transition";class Kr extends W{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Ur(t.layout)),t.paint)){this._transitionablePaint=new Br(t.paint);for(const t in e.paint)this.setPaintProperty(t,e.paint[t],{validate:!1});for(const t in e.layout)this.setLayoutProperty(t,e.layout[t],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gr(t.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){null!=t&&this._validate(gr,`layers.${this.id}.layout.${e}`,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return e.endsWith(Yr)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(mr,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(e.endsWith(Yr))return this._transitionablePaint.setTransition(e.slice(0,-11),t||void 0),!1;{const n=this._transitionablePaint._values[e],i="cross-faded-data-driven"===n.property.specification["property-type"],r=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const s=this._transitionablePaint._values[e].value;return s.isDataDriven()||r||i||this._handleOverridablePaintPropertyUpdate(e,o,s)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),b(e,((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}_validate(e,t,n,i,r={}){return(!r||!1!==r.validate)&&_r(this,e.call(pr,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:H,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Vr&&si(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}const Jr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Qr{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class eo{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function to(e,t=1){let n=0,i=0;return{members:e.map((e=>{const r=Jr[e.type].BYTES_PER_ELEMENT,o=n=no(n,Math.max(t,r)),s=e.components||1;return i=Math.max(i,r),n+=r*s,{name:e.name,type:e.type,components:s,offset:o}})),size:no(n,Math.max(i,t)),alignment:t}}function no(e,t){return Math.ceil(e/t)*t}class io extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}io.prototype.bytesPerElement=4,br("StructArrayLayout2i4",io);class ro extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.int16[r+0]=t,this.int16[r+1]=n,this.int16[r+2]=i,e}}ro.prototype.bytesPerElement=6,br("StructArrayLayout3i6",ro);class oo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=n,this.int16[o+2]=i,this.int16[o+3]=r,e}}oo.prototype.bytesPerElement=8,br("StructArrayLayout4i8",oo);class so extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}so.prototype.bytesPerElement=12,br("StructArrayLayout2i4i12",so);class ao extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=4*e,l=8*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.uint8[l+4]=i,this.uint8[l+5]=r,this.uint8[l+6]=o,this.uint8[l+7]=s,e}}ao.prototype.bytesPerElement=8,br("StructArrayLayout2i4ub8",ao);class lo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}lo.prototype.bytesPerElement=8,br("StructArrayLayout2f8",lo);class co extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,t,n,i,r,o,s,a,l,c)}emplace(e,t,n,i,r,o,s,a,l,c,u){const h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=i,this.uint16[h+3]=r,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=l,this.uint16[h+8]=c,this.uint16[h+9]=u,e}}co.prototype.bytesPerElement=20,br("StructArrayLayout10ui20",co);class uo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,r,o,s,a,l,c,u,h)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=n,this.int16[p+2]=i,this.int16[p+3]=r,this.uint16[p+4]=o,this.uint16[p+5]=s,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=h,this.int16[p+11]=d,e}}uo.prototype.bytesPerElement=24,br("StructArrayLayout4i4ui4i24",uo);class ho extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.float32[r+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}ho.prototype.bytesPerElement=12,br("StructArrayLayout3f12",ho);class po extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}po.prototype.bytesPerElement=4,br("StructArrayLayout1ul4",po);class fo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,i,r,o,s,a,l)}emplace(e,t,n,i,r,o,s,a,l,c){const u=10*e,h=5*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+3]=r,this.int16[u+4]=o,this.int16[u+5]=s,this.uint32[h+3]=a,this.uint16[u+8]=l,this.uint16[u+9]=c,e}}fo.prototype.bytesPerElement=20,br("StructArrayLayout6i1ul2ui20",fo);class mo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=r,this.int16[a+4]=o,this.int16[a+5]=s,e}}mo.prototype.bytesPerElement=12,br("StructArrayLayout2i2i2i12",mo);class go extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,r)}emplace(e,t,n,i,r,o){const s=4*e,a=8*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,this.int16[a+6]=r,this.int16[a+7]=o,e}}go.prototype.bytesPerElement=16,br("StructArrayLayout2f1f2i16",go);class _o extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i,r,o)}emplace(e,t,n,i,r,o,s){const a=16*e,l=4*e,c=8*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.int16[c+6]=o,this.int16[c+7]=s,e}}_o.prototype.bytesPerElement=16,br("StructArrayLayout2ub2f2i16",_o);class yo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,this.uint16[r+2]=i,e}}yo.prototype.bytesPerElement=6,br("StructArrayLayout3ui6",yo);class vo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_){const y=24*e,v=12*e,b=48*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.uint16[y+2]=i,this.uint16[y+3]=r,this.uint32[v+2]=o,this.uint32[v+3]=s,this.uint32[v+4]=a,this.uint16[y+10]=l,this.uint16[y+11]=c,this.uint16[y+12]=u,this.float32[v+7]=h,this.float32[v+8]=d,this.uint8[b+36]=p,this.uint8[b+37]=f,this.uint8[b+38]=m,this.uint32[v+10]=g,this.int16[y+22]=_,e}}vo.prototype.bytesPerElement=48,br("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vo);class bo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,E,S,T,A,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,E,S,T,A,C)}emplace(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,E,S,T,A,C,P){const I=32*e,M=16*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.int16[I+3]=r,this.int16[I+4]=o,this.int16[I+5]=s,this.int16[I+6]=a,this.int16[I+7]=l,this.uint16[I+8]=c,this.uint16[I+9]=u,this.uint16[I+10]=h,this.uint16[I+11]=d,this.uint16[I+12]=p,this.uint16[I+13]=f,this.uint16[I+14]=m,this.uint16[I+15]=g,this.uint16[I+16]=_,this.uint16[I+17]=y,this.uint16[I+18]=v,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=w,this.uint16[I+22]=E,this.uint32[M+12]=S,this.float32[M+13]=T,this.float32[M+14]=A,this.uint16[I+30]=C,this.uint16[I+31]=P,e}}bo.prototype.bytesPerElement=64,br("StructArrayLayout8i15ui1ul2f2ui64",bo);class xo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}xo.prototype.bytesPerElement=4,br("StructArrayLayout1f4",xo);class wo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=3*e;return this.uint16[6*e+0]=t,this.float32[r+1]=n,this.float32[r+2]=i,e}}wo.prototype.bytesPerElement=12,br("StructArrayLayout1ui2f12",wo);class Eo extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const r=4*e;return this.uint32[2*e+0]=t,this.uint16[r+2]=n,this.uint16[r+3]=i,e}}Eo.prototype.bytesPerElement=8,br("StructArrayLayout1ul2ui8",Eo);class So extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}So.prototype.bytesPerElement=4,br("StructArrayLayout2ui4",So);class To extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}To.prototype.bytesPerElement=2,br("StructArrayLayout1ui2",To);class Ao extends eo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,n,i)}emplace(e,t,n,i,r){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=r,e}}Ao.prototype.bytesPerElement=16,br("StructArrayLayout4f16",Ao);class Co extends Qr{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new o(this.anchorPointX,this.anchorPointY)}}Co.prototype.size=20;class Po extends fo{get(e){return new Co(this,e)}}br("CollisionBoxArray",Po);class Io extends Qr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Io.prototype.size=48;class Mo extends vo{get(e){return new Io(this,e)}}br("PlacedSymbolArray",Mo);class Ro extends Qr{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ro.prototype.size=64;class Oo extends bo{get(e){return new Ro(this,e)}}br("SymbolInstanceArray",Oo);class ko extends xo{getoffsetX(e){return this.float32[1*e+0]}}br("GlyphOffsetArray",ko);class Lo extends ro{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}br("SymbolLineVertexArray",Lo);class Do extends Qr{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Do.prototype.size=12;class Fo extends wo{get(e){return new Do(this,e)}}br("TextAnchorOffsetArray",Fo);class No extends Qr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}No.prototype.size=8;class Bo extends Eo{get(e){return new No(this,e)}}br("FeatureIndexArray",Bo);class zo extends io{}class jo extends io{}class Uo extends io{}class Vo extends so{}class Go extends ao{}class $o extends lo{}class Wo extends co{}class Ho extends uo{}class qo extends ho{}class Xo extends po{}class Zo extends mo{}class Yo extends _o{}class Ko extends yo{}class Jo extends So{}const Qo=to([{name:"a_pos",components:2,type:"Int16"}],4),{members:es}=Qo;class ts{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let r=this.segments[this.segments.length-1];return e>ts.MAX_VERTEX_ARRAY_LENGTH&&E(`Max vertices per segment is ${ts.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!r||r.vertexLength+e>ts.MAX_VERTEX_ARRAY_LENGTH||r.sortKey!==i)&&(r={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(r.sortKey=i),this.segments.push(r)),r}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new ts([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}function ns(e,t){return 256*(e=m(Math.floor(e),0,255))+m(Math.floor(t),0,255)}ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,br("SegmentVector",ts);const is=to([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var rs={exports:{}},os=function(e,t){var n,i,r,o,s,a,l,c;for(i=e.length-(n=3&e.length),r=t,s=3432918353,a=461845907,c=0;c<i;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,r=27492+(65535&(o=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0},ss=function(e,t){for(var n,i=e.length,r=t^i,o=0;i>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),i-=4,++o;switch(i){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0};rs.exports=os,rs.exports.murmur3=os,rs.exports.murmur2=ss;var as=n(rs.exports);class ls{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(cs(e)),this.positions.push(t,n,i)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const t=cs(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=t?i=e:n=e+1}const r=[];for(;this.ids[n]===t;)r.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return r}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return us(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new ls;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function cs(e){const t=+e;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:as(String(e))}function us(e,t,n,i){for(;n<i;){const r=e[n+i>>1];let o=n-1,s=i+1;for(;;){do{o++}while(e[o]<r);do{s--}while(e[s]>r);if(o>=s)break;hs(e,o,s),hs(t,3*o,3*s),hs(t,3*o+1,3*s+1),hs(t,3*o+2,3*s+2)}s-n<i-s?(us(e,t,n,s),n=s+1):(us(e,t,s+1,i),i=s)}}function hs(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}br("FeaturePositionMap",ls);class ds{constructor(e,t){this.gl=e.gl,this.location=t}}class ps extends ds{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fs extends ds{constructor(e,t){super(e,t),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class ms extends ds{constructor(e,t){super(e,t),this.current=qe.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const gs=new Float32Array(16);function _s(e){return[ns(255*e.r,255*e.g),ns(255*e.b,255*e.a)]}class ys{constructor(e,t,n){this.value=e,this.uniformNames=t.map((e=>`u_${e}`)),this.type=n}setUniform(e,t,n){e.set(n.constantOr(this.value))}getBinding(e,t,n){return"color"===this.type?new ms(e,t):new ps(e,t)}}class vs{constructor(e,t){this.uniformNames=t.map((e=>`u_${e}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}setUniform(e,t,n,i){const r="u_pattern_to"===i?this.patternTo:"u_pattern_from"===i?this.patternFrom:"u_pixel_ratio_to"===i?this.pixelRatioTo:"u_pixel_ratio_from"===i?this.pixelRatioFrom:null;r&&e.set(r)}getBinding(e,t,n){return"u_pattern"===n.substr(0,9)?new fs(e,t):new ps(e,t)}}class bs{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?2:1,offset:0}))),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,r){const o=this.paintVertexArray.length,s=this.expression.evaluate(new Dr(0),t,{},i,[],r);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:0},n,i);this._setPaintValue(e,t,r)}_setPaintValue(e,t,n){if("color"===this.type){const i=_s(n);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xs{constructor(e,t,n,i,r,o){this.expression=e,this.uniformNames=t.map((e=>`u_${e}_t`)),this.type=n,this.useIntegerZoom=i,this.zoom=r,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:`a_${e}`,type:"Float32",components:"color"===n?4:2,offset:0}))),this.paintVertexArray=new o}populatePaintArray(e,t,n,i,r){const o=this.expression.evaluate(new Dr(this.zoom),t,{},i,[],r),s=this.expression.evaluate(new Dr(this.zoom+1),t,{},i,[],r),a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(a,e,o,s)}updatePaintArray(e,t,n,i){const r=this.expression.evaluate({zoom:this.zoom},n,i),o=this.expression.evaluate({zoom:this.zoom+1},n,i);this._setPaintValue(e,t,r,o)}_setPaintValue(e,t,n,i){if("color"===this.type){const r=_s(n),o=_s(i);for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r[0],r[1],o[0],o[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t){const n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,i=m(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(i)}getBinding(e,t,n){return new ps(e,t)}}class ws{constructor(e,t,n,i,r,o){this.expression=e,this.type=t,this.useIntegerZoom=n,this.zoom=i,this.layerId=o,this.zoomInPaintVertexArray=new r,this.zoomOutPaintVertexArray=new r}populatePaintArray(e,t,n){const i=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,r){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],r)}_setPaintValues(e,t,n,i){if(!i||!n)return;const{min:r,mid:o,max:s}=n,a=i[r],l=i[o],c=i[s];if(a&&l&&c)for(let n=e;n<t;n++)this.zoomInPaintVertexArray.emplace(n,l.tl[0],l.tl[1],l.br[0],l.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],l.pixelRatio,a.pixelRatio),this.zoomOutPaintVertexArray.emplace(n,l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],l.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,is.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,is.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Es{constructor(e,t,n){this.binders={},this._buffers=[];const i=[];for(const r in e.paint._values){if(!n(r))continue;const o=e.paint.get(r);if(!(o instanceof Vr&&si(o.property.specification)))continue;const s=Ts(r,e.type),a=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u;if("constant"===a.kind)this.binders[r]=h?new vs(a.value,s):new ys(a.value,s,l),i.push(`/u_${r}`);else if("source"===a.kind||h){const n=As(r,l,"source");this.binders[r]=h?new ws(a,l,c,t,n,e.id):new bs(a,s,l,n),i.push(`/a_${r}`)}else{const e=As(r,l,"composite");this.binders[r]=new xs(a,s,l,c,t,e),i.push(`/z_${r}`)}}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof bs||t instanceof xs?t.maxValue:0}populatePaintArrays(e,t,n,i,r){for(const o in this.binders){const s=this.binders[o];(s instanceof bs||s instanceof xs||s instanceof ws)&&s.populatePaintArray(e,t,n,i,r)}}setConstantPatternPositions(e,t){for(const n in this.binders){const i=this.binders[n];i instanceof vs&&i.setConstantPatternPositions(e,t)}}updatePaintArrays(e,t,n,i,r){let o=!1;for(const s in e){const a=t.getPositions(s);for(const t of a){const a=n.feature(t.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof bs||l instanceof xs||l instanceof ws)&&!0===l.expression.isStateDependent){const c=i.paint.get(n);l.expression=c.value,l.updatePaintArray(t.start,t.end,a,e[s],r),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof ys||n instanceof vs)&&e.push(...n.uniformNames.map((e=>`#define HAS_UNIFORM_${e}`)))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof bs||n instanceof xs)for(let t=0;t<n.paintVertexAttributes.length;t++)e.push(n.paintVertexAttributes[t].name);else if(n instanceof ws)for(let t=0;t<is.members.length;t++)e.push(is.members[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof ys||n instanceof vs||n instanceof xs)for(const t of n.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,t){const n=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof ys||r instanceof vs||r instanceof xs)for(const o of r.uniformNames)if(t[o]){const s=r.getBinding(e,t[o],o);n.push({name:o,property:i,binding:s})}}return n}setUniforms(e,t,n,i){for(const{name:e,property:r,binding:o}of t)this.binders[r].setUniform(o,i,n.get(r),e)}updatePaintBuffers(e){this._buffers=[];for(const t in this.binders){const n=this.binders[t];if(e&&n instanceof ws){const t=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;t&&this._buffers.push(t)}else(n instanceof bs||n instanceof xs)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof bs||n instanceof xs||n instanceof ws)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof bs||t instanceof xs||t instanceof ws)&&t.destroy()}}}class Ss{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Es(i,t,n);this.needsUpload=!1,this._featureMap=new ls,this._bufferOffset=0}populatePaintArrays(e,t,n,i,r,o){for(const n in this.programConfigurations)this.programConfigurations[n].populatePaintArrays(e,t,i,r,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i){for(const r of n)this.needsUpload=this.programConfigurations[r.id].updatePaintArrays(e,this._featureMap,t,r,i)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Ts(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}function As(e,t,n){const i={color:{source:lo,composite:Ao},number:{source:xo,composite:lo}},r=function(e){return{"line-pattern":{source:Wo,composite:Wo},"fill-pattern":{source:Wo,composite:Wo},"fill-extrusion-pattern":{source:Wo,composite:Wo}}[e]}(e);return r&&r[n]||i[t][n]}br("ConstantBinder",ys),br("CrossFadedConstantBinder",vs),br("SourceExpressionBinder",bs),br("CrossFadedCompositeBinder",ws),br("CompositeExpressionBinder",xs),br("ProgramConfiguration",Es,{omit:["_buffers"]}),br("ProgramConfigurationSet",Ss);const Cs=8192,Ps=Math.pow(2,14)-1,Is=-Ps-1;function Ms(e){const t=Cs/e.extent,n=e.loadGeometry();for(let e=0;e<n.length;e++){const i=n[e];for(let e=0;e<i.length;e++){const n=i[e],r=Math.round(n.x*t),o=Math.round(n.y*t);n.x=m(r,Is,Ps),n.y=m(o,Is,Ps),(r<n.x||r>n.x+1||o<n.y||o>n.y+1)&&E("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Rs(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Ms(e):[]}}function Os(e,t,n,i,r){e.emplaceBack(2*t+(i+1)/2,2*n+(r+1)/2)}class ks{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new jo,this.indexArray=new Ko,this.segments=new ts,this.programConfigurations=new Ss(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){const i=this.layers[0],r=[];let o=null,s=!1;"circle"===i.type&&(o=i.layout.get("circle-sort-key"),s=!o.isConstant());for(const{feature:t,id:i,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Rs(t,e);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),c,n))continue;const u=s?o.evaluate(c,{},n):void 0,h={id:i,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ms(t),patterns:{},sortKey:u};r.push(h)}s&&r.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of r){const{geometry:r,index:o,sourceLayerIndex:s}=i,a=e[o].feature;this.addFeature(i,r,o,n),t.featureIndex.insert(a,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,es),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i){for(const n of t)for(const t of n){const n=t.x,i=t.y;if(n<0||n>=Cs||i<0||i>=Cs)continue;const r=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),o=r.vertexLength;Os(this.layoutVertexArray,n,i,-1,-1),Os(this.layoutVertexArray,n,i,1,-1),Os(this.layoutVertexArray,n,i,1,1),Os(this.layoutVertexArray,n,i,-1,1),this.indexArray.emplaceBack(o,o+1,o+2),this.indexArray.emplaceBack(o,o+3,o+2),r.vertexLength+=4,r.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i)}}function Ls(e,t){for(let n=0;n<e.length;n++)if(Gs(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Gs(e,t[n]))return!0;return!!Bs(e,t)}function Ds(e,t,n){return!!Gs(e,t)||!!js(t,e,n)}function Fs(e,t){if(1===e.length)return Vs(t,e[0]);for(let n=0;n<t.length;n++){const i=t[n];for(let t=0;t<i.length;t++)if(Gs(e,i[t]))return!0}for(let n=0;n<e.length;n++)if(Vs(t,e[n]))return!0;for(let n=0;n<t.length;n++)if(Bs(e,t[n]))return!0;return!1}function Ns(e,t,n){if(e.length>1){if(Bs(e,t))return!0;for(let i=0;i<t.length;i++)if(js(t[i],e,n))return!0}for(let i=0;i<e.length;i++)if(js(e[i],t,n))return!0;return!1}function Bs(e,t){if(0===e.length||0===t.length)return!1;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1];for(let e=0;e<t.length-1;e++)if(zs(i,r,t[e],t[e+1]))return!0}return!1}function zs(e,t,n,i){return S(e,n,i)!==S(t,n,i)&&S(e,t,n)!==S(e,t,i)}function js(e,t,n){const i=n*n;if(1===t.length)return e.distSqr(t[0])<i;for(let n=1;n<t.length;n++)if(Us(e,t[n-1],t[n])<i)return!0;return!1}function Us(e,t,n){const i=t.distSqr(n);if(0===i)return e.distSqr(t);const r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/i;return e.distSqr(r<0?t:r>1?n:n.sub(t)._mult(r)._add(t))}function Vs(e,t){let n,i,r,o=!1;for(let s=0;s<e.length;s++){n=e[s];for(let e=0,s=n.length-1;e<n.length;s=e++)i=n[e],r=n[s],i.y>t.y!=r.y>t.y&&t.x<(r.x-i.x)*(t.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function Gs(e,t){let n=!1;for(let i=0,r=e.length-1;i<e.length;r=i++){const o=e[i],s=e[r];o.y>t.y!=s.y>t.y&&t.x<(s.x-o.x)*(t.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function $s(e,t,n){const i=n[0],r=n[2];if(e.x<i.x&&t.x<i.x||e.x>r.x&&t.x>r.x||e.y<i.y&&t.y<i.y||e.y>r.y&&t.y>r.y)return!1;const o=S(e,t,n[0]);return o!==S(e,t,n[1])||o!==S(e,t,n[2])||o!==S(e,t,n[3])}function Ws(e,t,n){const i=t.paint.get(e).value;return"constant"===i.kind?i.value:n.programConfigurations.get(t.id).getMaxValue(e)}function Hs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function qs(e,t,n,i,r){if(!t[0]&&!t[1])return e;const s=o.convert(t)._mult(r);"viewport"===n&&s._rotate(-i);const a=[];for(let t=0;t<e.length;t++)a.push(e[t].sub(s));return a}let Xs,Zs;br("CircleBucket",ks,{omit:["layers"]});var Ys={get paint(){return Zs=Zs||new Zr({"circle-radius":new Wr(H.paint_circle["circle-radius"]),"circle-color":new Wr(H.paint_circle["circle-color"]),"circle-blur":new Wr(H.paint_circle["circle-blur"]),"circle-opacity":new Wr(H.paint_circle["circle-opacity"]),"circle-translate":new $r(H.paint_circle["circle-translate"]),"circle-translate-anchor":new $r(H.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $r(H.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $r(H.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wr(H.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wr(H.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wr(H.paint_circle["circle-stroke-opacity"])})},get layout(){return Xs=Xs||new Zr({"circle-sort-key":new Wr(H.layout_circle["circle-sort-key"])})}},Ks=1e-6,Js="undefined"!=typeof Float32Array?Float32Array:Array;function Qs(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ea(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*i+b*a+x*h+w*m,e[1]=v*r+b*l+x*d+w*g,e[2]=v*o+b*c+x*p+w*_,e[3]=v*s+b*u+x*f+w*y,e[4]=(v=n[4])*i+(b=n[5])*a+(x=n[6])*h+(w=n[7])*m,e[5]=v*r+b*l+x*d+w*g,e[6]=v*o+b*c+x*p+w*_,e[7]=v*s+b*u+x*f+w*y,e[8]=(v=n[8])*i+(b=n[9])*a+(x=n[10])*h+(w=n[11])*m,e[9]=v*r+b*l+x*d+w*g,e[10]=v*o+b*c+x*p+w*_,e[11]=v*s+b*u+x*f+w*y,e[12]=(v=n[12])*i+(b=n[13])*a+(x=n[14])*h+(w=n[15])*m,e[13]=v*r+b*l+x*d+w*g,e[14]=v*o+b*c+x*p+w*_,e[15]=v*s+b*u+x*f+w*y,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var ta,na=ea;function ia(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}ta=new Js(4),Js!=Float32Array&&(ta[0]=0,ta[1]=0,ta[2]=0,ta[3]=0);class ra extends Kr{constructor(e){super(e,Ys)}createBucket(e){return new ks(e)}queryRadius(e){const t=e;return Ws("circle-radius",this,t)+Ws("circle-stroke-width",this,t)+Hs(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s,a){const l=qs(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,s),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),u="map"===this.paint.get("circle-pitch-alignment"),h=u?l:function(e,t){return e.map((e=>oa(e,t)))}(l,a),d=u?c*s:c;for(const e of i)for(const t of e){const e=u?t:oa(t,a);let n=d;const i=ia([],[t.x,t.y,0,1],a);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?n*=i[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(n*=o.cameraToCenterDistance/i[3]),Ds(h,e,n))return!0}return!1}}function oa(e,t){const n=ia([],[e.x,e.y,0,1],t);return new o(n[0]/n[3],n[1]/n[3])}class sa extends ks{}let aa;br("HeatmapBucket",sa,{omit:["layers"]});var la={get paint(){return aa=aa||new Zr({"heatmap-radius":new Wr(H.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wr(H.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $r(H.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xr(H.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $r(H.paint_heatmap["heatmap-opacity"])})}};function ca(e,{width:t,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==t*n*i)throw new RangeError(`mismatched image size. expected: ${r.length} but got: ${t*n*i}`)}else r=new Uint8Array(t*n*i);return e.width=t,e.height=n,e.data=r,e}function ua(e,{width:t,height:n},i){if(t===e.width&&n===e.height)return;const r=ca({},{width:t,height:n},i);ha(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,n)},i),e.width=t,e.height=n,e.data=r.data}function ha(e,t,n,i,r,o){if(0===r.width||0===r.height)return t;if(r.width>e.width||r.height>e.height||n.x>e.width-r.width||n.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>t.width||r.height>t.height||i.x>t.width-r.width||i.y>t.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,a=t.data;if(s===a)throw new Error("srcData equals dstData, so image is already copied");for(let l=0;l<r.height;l++){const c=((n.y+l)*e.width+n.x)*o,u=((i.y+l)*t.width+i.x)*o;for(let e=0;e<r.width*o;e++)a[u+e]=s[c+e]}return t}class da{constructor(e,t){ca(this,e,1,t)}resize(e){ua(this,e,1)}clone(){return new da({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){ha(e,t,n,i,r,1)}}class pa{constructor(e,t){ca(this,e,4,t)}resize(e){ua(this,e,4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,r){ha(e,t,n,i,r,4)}}function fa(e){const t={},n=e.resolution||256,i=e.clips?e.clips.length:1,r=e.image||new pa({width:n,height:i});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const o=(n,i,o)=>{t[e.evaluationKey]=o;const s=e.expression.evaluate(t);r.data[n+i+0]=Math.floor(255*s.r/s.a),r.data[n+i+1]=Math.floor(255*s.g/s.a),r.data[n+i+2]=Math.floor(255*s.b/s.a),r.data[n+i+3]=Math.floor(255*s.a)};if(e.clips)for(let t=0,r=0;t<i;++t,r+=4*n)for(let i=0,s=0;i<n;i++,s+=4){const a=i/(n-1),{start:l,end:c}=e.clips[t];o(r,s,l*(1-a)+c*a)}else for(let e=0,t=0;e<n;e++,t+=4)o(0,t,e/(n-1));return r}br("AlphaImage",da),br("RGBAImage",pa);class ma extends Kr{createBucket(e){return new sa(e)}constructor(e){super(e,la),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}}let ga;var _a={get paint(){return ga=ga||new Zr({"hillshade-illumination-direction":new $r(H.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $r(H.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $r(H.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $r(H.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $r(H.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $r(H.paint_hillshade["hillshade-accent-color"])})}};class ya extends Kr{constructor(e){super(e,_a)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}}const va=to([{name:"a_pos",components:2,type:"Int16"}],4),{members:ba}=va;var xa={exports:{}};function wa(e,t,n){n=n||2;var i,r,o,s,a,l,c,u=t&&t.length,h=u?t[0]*n:e.length,d=Ea(e,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(e,t,n,i){var r,o,s,a=[];for(r=0,o=t.length;r<o;r++)(s=Ea(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),a.push(La(s));for(a.sort(Ma),r=0;r<a.length;r++)n=Ra(a[r],n);return n}(e,t,d,n)),e.length>80*n){i=o=e[0],r=s=e[1];for(var f=n;f<h;f+=n)(a=e[f])<i&&(i=a),(l=e[f+1])<r&&(r=l),a>o&&(o=a),l>s&&(s=l);c=0!==(c=Math.max(o-i,s-r))?32767/c:0}return Ta(d,p,n,i,r,c,0),p}function Ea(e,t,n,i,r){var o,s;if(r===qa(e,t,n,i)>0)for(o=t;o<n;o+=i)s=$a(o,e[o],e[o+1],s);else for(o=n-i;o>=t;o-=i)s=$a(o,e[o],e[o+1],s);return s&&Ba(s,s.next)&&(Wa(s),s=s.next),s}function Sa(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!Ba(i,i.next)&&0!==Na(i.prev,i,i.next))i=i.next;else{if(Wa(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function Ta(e,t,n,i,r,o,s){if(e){!s&&o&&function(e,t,n,i){var r=e;do{0===r.z&&(r.z=ka(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,n,i,r,o,s,a,l,c=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,l--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;n=i}o.nextZ=null,c*=2}while(s>1)}(r)}(e,i,r,o);for(var a,l,c=e;e.prev!==e.next;)if(a=e.prev,l=e.next,o?Ca(e,i,r,o):Aa(e))t.push(a.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Wa(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?Ta(e=Pa(Sa(e),t,n),t,n,i,r,o,2):2===s&&Ia(e,t,n,i,r,o):Ta(Sa(e),t,n,i,r,o,1);break}}}function Aa(e){var t=e.prev,n=e,i=e.next;if(Na(t,n,i)>=0)return!1;for(var r=t.x,o=n.x,s=i.x,a=t.y,l=n.y,c=i.y,u=r<o?r<s?r:s:o<s?o:s,h=a<l?a<c?a:c:l<c?l:c,d=r>o?r>s?r:s:o>s?o:s,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==t;){if(f.x>=u&&f.x<=d&&f.y>=h&&f.y<=p&&Da(r,a,o,l,s,c,f.x,f.y)&&Na(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ca(e,t,n,i){var r=e.prev,o=e,s=e.next;if(Na(r,o,s)>=0)return!1;for(var a=r.x,l=o.x,c=s.x,u=r.y,h=o.y,d=s.y,p=a<l?a<c?a:c:l<c?l:c,f=u<h?u<d?u:d:h<d?h:d,m=a>l?a>c?a:c:l>c?l:c,g=u>h?u>d?u:d:h>d?h:d,_=ka(p,f,t,n,i),y=ka(m,g,t,n,i),v=e.prevZ,b=e.nextZ;v&&v.z>=_&&b&&b.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Da(a,u,l,h,c,d,v.x,v.y)&&Na(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&Da(a,u,l,h,c,d,b.x,b.y)&&Na(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==r&&v!==s&&Da(a,u,l,h,c,d,v.x,v.y)&&Na(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;b&&b.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&Da(a,u,l,h,c,d,b.x,b.y)&&Na(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function Pa(e,t,n){var i=e;do{var r=i.prev,o=i.next.next;!Ba(r,o)&&za(r,i,i.next,o)&&Va(r,o)&&Va(o,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(o.i/n|0),Wa(i),Wa(i.next),i=e=o),i=i.next}while(i!==e);return Sa(i)}function Ia(e,t,n,i,r,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Fa(s,a)){var l=Ga(s,a);return s=Sa(s,s.next),l=Sa(l,l.next),Ta(s,t,n,i,r,o,0),void Ta(l,t,n,i,r,o,0)}a=a.next}s=s.next}while(s!==e)}function Ma(e,t){return e.x-t.x}function Ra(e,t){var n=function(e,t){var n,i=t,r=e.x,o=e.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==t);if(!n)return null;var l,c=n,u=n.x,h=n.y,d=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&Da(o<h?r:s,o,u,h,o<h?s:r,o,i.x,i.y)&&(l=Math.abs(o-i.y)/(r-i.x),Va(i,e)&&(l<d||l===d&&(i.x>n.x||i.x===n.x&&Oa(n,i)))&&(n=i,d=l)),i=i.next}while(i!==c);return n}(e,t);if(!n)return t;var i=Ga(n,e);return Sa(i,i.next),Sa(n,n.next)}function Oa(e,t){return Na(e.prev,e,t.prev)<0&&Na(t.next,e,e.next)<0}function ka(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function La(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Da(e,t,n,i,r,o,s,a){return(r-s)*(t-a)>=(e-s)*(o-a)&&(e-s)*(i-a)>=(n-s)*(t-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Fa(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&za(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Va(e,t)&&Va(t,e)&&function(e,t){var n=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Na(e.prev,e,t.prev)||Na(e,t.prev,t))||Ba(e,t)&&Na(e.prev,e,e.next)>0&&Na(t.prev,t,t.next)>0)}function Na(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Ba(e,t){return e.x===t.x&&e.y===t.y}function za(e,t,n,i){var r=Ua(Na(e,t,n)),o=Ua(Na(e,t,i)),s=Ua(Na(n,i,e)),a=Ua(Na(n,i,t));return r!==o&&s!==a||!(0!==r||!ja(e,n,t))||!(0!==o||!ja(e,i,t))||!(0!==s||!ja(n,e,i))||!(0!==a||!ja(n,t,i))}function ja(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ua(e){return e>0?1:e<0?-1:0}function Va(e,t){return Na(e.prev,e,e.next)<0?Na(e,t,e.next)>=0&&Na(e,e.prev,t)>=0:Na(e,t,e.prev)<0||Na(e,e.next,t)<0}function Ga(e,t){var n=new Ha(e.i,e.x,e.y),i=new Ha(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function $a(e,t,n,i){var r=new Ha(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Wa(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ha(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qa(e,t,n,i){for(var r=0,o=t,s=n-i;o<n;o+=i)r+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return r}xa.exports=wa,xa.exports.default=wa,wa.deviation=function(e,t,n,i){var r=t&&t.length,o=Math.abs(qa(e,0,r?t[0]*n:e.length,n));if(r)for(var s=0,a=t.length;s<a;s++)o-=Math.abs(qa(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n));var l=0;for(s=0;s<i.length;s+=3){var c=i[s]*n,u=i[s+1]*n,h=i[s+2]*n;l+=Math.abs((e[c]-e[h])*(e[u+1]-e[c+1])-(e[c]-e[u])*(e[h+1]-e[c+1]))}return 0===o&&0===l?0:Math.abs((l-o)/o)},wa.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var s=0;s<t;s++)n.vertices.push(e[r][o][s]);r>0&&n.holes.push(i+=e[r-1].length)}return n};var Xa=n(xa.exports);function Za(e,t,n){const i=n.patternDependencies;let r=!1;for(const n of t){const t=n.paint.get(`${e}-pattern`);t.isConstant()||(r=!0);const o=t.constantOr(null);o&&(r=!0,i[o.to]=!0,i[o.from]=!0)}return r}function Ya(e,t,n,i,r){const o=r.patternDependencies;for(const s of t){const t=s.paint.get(`${e}-pattern`).value;if("constant"!==t.kind){let e=t.evaluate({zoom:i-1},n,{},r.availableImages),a=t.evaluate({zoom:i},n,{},r.availableImages),l=t.evaluate({zoom:i+1},n,{},r.availableImages);e=e&&e.name?e.name:e,a=a&&a.name?a.name:a,l=l&&l.name?l.name:l,o[e]=!0,o[a]=!0,o[l]=!0,n.patterns[s.id]={min:e,mid:a,max:l}}}return n}class Ka{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Uo,this.indexArray=new Ko,this.indexArray2=new Jo,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new ts,this.segments2=new ts,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Za("fill",this.layers,t);const i=this.layers[0].layout.get("fill-sort-key"),r=!i.isConstant(),o=[];for(const{feature:s,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Rs(s,e);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),u,n))continue;const h=r?i.evaluate(u,{},n,t.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Ms(s),patterns:{},sortKey:h};o.push(d)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of o){const{geometry:r,index:o,sourceLayerIndex:s}=i;if(this.hasPattern){const e=Ya("fill",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,o,n,{});t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ba),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,r){for(const e of vn(t,500)){let t=0;for(const n of e)t+=n.length;const n=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),i=n.vertexLength,r=[],o=[];for(const t of e){if(0===t.length)continue;t!==e[0]&&o.push(r.length/2);const n=this.segments2.prepareSegment(t.length,this.layoutVertexArray,this.indexArray2),i=n.vertexLength;this.layoutVertexArray.emplaceBack(t[0].x,t[0].y),this.indexArray2.emplaceBack(i+t.length-1,i),r.push(t[0].x),r.push(t[0].y);for(let e=1;e<t.length;e++)this.layoutVertexArray.emplaceBack(t[e].x,t[e].y),this.indexArray2.emplaceBack(i+e-1,i+e),r.push(t[e].x),r.push(t[e].y);n.vertexLength+=t.length,n.primitiveLength+=t.length}const s=Xa(r,o);for(let e=0;e<s.length;e+=3)this.indexArray.emplaceBack(i+s[e],i+s[e+1],i+s[e+2]);n.vertexLength+=t,n.primitiveLength+=s.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}}let Ja,Qa;br("FillBucket",Ka,{omit:["layers","patternFeatures"]});var el={get paint(){return Qa=Qa||new Zr({"fill-antialias":new $r(H.paint_fill["fill-antialias"]),"fill-opacity":new Wr(H.paint_fill["fill-opacity"]),"fill-color":new Wr(H.paint_fill["fill-color"]),"fill-outline-color":new Wr(H.paint_fill["fill-outline-color"]),"fill-translate":new $r(H.paint_fill["fill-translate"]),"fill-translate-anchor":new $r(H.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hr(H.paint_fill["fill-pattern"])})},get layout(){return Ja=Ja||new Zr({"fill-sort-key":new Wr(H.layout_fill["fill-sort-key"])})}};class tl extends Kr{constructor(e){super(e,el)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ka(e)}queryRadius(){return Hs(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,r,o,s){return Fs(qs(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,s),i)}isTileClipped(){return!0}}const nl=to([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),il=to([{name:"a_centroid",components:2,type:"Int16"}],4),{members:rl}=nl;var ol={},sl=i,al=ll;function ll(e,t,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=r,e.readFields(cl,this,t)}function cl(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var i=t._keys[e.readVarint()],r=t._values[e.readVarint()];t.properties[i]=r}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function ul(e){for(var t,n,i=0,r=0,o=e.length,s=o-1;r<o;s=r++)i+=((n=e[s]).x-(t=e[r]).x)*(t.y+n.y);return i}ll.types=["Unknown","Point","LineString","Polygon"],ll.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,r=0,o=0,s=0,a=[];e.pos<n;){if(r<=0){var l=e.readVarint();i=7&l,r=l>>3}if(r--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&a.push(t),t=[]),t.push(new sl(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&a.push(t),a},ll.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,i=0,r=0,o=0,s=1/0,a=-1/0,l=1/0,c=-1/0;e.pos<t;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)(r+=e.readSVarint())<s&&(s=r),r>a&&(a=r),(o+=e.readSVarint())<l&&(l=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,l,a,c]},ll.prototype.toGeoJSON=function(e,t,n){var i,r,o=this.extent*Math.pow(2,n),s=this.extent*e,a=this.extent*t,l=this.loadGeometry(),c=ll.types[this.type];function u(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];u(l=h);break;case 2:for(i=0;i<l.length;i++)u(l[i]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,i,r=[],o=0;o<t;o++){var s=ul(e[o]);0!==s&&(void 0===i&&(i=s<0),i===s<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(l),i=0;i<l.length;i++)for(r=0;r<l[i].length;r++)u(l[i][r])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var hl=al,dl=pl;function pl(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(fl,this,t),this.length=this._features.length}function fl(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var i=e.readVarint()>>3;t=1===i?e.readString():2===i?e.readFloat():3===i?e.readDouble():4===i?e.readVarint64():5===i?e.readVarint():6===i?e.readSVarint():7===i?e.readBoolean():null}return t}(n))}pl.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new hl(this._pbf,t,this.extent,this._keys,this._values)};var ml=dl;function gl(e,t,n){if(3===e){var i=new ml(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}ol.VectorTile=function(e,t){this.layers=e.readFields(gl,{},t)},ol.VectorTileFeature=al,ol.VectorTileLayer=dl;const _l=ol.VectorTileFeature.types,yl=Math.pow(2,13);function vl(e,t,n,i,r,o,s,a){e.emplaceBack(t,n,2*Math.floor(i*yl)+s,r*yl*2,o*yl*2,Math.round(a))}class bl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Vo,this.centroidVertexArray=new zo,this.indexArray=new Ko,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new ts,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.features=[],this.hasPattern=Za("fill-extrusion",this.layers,t);for(const{feature:i,id:r,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,a=Rs(i,e);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),a,n))continue;const l={id:r,sourceLayerIndex:s,index:o,geometry:e?a.geometry:Ms(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(Ya("fill-extrusion",this.layers,l,this.zoom,t)):this.addFeature(l,l.geometry,o,n,{}),t.featureIndex.insert(i,l.geometry,o,s,this.index,!0)}}addFeatures(e,t,n){for(const e of this.features){const{geometry:i}=e;this.addFeature(e,i,e.index,t,n)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.centroidVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rl),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,il.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,t,n,i,r){const o={x:0,y:0,vertexCount:0};for(const n of vn(t,500)){let t=0;for(const e of n)t+=e.length;let i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const e of n){if(0===e.length)continue;if(wl(e))continue;let t=0;for(let n=0;n<e.length;n++){const r=e[n];if(n>=1){const s=e[n-1];if(!xl(r,s)){i.vertexLength+4>ts.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const e=r.sub(s)._perp()._unit(),n=s.dist(r);t+n>32768&&(t=0),vl(this.layoutVertexArray,r.x,r.y,e.x,e.y,0,0,t),vl(this.layoutVertexArray,r.x,r.y,e.x,e.y,0,1,t),o.x+=2*r.x,o.y+=2*r.y,o.vertexCount+=2,t+=n,vl(this.layoutVertexArray,s.x,s.y,e.x,e.y,0,0,t),vl(this.layoutVertexArray,s.x,s.y,e.x,e.y,0,1,t),o.x+=2*s.x,o.y+=2*s.y,o.vertexCount+=2;const a=i.vertexLength;this.indexArray.emplaceBack(a,a+2,a+1),this.indexArray.emplaceBack(a+1,a+2,a+3),i.vertexLength+=4,i.primitiveLength+=2}}}}if(i.vertexLength+t>ts.MAX_VERTEX_ARRAY_LENGTH&&(i=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray)),"Polygon"!==_l[e.type])continue;const r=[],s=[],a=i.vertexLength;for(const e of n)if(0!==e.length){e!==n[0]&&s.push(r.length/2);for(let t=0;t<e.length;t++){const n=e[t];vl(this.layoutVertexArray,n.x,n.y,0,0,1,1,0),o.x+=n.x,o.y+=n.y,o.vertexCount+=1,r.push(n.x),r.push(n.y)}}const l=Xa(r,s);for(let e=0;e<l.length;e+=3)this.indexArray.emplaceBack(a+l[e],a+l[e+2],a+l[e+1]);i.primitiveLength+=l.length/3,i.vertexLength+=t}for(let e=0;e<o.vertexCount;e++)this.centroidVertexArray.emplaceBack(Math.floor(o.x/o.vertexCount),Math.floor(o.y/o.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}}function xl(e,t){return e.x===t.x&&(e.x<0||e.x>Cs)||e.y===t.y&&(e.y<0||e.y>Cs)}function wl(e){return e.every((e=>e.x<0))||e.every((e=>e.x>Cs))||e.every((e=>e.y<0))||e.every((e=>e.y>Cs))}let El;br("FillExtrusionBucket",bl,{omit:["layers","features"]});var Sl={get paint(){return El=El||new Zr({"fill-extrusion-opacity":new $r(H["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wr(H["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $r(H["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $r(H["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hr(H["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wr(H["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wr(H["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $r(H["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Tl extends Kr{constructor(e){super(e,Sl)}createBucket(e){return new bl(e)}queryRadius(){return Hs(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,t,n,i,r,s,a,l){const c=qs(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,a),u=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),d=function(e,t,n,i){const r=[];for(const n of e){const e=[n.x,n.y,0,1];ia(e,e,t),r.push(new o(e[0]/e[3],e[1]/e[3]))}return r}(c,l),p=function(e,t,n,i){const r=[],s=[],a=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,h=i[8]*n,d=i[9]*n,p=i[10]*n,f=i[11]*n;for(const t of e){const e=[],n=[];for(const r of t){const t=r.x,s=r.y,m=i[0]*t+i[4]*s+i[12],g=i[1]*t+i[5]*s+i[13],_=i[2]*t+i[6]*s+i[14],y=i[3]*t+i[7]*s+i[15],v=_+c,b=y+u,x=m+h,w=g+d,E=_+p,S=y+f,T=new o((m+a)/b,(g+l)/b);T.z=v/b,e.push(T);const A=new o(x/S,w/S);A.z=E/S,n.push(A)}r.push(e),s.push(n)}return[r,s]}(i,h,u,l);return function(e,t,n){let i=1/0;Fs(n,t)&&(i=Cl(n,t[0]));for(let r=0;r<t.length;r++){const o=t[r],s=e[r];for(let e=0;e<o.length-1;e++){const t=o[e],r=[t,o[e+1],s[e+1],s[e],t];Ls(n,r)&&(i=Math.min(i,Cl(n,r)))}}return i!==1/0&&i}(p[0],p[1],d)}}function Al(e,t){return e.x*t.x+e.y*t.y}function Cl(e,t){if(1===e.length){let n=0;const i=t[n++];let r;for(;!r||i.equals(r);)if(r=t[n++],!r)return 1/0;for(;n<t.length;n++){const o=t[n],s=e[0],a=r.sub(i),l=o.sub(i),c=s.sub(i),u=Al(a,a),h=Al(a,l),d=Al(l,l),p=Al(c,a),f=Al(c,l),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=i.z*(1-g-_)+r.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const n of t)e=Math.min(e,n.z);return e}}const Pl=to([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Il}=Pl,Ml=to([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Rl}=Ml,Ol=ol.VectorTileFeature.types,kl=Math.cos(Math.PI/180*37.5),Ll=Math.pow(2,14)/.5;class Dl{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Go,this.layoutVertexArray2=new $o,this.indexArray=new Ko,this.programConfigurations=new Ss(e.layers,e.zoom),this.segments=new ts,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,n){this.hasPattern=Za("line",this.layers,t);const i=this.layers[0].layout.get("line-sort-key"),r=!i.isConstant(),o=[];for(const{feature:t,id:s,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Rs(t,e);if(!this.layers[0]._featureFilter.filter(new Dr(this.zoom),c,n))continue;const u=r?i.evaluate(c,{},n):void 0,h={id:s,properties:t.properties,type:t.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Ms(t),patterns:{},sortKey:u};o.push(h)}r&&o.sort(((e,t)=>e.sortKey-t.sortKey));for(const i of o){const{geometry:r,index:o,sourceLayerIndex:s}=i;if(this.hasPattern){const e=Ya("line",this.layers,i,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(i,r,o,n,{});t.featureIndex.insert(e[o].feature,r,o,s,this.index)}}update(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}addFeatures(e,t,n){for(const e of this.patternFeatures)this.addFeature(e,e.geometry,e.index,t,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Rl)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Il),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,r){const o=this.layers[0].layout,s=o.get("line-join").evaluate(e,{}),a=o.get("line-cap"),l=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const n of t)this.addLine(n,e,s,a,l,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,r,i)}addLine(e,t,n,i,r,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Ol[t.type];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;let l=0;for(;l<a-1&&e[l].equals(e[l+1]);)l++;if(a<(s?3:2))return;"bevel"===n&&(r=1.05);const c=this.overscaling<=16?15*Cs/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=e[a-2],m=e[l].sub(h)._unit()._perp());for(let t=l;t<a;t++){if(p=t===a-1?s?e[l+1]:void 0:e[t+1],p&&e[t].equals(p))continue;m&&(f=m),h&&(d=h),h=e[t],m=p?p.sub(h)._unit()._perp():f,f=f||m;let g=f.add(m);0===g.x&&0===g.y||g._unit();const _=f.x*m.x+f.y*m.y,y=g.x*m.x+g.y*m.y,v=0!==y?1/y:1/0,b=2*Math.sqrt(2-2*y),x=y<kl&&d&&p,w=f.x*m.y-f.y*m.x>0;if(x&&t>l){const e=h.dist(d);if(e>2*c){const t=h.sub(h.sub(d)._mult(c/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,f,0,0,u),d=t}}const E=d&&p;let S=E?n:s?"butt":i;if(E&&"round"===S&&(v<o?S="miter":v<=2&&(S="fakeround")),"miter"===S&&v>r&&(S="bevel"),"bevel"===S&&(v>2&&(S="flipbevel"),v<r&&(S="miter")),d&&this.updateDistance(d,h),"miter"===S)g._mult(v),this.addCurrentVertex(h,g,0,0,u);else if("flipbevel"===S){if(v>100)g=m.mult(-1);else{const e=v*f.add(m).mag()/f.sub(m).mag();g._perp()._mult(e*(w?-1:1))}this.addCurrentVertex(h,g,0,0,u),this.addCurrentVertex(h,g.mult(-1),0,0,u)}else if("bevel"===S||"fakeround"===S){const e=-Math.sqrt(v*v-1),t=w?e:0,n=w?0:e;if(d&&this.addCurrentVertex(h,f,t,n,u),"fakeround"===S){const e=Math.round(180*b/Math.PI/20);for(let t=1;t<e;t++){let n=t/e;if(.5!==n){const e=n-.5;n+=n*e*(n-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*e*e+(.848013+_*(.215638*_-1.06021)))}const i=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,i.x,i.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-t,-n,u)}else if("butt"===S)this.addCurrentVertex(h,g,0,0,u);else if("square"===S){const e=d?1:-1;this.addCurrentVertex(h,g,e,e,u)}else"round"===S&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(x&&t<a-1){const e=h.dist(p);if(e>2*c){const t=h.add(p.sub(h)._mult(c/e)._round());this.updateDistance(h,t),this.addCurrentVertex(t,m,0,0,u),h=t}}}}addCurrentVertex(e,t,n,i,r,o=!1){const s=t.y*i-t.x,a=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,o,!1,n,r),this.addHalfVertex(e,s,a,o,!0,-i,r),this.distance>Ll/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,t,n,i,r,o))}addHalfVertex({x:e,y:t},n,i,r,o,s,a){const l=.5*(this.lineClips?this.scaledDistance*(Ll-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(r?1:0),(t<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===s?0:s<0?-1:1)|(63&l)<<2,l>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}let Fl,Nl;br("LineBucket",Dl,{omit:["layers","patternFeatures"]});var Bl={get paint(){return Nl=Nl||new Zr({"line-opacity":new Wr(H.paint_line["line-opacity"]),"line-color":new Wr(H.paint_line["line-color"]),"line-translate":new $r(H.paint_line["line-translate"]),"line-translate-anchor":new $r(H.paint_line["line-translate-anchor"]),"line-width":new Wr(H.paint_line["line-width"]),"line-gap-width":new Wr(H.paint_line["line-gap-width"]),"line-offset":new Wr(H.paint_line["line-offset"]),"line-blur":new Wr(H.paint_line["line-blur"]),"line-dasharray":new qr(H.paint_line["line-dasharray"]),"line-pattern":new Hr(H.paint_line["line-pattern"]),"line-gradient":new Xr(H.paint_line["line-gradient"])})},get layout(){return Fl=Fl||new Zr({"line-cap":new $r(H.layout_line["line-cap"]),"line-join":new Wr(H.layout_line["line-join"]),"line-miter-limit":new $r(H.layout_line["line-miter-limit"]),"line-round-limit":new $r(H.layout_line["line-round-limit"]),"line-sort-key":new Wr(H.layout_line["line-sort-key"])})}};class zl extends Wr{possiblyEvaluate(e,t){return t=new Dr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=_({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}let jl;class Ul extends Kr{constructor(e){super(e,Bl),this.gradientVersion=0,jl||(jl=new zl(Bl.paint.properties["line-width"].specification),jl.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this.gradientExpression();this.stepInterpolant=!!function(e){return void 0!==e._styleExpression}(e)&&e._styleExpression.expression instanceof Et,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=jl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Dl(e)}queryRadius(e){const t=e,n=Vl(Ws("line-width",this,t),Ws("line-gap-width",this,t)),i=Ws("line-offset",this,t);return n/2+Math.abs(i)+Hs(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,r,s,a){const l=qs(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,a),c=a/2*Vl(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),u=this.paint.get("line-offset").evaluate(t,n);return u&&(i=function(e,t){const n=[];for(let i=0;i<e.length;i++){const r=e[i],s=[];for(let e=0;e<r.length;e++){const n=r[e-1],i=r[e],a=r[e+1],l=0===e?new o(0,0):i.sub(n)._unit()._perp(),c=e===r.length-1?new o(0,0):a.sub(i)._unit()._perp(),u=l._add(c)._unit(),h=u.x*c.x+u.y*c.y;0!==h&&u._mult(1/h),s.push(u._mult(t)._add(i))}n.push(s)}return n}(i,u*a)),function(e,t,n){for(let i=0;i<t.length;i++){const r=t[i];if(e.length>=3)for(let t=0;t<r.length;t++)if(Gs(e,r[t]))return!0;if(Ns(e,r,n))return!0}return!1}(l,i,c)}isTileClipped(){return!0}}function Vl(e,t){return t>0?t+2*e:e}const Gl=to([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$l=to([{name:"a_projected_pos",components:3,type:"Float32"}],4);to([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wl=to([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);to([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hl=to([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ql=to([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xl(e,t,n){return e.sections.forEach((e=>{e.text=function(e,t,n){const i=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===i?e=e.toLocaleUpperCase():"lowercase"===i&&(e=e.toLocaleLowerCase()),Lr.applyArabicShaping&&(e=Lr.applyArabicShaping(e)),e}(e.text,t,n)})),e}to([{name:"triangle",components:3,type:"Uint16"}]),to([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),to([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),to([{type:"Float32",name:"offsetX"}]),to([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),to([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Zl={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Yl=24,Kl=ec,Jl=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},Ql=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m};function ec(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ec.Varint=0,ec.Fixed64=1,ec.Bytes=2,ec.Fixed32=5;var tc=4294967296,nc=1/tc,ic="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function rc(e){return e.type===ec.Bytes?e.readVarint()+e.pos:e.pos+1}function oc(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function sc(e,t,n){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=e;r--)n.buf[r+i]=n.buf[r]}function ac(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function lc(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function cc(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function uc(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function hc(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function dc(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function pc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function fc(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function mc(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function gc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function _c(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function yc(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}ec.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,e(r,t,this),this.pos===o&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=gc(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=yc(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=gc(this.buf,this.pos)+gc(this.buf,this.pos+4)*tc;return this.pos+=8,e},readSFixed64:function(){var e=gc(this.buf,this.pos)+yc(this.buf,this.pos+4)*tc;return this.pos+=8,e},readFloat:function(){var e=Jl(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Jl(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,i=this.buf;return t=127&(n=i[this.pos++]),n<128?t:(t|=(127&(n=i[this.pos++]))<<7,n<128?t:(t|=(127&(n=i[this.pos++]))<<14,n<128?t:(t|=(127&(n=i[this.pos++]))<<21,n<128?t:function(e,t,n){var i,r,o=n.buf;if(i=(112&(r=o[n.pos++]))>>4,r<128)return oc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<3,r<128)return oc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<10,r<128)return oc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<17,r<128)return oc(e,i,t);if(i|=(127&(r=o[n.pos++]))<<24,r<128)return oc(e,i,t);if(i|=(1&(r=o[n.pos++]))<<31,r<128)return oc(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=i[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&ic?function(e,t,n){return ic.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var i="",r=t;r<n;){var o,s,a,l=e[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u>n)break;1===u?l<128&&(c=l):2===u?128==(192&(o=e[r+1]))&&(c=(31&l)<<6|63&o)<=127&&(c=null):3===u?(s=e[r+2],128==(192&(o=e[r+1]))&&128==(192&s)&&((c=(15&l)<<12|(63&o)<<6|63&s)<=2047||c>=55296&&c<=57343)&&(c=null)):4===u&&(s=e[r+2],a=e[r+3],128==(192&(o=e[r+1]))&&128==(192&s)&&128==(192&a)&&((c=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,u=1):c>65535&&(c-=65536,i+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),i+=String.fromCharCode(c),r+=u}return i}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ec.Bytes)return e.push(this.readVarint(t));var n=rc(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ec.Bytes)return e.push(this.readSVarint());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ec.Bytes)return e.push(this.readBoolean());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ec.Bytes)return e.push(this.readFloat());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ec.Bytes)return e.push(this.readDouble());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ec.Bytes)return e.push(this.readFixed32());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ec.Bytes)return e.push(this.readSFixed32());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ec.Bytes)return e.push(this.readFixed64());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ec.Bytes)return e.push(this.readSFixed64());var t=rc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ec.Varint)for(;this.buf[this.pos++]>127;);else if(t===ec.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ec.Fixed32)this.pos+=4;else{if(t!==ec.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),_c(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),_c(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),_c(this.buf,-1&e,this.pos),_c(this.buf,Math.floor(e*nc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),_c(this.buf,-1&e,this.pos),_c(this.buf,Math.floor(e*nc),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,i;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(i,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var i,r,o=0;o<t.length;o++){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){i>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):r=i;continue}if(i<56320){e[n++]=239,e[n++]=191,e[n++]=189,r=i;continue}i=r-55296<<10|i-56320|65536,r=null}else r&&(e[n++]=239,e[n++]=191,e[n++]=189,r=null);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&sc(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Ql(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Ql(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var i=this.pos-n;i>=128&&sc(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,n){this.writeTag(e,ec.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,ac,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,lc,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,hc,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,cc,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,uc,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,dc,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,pc,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,fc,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,mc,t)},writeBytesField:function(e,t){this.writeTag(e,ec.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ec.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ec.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ec.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ec.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ec.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ec.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ec.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ec.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ec.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var vc=n(Kl);const bc=3;function xc(e,t,n){1===e&&n.readMessage(wc,t)}function wc(e,t,n){if(3===e){const{id:e,bitmap:i,width:r,height:o,left:s,top:a,advance:l}=n.readMessage(Ec,{});t.push({id:e,bitmap:new da({width:r+2*bc,height:o+2*bc},i),metrics:{width:r,height:o,left:s,top:a,advance:l}})}}function Ec(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}const Sc=bc;function Tc(e){let t=0,n=0;for(const i of e)t+=i.w*i.h,n=Math.max(n,i.w);e.sort(((e,t)=>t.h-e.h));const i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let r=0,o=0;for(const t of e)for(let e=i.length-1;e>=0;e--){const n=i[e];if(!(t.w>n.w||t.h>n.h)){if(t.x=n.x,t.y=n.y,o=Math.max(o,t.y+t.h),r=Math.max(r,t.x+t.w),t.w===n.w&&t.h===n.h){const t=i.pop();e<i.length&&(i[e]=t)}else t.h===n.h?(n.x+=t.w,n.w-=t.w):t.w===n.w?(n.y+=t.h,n.h-=t.h):(i.push({x:n.x+t.w,y:n.y,w:n.w-t.w,h:t.h}),n.y+=t.h,n.h-=t.h);break}}return{w:r,h:o,fill:t/(r*o)||0}}const Ac=1;class Cc{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:r,content:o,textFitWidth:s,textFitHeight:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=r,this.content=o,this.version=n,this.textFitWidth=s,this.textFitHeight=a}get tl(){return[this.paddedRect.x+Ac,this.paddedRect.y+Ac]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ac,this.paddedRect.y+this.paddedRect.h-Ac]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ac)/this.pixelRatio,(this.paddedRect.h-2*Ac)/this.pixelRatio]}}class Pc{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const r=[];this.addImages(e,n,r),this.addImages(t,i,r);const{w:o,h:s}=Tc(r),a=new pa({width:o||1,height:s||1});for(const t in e){const i=e[t],r=n[t].paddedRect;pa.copy(i.data,a,{x:0,y:0},{x:r.x+Ac,y:r.y+Ac},i.data)}for(const e in t){const n=t[e],r=i[e].paddedRect,o=r.x+Ac,s=r.y+Ac,l=n.data.width,c=n.data.height;pa.copy(n.data,a,{x:0,y:0},{x:o,y:s},n.data),pa.copy(n.data,a,{x:0,y:c-1},{x:o,y:s-1},{width:l,height:1}),pa.copy(n.data,a,{x:0,y:0},{x:o,y:s+c},{width:l,height:1}),pa.copy(n.data,a,{x:l-1,y:0},{x:o-1,y:s},{width:1,height:c}),pa.copy(n.data,a,{x:0,y:0},{x:o+l,y:s},{width:1,height:c})}this.image=a,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const r=e[i],o={x:0,y:0,w:r.data.width+2*Ac,h:r.data.height+2*Ac};n.push(o),t[i]=new Cc(o,r),r.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,r]=e.tl;n.update(t.data,void 0,{x:i,y:r})}}var Ic;br("ImagePosition",Cc),br("ImageAtlas",Pc),e.ah=void 0,(Ic=e.ah||(e.ah={}))[Ic.none=0]="none",Ic[Ic.horizontal=1]="horizontal",Ic[Ic.vertical=2]="vertical",Ic[Ic.horizontalOnly=3]="horizontalOnly";const Mc=-17;class Rc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Rc;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Rc;return t.imageName=e,t}}class Oc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Oc;for(let i=0;i<e.sections.length;i++){const r=e.sections[i];r.image?n.addImageSection(r):n.addTextSection(r,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let t="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,r=e.charCodeAt(n-1)||null;t+=i&&Mr(i)&&!Zl[e[n+1]]||r&&Mr(r)&&!Zl[e[n-1]]||!Zl[e[n]]?e[n]:Zl[e[n]]}return t}(this.text)}trim(){let e=0;for(let t=0;t<this.text.length&&Lc[this.text.charCodeAt(t)];t++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&Lc[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Oc;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Rc.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let t=0;t<e.text.length;++t)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void E("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Rc.forImage(t)),this.sectionIndex.push(this.sections.length-1)):E("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kc(t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=Oc.fromFeature(t,o);let y;d===e.ah.vertical&&_.verticalizePunctuation();const{processBidirectionalText:v,processStyledBidirectionalText:b}=Lr;if(v&&1===_.sections.length){y=[];const e=v(_.toString(),Uc(_,u,s,n,r,f,m));for(const t of e){const e=new Oc;e.text=t,e.sections=_.sections;for(let n=0;n<t.length;n++)e.sectionIndex.push(0);y.push(e)}}else if(b){y=[];const e=b(_.text,_.sectionIndex,Uc(_,u,s,n,r,f,m));for(const t of e){const e=new Oc;e.text=t[0],e.sectionIndex=t[1],e.sections=_.sections,y.push(e)}}else y=function(e,t){const n=[],i=e.text;let r=0;for(const i of t)n.push(e.substring(r,i)),r=i;return r<i.length&&n.push(e.substring(r,i.length)),n}(_,Uc(_,u,s,n,r,f,m));const x=[],w={positionedLines:x,text:_.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:d,iconsInText:!1,verticalizable:!1};return function(t,n,i,r,o,s,a,l,c,u,h,d){let p=0,f=Mc,m=0,g=0;const _="right"===l?1:"left"===l?0:.5;let y=0;for(const a of o){a.trim();const o=a.getMaxScale(),l=(o-1)*Yl,b={positionedGlyphs:[],lineOffset:0};t.positionedLines[y]=b;const x=b.positionedGlyphs;let w=0;if(!a.length()){f+=s,++y;continue}for(let s=0;s<a.length();s++){const m=a.getSection(s),g=a.getSectionIndex(s),_=a.getCharCode(s);let y=0,b=null,E=null,S=null,T=Yl;const A=!(c===e.ah.horizontal||!h&&!Ir(_)||h&&(Lc[_]||(v=_,Tr.Arabic(v)||Tr["Arabic Supplement"](v)||Tr["Arabic Extended-A"](v)||Tr["Arabic Presentation Forms-A"](v)||Tr["Arabic Presentation Forms-B"](v))));if(m.imageName){const e=r[m.imageName];if(!e)continue;S=m.imageName,t.iconsInText=t.iconsInText||!0,E=e.paddedRect;const n=e.displaySize;m.scale=m.scale*Yl/d,b={width:n[0],height:n[1],left:Ac,top:-Sc,advance:A?n[1]:n[0]},y=l+(Yl-n[1]*m.scale),T=b.advance;const i=A?n[0]*m.scale-Yl*o:n[1]*m.scale-Yl*o;i>0&&i>w&&(w=i)}else{const e=i[m.fontStack],t=e&&e[_];if(t&&t.rect)E=t.rect,b=t.metrics;else{const e=n[m.fontStack],t=e&&e[_];if(!t)continue;b=t.metrics}y=(o-m.scale)*Yl}A?(t.verticalizable=!0,x.push({glyph:_,imageName:S,x:p,y:f+y,vertical:A,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:b,rect:E}),p+=T*m.scale+u):(x.push({glyph:_,imageName:S,x:p,y:f+y,vertical:A,scale:m.scale,fontStack:m.fontStack,sectionIndex:g,metrics:b,rect:E}),p+=b.advance*m.scale+u)}0!==x.length&&(m=Math.max(p-u,m),Gc(x,0,x.length-1,_,w)),p=0;const E=s*o+w;b.lineOffset=Math.max(w,l),f+=E,g=Math.max(E,g),++y}var v;const b=f-Mc,{horizontalAlign:x,verticalAlign:w}=Vc(a);(function(e,t,n,i,r,o,s,a,l){const c=(t-n)*r;let u=0;u=o!==s?-a*i-Mc:(-i*l+.5)*s;for(const t of e)for(const e of t.positionedGlyphs)e.x+=c,e.y+=u})(t.positionedLines,_,x,w,m,g,s,b,o.length),t.top+=-w*b,t.bottom=t.top+b,t.left+=-x*m,t.right=t.left+m}(w,n,i,r,y,a,l,c,d,u,p,g),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&w}const Lc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Dc={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fc(e,t,n,i,r,o){if(t.imageName){const e=i[t.imageName];return e?e.displaySize[0]*t.scale*Yl/o+r:0}{const i=n[t.fontStack],o=i&&i[e];return o?o.metrics.advance*t.scale+r:0}}function Nc(e,t,n,i){const r=Math.pow(e-t,2);return i?e<t?r/2:2*r:r+Math.abs(n)*n}function Bc(e,t,n){let i=0;return 10===e&&(i-=1e4),n&&(i+=150),40!==e&&65288!==e||(i+=50),41!==t&&65289!==t||(i+=50),i}function zc(e,t,n,i,r,o){let s=null,a=Nc(t,n,r,o);for(const e of i){const i=Nc(t-e.x,n,r,o)+e.badness;i<=a&&(s=e,a=i)}return{index:e,x:t,priorBreak:s,badness:a}}function jc(e){return e?jc(e.priorBreak).concat(e.index):[]}function Uc(e,t,n,i,r,o,s){if("point"!==o)return[];if(!e)return[];const a=[],l=function(e,t,n,i,r,o){let s=0;for(let n=0;n<e.length();n++){const a=e.getSection(n);s+=Fc(e.getCharCode(n),a,i,r,t,o)}return s/Math.max(1,Math.ceil(s/n))}(e,t,n,i,r,s),c=e.text.indexOf("​")>=0;let u=0;for(let n=0;n<e.length();n++){const o=e.getSection(n),d=e.getCharCode(n);if(Lc[d]||(u+=Fc(d,o,i,r,t,s)),n<e.length()-1){const t=!((h=d)<11904||!(Tr["Bopomofo Extended"](h)||Tr.Bopomofo(h)||Tr["CJK Compatibility Forms"](h)||Tr["CJK Compatibility Ideographs"](h)||Tr["CJK Compatibility"](h)||Tr["CJK Radicals Supplement"](h)||Tr["CJK Strokes"](h)||Tr["CJK Symbols and Punctuation"](h)||Tr["CJK Unified Ideographs Extension A"](h)||Tr["CJK Unified Ideographs"](h)||Tr["Enclosed CJK Letters and Months"](h)||Tr["Halfwidth and Fullwidth Forms"](h)||Tr.Hiragana(h)||Tr["Ideographic Description Characters"](h)||Tr["Kangxi Radicals"](h)||Tr["Katakana Phonetic Extensions"](h)||Tr.Katakana(h)||Tr["Vertical Forms"](h)||Tr["Yi Radicals"](h)||Tr["Yi Syllables"](h)));(Dc[d]||t||o.imageName)&&a.push(zc(n+1,u,l,a,Bc(d,e.getCharCode(n+1),t&&c),!1))}}var h;return jc(zc(e.length(),u,l,a,0,!0))}function Vc(e){let t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function Gc(e,t,n,i,r){if(!i&&!r)return;const o=e[n],s=(e[n].x+o.metrics.advance*o.scale)*i;for(let i=t;i<=n;i++)e[i].x-=s,e[i].y+=r}function $c(e,t,n){const{horizontalAlign:i,verticalAlign:r}=Vc(n),o=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*r;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Wc(e){var t,n;let i=e.left,r=e.top,o=e.right-i,s=e.bottom-r;const a=null!==(t=e.image.textFitWidth)&&void 0!==t?t:"stretchOrShrink",l=null!==(n=e.image.textFitHeight)&&void 0!==n?n:"stretchOrShrink",c=(e.image.content[2]-e.image.content[0])/(e.image.content[3]-e.image.content[1]);if("proportional"===l){if("stretchOnly"===a&&o/s<c||"proportional"===a){const e=Math.ceil(s*c);i*=e/o,o=e}}else if("proportional"===a&&"stretchOnly"===l&&0!==c&&o/s>c){const e=Math.ceil(o/c);r*=e/s,s=e}return{x1:i,y1:r,x2:i+o,y2:r+s}}function Hc(e,t,n,i,r,o){const s=e.image;let a;if(s.content){const e=s.content,t=s.pixelRatio||1;a=[e[0]/t,e[1]/t,s.displaySize[0]-e[2]/t,s.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,h,d,p;"width"===n||"both"===n?(p=r[0]+l-i[3],h=r[0]+c+i[1]):(p=r[0]+(l+c-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=t.top*o,m=t.bottom*o;return"height"===n||"both"===n?(u=r[1]+f-i[0],d=r[1]+m+i[2]):(u=r[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}const qc=255,Xc=128,Zc=qc*Xc;function Yc(e,t){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Dr(e+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let r=0;for(;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);let o=r;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const s=t[r],a=t[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new Dr(s)),maxSize:n.evaluate(new Dr(a)),interpolationType:i}}}function Kc(e,t,n){let i="never";const r=e.get(t);return r?i=r:e.get(n)&&(i="always"),i}const Jc=ol.VectorTileFeature.types,Qc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eu(e,t,n,i,r,o,s,a,l,c,u,h,d){const p=a?Math.min(Zc,Math.round(a[0])):0,f=a?Math.min(Zc,Math.round(a[1])):0;e.emplaceBack(t,n,Math.round(32*i),Math.round(32*r),o,s,(p<<1)+(l?1:0),f,16*c,16*u,256*h,256*d)}function tu(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function nu(e){for(const t of e.sections)if(kr(t.text))return!0;return!1}class iu{constructor(e){this.layoutVertexArray=new Ho,this.indexArray=new Ko,this.programConfigurations=e,this.segments=new ts,this.dynamicLayoutVertexArray=new qo,this.opacityVertexArray=new Xo,this.hasVisibleVertices=!1,this.placedSymbolArray=new Mo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,$l.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Qc,!0),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}br("SymbolBuffers",iu);class ru{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new ts,this.collisionVertexArray=new Yo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Wl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}br("CollisionBuffers",ru);class ou{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qs([]),this.placementViewportMatrix=Qs([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yc(this.zoom,n["text-size"]),this.iconSizeData=Yc(this.zoom,n["icon-size"]);const i=this.layers[0].layout,r=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap="never"!==Kc(i,"text-overlap","text-allow-overlap")||"never"!==Kc(i,"icon-overlap","icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==o&&!r.isConstant(),this.sortFeaturesByY=("viewport-y"===o||"auto"===o&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===i.get("symbol-placement")&&(this.writingModes=i.get("text-writing-mode").map((t=>e.ah[t]))),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID}createArrays(){this.text=new iu(new Ss(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new iu(new Ss(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new ko,this.lineVertexArray=new Lo,this.symbolInstances=new Oo,this.textAnchorOffsets=new Fo}calculateGlyphDependencies(e,t,n,i,r){for(let o=0;o<e.length;o++)if(t[e.charCodeAt(o)]=!0,(n||i)&&r){const n=Zl[e.charAt(o)];n&&(t[n.charCodeAt(0)]=!0)}}populate(t,n,i){const r=this.layers[0],o=r.layout,s=o.get("text-font"),a=o.get("text-field"),l=o.get("icon-image"),c=("constant"!==a.value.kind||a.value.value instanceof Ye&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==l.value.kind||!!l.value.value||Object.keys(l.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!c&&!u)return;const d=n.iconDependencies,p=n.glyphDependencies,f=n.availableImages,m=new Dr(this.zoom);for(const{feature:n,id:a,index:l,sourceLayerIndex:g}of t){const t=r._featureFilter.needGeometry,_=Rs(n,t);if(!r._featureFilter.filter(m,_,i))continue;let y,v;if(t||(_.geometry=Ms(n)),c){const e=r.getValueAndResolveTokens("text-field",_,i,f),t=Ye.factory(e),n=this.hasRTLText=this.hasRTLText||nu(t);(!n||"unavailable"===Lr.getRTLTextPluginStatus()||n&&Lr.isParsed())&&(y=Xl(t,r,_))}if(u){const e=r.getValueAndResolveTokens("icon-image",_,i,f);v=e instanceof et?e:et.fromString(e)}if(!y&&!v)continue;const b=this.sortFeaturesByKey?h.evaluate(_,{},i):void 0;if(this.features.push({id:a,text:y,icon:v,index:l,sourceLayerIndex:g,geometry:_.geometry,properties:n.properties,type:Jc[n.type],sortKey:b}),v&&(d[v.name]=!0),y){const t=s.evaluate(_,{},i).join(","),n="viewport"!==o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(e.ah.vertical)>=0;for(const e of y.sections)if(e.image)d[e.image.name]=!0;else{const i=Ar(y.toString()),r=e.fontStack||t,o=p[r]=p[r]||{};this.calculateGlyphDependencies(e.text,o,n,this.allowVerticalPlacement,i)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},n={},i=[];let r=0;function o(t){i.push(e[t]),r++}function s(e,t,r){const o=n[e];return delete n[e],n[t]=o,i[o].geometry[0].pop(),i[o].geometry[0]=i[o].geometry[0].concat(r[0]),o}function a(e,n,r){const o=t[n];return delete t[n],t[e]=o,i[o].geometry[0].shift(),i[o].geometry[0]=r[0].concat(i[o].geometry[0]),o}function l(e,t,n){const i=n?t[0][t[0].length-1]:t[0][0];return`${e}:${i.x}:${i.y}`}for(let c=0;c<e.length;c++){const u=e[c],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(c);continue}const p=l(d,h),f=l(d,h,!0);if(p in n&&f in t&&n[p]!==t[f]){const e=a(p,f,h),r=s(p,f,i[e].geometry);delete t[p],delete n[f],n[l(d,i[r].geometry,!0)]=r,i[e].geometry=null}else p in n?s(p,f,h):f in t?a(p,f,h):(o(c),t[p]=r-1,n[f]=r-1)}return i.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment){let n=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]);const r={};for(let i=e.segment+1;i<t.length;i++)r[i]={x:t[i].x,y:t[i].y,tileUnitDistanceFromAnchor:n},i<t.length-1&&(n+=t[i+1].dist(t[i]));for(let n=e.segment||0;n>=0;n--)r[n]={x:t[n].x,y:t[n].y,tileUnitDistanceFromAnchor:i},n>0&&(i+=t[n-1].dist(t[n]));for(let e=0;e<t.length;e++){const t=r[e];this.lineVertexArray.emplaceBack(t.x,t.y,t.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,n,i,r,o,s,a,l,c,u,h,d){const p=t.indexArray,f=t.layoutVertexArray,m=t.segments.prepareSegment(4*n.length,f,p,this.canOverlap?s.sortKey:void 0),g=this.glyphOffsetArray.length,_=m.vertexLength,y=this.allowVerticalPlacement&&a===e.ah.vertical?Math.PI/2:0,v=s.text&&s.text.sections;for(let e=0;e<n.length;e++){const{tl:r,tr:o,bl:a,br:c,tex:u,pixelOffsetTL:h,pixelOffsetBR:g,minFontScaleX:_,minFontScaleY:b,glyphOffset:x,isSDF:w,sectionIndex:E}=n[e],S=m.vertexLength,T=x[1];eu(f,l.x,l.y,r.x,T+r.y,u.x,u.y,i,w,h.x,h.y,_,b),eu(f,l.x,l.y,o.x,T+o.y,u.x+u.w,u.y,i,w,g.x,h.y,_,b),eu(f,l.x,l.y,a.x,T+a.y,u.x,u.y+u.h,i,w,h.x,g.y,_,b),eu(f,l.x,l.y,c.x,T+c.y,u.x+u.w,u.y+u.h,i,w,g.x,g.y,_,b),tu(t.dynamicLayoutVertexArray,l,y),p.emplaceBack(S,S+1,S+2),p.emplaceBack(S+1,S+2,S+3),m.vertexLength+=4,m.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(x[0]),e!==n.length-1&&E===n[e+1].sectionIndex||t.programConfigurations.populatePaintArrays(f.length,s,s.index,{},d,v&&v[E])}t.placedSymbolArray.emplaceBack(l.x,l.y,g,this.glyphOffsetArray.length-g,_,c,u,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],a,0,!1,0,h)}_addCollisionDebugVertex(e,t,n,i,r,o){return t.emplaceBack(0,0),e.emplaceBack(n.x,n.y,i,r,Math.round(o.x),Math.round(o.y))}addCollisionDebugVertices(e,t,n,i,r,s,a){const l=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),c=l.vertexLength,u=r.layoutVertexArray,h=r.collisionVertexArray,d=a.anchorX,p=a.anchorY;this._addCollisionDebugVertex(u,h,s,d,p,new o(e,t)),this._addCollisionDebugVertex(u,h,s,d,p,new o(n,t)),this._addCollisionDebugVertex(u,h,s,d,p,new o(n,i)),this._addCollisionDebugVertex(u,h,s,d,p,new o(e,i)),l.vertexLength+=4;const f=r.indexArray;f.emplaceBack(c,c+1),f.emplaceBack(c+1,c+2),f.emplaceBack(c+2,c+3),f.emplaceBack(c+3,c),l.primitiveLength+=4}addDebugCollisionBoxes(e,t,n,i){for(let r=e;r<t;r++){const e=this.collisionBoxArray.get(r);this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,i?this.textCollisionBox:this.iconCollisionBox,e.anchorPoint,n)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ru(Zo,Hl.members,Jo),this.iconCollisionBox=new ru(Zo,Hl.members,Jo);for(let e=0;e<this.symbolInstances.length;e++){const t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}}_deserializeCollisionBoxesForSymbol(e,t,n,i,r,o,s,a,l){const c={};for(let i=t;i<n;i++){const t=e.get(i);c.textBox={x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,anchorPointX:t.anchorPointX,anchorPointY:t.anchorPointY},c.textFeatureIndex=t.featureIndex;break}for(let t=i;t<r;t++){const n=e.get(t);c.verticalTextBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalTextFeatureIndex=n.featureIndex;break}for(let t=o;t<s;t++){const n=e.get(t);c.iconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.iconFeatureIndex=n.featureIndex;break}for(let t=a;t<l;t++){const n=e.get(t);c.verticalIconBox={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2,anchorPointX:n.anchorPointX,anchorPointY:n.anchorPointY},c.verticalIconFeatureIndex=n.featureIndex;break}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let t=n.vertexStartIndex;t<i;t+=4)e.indexArray.emplaceBack(t,t+1,t+2),e.indexArray.emplaceBack(t+1,t+2,t+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],r=[],o=[];for(let e=0;e<this.symbolInstances.length;++e){o.push(e);const s=this.symbolInstances.get(e);i.push(0|Math.round(t*s.anchorX+n*s.anchorY)),r.push(s.featureIndex)}return o.sort(((e,t)=>i[e]-i[t]||r[t]-r[e])),o}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex),[t.rightJustifiedTextSymbolIndex,t.centerJustifiedTextSymbolIndex,t.leftJustifiedTextSymbolIndex].forEach(((e,t,n)=>{e>=0&&n.indexOf(e)===t&&this.addIndicesForPlacedSymbol(this.text,e)})),t.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,t.verticalPlacedTextSymbolIndex),t.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.placedIconSymbolIndex),t.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,t.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let su,au;br("SymbolBucket",ou,{omit:["layers","collisionBoxArray","features","compareText"]}),ou.MAX_GLYPHS=65535,ou.addDynamicAttributes=tu;var lu={get paint(){return au=au||new Zr({"icon-opacity":new Wr(H.paint_symbol["icon-opacity"]),"icon-color":new Wr(H.paint_symbol["icon-color"]),"icon-halo-color":new Wr(H.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wr(H.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wr(H.paint_symbol["icon-halo-blur"]),"icon-translate":new $r(H.paint_symbol["icon-translate"]),"icon-translate-anchor":new $r(H.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wr(H.paint_symbol["text-opacity"]),"text-color":new Wr(H.paint_symbol["text-color"],{runtimeType:de,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Wr(H.paint_symbol["text-halo-color"]),"text-halo-width":new Wr(H.paint_symbol["text-halo-width"]),"text-halo-blur":new Wr(H.paint_symbol["text-halo-blur"]),"text-translate":new $r(H.paint_symbol["text-translate"]),"text-translate-anchor":new $r(H.paint_symbol["text-translate-anchor"])})},get layout(){return su=su||new Zr({"symbol-placement":new $r(H.layout_symbol["symbol-placement"]),"symbol-spacing":new $r(H.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $r(H.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wr(H.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $r(H.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $r(H.layout_symbol["icon-allow-overlap"]),"icon-overlap":new $r(H.layout_symbol["icon-overlap"]),"icon-ignore-placement":new $r(H.layout_symbol["icon-ignore-placement"]),"icon-optional":new $r(H.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $r(H.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wr(H.layout_symbol["icon-size"]),"icon-text-fit":new $r(H.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $r(H.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wr(H.layout_symbol["icon-image"]),"icon-rotate":new Wr(H.layout_symbol["icon-rotate"]),"icon-padding":new Wr(H.layout_symbol["icon-padding"]),"icon-keep-upright":new $r(H.layout_symbol["icon-keep-upright"]),"icon-offset":new Wr(H.layout_symbol["icon-offset"]),"icon-anchor":new Wr(H.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $r(H.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $r(H.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $r(H.layout_symbol["text-rotation-alignment"]),"text-field":new Wr(H.layout_symbol["text-field"]),"text-font":new Wr(H.layout_symbol["text-font"]),"text-size":new Wr(H.layout_symbol["text-size"]),"text-max-width":new Wr(H.layout_symbol["text-max-width"]),"text-line-height":new $r(H.layout_symbol["text-line-height"]),"text-letter-spacing":new Wr(H.layout_symbol["text-letter-spacing"]),"text-justify":new Wr(H.layout_symbol["text-justify"]),"text-radial-offset":new Wr(H.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $r(H.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wr(H.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wr(H.layout_symbol["text-anchor"]),"text-max-angle":new $r(H.layout_symbol["text-max-angle"]),"text-writing-mode":new $r(H.layout_symbol["text-writing-mode"]),"text-rotate":new Wr(H.layout_symbol["text-rotate"]),"text-padding":new $r(H.layout_symbol["text-padding"]),"text-keep-upright":new $r(H.layout_symbol["text-keep-upright"]),"text-transform":new Wr(H.layout_symbol["text-transform"]),"text-offset":new Wr(H.layout_symbol["text-offset"]),"text-allow-overlap":new $r(H.layout_symbol["text-allow-overlap"]),"text-overlap":new $r(H.layout_symbol["text-overlap"]),"text-ignore-placement":new $r(H.layout_symbol["text-ignore-placement"]),"text-optional":new $r(H.layout_symbol["text-optional"])})}};class cu{constructor(e){if(void 0===e.property.overrides)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:le,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}br("FormatSectionOverride",cu,{omit:["defaultValue"]});class uu extends Kr{constructor(e){super(e,lu)}recalculate(e,t){if(super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]="map"===this.layout.get("text-rotation-alignment")?"map":"viewport"),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){const e=this.layout.get("text-writing-mode");if(e){const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const r=this.layout.get(e).evaluate(t,{},n,i),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||vi(o.value)||!r?r:function(e,t){return t.replace(/{([^{}]+)}/g,((t,n)=>e&&n in e?String(e[n]):""))}(t.properties,r)}createBucket(e){return new ou(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of lu.paint.overridableProperties){if(!uu.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new cu(t),i=new yi(n,t.property.specification);let r=null;r="constant"===t.value.kind||"source"===t.value.kind?new xi("source",i):new wi("composite",i,t.value.zoomStops),this.paint._values[e]=new Vr(t.property,r,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&uu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=lu.paint.properties[t];let r=!1;const o=e=>{for(const t of e)if(i.overrides&&i.overrides.hasOverride(t))return void(r=!0)};if("constant"===n.value.kind&&n.value.value instanceof Ye)o(n.value.value.sections);else if("source"===n.value.kind){const e=t=>{r||(t instanceof ot&&it(t.value)===ge?o(t.value.sections):t instanceof $t?o(t.sections):t.eachChild(e))},t=n.value;t._styleExpression&&e(t._styleExpression.expression)}return r}}let hu;var du={get paint(){return hu=hu||new Zr({"background-color":new $r(H.paint_background["background-color"]),"background-pattern":new qr(H.paint_background["background-pattern"]),"background-opacity":new $r(H.paint_background["background-opacity"])})}};class pu extends Kr{constructor(e){super(e,du)}}let fu;var mu={get paint(){return fu=fu||new Zr({"raster-opacity":new $r(H.paint_raster["raster-opacity"]),"raster-hue-rotate":new $r(H.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $r(H.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $r(H.paint_raster["raster-brightness-max"]),"raster-saturation":new $r(H.paint_raster["raster-saturation"]),"raster-contrast":new $r(H.paint_raster["raster-contrast"]),"raster-resampling":new $r(H.paint_raster["raster-resampling"]),"raster-fade-duration":new $r(H.paint_raster["raster-fade-duration"])})}};class gu extends Kr{constructor(e){super(e,mu)}}class _u extends Kr{constructor(e){super(e,{}),this.onAdd=e=>{this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)},this.onRemove=e=>{this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)},this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class yu{constructor(e){this._methodToThrottle=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const vu=6371008.8;class bu{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bu(g(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,r=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return vu*Math.acos(Math.min(r,1))}static convert(e){if(e instanceof bu)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new bu(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new bu(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xu=2*Math.PI*vu;function wu(e){return xu*Math.cos(e*Math.PI/180)}function Eu(e){return(180+e)/360}function Su(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Tu(e,t){return e/wu(t)}function Au(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}class Cu{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=bu.convert(e);return new Cu(Eu(n.lng),Su(n.lat),Tu(t,n.lat))}toLngLat(){return new bu(360*this.x-180,Au(this.y))}toAltitude(){return this.z*wu(Au(this.y))}meterInMercatorCoordinateUnits(){return 1/xu*(e=Au(this.y),1/Math.cos(e*Math.PI/180));var e}}function Pu(e,t,n){var i=2*Math.PI*6378137/256/Math.pow(2,n);return[e*i-2*Math.PI*6378137/2,t*i-2*Math.PI*6378137/2]}class Iu{constructor(e,t,n){if(e<0||e>25||n<0||n>=Math.pow(2,e)||t<0||t>=Math.pow(2,e))throw new Error(`x=${t}, y=${n}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=t,this.y=n,this.key=Ou(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t,n){const i=(o=this.y,s=this.z,a=Pu(256*(r=this.x),256*(o=Math.pow(2,s)-o-1),s),l=Pu(256*(r+1),256*(o+1),s),a[0]+","+a[1]+","+l[0]+","+l[1]);var r,o,s,a,l;const c=function(e,t,n){let i,r="";for(let o=e;o>0;o--)i=1<<o-1,r+=(t&i?1:0)+(n&i?2:0);return r}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,t>1?"@2x":"").replace(/{quadkey}/g,c).replace(/{bbox-epsg-3857}/g,i)}isChildOf(e){const t=this.z-e.z;return t>0&&e.x===this.x>>t&&e.y===this.y>>t}getTilePoint(e){const t=Math.pow(2,this.z);return new o((e.x*t-this.x)*Cs,(e.y*t-this.y)*Cs)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Ou(e,t.z,t.z,t.x,t.y)}}class Ru{constructor(e,t,n,i,r){if(e<n)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${n}`);this.overscaledZ=e,this.wrap=t,this.canonical=new Iu(n,+i,+r),this.key=Ou(t,e,n,i,r)}clone(){return new Ru(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const t=this.canonical.z-e;return e>this.canonical.z?new Ru(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ru(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?Ou(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Ou(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Ru(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new Ru(t,this.wrap,t,n,i),new Ru(t,this.wrap,t,n+1,i),new Ru(t,this.wrap,t,n,i+1),new Ru(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ru(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ru(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Cu(e.x-this.wrap,e.y))}}function Ou(e,t,n,i,r){(e*=2)<0&&(e=-1*e-1);const o=1<<n;return(o*o*e+o*r+i).toString(36)+n.toString(36)+t.toString(36)}br("CanonicalTileID",Iu),br("OverscaledTileID",Ru,{omit:["posMatrix"]});class ku{constructor(e,t,n,i=1,r=1,o=1,s=0){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&!["mapbox","terrarium","custom"].includes(n))return void E(`"${n}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=t.height;const a=this.dim=t.height-2;switch(this.data=new Uint32Array(t.data.buffer),n){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=i,this.greenFactor=r,this.blueFactor=o,this.baseShift=s;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let e=0;e<a;e++)this.data[this._idx(-1,e)]=this.data[this._idx(0,e)],this.data[this._idx(a,e)]=this.data[this._idx(a-1,e)],this.data[this._idx(e,-1)]=this.data[this._idx(e,0)],this.data[this._idx(e,a)]=this.data[this._idx(e,a-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(a,-1)]=this.data[this._idx(a-1,0)],this.data[this._idx(-1,a)]=this.data[this._idx(0,a-1)],this.data[this._idx(a,a)]=this.data[this._idx(a-1,a-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let e=0;e<a;e++)for(let t=0;t<a;t++){const n=this.get(e,t);n>this.max&&(this.max=n),n<this.min&&(this.min=n)}}get(e,t){const n=new Uint8Array(this.data.buffer),i=4*this._idx(e,t);return this.unpack(n[i],n[i+1],n[i+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}unpack(e,t,n){return e*this.redFactor+t*this.greenFactor+n*this.blueFactor-this.baseShift}getPixels(){return new pa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,r=t*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(t){case-1:i=r-1;break;case 1:r=i+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-t*this.dim,l=-n*this.dim;for(let t=o;t<s;t++)for(let n=i;n<r;n++)this.data[this._idx(n,t)]=e.data[this._idx(n+a,t+l)]}}br("DEMData",ku);class Lu{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Du{constructor(e,t,n,i,r){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=n,e._y=i,this.properties=e.properties,this.id=r}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}}class Fu{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yr(Cs,16,0),this.grid3D=new yr(Cs,16,0),this.featureIndexArray=new Bo,this.promoteId=t}insert(e,t,n,i,r,o){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,r);const a=o?this.grid3D:this.grid;for(let e=0;e<t.length;e++){const n=t[e],i=[1/0,1/0,-1/0,-1/0];for(let e=0;e<n.length;e++){const t=n[e];i[0]=Math.min(i[0],t.x),i[1]=Math.min(i[1],t.y),i[2]=Math.max(i[2],t.x),i[3]=Math.max(i[3],t.y)}i[0]<Cs&&i[1]<Cs&&i[2]>=0&&i[3]>=0&&a.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ol.VectorTile(new vc(this.rawTileData)).layers,this.sourceLayerCoder=new Lu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,t,n,i){this.loadVTLayers();const r=e.params||{},s=Cs/e.tileSize/e.scale,a=Pi(r.filter),l=e.queryGeometry,c=e.queryPadding*s,u=Bu(l),h=this.grid.query(u.minX-c,u.minY-c,u.maxX+c,u.maxY+c),d=Bu(e.cameraQueryGeometry),p=this.grid3D.query(d.minX-c,d.minY-c,d.maxX+c,d.maxY+c,((t,n,i,r)=>function(e,t,n,i,r){for(const o of e)if(t<=o.x&&n<=o.y&&i>=o.x&&r>=o.y)return!0;const s=[new o(t,n),new o(t,r),new o(i,r),new o(i,n)];if(e.length>2)for(const t of s)if(Gs(e,t))return!0;for(let t=0;t<e.length-1;t++)if($s(e[t],e[t+1],s))return!0;return!1}(e.cameraQueryGeometry,t-c,n-c,i+c,r+c)));for(const e of p)h.push(e);h.sort(zu);const f={};let m;for(let o=0;o<h.length;o++){const c=h[o];if(c===m)continue;m=c;const u=this.featureIndexArray.get(c);let d=null;this.loadMatchingFeature(f,u.bucketIndex,u.sourceLayerIndex,u.featureIndex,a,r.layers,r.availableImages,t,n,i,((t,n,i)=>(d||(d=Ms(t)),n.queryIntersectsFeature(l,t,i,d,this.z,e.transform,s,e.pixelPosMatrix))))}return f}loadMatchingFeature(e,t,n,i,r,o,s,a,l,c,u){const h=this.bucketLayerIDs[t];if(o&&!function(e,t){for(let n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(o,h))return;const d=this.sourceLayerCoder.decode(n),p=this.vtLayers[d].feature(i);if(r.needGeometry){const e=Rs(p,!0);if(!r.filter(new Dr(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!r.filter(new Dr(this.tileID.overscaledZ),p))return;const f=this.getId(p,d);for(let t=0;t<h.length;t++){const n=h[t];if(o&&o.indexOf(n)<0)continue;const r=a[n];if(!r)continue;let d={};f&&c&&(d=c.getState(r.sourceLayer||"_geojsonTileLayer",f));const m=_({},l[n]);m.paint=Nu(m.paint,r.paint,p,d,s),m.layout=Nu(m.layout,r.layout,p,d,s);const g=!u||u(p,r,d);if(!g)continue;const y=new Du(p,this.z,this.x,this.y,f);y.layer=m;let v=e[n];void 0===v&&(v=e[n]=[]),v.push({featureIndex:i,feature:y,intersectionZ:g})}}lookupSymbolFeatures(e,t,n,i,r,o,s,a){const l={};this.loadVTLayers();const c=Pi(r);for(const r of e)this.loadMatchingFeature(l,n,i,r,c,o,s,a,t);return l}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;return this.promoteId&&(n=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]],"boolean"==typeof n&&(n=Number(n))),n}}function Nu(e,t,n,i,r){return v(e,((e,o)=>{const s=t instanceof Gr?t.get(o):null;return s&&s.evaluate?s.evaluate(n,i,r):s}))}function Bu(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{minX:t,minY:n,maxX:i,maxY:r}}function zu(e,t){return t-e}function ju(e,t,n,i,r){const s=[];for(let a=0;a<e.length;a++){const l=e[a];let c;for(let e=0;e<l.length-1;e++){let a=l[e],u=l[e+1];a.x<t&&u.x<t||(a.x<t?a=new o(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<t&&(u=new o(t,a.y+(t-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<n&&u.y<n||(a.y<n?a=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y<n&&(u=new o(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),a.x>=i&&u.x>=i||(a.x>=i?a=new o(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=i&&(u=new o(i,a.y+(i-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=r&&u.y>=r||(a.y>=r?a=new o(a.x+(r-a.y)/(u.y-a.y)*(u.x-a.x),r)._round():u.y>=r&&(u=new o(a.x+(r-a.y)/(u.y-a.y)*(u.x-a.x),r)._round()),c&&a.equals(c[c.length-1])||(c=[a],s.push(c)),c.push(u)))))}}return s}br("FeatureIndex",Fu,{omit:["rawTileData","sourceLayerCoder"]});class Uu extends o{constructor(e,t,n,i){super(e,t),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new Uu(this.x,this.y,this.angle,this.segment)}}function Vu(e,t,n,i,r){if(void 0===t.segment||0===n)return!0;let o=t,s=t.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=e[s].dist(o),o=e[s]}a+=e[s].dist(e[s+1]),s++;const l=[];let c=0;for(;a<n/2;){const t=e[s],n=e[s+1];if(!n)return!1;let o=e[s-1].angleTo(t)-t.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:o}),c+=o;a-l[0].distance>i;)c-=l.shift().angleDelta;if(c>r)return!1;s++,a+=t.dist(n)}return!0}function Gu(e){let t=0;for(let n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function $u(e,t,n){return e?.6*t*n:0}function Wu(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Hu(e,t,n,i,r,o){const s=$u(n,r,o),a=Wu(n,i)*o;let l=0;const c=Gu(e)/2;for(let n=0;n<e.length-1;n++){const i=e[n],r=e[n+1],o=i.dist(r);if(l+o>c){const u=(c-l)/o,h=It.number(i.x,r.x,u),d=It.number(i.y,r.y,u),p=new Uu(h,d,r.angleTo(i),n);return p._round(),!s||Vu(e,p,a,s,t)?p:void 0}l+=o}}function qu(e,t,n,i,r,o,s,a,l){const c=$u(i,o,s),u=Wu(i,r),h=u*s,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),Xu(e,d?t/2*a%t:(u/2+2*o)*s*a%t,t,c,n,h,d,!1,l)}function Xu(e,t,n,i,r,o,s,a,l){const c=o/2,u=Gu(e);let h=0,d=t-n,p=[];for(let t=0;t<e.length-1;t++){const s=e[t],a=e[t+1],f=s.dist(a),m=a.angleTo(s);for(;d+n<h+f;){d+=n;const g=(d-h)/f,_=It.number(s.x,a.x,g),y=It.number(s.y,a.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=u){const n=new Uu(_,y,m,t);n._round(),i&&!Vu(e,n,o,i,r)||p.push(n)}}h+=f}return a||p.length||s||(p=Xu(e,h/2,n,i,r,o,s,!0,l)),p}br("Anchor",Uu);const Zu=Ac;function Yu(e,t,n,i){const r=[],s=e.image,a=s.pixelRatio,l=s.paddedRect.w-2*Zu,c=s.paddedRect.h-2*Zu;let u={x1:e.left,y1:e.top,x2:e.right,y2:e.bottom};const h=s.stretchX||[[0,l]],d=s.stretchY||[[0,c]],p=(e,t)=>e+t[1]-t[0],f=h.reduce(p,0),m=d.reduce(p,0),g=l-f,_=c-m;let y=0,v=f,b=0,x=m,w=0,E=g,S=0,T=_;if(s.content&&i){const t=s.content,n=t[2]-t[0],i=t[3]-t[1];(s.textFitWidth||s.textFitHeight)&&(u=Wc(e)),y=Ku(h,0,t[0]),b=Ku(d,0,t[1]),v=Ku(h,t[0],t[2]),x=Ku(d,t[1],t[3]),w=t[0]-y,S=t[1]-b,E=n-v,T=i-x}const A=u.x1,C=u.y1,P=u.x2-A,I=u.y2-C,M=(e,i,r,l)=>{const c=Qu(e.stretch-y,v,P,A),u=eh(e.fixed-w,E,e.stretch,f),h=Qu(i.stretch-b,x,I,C),d=eh(i.fixed-S,T,i.stretch,m),p=Qu(r.stretch-y,v,P,A),g=eh(r.fixed-w,E,r.stretch,f),_=Qu(l.stretch-b,x,I,C),M=eh(l.fixed-S,T,l.stretch,m),R=new o(c,h),O=new o(p,h),k=new o(p,_),L=new o(c,_),D=new o(u/a,d/a),F=new o(g/a,M/a),N=t*Math.PI/180;if(N){const e=Math.sin(N),t=Math.cos(N),n=[t,-e,e,t];R._matMult(n),O._matMult(n),L._matMult(n),k._matMult(n)}const B=e.stretch+e.fixed,z=i.stretch+i.fixed;return{tl:R,tr:O,bl:L,br:k,tex:{x:s.paddedRect.x+Zu+B,y:s.paddedRect.y+Zu+z,w:r.stretch+r.fixed-B,h:l.stretch+l.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:F,minFontScaleX:E/a/P,minFontScaleY:T/a/I,isSDF:n}};if(i&&(s.stretchX||s.stretchY)){const e=Ju(h,g,f),t=Ju(d,_,m);for(let n=0;n<e.length-1;n++){const i=e[n],o=e[n+1];for(let e=0;e<t.length-1;e++)r.push(M(i,t[e],o,t[e+1]))}}else r.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return r}function Ku(e,t,n){let i=0;for(const r of e)i+=Math.max(t,Math.min(n,r[1]))-Math.max(t,Math.min(n,r[0]));return i}function Ju(e,t,n){const i=[{fixed:-Zu,stretch:0}];for(const[t,n]of e){const e=i[i.length-1];i.push({fixed:t-e.stretch,stretch:e.stretch}),i.push({fixed:t-e.stretch,stretch:e.stretch+(n-t)})}return i.push({fixed:t+Zu,stretch:n}),i}function Qu(e,t,n,i){return e/t*n+i}function eh(e,t,n,i){return e-t*n/i}class th{constructor(e,t,n,i,r,s,a,l,c,u){var h;if(this.boxStartIndex=e.length,c){let e=s.top,t=s.bottom;const n=s.collisionPadding;n&&(e-=n[1],t+=n[3]);let i=t-e;i>0&&(i=Math.max(10,i),this.circleDiameter=i)}else{const c=(null===(h=s.image)||void 0===h?void 0:h.content)&&(s.image.textFitWidth||s.image.textFitHeight)?Wc(s):{x1:s.left,y1:s.top,x2:s.right,y2:s.bottom};c.y1=c.y1*a-l[0],c.y2=c.y2*a+l[2],c.x1=c.x1*a-l[3],c.x2=c.x2*a+l[1];const d=s.collisionPadding;if(d&&(c.x1-=d[0]*a,c.y1-=d[1]*a,c.x2+=d[2]*a,c.y2+=d[3]*a),u){const e=new o(c.x1,c.y1),t=new o(c.x2,c.y1),n=new o(c.x1,c.y2),i=new o(c.x2,c.y2),r=u*Math.PI/180;e._rotate(r),t._rotate(r),n._rotate(r),i._rotate(r),c.x1=Math.min(e.x,t.x,n.x,i.x),c.x2=Math.max(e.x,t.x,n.x,i.x),c.y1=Math.min(e.y,t.y,n.y,i.y),c.y2=Math.max(e.y,t.y,n.y,i.y)}e.emplaceBack(t.x,t.y,c.x1,c.y1,c.x2,c.y2,n,i,r)}this.boxEndIndex=e.length}}class nh{constructor(e=[],t=ih){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const r=e-1>>1,o=t[r];if(n(i,o)>=0)break;t[e]=o,e=r}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,r=t[e];for(;e<i;){let i=1+(e<<1),o=t[i];const s=i+1;if(s<this.length&&n(t[s],o)<0&&(i=s,o=t[s]),n(o,r)>=0)break;t[e]=o,e=i}t[e]=r}}function ih(e,t){return e<t?-1:e>t?1:0}function rh(e,t=1,n=!1){let i=1/0,r=1/0,s=-1/0,a=-1/0;const l=e[0];for(let e=0;e<l.length;e++){const t=l[e];(!e||t.x<i)&&(i=t.x),(!e||t.y<r)&&(r=t.y),(!e||t.x>s)&&(s=t.x),(!e||t.y>a)&&(a=t.y)}const c=Math.min(s-i,a-r);let u=c/2;const h=new nh([],oh);if(0===c)return new o(i,r);for(let t=i;t<s;t+=c)for(let n=r;n<a;n+=c)h.push(new sh(t+u,n+u,u,e));let d=function(e){let t=0,n=0,i=0;const r=e[0];for(let e=0,o=r.length,s=o-1;e<o;s=e++){const o=r[e],a=r[s],l=o.x*a.y-a.x*o.y;n+=(o.x+a.x)*l,i+=(o.y+a.y)*l,t+=3*l}return new sh(n/t,i/t,0,e)}(e),p=h.length;for(;h.length;){const i=h.pop();(i.d>d.d||!d.d)&&(d=i,n&&console.log("found best %d after %d probes",Math.round(1e4*i.d)/1e4,p)),i.max-d.d<=t||(u=i.h/2,h.push(new sh(i.p.x-u,i.p.y-u,u,e)),h.push(new sh(i.p.x+u,i.p.y-u,u,e)),h.push(new sh(i.p.x-u,i.p.y+u,u,e)),h.push(new sh(i.p.x+u,i.p.y+u,u,e)),p+=4)}return n&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function oh(e,t){return t.max-e.max}function sh(e,t,n,i){this.p=new o(e,t),this.h=n,this.d=function(e,t){let n=!1,i=1/0;for(let r=0;r<t.length;r++){const o=t[r];for(let t=0,r=o.length,s=r-1;t<r;s=t++){const r=o[t],a=o[s];r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,Us(e,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}var ah;e.aq=void 0,(ah=e.aq||(e.aq={}))[ah.center=1]="center",ah[ah.left=2]="left",ah[ah.right=3]="right",ah[ah.top=4]="top",ah[ah.bottom=5]="bottom",ah[ah["top-left"]=6]="top-left",ah[ah["top-right"]=7]="top-right",ah[ah["bottom-left"]=8]="bottom-left",ah[ah["bottom-right"]=9]="bottom-right";const lh=7,ch=Number.POSITIVE_INFINITY;function uh(e,t){return t[1]!==ch?function(e,t,n){let i=0,r=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":r=n-lh;break;case"bottom-right":case"bottom-left":case"bottom":r=-n+lh}switch(e){case"top-right":case"bottom-right":case"right":i=-t;break;case"top-left":case"bottom-left":case"left":i=t}return[i,r]}(e,t[0],t[1]):function(e,t){let n=0,i=0;t<0&&(t=0);const r=t/Math.SQRT2;switch(e){case"top-right":case"top-left":i=r-lh;break;case"bottom-right":case"bottom-left":i=-r+lh;break;case"bottom":i=-t+lh;break;case"top":i=t-lh}switch(e){case"top-right":case"bottom-right":n=-r;break;case"top-left":case"bottom-left":n=r;break;case"left":n=t;break;case"right":n=-t}return[n,i]}(e,t[0])}function hh(e,t,n){var i;const r=e.layout,o=null===(i=r.get("text-variable-anchor-offset"))||void 0===i?void 0:i.evaluate(t,{},n);if(o){const e=o.values,t=[];for(let n=0;n<e.length;n+=2){const i=t[n]=e[n],r=e[n+1].map((e=>e*Yl));i.startsWith("top")?r[1]-=lh:i.startsWith("bottom")&&(r[1]+=lh),t[n+1]=r}return new Qe(t)}const s=r.get("text-variable-anchor");if(s){let i;i=void 0!==e._unevaluatedLayout.getValue("text-radial-offset")?[r.get("text-radial-offset").evaluate(t,{},n)*Yl,ch]:r.get("text-offset").evaluate(t,{},n).map((e=>e*Yl));const o=[];for(const e of s)o.push(e,uh(e,i));return new Qe(o)}return null}function dh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ph(t,n,i,r,o,s,a,l,c,u,h){let d=s.textMaxSize.evaluate(n,{});void 0===d&&(d=a);const p=t.layers[0].layout,f=p.get("icon-offset").evaluate(n,{},h),m=mh(i.horizontal),g=a/24,_=t.tilePixelRatio*g,y=t.tilePixelRatio*d/24,v=t.tilePixelRatio*l,b=t.tilePixelRatio*p.get("symbol-spacing"),x=p.get("text-padding")*t.tilePixelRatio,w=function(e,t,n,i=1){const r=e.get("icon-padding").evaluate(t,{},n),o=r&&r.values;return[o[0]*i,o[1]*i,o[2]*i,o[3]*i]}(p,n,h,t.tilePixelRatio),S=p.get("text-max-angle")/180*Math.PI,T="viewport"!==p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),A="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),C=p.get("symbol-placement"),P=b/2,I=p.get("icon-text-fit");let M;r&&"none"!==I&&(t.allowVerticalPlacement&&i.vertical&&(M=Hc(r,i.vertical,I,p.get("icon-text-fit-padding"),f,g)),m&&(r=Hc(r,m,I,p.get("icon-text-fit-padding"),f,g)));const R=(l,d)=>{d.x<0||d.x>=Cs||d.y<0||d.y>=Cs||function(t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,S,T,A){const C=t.addToLineVertexArray(n,i);let P,I,M,R,O=0,k=0,L=0,D=0,F=-1,N=-1;const B={};let z=as("");if(t.allowVerticalPlacement&&r.vertical){const e=l.layout.get("text-rotate").evaluate(x,{},T)+90;M=new th(c,n,u,h,d,r.vertical,p,f,m,e),a&&(R=new th(c,n,u,h,d,a,_,y,m,e))}if(o){const i=l.layout.get("icon-rotate").evaluate(x,{}),r="none"!==l.layout.get("icon-text-fit"),s=Yu(o,i,S,r),p=a?Yu(a,i,S,r):void 0;I=new th(c,n,u,h,d,o,_,y,!1,i),O=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[Xc*l.layout.get("icon-size").evaluate(x,{})],m[0]>Zc&&E(`${t.layerIds[0]}: Value for "icon-size" is >= ${qc}. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[Xc*w.compositeIconSizes[0].evaluate(x,{},T),Xc*w.compositeIconSizes[1].evaluate(x,{},T)],(m[0]>Zc||m[1]>Zc)&&E(`${t.layerIds[0]}: Value for "icon-size" is >= ${qc}. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,b,v,x,e.ah.none,n,C.lineStartIndex,C.lineLength,-1,T),F=t.icon.placedSymbolArray.length-1,p&&(k=4*p.length,t.addSymbols(t.icon,p,m,b,v,x,e.ah.vertical,n,C.lineStartIndex,C.lineLength,-1,T),N=t.icon.placedSymbolArray.length-1)}const j=Object.keys(r.horizontal);for(const i of j){const o=r.horizontal[i];if(!P){z=as(o.text);const e=l.layout.get("text-rotate").evaluate(x,{},T);P=new th(c,n,u,h,d,o,p,f,m,e)}const a=1===o.positionedLines.length;if(L+=fh(t,n,o,s,l,m,x,g,C,r.vertical?e.ah.horizontal:e.ah.horizontalOnly,a?j:[i],B,F,w,T),a)break}r.vertical&&(D+=fh(t,n,r.vertical,s,l,m,x,g,C,e.ah.vertical,["vertical"],B,N,w,T));const U=P?P.boxStartIndex:t.collisionBoxArray.length,V=P?P.boxEndIndex:t.collisionBoxArray.length,G=M?M.boxStartIndex:t.collisionBoxArray.length,$=M?M.boxEndIndex:t.collisionBoxArray.length,W=I?I.boxStartIndex:t.collisionBoxArray.length,H=I?I.boxEndIndex:t.collisionBoxArray.length,q=R?R.boxStartIndex:t.collisionBoxArray.length,X=R?R.boxEndIndex:t.collisionBoxArray.length;let Z=-1;const Y=(e,t)=>e&&e.circleDiameter?Math.max(e.circleDiameter,t):t;Z=Y(P,Z),Z=Y(M,Z),Z=Y(I,Z),Z=Y(R,Z);const K=Z>-1?1:0;K&&(Z*=A/Yl),t.glyphOffsetArray.length>=ou.MAX_GLYPHS&&E("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey);const J=hh(l,x,T),[Q,ee]=function(t,n){const i=t.length,r=null==n?void 0:n.values;if((null==r?void 0:r.length)>0)for(let n=0;n<r.length;n+=2){const i=r[n+1];t.emplaceBack(e.aq[r[n]],i[0],i[1])}return[i,t.length]}(t.textAnchorOffsets,J);t.symbolInstances.emplaceBack(n.x,n.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical||-1,F,N,z,U,V,G,$,W,H,q,X,u,L,D,O,k,K,0,p,Z,Q,ee)}(t,d,l,i,r,o,M,t.layers[0],t.collisionBoxArray,n.index,n.sourceLayerIndex,t.index,_,[x,x,x,x],T,c,v,w,A,f,n,s,u,h,a)};if("line"===C)for(const e of ju(n.geometry,0,0,Cs,Cs)){const n=qu(e,b,S,i.vertical||m,r,24,y,t.overscaling,Cs);for(const i of n)m&&gh(t,m.text,P,i)||R(e,i)}else if("line-center"===C){for(const e of n.geometry)if(e.length>1){const t=Hu(e,S,i.vertical||m,r,24,y);t&&R(e,t)}}else if("Polygon"===n.type)for(const e of vn(n.geometry,0)){const t=rh(e,16);R(e[0],new Uu(t.x,t.y,0))}else if("LineString"===n.type)for(const e of n.geometry)R(e,new Uu(e[0].x,e[0].y,0));else if("Point"===n.type)for(const e of n.geometry)for(const t of e)R([t],new Uu(t.x,t.y,0))}function fh(e,t,n,i,r,s,a,l,c,u,h,d,p,f,m){const g=function(e,t,n,i,r,s,a,l){const c=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=[];for(const e of t.positionedLines)for(const i of e.positionedGlyphs){if(!i.rect)continue;const s=i.rect||{};let h=Sc+1,d=!0,p=1,f=0;const m=(r||l)&&i.vertical,g=i.metrics.advance*i.scale/2;if(l&&t.verticalizable&&(f=e.lineOffset/2-(i.imageName?-(Yl-i.metrics.width*i.scale)/2:(i.scale-1)*Yl)),i.imageName){const e=a[i.imageName];d=e.sdf,p=e.pixelRatio,h=Ac/p}const _=r?[i.x+g,i.y]:[0,0];let y=r?[0,0]:[i.x+g+n[0],i.y+n[1]-f],v=[0,0];m&&(v=y,y=[0,0]);const b=i.metrics.isDoubleResolution?2:1,x=(i.metrics.left-h)*i.scale-g+y[0],w=(-i.metrics.top-h)*i.scale+y[1],E=x+s.w/b*i.scale/p,S=w+s.h/b*i.scale/p,T=new o(x,w),A=new o(E,w),C=new o(x,S),P=new o(E,S);if(m){const e=new o(-g,g-Mc),t=-Math.PI/2,n=Yl/2-g,r=new o(5-Mc-n,-(i.imageName?n:0)),s=new o(...v);T._rotateAround(t,e)._add(r)._add(s),A._rotateAround(t,e)._add(r)._add(s),C._rotateAround(t,e)._add(r)._add(s),P._rotateAround(t,e)._add(r)._add(s)}if(c){const e=Math.sin(c),t=Math.cos(c),n=[t,-e,e,t];T._matMult(n),A._matMult(n),C._matMult(n),P._matMult(n)}const I=new o(0,0),M=new o(0,0);u.push({tl:T,tr:A,bl:C,br:P,tex:s,writingMode:t.writingMode,glyphOffset:_,sectionIndex:i.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:M,minFontScaleX:0,minFontScaleY:0})}return u}(0,n,l,r,s,a,i,e.allowVerticalPlacement),_=e.textSizeData;let y=null;"source"===_.kind?(y=[Xc*r.layout.get("text-size").evaluate(a,{})],y[0]>Zc&&E(`${e.layerIds[0]}: Value for "text-size" is >= ${qc}. Reduce your "text-size".`)):"composite"===_.kind&&(y=[Xc*f.compositeTextSizes[0].evaluate(a,{},m),Xc*f.compositeTextSizes[1].evaluate(a,{},m)],(y[0]>Zc||y[1]>Zc)&&E(`${e.layerIds[0]}: Value for "text-size" is >= ${qc}. Reduce your "text-size".`)),e.addSymbols(e.text,g,y,l,s,a,u,t,c.lineStartIndex,c.lineLength,p,m);for(const t of h)d[t]=e.text.placedSymbolArray.length-1;return 4*g.length}function mh(e){for(const t in e)return e[t];return null}function gh(e,t,n,i){const r=e.compareText;if(t in r){const e=r[t];for(let t=e.length-1;t>=0;t--)if(i.dist(e[t])<n)return!0}else r[t]=[];return r[t].push(i),!1}const _h=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class yh{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const r=_h[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new yh(s,o,r,e)}constructor(e,t=64,n=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=_h.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return vh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)Eh(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];Eh(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function vh(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;bh(e,t,s,i,r,o),vh(e,t,n,i,s-1,1-o),vh(e,t,n,s+1,r,1-o)}function bh(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);bh(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(xh(e,t,i,n),t[2*r+o]>s&&xh(e,t,i,r);a<l;){for(xh(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?xh(e,t,i,l):(l++,xh(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function xh(e,t,n,i){wh(e,n,i),wh(t,2*n,2*i),wh(t,2*n+1,2*i+1)}function wh(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function Eh(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}var Sh;e.be=void 0,(Sh=e.be||(e.be={})).create="create",Sh.load="load",Sh.fullLoad="fullLoad";let Th=null,Ah=[];const Ch=1e3/60,Ph="loadTime",Ih="fullLoadTime",Mh={mark(e){performance.mark(e)},frame(e){const t=e;null!=Th&&Ah.push(t-Th),Th=t},clearMetrics(){Th=null,Ah=[],performance.clearMeasures(Ph),performance.clearMeasures(Ih);for(const t in e.be)performance.clearMarks(e.be[t])},getPerformanceMetrics(){performance.measure(Ph,e.be.create,e.be.load),performance.measure(Ih,e.be.create,e.be.fullLoad);const t=performance.getEntriesByName(Ph)[0].duration,n=performance.getEntriesByName(Ih)[0].duration,i=Ah.length,r=1/(Ah.reduce(((e,t)=>e+t),0)/i/1e3),o=Ah.filter((e=>e>Ch)).reduce(((e,t)=>e+(t-Ch)/Ch),0);return{loadTime:t,fullLoadTime:n,fps:r,percentDroppedFrames:o/(i+o)*100,totalFrames:i}}};e.$=ts,e.A=Js,e.B=function(e){if(null==A){const t=e.navigator?e.navigator.userAgent:null;A=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return A},e.C=class{constructor(e,t){this.target=e,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new yu((()=>this.process())),this.subscription=function(e,t,n,i){return e.addEventListener(t,n,!1),{unsubscribe:()=>{e.removeEventListener(t,n,!1)}}}(this.target,"message",(e=>this.receive(e))),this.globalScope=T(self)?e:window}registerMessageHandler(e,t){this.messageHandlers[e]=t}sendAsync(e,t){return new Promise(((n,i)=>{const r=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[r]={resolve:n,reject:i},t&&t.signal.addEventListener("abort",(()=>{delete this.resolveRejects[r];const t={id:r,type:"<cancel>",origin:location.origin,targetMapId:e.targetMapId,sourceMapId:this.mapId};this.target.postMessage(t)}),{once:!0});const o=[],s=Object.assign(Object.assign({},e),{id:r,sourceMapId:this.mapId,origin:location.origin,data:wr(e.data,o)});this.target.postMessage(s,{transfer:o})}))}receive(e){const t=e.data,n=t.id;if(!("file://"!==t.origin&&"file://"!==location.origin&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if("<cancel>"===t.type){delete this.tasks[n];const e=this.abortControllers[n];return delete this.abortControllers[n],void(e&&e.abort())}if(T(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(0===this.taskQueue.length)return;const e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(e,t)}processTask(e,n){return t(this,void 0,void 0,(function*(){if("<response>"===n.type){const t=this.resolveRejects[e];if(delete this.resolveRejects[e],!t)return;return void(n.error?t.reject(Er(n.error)):t.resolve(Er(n.data)))}if(!this.messageHandlers[n.type])return void this.completeTask(e,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const t=Er(n.data),i=new AbortController;this.abortControllers[e]=i;try{const r=yield this.messageHandlers[n.type](n.sourceMapId,t,i);this.completeTask(e,null,r)}catch(t){this.completeTask(e,t)}}))}completeTask(e,t,n){const i=[];delete this.abortControllers[e];const r={id:e,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?wr(t):null,data:wr(n,i)};this.target.postMessage(r,{transfer:i})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},e.D=$r,e.E=W,e.F=function(){var e=new Js(16);return Js!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.G=F,e.H=function(e,t,n){var i,r,o,s,a,l,c,u,h,d,p,f,m=n[0],g=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=i=t[0],e[1]=r,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=i*m+a*g+h*_+t[12],e[13]=r*m+l*g+d*_+t[13],e[14]=o*m+c*g+p*_+t[14],e[15]=s*m+u*g+f*_+t[15]),e},e.I=Cc,e.J=function(e,t,n){var i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.K=ea,e.L=function(e,t){const n={};for(let i=0;i<t.length;i++){const r=t[i];r in e&&(n[r]=e[r])}return n},e.M=bu,e.N=Eu,e.O=Su,e.P=o,e.Q=Ru,e.R=pa,e.S=h,e.T=Br,e.U=d,e.V=I,e.W=Cs,e.X=to,e.Y=Cu,e.Z=class extends oo{},e._=t,e.a=L,e.a$=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.a0=Iu,e.a1=re,e.a2=e=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const n of e){const e=window.document.createElement("source");j(n)||(t.crossOrigin="Anonymous"),e.src=n,t.appendChild(e)}}))},e.a3=function(){return y++},e.a4=Po,e.a5=ou,e.a6=Pi,e.a7=Rs,e.a8=Dr,e.a9=Du,e.aA=function(e){if("custom"===e.type)return new _u(e);switch(e.type){case"background":return new pu(e);case"circle":return new ra(e);case"fill":return new tl(e);case"fill-extrusion":return new Tl(e);case"heatmap":return new ma(e);case"hillshade":return new ya(e);case"line":return new Ul(e);case"raster":return new gu(e);case"symbol":return new uu(e)}},e.aB=x,e.aC=function(e,t){if(!e)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Z(e.version,t.version))return[{command:"setStyle",args:[t]}];Z(e.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Z(e.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Z(e.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Z(e.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Z(e.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Z(e.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Z(e.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Z(e.light,t.light)||n.push({command:"setLight",args:[t.light]}),Z(e.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Z(e.sky,t.sky)||n.push({command:"setSky",args:[t.sky]});const i={},r=[];!function(e,t,n,i){let r;for(r in t=t||{},e=e||{})Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)||J(r,n,i));for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(Object.prototype.hasOwnProperty.call(e,r)?Z(e[r],t[r])||("geojson"===e[r].type&&"geojson"===t[r].type&&ee(e,t,r)?Y(n,{command:"setGeoJSONSourceData",args:[r,t[r].data]}):Q(r,t,n,i)):K(r,t,n))}(e.sources,t.sources,r,i);const o=[];e.layers&&e.layers.forEach((e=>{"source"in e&&i[e.source]?n.push({command:"removeLayer",args:[e.id]}):o.push(e)})),n=n.concat(r),function(e,t,n){t=t||[];const i=(e=e||[]).map(ne),r=t.map(ne),o=e.reduce(ie,{}),s=t.reduce(ie,{}),a=i.slice(),l=Object.create(null);let c,u,h,d,p;for(let e=0,t=0;e<i.length;e++)c=i[e],Object.prototype.hasOwnProperty.call(s,c)?t++:(Y(n,{command:"removeLayer",args:[c]}),a.splice(a.indexOf(c,t),1));for(let e=0,t=0;e<r.length;e++)c=r[r.length-1-e],a[a.length-1-e]!==c&&(Object.prototype.hasOwnProperty.call(o,c)?(Y(n,{command:"removeLayer",args:[c]}),a.splice(a.lastIndexOf(c,a.length-t),1)):t++,d=a[a.length-e],Y(n,{command:"addLayer",args:[s[c],d]}),a.splice(a.length-e,0,c),l[c]=!0);for(let e=0;e<r.length;e++)if(c=r[e],u=o[c],h=s[c],!l[c]&&!Z(u,h))if(Z(u.source,h.source)&&Z(u["source-layer"],h["source-layer"])&&Z(u.type,h.type)){for(p in te(u.layout,h.layout,n,c,null,"setLayoutProperty"),te(u.paint,h.paint,n,c,null,"setPaintProperty"),Z(u.filter,h.filter)||Y(n,{command:"setFilter",args:[c,h.filter]}),Z(u.minzoom,h.minzoom)&&Z(u.maxzoom,h.maxzoom)||Y(n,{command:"setLayerZoomRange",args:[c,h.minzoom,h.maxzoom]}),u)Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?te(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):Z(u[p],h[p])||Y(n,{command:"setLayerProperty",args:[c,p,h[p]]}));for(p in h)Object.prototype.hasOwnProperty.call(h,p)&&!Object.prototype.hasOwnProperty.call(u,p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?te(u[p],h[p],n,c,p.slice(6),"setPaintProperty"):Z(u[p],h[p])||Y(n,{command:"setLayerProperty",args:[c,p,h[p]]}))}else Y(n,{command:"removeLayer",args:[c]}),d=a[a.lastIndexOf(c)+1],Y(n,{command:"addLayer",args:[h,d]})}(o,t.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:"setStyle",args:[t]}]}return n},e.aD=function(e){const t=[],n=e.id;return void 0===n&&t.push({message:`layers.${n}: missing required property "id"`}),void 0===e.render&&t.push({message:`layers.${n}: missing required method "render"`}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},e.aE=function e(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(!e(t[i],n[i]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==n){if("object"!=typeof n)return!1;if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const i in t)if(!e(t[i],n[i]))return!1;return!0}return t===n},e.aF=v,e.aG=b,e.aH=class extends ds{constructor(e,t){super(e,t),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}},e.aI=ps,e.aJ=class extends ds{constructor(e,t){super(e,t),this.current=gs}set(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(let t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}},e.aK=fs,e.aL=class extends ds{constructor(e,t){super(e,t),this.current=[0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}},e.aM=class extends ds{constructor(e,t){super(e,t),this.current=[0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}},e.aN=ms,e.aO=function(e,t,n,i,r,o,s){var a=1/(t-n),l=1/(i-r),c=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1,e},e.aP=qe,e.aQ=na,e.aR=class extends go{},e.aS=ql,e.aT=class extends yo{},e.aU=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.aV=fa,e.aW=zo,e.aX=class extends To{},e.aY=Ko,e.aZ=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},e.a_=function(e,t){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=t[0],v=t[1],b=t[2],x=t[3],w=t[4],E=t[5],S=t[6],T=t[7],A=t[8],C=t[9],P=t[10],I=t[11],M=t[12],R=t[13],O=t[14],k=t[15];return Math.abs(n-y)<=Ks*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-v)<=Ks*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-b)<=Ks*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(o-x)<=Ks*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-w)<=Ks*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(a-E)<=Ks*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(l-S)<=Ks*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-T)<=Ks*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-A)<=Ks*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-C)<=Ks*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-P)<=Ks*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-I)<=Ks*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(f-M)<=Ks*Math.max(1,Math.abs(f),Math.abs(M))&&Math.abs(m-R)<=Ks*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-O)<=Ks*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(_-k)<=Ks*Math.max(1,Math.abs(_),Math.abs(k))},e.aa=function(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,n,i,r)=>{const o=i||r;return t[n]=!o||o.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t},e.ab=function(e,t){const n=[];for(const i in e)i in t||n.push(i);return n},e.ac=m,e.ad=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e},e.ae=function(e){var t=new Js(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.af=ia,e.ag=function(e,t){let n=0,i=0;if("constant"===e.kind)i=e.layoutSize;else if("source"!==e.kind){const{interpolationType:r,minZoom:o,maxZoom:s}=e,a=r?m(Mt.interpolationFactor(r,t,o,s),0,1):0;"camera"===e.kind?i=It.number(e.minSize,e.maxSize,a):n=a}return{uSizeT:n,uSize:i}},e.ai=function(e,{uSize:t,uSizeT:n},{lowerSize:i,upperSize:r}){return"source"===e.kind?i/Xc:"composite"===e.kind?It.number(i/Xc,r/Xc,n):t},e.aj=tu,e.ak=function(e,t,n,i){const r=t.y-e.y,s=t.x-e.x,a=i.y-n.y,l=i.x-n.x,c=a*s-l*r;if(0===c)return null;const u=(l*(e.y-n.y)-a*(e.x-n.x))/c;return new o(e.x+u*s,e.y+u*r)},e.al=ju,e.am=Ls,e.an=Qs,e.ao=function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;for(const o of e)t=Math.min(t,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return[t,n,i,r]},e.ap=Yl,e.ar=Kc,e.as=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,b=n*c-o*s,x=i*l-r*a,w=i*c-o*a,E=r*c-o*l,S=u*m-h*f,T=u*g-d*f,A=u*_-p*f,C=h*g-d*m,P=h*_-p*m,I=d*_-p*g,M=y*I-v*P+b*C+x*A-w*T+E*S;return M?(e[0]=(a*I-l*P+c*C)*(M=1/M),e[1]=(r*P-i*I-o*C)*M,e[2]=(m*E-g*w+_*x)*M,e[3]=(d*w-h*E-p*x)*M,e[4]=(l*A-s*I-c*T)*M,e[5]=(n*I-r*A+o*T)*M,e[6]=(g*b-f*E-_*v)*M,e[7]=(u*E-d*b+p*v)*M,e[8]=(s*P-a*A+c*S)*M,e[9]=(i*A-n*P-o*S)*M,e[10]=(f*w-m*b+_*y)*M,e[11]=(h*b-u*w-p*y)*M,e[12]=(a*T-s*C-l*S)*M,e[13]=(n*C-i*T+r*S)*M,e[14]=(m*v-f*x-g*y)*M,e[15]=(u*x-h*v+d*y)*M,e):null},e.at=dh,e.au=Vc,e.av=yh,e.aw=function(){const e={},t=H.$version;for(const n in H.$root){const i=H.$root[n];if(i.required){let r=null;r="version"===n?t:"array"===i.type?[]:{},null!=r&&(e[n]=r)}}return e},e.ax=Sr,e.ay=B,e.az=function(e){e=e.slice();const t=Object.create(null);for(let n=0;n<e.length;n++)t[e[n].id]=e[n];for(let n=0;n<e.length;n++)"ref"in e[n]&&(e[n]=X(e[n],t[e[n].ref]));return e},e.b=C,e.b0=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},e.b1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},e.b2=g,e.b3=Mu,e.b4=Tu,e.b5=function(e,t,n,i,r){var o,s=1/Math.tan(t/2);return e[0]=s/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0?(e[10]=(r+i)*(o=1/(i-r)),e[14]=2*r*i*o):(e[10]=-1,e[14]=-2*i),e},e.b6=function(e,t,n){var i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e},e.b7=p,e.b8=f,e.b9=function(e){return e*Math.PI/180},e.bA=bi,e.bB=Lr,e.ba=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.bb=class extends ro{},e.bc=vu,e.bd=Mh,e.bf=N,e.bg=function(e,t){L.REGISTERED_PROTOCOLS[e]=t},e.bh=function(e){delete L.REGISTERED_PROTOCOLS[e]},e.bi=function(e,t){const n={};for(let i=0;i<e.length;i++){const r=t&&t[e[i].id]||Ni(e[i]);t&&(t[e[i].id]=r);let o=n[r];o||(o=n[r]=[]),o.push(e[i])}const i=[];for(const e in n)i.push(n[e]);return i},e.bj=br,e.bk=Lu,e.bl=Fu,e.bm=Pc,e.bn=function(t){t.bucket.createArrays(),t.bucket.tilePixelRatio=Cs/(512*t.bucket.overscaling),t.bucket.compareText={},t.bucket.iconsNeedLinear=!1;const n=t.bucket.layers[0],i=n.layout,r=n._unevaluatedLayout._values,o={layoutIconSize:r["icon-size"].possiblyEvaluate(new Dr(t.bucket.zoom+1),t.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Dr(t.bucket.zoom+1),t.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Dr(18))};if("composite"===t.bucket.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.textSizeData;o.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Dr(e),t.canonical),r["text-size"].possiblyEvaluate(new Dr(n),t.canonical)]}if("composite"===t.bucket.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.bucket.iconSizeData;o.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Dr(e),t.canonical),r["icon-size"].possiblyEvaluate(new Dr(n),t.canonical)]}const s=i.get("text-line-height")*Yl,a="viewport"!==i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),l=i.get("text-keep-upright"),c=i.get("text-size");for(const r of t.bucket.features){const u=i.get("text-font").evaluate(r,{},t.canonical).join(","),h=c.evaluate(r,{},t.canonical),d=o.layoutTextSize.evaluate(r,{},t.canonical),p=o.layoutIconSize.evaluate(r,{},t.canonical),f={horizontal:{},vertical:void 0},m=r.text;let g,_=[0,0];if(m){const o=m.toString(),c=i.get("text-letter-spacing").evaluate(r,{},t.canonical)*Yl,p=Cr(o)?c:0,g=i.get("text-anchor").evaluate(r,{},t.canonical),y=hh(n,r,t.canonical);if(!y){const e=i.get("text-radial-offset").evaluate(r,{},t.canonical);_=e?uh(g,[e*Yl,ch]):i.get("text-offset").evaluate(r,{},t.canonical).map((e=>e*Yl))}let v=a?"center":i.get("text-justify").evaluate(r,{},t.canonical);const b=i.get("symbol-placement"),x="point"===b?i.get("text-max-width").evaluate(r,{},t.canonical)*Yl:0,w=()=>{t.bucket.allowVerticalPlacement&&Ar(o)&&(f.vertical=kc(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,"left",p,_,e.ah.vertical,!0,b,d,h))};if(!a&&y){const n=new Set;if("auto"===v)for(let e=0;e<y.values.length;e+=2)n.add(dh(y.values[e]));else n.add(v);let i=!1;for(const r of n)if(!f.horizontal[r])if(i)f.horizontal[r]=f.horizontal[0];else{const n=kc(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,"center",r,p,_,e.ah.horizontal,!1,b,d,h);n&&(f.horizontal[r]=n,i=1===n.positionedLines.length)}w()}else{"auto"===v&&(v=dh(g));const n=kc(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,v,p,_,e.ah.horizontal,!1,b,d,h);n&&(f.horizontal[v]=n),w(),Ar(o)&&a&&l&&(f.vertical=kc(m,t.glyphMap,t.glyphPositions,t.imagePositions,u,x,s,g,v,p,_,e.ah.vertical,!1,b,d,h))}}let y=!1;if(r.icon&&r.icon.name){const e=t.imageMap[r.icon.name];e&&(g=$c(t.imagePositions[r.icon.name],i.get("icon-offset").evaluate(r,{},t.canonical),i.get("icon-anchor").evaluate(r,{},t.canonical)),y=!!e.sdf,void 0===t.bucket.sdfIcons?t.bucket.sdfIcons=y:t.bucket.sdfIcons!==y&&E("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.bucket.pixelRatio||0!==i.get("icon-rotate").constantOr(1))&&(t.bucket.iconsNeedLinear=!0))}const v=mh(f.horizontal)||f.vertical;t.bucket.iconsInText=!!v&&v.iconsInText,(v||g)&&ph(t.bucket,r,f,g,t.imageMap,o,d,p,_,y,t.canonical)}t.showCollisionBoxes&&t.bucket.generateCollisionDebugBuffers()},e.bo=Dl,e.bp=Ka,e.bq=bl,e.br=ol,e.bs=vc,e.bt=class{constructor(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let e=performance.getEntriesByName(this._marks.measure);return 0===e.length&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),e=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),e}},e.bu=function(e,n,i,r,o){return t(this,void 0,void 0,(function*(){if(d())try{return yield I(e,n,i,r,o)}catch(e){}return function(e,t,n,i,r){const o=e.width,s=e.height;M&&R||(M=new OffscreenCanvas(o,s),R=M.getContext("2d",{willReadFrequently:!0})),M.width=o,M.height=s,R.drawImage(e,0,0,o,s);const a=R.getImageData(t,n,i,r);return R.clearRect(0,0,o,s),a.data}(e,n,i,r,o)}))},e.bv=ku,e.bw=n,e.bx=i,e.by=Kl,e.bz=function(e){return e.message===O},e.c=k,e.d=e=>t(void 0,void 0,void 0,(function*(){if(0===e.byteLength)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(e)],{type:"image/png"});try{return createImageBitmap(t)}catch(e){throw new Error(`Could not load image because of ${e.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),e.e=_,e.f=e=>new Promise(((t,n)=>{const i=new Image;i.onload=()=>{t(i),URL.revokeObjectURL(i.src),i.onload=null,window.requestAnimationFrame((()=>{i.src=P}))},i.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(r):P})),e.g=D,e.h=(e,t)=>z(_(e,{type:"json"}),t),e.i=T,e.j=$,e.k=G,e.l=(e,t)=>z(_(e,{type:"arrayBuffer"}),t),e.m=z,e.n=function(e){return new vc(e).readFields(xc,[])},e.o=da,e.p=Tc,e.q=Zr,e.r=fr,e.s=j,e.t=_r,e.u=Tr,e.v=H,e.w=E,e.x=pr,e.y=function([e,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(n),y:e*Math.sin(t)*Math.sin(n),z:e*Math.cos(n)}},e.z=It})),n("worker",0,(function(e){class t{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(t,n){for(const n of t){this._layerConfigs[n.id]=n;const t=this._layers[n.id]=e.aA(n);t._featureFilter=e.a6(t.filter),this.keyCache[n.id]&&delete this.keyCache[n.id]}for(const e of n)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const i=e.bi(Object.values(this._layerConfigs),this.keyCache);for(const e of i){const t=e.map((e=>this._layers[e.id])),n=t[0];if("none"===n.visibility)continue;const i=n.source||"";let r=this.familiesBySource[i];r||(r=this.familiesBySource[i]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=r[o];s||(s=r[o]=[]),s.push(t)}}}class n{constructor(t){const n={},i=[];for(const e in t){const r=t[e],o=n[e]={};for(const e in r){const t=r[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const n={x:0,y:0,w:t.bitmap.width+2,h:t.bitmap.height+2};i.push(n),o[e]={rect:n,metrics:t.metrics}}}const{w:r,h:o}=e.p(i),s=new e.o({width:r||1,height:o||1});for(const i in t){const r=t[i];for(const t in r){const o=r[+t];if(!o||0===o.bitmap.width||0===o.bitmap.height)continue;const a=n[i][t].rect;e.o.copy(o.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},o.bitmap)}}this.image=s,this.positions=n}}e.bj("GlyphAtlas",n);class i{constructor(t){this.tileID=new e.Q(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.inFlightDependencies=[]}parse(t,i,o,s){return e._(this,void 0,void 0,(function*(){this.status="parsing",this.data=t,this.collisionBoxArray=new e.a4;const a=new e.bk(Object.keys(t.layers).sort()),l=new e.bl(this.tileID,this.promoteId);l.bucketLayerIDs=[];const c={},u={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:o},h=i.familiesBySource[this.source];for(const n in h){const i=t.layers[n];if(!i)continue;1===i.version&&e.w(`Vector tile source "${this.source}" layer "${n}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const s=a.encode(n),d=[];for(let e=0;e<i.length;e++){const t=i.feature(e),r=l.getId(t,n);d.push({feature:t,id:r,index:e,sourceLayerIndex:s})}for(const t of h[n]){const n=t[0];n.source!==this.source&&e.w(`layer.source = ${n.source} does not equal this.source = ${this.source}`),n.minzoom&&this.zoom<Math.floor(n.minzoom)||n.maxzoom&&this.zoom>=n.maxzoom||"none"!==n.visibility&&(r(t,this.zoom,o),(c[n.id]=n.createBucket({index:l.bucketLayerIDs.length,layers:t,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:s,sourceID:this.source})).populate(d,u,this.tileID.canonical),l.bucketLayerIDs.push(t.map((e=>e.id))))}}const d=e.aF(u.glyphDependencies,(e=>Object.keys(e).map(Number)));this.inFlightDependencies.forEach((e=>null==e?void 0:e.abort())),this.inFlightDependencies=[];let p=Promise.resolve({});if(Object.keys(d).length){const e=new AbortController;this.inFlightDependencies.push(e),p=s.sendAsync({type:"GG",data:{stacks:d,source:this.source,tileID:this.tileID,type:"glyphs"}},e)}const f=Object.keys(u.iconDependencies);let m=Promise.resolve({});if(f.length){const e=new AbortController;this.inFlightDependencies.push(e),m=s.sendAsync({type:"GI",data:{icons:f,source:this.source,tileID:this.tileID,type:"icons"}},e)}const g=Object.keys(u.patternDependencies);let _=Promise.resolve({});if(g.length){const e=new AbortController;this.inFlightDependencies.push(e),_=s.sendAsync({type:"GI",data:{icons:g,source:this.source,tileID:this.tileID,type:"patterns"}},e)}const[y,v,b]=yield Promise.all([p,m,_]),x=new n(y),w=new e.bm(v,b);for(const t in c){const n=c[t];n instanceof e.a5?(r(n.layers,this.zoom,o),e.bn({bucket:n,glyphMap:y,glyphPositions:x.positions,imageMap:v,imagePositions:w.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):n.hasPattern&&(n instanceof e.bo||n instanceof e.bp||n instanceof e.bq)&&(r(n.layers,this.zoom,o),n.addFeatures(u,this.tileID.canonical,w.patternPositions))}return this.status="done",{buckets:Object.values(c).filter((e=>!e.isEmpty())),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:x.image,imageAtlas:w,glyphMap:this.returnDependencies?y:null,iconMap:this.returnDependencies?v:null,glyphPositions:this.returnDependencies?x.positions:null}}))}}function r(t,n,i){const r=new e.a8(n);for(const e of t)e.recalculate(r,i)}class o{constructor(e,t,n){this.actor=e,this.layerIndex=t,this.availableImages=n,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(t,n){return e._(this,void 0,void 0,(function*(){const i=yield e.l(t.request,n);try{return{vectorTile:new e.br.VectorTile(new e.bs(i.data)),rawData:i.data,cacheControl:i.cacheControl,expires:i.expires}}catch(e){const n=new Uint8Array(i.data);let r=`Unable to parse the tile at ${t.request.url}, `;throw r+=31===n[0]&&139===n[1]?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${e.messge}`,new Error(r)}}))}loadTile(t){return e._(this,void 0,void 0,(function*(){const n=t.uid,r=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bt(t.request),o=new i(t);this.loading[n]=o;const s=new AbortController;o.abort=s;try{const i=yield this.loadVectorTile(t,s);if(delete this.loading[n],!i)return null;const a=i.rawData,l={};i.expires&&(l.expires=i.expires),i.cacheControl&&(l.cacheControl=i.cacheControl);const c={};if(r){const e=r.finish();e&&(c.resourceTiming=JSON.parse(JSON.stringify(e)))}o.vectorTile=i.vectorTile;const u=o.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[n]=o,this.fetching[n]={rawTileData:a,cacheControl:l,resourceTiming:c};try{const t=yield u;return e.e({rawTileData:a.slice(0)},t,l,c)}finally{delete this.fetching[n]}}catch(e){throw delete this.loading[n],o.status="done",this.loaded[n]=o,e}}))}reloadTile(t){return e._(this,void 0,void 0,(function*(){const n=t.uid;if(!this.loaded||!this.loaded[n])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const i=this.loaded[n];if(i.showCollisionBoxes=t.showCollisionBoxes,"parsing"===i.status){const t=yield i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor);let r;if(this.fetching[n]){const{rawTileData:i,cacheControl:o,resourceTiming:s}=this.fetching[n];delete this.fetching[n],r=e.e({rawTileData:i.slice(0)},t,o,s)}else r=t;return r}if("done"===i.status&&i.vectorTile)return i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(t){return e._(this,void 0,void 0,(function*(){const e=this.loading,n=t.uid;e&&e[n]&&e[n].abort&&(e[n].abort.abort(),delete e[n])}))}removeTile(t){return e._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[t.uid]&&delete this.loaded[t.uid]}))}}class s{constructor(){this.loaded={}}loadTile(t){return e._(this,void 0,void 0,(function*(){const{uid:n,encoding:i,rawImageData:r,redFactor:o,greenFactor:s,blueFactor:a,baseShift:l}=t,c=r.width+2,u=r.height+2,h=e.b(r)?new e.R({width:c,height:u},yield e.bu(r,-1,-1,c,u)):r,d=new e.bv(n,h,i,o,s,a,l);return this.loaded=this.loaded||{},this.loaded[n]=d,d}))}removeTile(e){const t=this.loaded,n=e.uid;t&&t[n]&&delete t[n]}}function a(e,t){if(0!==e.length){l(e[0],t);for(var n=1;n<e.length;n++)l(e[n],!t)}}function l(e,t){for(var n=0,i=0,r=0,o=e.length,s=o-1;r<o;s=r++){var a=(e[r][0]-e[s][0])*(e[s][1]+e[r][1]),l=n+a;i+=Math.abs(n)>=Math.abs(a)?n-l+a:a-l+n,n=l}n+i>=0!=!!t&&e.reverse()}var c=e.bw((function e(t,n){var i,r=t&&t.type;if("FeatureCollection"===r)for(i=0;i<t.features.length;i++)e(t.features[i],n);else if("GeometryCollection"===r)for(i=0;i<t.geometries.length;i++)e(t.geometries[i],n);else if("Feature"===r)e(t.geometry,n);else if("Polygon"===r)a(t.coordinates,n);else if("MultiPolygon"===r)for(i=0;i<t.coordinates.length;i++)a(t.coordinates[i],n);return t}));const u=e.br.VectorTileFeature.prototype.toGeoJSON;var h={exports:{}},d=e.bx,p=e.br.VectorTileFeature,f=m;function m(e,t){this.options=t||{},this.features=e,this.length=e.length}function g(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}m.prototype.feature=function(e){return new g(this.features[e],this.options.extent)},g.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var n=e[t],i=[],r=0;r<n.length;r++)i.push(new d(n[r][0],n[r][1]));this.geometry.push(i)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,i=1/0,r=-1/0,o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];t=Math.min(t,l.x),n=Math.max(n,l.x),i=Math.min(i,l.y),r=Math.max(r,l.y)}return[t,i,n,r]},g.prototype.toGeoJSON=p.prototype.toGeoJSON;var _=e.by,y=f;function v(e){var t=new _;return function(e,t){for(var n in e.layers)t.writeMessage(3,b,e.layers[n])}(e,t),t.finish()}function b(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)i.feature=e.feature(n),t.writeMessage(2,x,i);var r=i.keys;for(n=0;n<r.length;n++)t.writeStringField(3,r[n]);var o=i.values;for(n=0;n<o.length;n++)t.writeMessage(4,A,o[n])}function x(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,w,e),t.writeVarintField(3,n.type),t.writeMessage(4,T,n)}function w(e,t){var n=e.feature,i=e.keys,r=e.values,o=e.keycache,s=e.valuecache;for(var a in n.properties){var l=n.properties[a],c=o[a];if(null!==l){void 0===c&&(i.push(a),o[a]=c=i.length-1),t.writeVarint(c);var u=typeof l;"string"!==u&&"boolean"!==u&&"number"!==u&&(l=JSON.stringify(l));var h=u+":"+l,d=s[h];void 0===d&&(r.push(l),s[h]=d=r.length-1),t.writeVarint(d)}}}function E(e,t){return(t<<3)+(7&e)}function S(e){return e<<1^e>>31}function T(e,t){for(var n=e.loadGeometry(),i=e.type,r=0,o=0,s=n.length,a=0;a<s;a++){var l=n[a],c=1;1===i&&(c=l.length),t.writeVarint(E(1,c));for(var u=3===i?l.length-1:l.length,h=0;h<u;h++){1===h&&1!==i&&t.writeVarint(E(2,u-1));var d=l[h].x-r,p=l[h].y-o;t.writeVarint(S(d)),t.writeVarint(S(p)),r+=d,o+=p}3===i&&t.writeVarint(E(7,1))}}function A(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}h.exports=v,h.exports.fromVectorTileJs=v,h.exports.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var i in e)n[i]=new y(e[i].features,t),n[i].name=i,n[i].version=t.version,n[i].extent=t.extent;return v({layers:n})},h.exports.GeoJSONWrapper=y;var C=e.bw(h.exports);const P={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},I=Math.fround||(M=new Float32Array(1),e=>(M[0]=+e,M[0]));var M;const R=3,O=5,k=6;class L{constructor(e){this.options=Object.assign(Object.create(P),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(!n.geometry)continue;const[i,r]=n.geometry.coordinates,s=I(N(i)),a=I(B(r));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let e=i;e>=n;e--){const n=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(N(n),B(o),N(r),B(i)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+O]>1?D(l,t,this.clusterProps):this.points[l[t+R]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=r.within(o[t*this.stride],o[t*this.stride+1],s),l=[];for(const t of a){const n=t*this.stride;o[n+4]===e&&l.push(o[n+O]>1?D(o,n,this.clusterProps):this.points[o[n+R]])}if(0===l.length)throw new Error(i);return l}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=i?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,n,i,r):r<i?r++:e.push(t),e.length===n)break}return r}_createTree(t){const n=new e.av(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)n.add(t[e],t[e+1]);return n.finish(),n.data=t,n}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+O]>1;let l,c,u;if(a)l=F(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+R]];l=n.properties;const[i,r]=n.geometry.coordinates;c=N(i),u=B(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+R]:this.points[t[e+R]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let n=0;n<a.length;n+=c){if(a[n+2]<=t)continue;a[n+2]=t;const i=a[n],u=a[n+1],h=e.within(a[n],a[n+1],s),d=a[n+O];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+O])}if(p>d&&p>=o){let e,o=i*d,s=u*d,f=-1;const m=(n/c<<5)+(t+1)+this.points.length;for(const i of h){const l=i*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+O];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(e||(e=this._map(a,n,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[n+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[n+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+O]>1){const i=this.clusterProps[e[t+k]];return n?Object.assign({},i):i}const i=this.points[e[t+R]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function D(e,t,n){return{type:"Feature",id:e[t+R],properties:F(e,t,n),geometry:{type:"Point",coordinates:[(i=e[t],360*(i-.5)),z(e[t+1])]}};var i}function F(e,t,n){const i=e[t+O],r=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+k],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+R],point_count:i,point_count_abbreviated:r})}function N(e){return e/360+.5}function B(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function z(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function j(e,t,n,i){for(var r,o=i,s=n-t>>1,a=n-t,l=e[t],c=e[t+1],u=e[n],h=e[n+1],d=t+3;d<n;d+=3){var p=U(e[d],e[d+1],l,c,u,h);if(p>o)r=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(r=d,a=f)}}o>i&&(r-t>3&&j(e,t,r,i),e[r+2]=o,n-r>3&&j(e,r,n,i))}function U(e,t,n,i,r,o){var s=r-n,a=o-i;if(0!==s||0!==a){var l=((e-n)*s+(t-i)*a)/(s*s+a*a);l>1?(n=r,i=o):l>0&&(n+=s*l,i+=a*l)}return(s=e-n)*s+(a=t-i)*a}function V(e,t,n,i){var r={id:void 0===e?null:e,type:t,geometry:n,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)G(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var i=0;i<t.length;i++)G(e,t[i]);else if("MultiPolygon"===n)for(i=0;i<t.length;i++)for(var r=0;r<t[i].length;r++)G(e,t[i][r])}(r),r}function G(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function $(e,t,n,i){if(t.geometry){var r=t.geometry.coordinates,o=t.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=i||0),"Point"===o)W(r,a);else if("MultiPoint"===o)for(var c=0;c<r.length;c++)W(r[c],a);else if("LineString"===o)H(r,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<r.length;c++)H(r[c],a=[],s,!1),e.push(V(l,"LineString",a,t.properties));return}q(r,a,s,!1)}else if("Polygon"===o)q(r,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<t.geometry.geometries.length;c++)$(e,{id:l,geometry:t.geometry.geometries[c],properties:t.properties},n,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<r.length;c++){var u=[];q(r[c],u,s,!0),a.push(u)}}e.push(V(l,o,a,t.properties))}}function W(e,t){t.push(X(e[0])),t.push(Z(e[1])),t.push(0)}function H(e,t,n,i){for(var r,o,s=0,a=0;a<e.length;a++){var l=X(e[a][0]),c=Z(e[a][1]);t.push(l),t.push(c),t.push(0),a>0&&(s+=i?(r*c-l*o)/2:Math.sqrt(Math.pow(l-r,2)+Math.pow(c-o,2))),r=l,o=c}var u=t.length-3;t[2]=1,j(t,0,u,n),t[u+2]=1,t.size=Math.abs(s),t.start=0,t.end=t.size}function q(e,t,n,i){for(var r=0;r<e.length;r++){var o=[];H(e[r],o,n,i),t.push(o)}}function X(e){return e/360+.5}function Z(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function Y(e,t,n,i,r,o,s,a){if(i/=t,o>=(n/=t)&&s<i)return e;if(s<n||o>=i)return null;for(var l=[],c=0;c<e.length;c++){var u=e[c],h=u.geometry,d=u.type,p=0===r?u.minX:u.minY,f=0===r?u.maxX:u.maxY;if(p>=n&&f<i)l.push(u);else if(!(f<n||p>=i)){var m=[];if("Point"===d||"MultiPoint"===d)K(h,m,n,i,r);else if("LineString"===d)J(h,m,n,i,r,!1,a.lineMetrics);else if("MultiLineString"===d)ee(h,m,n,i,r,!1);else if("Polygon"===d)ee(h,m,n,i,r,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var _=[];ee(h[g],_,n,i,r,!0),_.length&&m.push(_)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)l.push(V(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),l.push(V(u.id,d,m,u.tags))}}}return l.length?l:null}function K(e,t,n,i,r){for(var o=0;o<e.length;o+=3){var s=e[o+r];s>=n&&s<=i&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function J(e,t,n,i,r,o,s){for(var a,l,c=Q(e),u=0===r?ne:ie,h=e.start,d=0;d<e.length-3;d+=3){var p=e[d],f=e[d+1],m=e[d+2],g=e[d+3],_=e[d+4],y=0===r?p:f,v=0===r?g:_,b=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<n?v>n&&(l=u(c,p,f,g,_,n),s&&(c.start=h+a*l)):y>i?v<i&&(l=u(c,p,f,g,_,i),s&&(c.start=h+a*l)):te(c,p,f,m),v<n&&y>=n&&(l=u(c,p,f,g,_,n),b=!0),v>i&&y<=i&&(l=u(c,p,f,g,_,i),b=!0),!o&&b&&(s&&(c.end=h+a*l),t.push(c),c=Q(e)),s&&(h+=a)}var x=e.length-3;p=e[x],f=e[x+1],m=e[x+2],(y=0===r?p:f)>=n&&y<=i&&te(c,p,f,m),x=c.length-3,o&&x>=3&&(c[x]!==c[0]||c[x+1]!==c[1])&&te(c,c[0],c[1],c[2]),c.length&&t.push(c)}function Q(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ee(e,t,n,i,r,o){for(var s=0;s<e.length;s++)J(e[s],t,n,i,r,o,!1)}function te(e,t,n,i){e.push(t),e.push(n),e.push(i)}function ne(e,t,n,i,r,o){var s=(o-t)/(i-t);return e.push(o),e.push(n+(r-n)*s),e.push(1),s}function ie(e,t,n,i,r,o){var s=(o-n)/(r-n);return e.push(t+(i-t)*s),e.push(o),e.push(1),s}function re(e,t){for(var n=[],i=0;i<e.length;i++){var r,o=e[i],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)r=oe(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){r=[];for(var a=0;a<o.geometry.length;a++)r.push(oe(o.geometry[a],t))}else if("MultiPolygon"===s)for(r=[],a=0;a<o.geometry.length;a++){for(var l=[],c=0;c<o.geometry[a].length;c++)l.push(oe(o.geometry[a][c],t));r.push(l)}n.push(V(o.id,s,r,o.tags))}return n}function oe(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var i=0;i<e.length;i+=3)n.push(e[i]+t,e[i+1],e[i+2]);return n}function se(e,t){if(e.transformed)return e;var n,i,r,o=1<<e.z,s=e.x,a=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],c=l.geometry,u=l.type;if(l.geometry=[],1===u)for(i=0;i<c.length;i+=2)l.geometry.push(ae(c[i],c[i+1],t,o,s,a));else for(i=0;i<c.length;i++){var h=[];for(r=0;r<c[i].length;r+=2)h.push(ae(c[i][r],c[i][r+1],t,o,s,a));l.geometry.push(h)}}return e.transformed=!0,e}function ae(e,t,n,i,r,o){return[Math.round(n*(e*i-r)),Math.round(n*(t*i-o))]}function le(e,t,n,i,r){for(var o=t===r.maxZoom?0:r.tolerance/((1<<t)*r.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:i,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,ce(s,e[a],o,r);var l=e[a].minX,c=e[a].minY,u=e[a].maxX,h=e[a].maxY;l<s.minX&&(s.minX=l),c<s.minY&&(s.minY=c),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function ce(e,t,n,i){var r=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<r.length;a+=3)s.push(r[a]),s.push(r[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)ue(s,r,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<r.length;a++)ue(s,r[a],e,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var l=0;l<r.length;l++){var c=r[l];for(a=0;a<c.length;a++)ue(s,c[a],e,n,!0,0===a)}if(s.length){var u=t.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in u={},t.tags)u[h]=t.tags[h];u.mapbox_clip_start=r.start/r.size,u.mapbox_clip_end=r.end/r.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==t.id&&(d.id=t.id),e.features.push(d)}}function ue(e,t,n,i,r,o){var s=i*i;if(i>0&&t.size<(r?s:i))n.numPoints+=t.length/3;else{for(var a=[],l=0;l<t.length;l+=3)(0===i||t[l+2]>s)&&(n.numSimplified++,a.push(t[l]),a.push(t[l+1])),n.numPoints++;r&&function(e,t){for(var n=0,i=0,r=e.length,o=r-2;i<r;o=i,i+=2)n+=(e[i]-e[o])*(e[i+1]+e[o+1]);if(n>0===t)for(i=0,r=e.length;i<r/2;i+=2){var s=e[i],a=e[i+1];e[i]=e[r-2-i],e[i+1]=e[r-1-i],e[r-2-i]=s,e[r-1-i]=a}}(a,o),e.push(a)}}function he(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var i=0;i<e.features.length;i++)$(n,e.features[i],t,i);else $(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(e,t){var n=t.buffer/t.extent,i=e,r=Y(e,1,-1-n,n,0,-1,2,t),o=Y(e,1,1-n,2+n,0,-1,2,t);return(r||o)&&(i=Y(e,1,-n,1+n,0,-1,2,t)||[],r&&(i=re(r,1).concat(i)),o&&(i=i.concat(re(o,-1)))),i}(i,t),i.length&&this.splitTile(i,0,0,0),n&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function de(e,t,n){return 32*((1<<e)*n+t)+e}function pe(e,t){return t?e.properties[t]:e.id}function fe(e,t){if(null==e)return!0;if("Feature"===e.type)return null!=pe(e,t);if("FeatureCollection"===e.type){const n=new Set;for(const i of e.features){const e=pe(i,t);if(null==e)return!1;if(n.has(e))return!1;n.add(e)}return!0}return!1}function me(e,t){const n=new Map;if(null==e);else if("Feature"===e.type)n.set(pe(e,t),e);else for(const i of e.features)n.set(pe(i,t),i);return n}he.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},he.prototype.splitTile=function(e,t,n,i,r,o,s){for(var a=[e,t,n,i],l=this.options,c=l.debug;a.length;){i=a.pop(),n=a.pop(),t=a.pop(),e=a.pop();var u=1<<t,h=de(t,n,i),d=this.tiles[h];if(!d&&(c>1&&console.time("creation"),d=this.tiles[h]=le(e,t,n,i,l),this.tileCoords.push({z:t,x:n,y:i}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=e,r){if(t===l.maxZoom||t===r)continue;var f=1<<r-t;if(n!==Math.floor(o/f)||i!==Math.floor(s/f))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,0!==e.length){c>1&&console.time("clipping");var m,g,_,y,v,b,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,S=1+x;m=g=_=y=null,v=Y(e,u,n-x,n+E,0,d.minX,d.maxX,l),b=Y(e,u,n+w,n+S,0,d.minX,d.maxX,l),e=null,v&&(m=Y(v,u,i-x,i+E,1,d.minY,d.maxY,l),g=Y(v,u,i+w,i+S,1,d.minY,d.maxY,l),v=null),b&&(_=Y(b,u,i-x,i+E,1,d.minY,d.maxY,l),y=Y(b,u,i+w,i+S,1,d.minY,d.maxY,l),b=null),c>1&&console.timeEnd("clipping"),a.push(m||[],t+1,2*n,2*i),a.push(g||[],t+1,2*n,2*i+1),a.push(_||[],t+1,2*n+1,2*i),a.push(y||[],t+1,2*n+1,2*i+1)}}},he.prototype.getTile=function(e,t,n){var i=this.options,r=i.extent,o=i.debug;if(e<0||e>24)return null;var s=1<<e,a=de(e,t=(t%s+s)%s,n);if(this.tiles[a])return se(this.tiles[a],r);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,c=e,u=t,h=n;!l&&c>0;)c--,u=Math.floor(u/2),h=Math.floor(h/2),l=this.tiles[de(c,u,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",c,u,h),o>1&&console.time("drilling down"),this.splitTile(l.source,c,u,h,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?se(this.tiles[a],r):null):null};class ge extends o{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(t,n){return e._(this,void 0,void 0,(function*(){const n=t.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return null;const r=new class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.W,this.length=t.length,this._features=t}feature(t){return new class{constructor(t){this._feature=t,this.extent=e.W,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const n of this._feature.geometry)t.push([new e.P(n[0],n[1])]);return t}{const t=[];for(const n of this._feature.geometry){const i=[];for(const t of n)i.push(new e.P(t[0],t[1]));t.push(i)}return t}}toGeoJSON(e,t,n){return u.call(this,e,t,n)}}(this._features[t])}}(i.features);let o=C(r);return 0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),{vectorTile:r,rawData:o.buffer}}))}loadData(t){return e._(this,void 0,void 0,(function*(){var n;null===(n=this._pendingRequest)||void 0===n||n.abort();const i=!!(t&&t.request&&t.request.collectResourceTiming)&&new e.bt(t.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(t,this._pendingRequest),this._geoJSONIndex=t.cluster?new L(function({superclusterOptions:t,clusterProperties:n}){if(!n||!t)return t;const i={},r={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const t of a){const[o,s]=n[t],a=e.bA(s),l=e.bA("string"==typeof o?[o,["accumulated"],["get",t]]:o);i[t]=a.value,r[t]=l.value}return t.map=e=>{s.properties=e;const t={};for(const e of a)t[e]=i[e].evaluate(o,s);return t},t.reduce=(e,t)=>{s.properties=t;for(const t of a)o.accumulated=e[t],e[t]=r[t].evaluate(o,s)},t}(t)).load((yield this._pendingData).features):new he(yield this._pendingData,t.geojsonVtOptions),this.loaded={};const n={};if(i){const e=i.finish();e&&(n.resourceTiming={},n.resourceTiming[t.source]=JSON.parse(JSON.stringify(e)))}return n}catch(t){if(delete this._pendingRequest,e.bz(t))return{abandoned:!0};throw t}}))}getData(){return e._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(e){const t=this.loaded;return t&&t[e.uid]?super.reloadTile(e):this.loadTile(e)}loadAndProcessGeoJSON(t,n){return e._(this,void 0,void 0,(function*(){let i=yield this.loadGeoJSON(t,n);if(delete this._pendingRequest,"object"!=typeof i)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(c(i,!0),t.filter){const n=e.bA(t.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map((e=>`${e.key}: ${e.message}`)).join(", "));const r=i.features.filter((e=>n.value.evaluate({zoom:0},e)));i={type:"FeatureCollection",features:r}}return i}))}loadGeoJSON(t,n){return e._(this,void 0,void 0,(function*(){const{promoteId:i}=t;if(t.request){const r=yield e.h(t.request,n);return this._dataUpdateable=fe(r.data,i)?me(r.data,i):void 0,r.data}if("string"==typeof t.data)try{const e=JSON.parse(t.data);return this._dataUpdateable=fe(e,i)?me(e,i):void 0,e}catch(e){throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`)}if(!t.dataDiff)throw new Error(`Input data given to '${t.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${t.source}`);return function(e,t,n){var i,r,o,s;if(t.removeAll&&e.clear(),t.remove)for(const n of t.remove)e.delete(n);if(t.add)for(const i of t.add){const t=pe(i,n);null!=t&&e.set(t,i)}if(t.update)for(const n of t.update){let t=e.get(n.id);if(null==t)continue;const a=!n.removeAllProperties&&((null===(i=n.removeProperties)||void 0===i?void 0:i.length)>0||(null===(r=n.addOrUpdateProperties)||void 0===r?void 0:r.length)>0);if((n.newGeometry||n.removeAllProperties||a)&&(t=Object.assign({},t),e.set(n.id,t),a&&(t.properties=Object.assign({},t.properties))),n.newGeometry&&(t.geometry=n.newGeometry),n.removeAllProperties)t.properties={};else if((null===(o=n.removeProperties)||void 0===o?void 0:o.length)>0)for(const e of n.removeProperties)Object.prototype.hasOwnProperty.call(t.properties,e)&&delete t.properties[e];if((null===(s=n.addOrUpdateProperties)||void 0===s?void 0:s.length)>0)for(const{key:e,value:i}of n.addOrUpdateProperties)t.properties[e]=i}}(this._dataUpdateable,t.dataDiff,i),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(t){return e._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(e){return this._geoJSONIndex.getClusterExpansionZoom(e.clusterId)}getClusterChildren(e){return this._geoJSONIndex.getChildren(e.clusterId)}getClusterLeaves(e){return this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset)}}class _e{constructor(t){this.self=t,this.actor=new e.C(t),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(e,t)=>{if(this.externalWorkerSourceTypes[e])throw new Error(`Worker source with name "${e}" already registered.`);this.externalWorkerSourceTypes[e]=t},this.self.addProtocol=e.bg,this.self.removeProtocol=e.bh,this.self.registerRTLTextPlugin=t=>{if(e.bB.isParsed())throw new Error("RTL text plugin already registered.");e.bB.setMethods(t)},this.actor.registerMessageHandler("LDT",((e,t)=>this._getDEMWorkerSource(e,t.source).loadTile(t))),this.actor.registerMessageHandler("RDT",((t,n)=>e._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(t,n.source).removeTile(n)})))),this.actor.registerMessageHandler("GCEZ",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterExpansionZoom(n)})))),this.actor.registerMessageHandler("GCC",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterChildren(n)})))),this.actor.registerMessageHandler("GCL",((t,n)=>e._(this,void 0,void 0,(function*(){return this._getWorkerSource(t,n.type,n.source).getClusterLeaves(n)})))),this.actor.registerMessageHandler("LD",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadData(t))),this.actor.registerMessageHandler("GD",((e,t)=>this._getWorkerSource(e,t.type,t.source).getData())),this.actor.registerMessageHandler("LT",((e,t)=>this._getWorkerSource(e,t.type,t.source).loadTile(t))),this.actor.registerMessageHandler("RT",((e,t)=>this._getWorkerSource(e,t.type,t.source).reloadTile(t))),this.actor.registerMessageHandler("AT",((e,t)=>this._getWorkerSource(e,t.type,t.source).abortTile(t))),this.actor.registerMessageHandler("RMT",((e,t)=>this._getWorkerSource(e,t.type,t.source).removeTile(t))),this.actor.registerMessageHandler("RS",((t,n)=>e._(this,void 0,void 0,(function*(){if(!this.workerSources[t]||!this.workerSources[t][n.type]||!this.workerSources[t][n.type][n.source])return;const e=this.workerSources[t][n.type][n.source];delete this.workerSources[t][n.type][n.source],void 0!==e.removeSource&&e.removeSource(n)})))),this.actor.registerMessageHandler("RM",(t=>e._(this,void 0,void 0,(function*(){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t]})))),this.actor.registerMessageHandler("SR",((t,n)=>e._(this,void 0,void 0,(function*(){this.referrer=n})))),this.actor.registerMessageHandler("SRPS",((e,t)=>this._syncRTLPluginState(e,t))),this.actor.registerMessageHandler("IS",((t,n)=>e._(this,void 0,void 0,(function*(){this.self.importScripts(n)})))),this.actor.registerMessageHandler("SI",((e,t)=>this._setImages(e,t))),this.actor.registerMessageHandler("UL",((t,n)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).update(n.layers,n.removedIds)})))),this.actor.registerMessageHandler("SL",((t,n)=>e._(this,void 0,void 0,(function*(){this._getLayerIndex(t).replace(n)}))))}_setImages(t,n){return e._(this,void 0,void 0,(function*(){this.availableImages[t]=n;for(const e in this.workerSources[t]){const i=this.workerSources[t][e];for(const e in i)i[e].availableImages=n}}))}_syncRTLPluginState(t,n){return e._(this,void 0,void 0,(function*(){if(e.bB.isParsed())return e.bB.getState();if("loading"!==n.pluginStatus)return e.bB.setState(n),n;const t=n.pluginURL;if(this.self.importScripts(t),e.bB.isParsed()){const n={pluginStatus:"loaded",pluginURL:t};return e.bB.setState(n),n}throw e.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${t}`)}))}_getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}_getLayerIndex(e){let n=this.layerIndexes[e];return n||(n=this.layerIndexes[e]=new t),n}_getWorkerSource(e,t,n){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][n]){const i={sendAsync:(t,n)=>(t.targetMapId=e,this.actor.sendAsync(t,n))};switch(t){case"vector":this.workerSources[e][t][n]=new o(i,this._getLayerIndex(e),this._getAvailableImages(e));break;case"geojson":this.workerSources[e][t][n]=new ge(i,this._getLayerIndex(e),this._getAvailableImages(e));break;default:this.workerSources[e][t][n]=new this.externalWorkerSourceTypes[t](i,this._getLayerIndex(e),this._getAvailableImages(e))}}return this.workerSources[e][t][n]}_getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new s),this.demWorkerSources[e][t]}}return e.i(self)&&(self.worker=new _e(self)),_e})),n("index",0,(function(e,t){var n="4.3.2";let i,r;const o={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:e=>new Promise(((n,i)=>{const r=requestAnimationFrame(n);e.signal.addEventListener("abort",(()=>{cancelAnimationFrame(r),i(t.c())}))})),getImageData(e,t=0){return this.getImageCanvasContext(e).getImageData(-t,-t,e.width+2*t,e.height+2*t)},getImageCanvasContext(e){const t=window.document.createElement("canvas"),n=t.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0,e.width,e.height),n},resolveURL:e=>(i||(i=document.createElement("a")),i.href=e,i.href),hardwareConcurrency:"undefined"!=typeof navigator&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(null==r&&(r=matchMedia("(prefers-reduced-motion: reduce)")),r.matches)}};class s{static testProp(e){if(!s.docStyle)return e[0];for(let t=0;t<e.length;t++)if(e[t]in s.docStyle)return e[t];return e[0]}static create(e,t,n){const i=window.document.createElement(e);return void 0!==t&&(i.className=t),n&&n.appendChild(i),i}static createNS(e,t){return window.document.createElementNS(e,t)}static disableDrag(){s.docStyle&&s.selectProp&&(s.userSelect=s.docStyle[s.selectProp],s.docStyle[s.selectProp]="none")}static enableDrag(){s.docStyle&&s.selectProp&&(s.docStyle[s.selectProp]=s.userSelect)}static setTransform(e,t){e.style[s.transformProp]=t}static addEventListener(e,t,n,i={}){e.addEventListener(t,n,"passive"in i?i:i.capture)}static removeEventListener(e,t,n,i={}){e.removeEventListener(t,n,"passive"in i?i:i.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",s.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",s.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",s.suppressClickInternal,!0)}),0)}static getScale(e){const t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}static getPoint(e,n,i){const r=n.boundingClientRect;return new t.P((i.clientX-r.left)/n.x-e.clientLeft,(i.clientY-r.top)/n.y-e.clientTop)}static mousePos(e,t){const n=s.getScale(e);return s.getPoint(e,n,t)}static touchPos(e,t){const n=[],i=s.getScale(e);for(let r=0;r<t.length;r++)n.push(s.getPoint(e,i,t[r]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}s.docStyle="undefined"!=typeof window&&window.document&&window.document.documentElement.style,s.selectProp=s.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),s.transformProp=s.testProp(["transform","WebkitTransform"]);const a={supported:!1,testSupport:function(e){!u&&c&&(h?d(e):l=e)}};let l,c,u=!1,h=!1;function d(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c),e.isContextLost())return;a.supported=!0}catch(e){}e.deleteTexture(t),u=!0}var p;"undefined"!=typeof document&&(c=document.createElement("img"),c.onload=()=>{l&&d(l),l=null,h=!0},c.onerror=()=>{u=!0,l=null},c.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(e){let n,i,r,o;e.resetRequestQueue=()=>{n=[],i=0,r=0,o={}},e.addThrottleControl=e=>{const t=r++;return o[t]=e,t},e.removeThrottleControl=e=>{delete o[e],l()},e.getImage=(e,i,r=!0)=>new Promise(((o,s)=>{a.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),t.e(e,{type:"image"}),n.push({abortController:i,requestParameters:e,supportImageRefresh:r,state:"queued",onError:e=>{s(e)},onSuccess:e=>{o(e)}}),l()}));const s=e=>t._(this,void 0,void 0,(function*(){e.state="running";const{requestParameters:n,supportImageRefresh:r,onError:o,onSuccess:s,abortController:a}=e,u=!1===r&&!t.i(self)&&!t.g(n.url)&&(!n.headers||Object.keys(n.headers).reduce(((e,t)=>e&&"accept"===t),!0));i++;const h=u?c(n,a):t.m(n,a);try{const n=yield h;delete e.abortController,e.state="completed",n.data instanceof HTMLImageElement||t.b(n.data)?s(n):n.data&&s({data:yield(d=n.data,"function"==typeof createImageBitmap?t.d(d):t.f(d)),cacheControl:n.cacheControl,expires:n.expires})}catch(t){delete e.abortController,o(t)}finally{i--,l()}var d})),l=()=>{const e=(()=>{for(const e of Object.keys(o))if(o[e]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let t=i;t<e&&n.length>0;t++){const e=n.shift();e.abortController.signal.aborted?t--:s(e)}},c=(e,n)=>new Promise(((i,r)=>{const o=new Image,s=e.url,a=e.credentials;a&&"include"===a?o.crossOrigin="use-credentials":(a&&"same-origin"===a||!t.s(s))&&(o.crossOrigin="anonymous"),n.signal.addEventListener("abort",(()=>{o.src="",r(t.c())})),o.fetchPriority="high",o.onload=()=>{o.onerror=o.onload=null,i({data:o})},o.onerror=()=>{o.onerror=o.onload=null,n.signal.aborted||r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},o.src=s}))}(p||(p={})),p.resetRequestQueue();class f{constructor(e){this._transformRequestFn=e}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function m(e){var n=new t.A(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}var g,_=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e};g=new t.A(3),t.A!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0);var y=function(e){var t=e[0],n=e[1];return t*t+n*n};function v(e){const t=[];if("string"==typeof e)t.push({id:"default",url:e});else if(e&&e.length>0){const n=[];for(const{id:i,url:r}of e){const e=`${i}${r}`;-1===n.indexOf(e)&&(n.push(e),t.push({id:i,url:r}))}}return t}function b(e,t,n){const i=e.split("?");return i[0]+=`${t}${n}`,i.join("?")}!function(){var e=new t.A(2);t.A!=Float32Array&&(e[0]=0,e[1]=0)}();class x{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,n,i){const{width:r,height:o}=e,s=!(this.size&&this.size[0]===r&&this.size[1]===o||i),{context:a}=this,{gl:l}=a;if(this.useMipmap=Boolean(n&&n.useMipmap),l.bindTexture(l.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===l.RGBA&&(!n||!1!==n.premultiply)),s)this.size=[r,o],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texImage2D(l.TEXTURE_2D,0,this.format,this.format,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,this.format,r,o,0,this.format,l.UNSIGNED_BYTE,e.data);else{const{x:n,y:s}=i||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||t.b(e)?l.texSubImage2D(l.TEXTURE_2D,0,n,s,l.RGBA,l.UNSIGNED_BYTE,e):l.texSubImage2D(l.TEXTURE_2D,0,n,s,r,o,l.RGBA,l.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&l.generateMipmap(l.TEXTURE_2D)}bind(e,t,n){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function w(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class E extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:e,promiseResolve:t}of this.requestors)t(this._getImagesForIds(e));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const e=n.spriteData;n.data=new t.R({width:e.width,height:e.height},e.context.getImageData(e.x,e.y,e.width,e.height).data),n.spriteData=null}return n}addImage(e,t){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,t)&&(this.images[e]=t)}_validate(e,n){let i=!0;const r=n.data||n.spriteData;return this._validateStretch(n.stretchX,r&&r.width)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,r&&r.height)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new t.j(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,t){if(!e)return!0;let n=0;for(const i of e){if(i[0]<n||i[1]<i[0]||t<i[1])return!1;n=i[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;const n=t.spriteData,i=n&&n.width||t.data.width,r=n&&n.height||t.data.height;return!(e[0]<0||i<e[0]||e[1]<0||r<e[1]||e[2]<0||i<e[2]||e[3]<0||r<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,t,n=!0){const i=this.getImage(e);if(n&&(i.data.width!==t.data.width||i.data.height!==t.data.height))throw new Error(`size mismatch between old image (${i.data.width}x${i.data.height}) and new image (${t.data.width}x${t.data.height}).`);t.version=i.version+1,this.images[e]=t,this.updatedImages[e]=!0}removeImage(e){const t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((t,n)=>{let i=!0;if(!this.isLoaded())for(const t of e)this.images[t]||(i=!1);this.isLoaded()||i?t(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:t})}))}_getImagesForIds(e){const n={};for(const i of e){let e=this.getImage(i);e||(this.fire(new t.k("styleimagemissing",{id:i})),e=this.getImage(i)),e?n[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,textFitWidth:e.textFitWidth,textFitHeight:e.textFitHeight,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.w(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:t}=this.atlasImage;return{width:e,height:t}}getPattern(e){const n=this.patterns[e],i=this.getImage(e);if(!i)return null;if(n&&n.position.version===i.version)return n.position;if(n)n.position.version=i.version;else{const n={w:i.data.width+2,h:i.data.height+2,x:0,y:0},r=new t.I(n,i);this.patterns[e]={bin:n,position:r}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new x(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:i}=t.p(e),r=this.atlasImage;r.resize({width:n||1,height:i||1});for(const e in this.patterns){const{bin:n}=this.patterns[e],i=n.x+1,o=n.y+1,s=this.getImage(e).data,a=s.width,l=s.height;t.R.copy(s,r,{x:0,y:0},{x:i,y:o},{width:a,height:l}),t.R.copy(s,r,{x:0,y:l-1},{x:i,y:o-1},{width:a,height:1}),t.R.copy(s,r,{x:0,y:0},{x:i,y:o+l},{width:a,height:1}),t.R.copy(s,r,{x:a-1,y:0},{x:i-1,y:o},{width:1,height:l}),t.R.copy(s,r,{x:0,y:0},{x:i+a,y:o},{width:1,height:l})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const e=this.getImage(n);e||t.w(`Image with ID: "${n}" was not found`),w(e)&&this.updateImage(n,e)}}}const S=1e20;function T(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)A(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)A(e,c*o+t,1,i,s,a,l)}function A(e,t,n,i,r,o,s){o[0]=0,s[0]=-S,s[1]=S,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=S}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}class C{constructor(e,t){this.requestManager=e,this.localIdeographFontFamily=t,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return t._(this,void 0,void 0,(function*(){const t=[];for(const n in e)for(const i of e[n])t.push(this._getAndCacheGlyphsPromise(n,i));const n=yield Promise.all(t),i={};for(const{stack:e,id:t,glyph:r}of n)i[e]||(i[e]={}),i[e][t]=r&&{id:r.id,bitmap:r.bitmap.clone(),metrics:r.metrics};return i}))}_getAndCacheGlyphsPromise(e,n){return t._(this,void 0,void 0,(function*(){let t=this.entries[e];t||(t=this.entries[e]={glyphs:{},requests:{},ranges:{}});let i=t.glyphs[n];if(void 0!==i)return{stack:e,id:n,glyph:i};if(i=this._tinySDF(t,e,n),i)return t.glyphs[n]=i,{stack:e,id:n,glyph:i};const r=Math.floor(n/256);if(256*r>65535)throw new Error("glyphs > 65535 not supported");if(t.ranges[r])return{stack:e,id:n,glyph:i};if(!this.url)throw new Error("glyphsUrl is not set");if(!t.requests[r]){const n=C.loadGlyphRange(e,r,this.url,this.requestManager);t.requests[r]=n}const o=yield t.requests[r];for(const e in o)this._doesCharSupportLocalGlyph(+e)||(t.glyphs[+e]=o[+e]);return t.ranges[r]=!0,{stack:e,id:n,glyph:o[n]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(t.u["CJK Unified Ideographs"](e)||t.u["Hangul Syllables"](e)||t.u.Hiragana(e)||t.u.Katakana(e))}_tinySDF(e,n,i){const r=this.localIdeographFontFamily;if(!r)return;if(!this._doesCharSupportLocalGlyph(i))return;let o=e.tinySDF;if(!o){let t="400";/bold/i.test(n)?t="900":/medium/i.test(n)?t="500":/light/i.test(n)&&(t="200"),o=e.tinySDF=new C.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:r,fontWeight:t})}const s=o.draw(String.fromCharCode(i));return{id:i,bitmap:new t.o({width:s.width||60,height:s.height||60},s.data),metrics:{width:s.glyphWidth/2||24,height:s.glyphHeight/2||24,left:s.glyphLeft/2+.5||0,top:s.glyphTop/2-27.5||-8,advance:s.glyphAdvance/2||24,isDoubleResolution:!0}}}}C.loadGlyphRange=function(e,n,i,r){return t._(this,void 0,void 0,(function*(){const o=256*n,s=o+255,a=r.transformRequest(i.replace("{fontstack}",e).replace("{range}",`${o}-${s}`),"Glyphs"),l=yield t.l(a,new AbortController);if(!l||!l.data)throw new Error(`Could not load glyph range. range: ${n}, ${o}-${s}`);const c={};for(const e of t.n(l.data))c[e.id]=e;return c}))},C.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(S,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=y.data[4*(e*a+t)+3]/255;if(0===n)continue;const i=(e+m)*c+t+m;if(1===n)_[i]=0,g[i]=S;else{const e=.5-n;_[i]=e>0?e*e:0,g[i]=e<0?e*e:0}}T(_,0,0,c,u,c,this.f,this.v,this.z),T(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class P{constructor(){this.specification=t.v.light.position}possiblyEvaluate(e,n){return t.y(e.expression.evaluate(n))}interpolate(e,n,i){return{x:t.z.number(e.x,n.x,i),y:t.z.number(e.y,n.y,i),z:t.z.number(e.z,n.z,i)}}}let I;class M extends t.E{constructor(e){super(),I=I||new t.q({anchor:new t.D(t.v.light.anchor),position:new P,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(I),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.r,e,n))for(const t in e){const n=e[t];t.endsWith("-transition")?this._transitionable.setTransition(t.slice(0,-11),n):this._transitionable.setValue(t,n)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||!1!==i.validate)&&t.t(this,e.call(t.x,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.v}))}}class R{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,t){const n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}getDashRanges(e,t,n){const i=[];let r=e.length%2==1?-e[e.length-1]*n:0,o=e[0]*n,s=!0;i.push({left:r,right:o,isDash:s,zeroLength:0===e[0]});let a=e[0];for(let t=1;t<e.length;t++){s=!s;const l=e[t];r=a*n,a+=l,o=a*n,i.push({left:r,right:o,isDash:s,zeroLength:0===l})}return i}addRoundDash(e,t,n){const i=t/2;for(let t=-n;t<=n;t++){const r=this.width*(this.nextRow+n+t);let o=0,s=e[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=e[++o]);const l=Math.abs(a-s.left),c=Math.abs(a-s.right),u=Math.min(l,c);let h;const d=t/n*(i+1);if(s.isDash){const e=i-Math.abs(d);h=Math.sqrt(u*u+e*e)}else h=i-Math.sqrt(u*u+d*d);this.data[r+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(e){for(let t=e.length-1;t>=0;--t){const n=e[t],i=e[t+1];n.zeroLength?e.splice(t,1):i&&i.isDash===n.isDash&&(i.left=n.left,e.splice(t,1))}const t=e[0],n=e[e.length-1];t.isDash===n.isDash&&(t.left=n.left-this.width,n.right=t.right+this.width);const i=this.width*this.nextRow;let r=0,o=e[r];for(let t=0;t<this.width;t++){t/o.right>1&&(o=e[++r]);const n=Math.abs(t-o.left),s=Math.abs(t-o.right),a=Math.min(n,s);this.data[i+t]=Math.max(0,Math.min(255,(o.isDash?a:-a)+128))}}addDash(e,n){const i=n?7:0,r=2*i+1;if(this.nextRow+r>this.height)return t.w("LineAtlas out of space"),null;let o=0;for(let t=0;t<e.length;t++)o+=e[t];if(0!==o){const t=this.width/o,r=this.getDashRanges(e,this.width,t);n?this.addRoundDash(r,t,i):this.addRegularDash(r)}const s={y:(this.nextRow+i+.5)/this.height,height:2*i/this.height,width:o};return this.nextRow+=r,this.dirty=!0,s}bind(e){const t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}const O="maplibre_preloaded_worker_pool";class k{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<k.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[O]}numActive(){return Object.keys(this.active).length}}const L=Math.floor(o.hardwareConcurrency/2);let D,F;function N(){return D||(D=new k),D}k.workerCount=t.B(globalThis)?Math.max(Math.min(L,3),1):1;class B{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const i=this.workerPool.acquire(n);for(let e=0;e<i.length;e++){const r=new t.C(i[e],n);r.name=`Worker ${e}`,this.actors.push(r)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,t){const n=[];for(const i of this.actors)n.push(i.sendAsync({type:e,data:t}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((e=>{e.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,t){for(const n of this.actors)n.registerMessageHandler(e,t)}}function z(){return F||(F=new B(N(),t.G),F.registerMessageHandler("GR",((e,n,i)=>t.m(n,i)))),F}function j(e,n){const i=t.F();return t.H(i,i,[1,1,0]),t.J(i,i,[.5*e.width,.5*e.height,1]),t.K(i,i,e.calculatePosMatrix(n.toUnwrapped()))}function U(e,t,n,i,r,o){const s=function(e,t,n){if(e)for(const i of e){const e=t[i];if(e&&e.source===n&&"fill-extrusion"===e.type)return!0}else for(const e in t){const i=t[e];if(i.source===n&&"fill-extrusion"===i.type)return!0}return!1}(r&&r.layers,t,e.id),a=o.maxPitchScaleFactor(),l=e.tilesIn(i,a,s);l.sort(V);const c=[];for(const i of l)c.push({wrappedTileID:i.tileID.wrapped().key,queryResults:i.tile.queryRenderedFeatures(t,n,e._state,i.queryGeometry,i.cameraQueryGeometry,i.scale,r,o,a,j(e.transform,i.tileID))});const u=function(e){const t={},n={};for(const i of e){const e=i.queryResults,r=i.wrappedTileID,o=n[r]=n[r]||{};for(const n in e){const i=e[n],r=o[n]=o[n]||{},s=t[n]=t[n]||[];for(const e of i)r[e.featureIndex]||(r[e.featureIndex]=!0,s.push(e))}}return t}(c);for(const t in u)u[t].forEach((t=>{const n=t.feature,i=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=i}));return u}function V(e,t){const n=e.tileID,i=t.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}function G(e,n,i){return t._(this,void 0,void 0,(function*(){let r=e;if(e.url?r=(yield t.h(n.transformRequest(e.url,"Source"),i)).data:yield o.frameAsync(i),!r)return null;const s=t.L(t.e(r,e),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in r&&r.vector_layers&&(s.vectorLayerIds=r.vector_layers.map((e=>e.id))),s}))}class ${constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&(4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof t.M?new t.M(e.lng,e.lat):t.M.convert(e),this}setSouthWest(e){return this._sw=e instanceof t.M?new t.M(e.lng,e.lat):t.M.convert(e),this}extend(e){const n=this._sw,i=this._ne;let r,o;if(e instanceof t.M)r=e,o=e;else{if(!(e instanceof $))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend($.convert(e)):this.extend(t.M.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(t.M.convert(e)):this;if(r=e._sw,o=e._ne,!r||!o)return this}return n||i?(n.lng=Math.min(r.lng,n.lng),n.lat=Math.min(r.lat,n.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)):(this._sw=new t.M(r.lng,r.lat),this._ne=new t.M(o.lng,o.lat)),this}getCenter(){return new t.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.M(this.getWest(),this.getNorth())}getSouthEast(){return new t.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:i}=t.M.convert(e);let r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return e instanceof $?e:e?new $(e):e}static fromLngLat(e,n=0){const i=360*n/40075017,r=i/Math.cos(Math.PI/180*e.lat);return new $(new t.M(e.lng-r,e.lat-i),new t.M(e.lng+r,e.lat+i))}}class W{constructor(e,t,n){this.bounds=$.convert(this.validateBounds(e)),this.minzoom=t||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),i=Math.floor(t.N(this.bounds.getWest())*n),r=Math.floor(t.O(this.bounds.getNorth())*n),o=Math.ceil(t.N(this.bounds.getEast())*n),s=Math.ceil(t.O(this.bounds.getSouth())*n);return e.x>=i&&e.x<o&&e.y>=r&&e.y<s}}class H extends t.E{constructor(e,n,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.L(n,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(t.e(this,e),e.bounds&&(this.tileBounds=new W(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new t.j(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(t,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request.collectResourceTiming=this._collectResourceTiming;let i="RT";if(e.actor&&"expired"!==e.state){if("loading"===e.state)return new Promise(((t,n)=>{e.reloadPromise={resolve:t,reject:n}}))}else e.actor=this.dispatcher.getActor(),i="LT";e.abortController=new AbortController;try{const t=yield e.actor.sendAsync({type:i,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,t)}catch(t){if(delete e.abortController,e.aborted)return;if(t&&404!==t.status)throw t;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,t){if(t&&t.resourceTiming&&(e.resourceTiming=t.resourceTiming),t&&this.map._refreshExpiredTiles&&e.setExpiryData(t),e.loadVectorData(t,this.map.painter),e.reloadPromise){const t=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(t.resolve).catch(t.reject)}}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class q extends t.E{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},n),t.e(this,t.L(n,["url","scheme","tileSize"]))}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield G(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(t.e(this,e),e.bounds&&(this.tileBounds=new W(e.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new t.j(e))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return t.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const n=yield p.getImage(this.map._requestManager.transformRequest(t,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){this.map._refreshExpiredTiles&&n.cacheControl&&n.expires&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const t=this.map.painter.context,i=t.gl,r=n.data;e.texture=this.map.painter.getTileTexture(r.width),e.texture?e.texture.update(r,{useMipmap:!0}):(e.texture=new x(t,r,i.RGBA,{useMipmap:!0}),e.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE,i.LINEAR_MIPMAP_NEAREST),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax)),e.state="loaded"}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class X extends q{constructor(e,n,i,r){super(e,n,i,r),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return t._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),i=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const n=yield p.getImage(i,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){const i=n.data;this.map._refreshExpiredTiles&&n.cacheControl&&n.expires&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const r=t.b(i)&&t.S()?i:yield this.readImageNow(i),o={type:this.type,uid:e.uid,source:this.id,rawImageData:r,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||"expired"===e.state){e.actor=this.dispatcher.getActor();const t=yield e.actor.sendAsync({type:"LDT",data:o});e.dem=t,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(t){if(delete e.abortController,e.aborted)e.state="unloaded";else if(t)throw e.state="errored",t}}))}readImageNow(e){return t._(this,void 0,void 0,(function*(){if("undefined"!=typeof VideoFrame&&t.U()){const n=e.width+2,i=e.height+2;try{return new t.R({width:n,height:i},yield t.V(e,-1,-1,n,i))}catch(e){}}return o.getImageData(e,1)}))}_getNeighboringTiles(e){const n=e.canonical,i=Math.pow(2,n.z),r=(n.x-1+i)%i,o=0===n.x?e.wrap-1:e.wrap,s=(n.x+1+i)%i,a=n.x+1===i?e.wrap+1:e.wrap,l={};return l[new t.Q(e.overscaledZ,o,n.z,r,n.y).key]={backfilled:!1},l[new t.Q(e.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(l[new t.Q(e.overscaledZ,o,n.z,r,n.y-1).key]={backfilled:!1},l[new t.Q(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new t.Q(e.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<i&&(l[new t.Q(e.overscaledZ,o,n.z,r,n.y+1).key]={backfilled:!1},l[new t.Q(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new t.Q(e.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),l}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Z extends t.E{constructor(e,n,i,r){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=i.getActor(),this.setEventedParent(r),this._data=n.data,this._options=t.e({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=t.W/this.tileSize;this.workerOptions=t.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.W,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.W,radius:(n.clusterRadius||50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),"string"==typeof this.promoteId&&(this.workerOptions.promoteId=this.promoteId)}load(){return t._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return t._(this,void 0,void 0,(function*(){const e=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(void 0!==e.clusterRadius&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),void 0!==e.clusterMaxZoom&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,t,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:t,offset:n}})}_updateWorkerData(e){return t._(this,void 0,void 0,(function*(){const n=t.e({type:this.type},this.workerOptions);e?n.dataDiff=e:"string"==typeof this._data?(n.request=this.map._requestManager.transformRequest(o.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.k("dataloading",{dataType:"source"}));try{const e=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||e.abandoned)return void this.fire(new t.k("dataabort",{dataType:"source"}));let i=null;e.resourceTiming&&e.resourceTiming[this.id]&&(i=e.resourceTiming[this.id].slice(0));const r={dataType:"source"};this._collectResourceTiming&&i&&i.length>0&&t.e(r,{resourceTiming:i}),this.fire(new t.k("data",Object.assign(Object.assign({},r),{sourceDataType:"metadata"}))),this.fire(new t.k("data",Object.assign(Object.assign({},r),{sourceDataType:"content"})))}catch(e){if(this._pendingLoads--,this._removed)return void this.fire(new t.k("dataabort",{dataType:"source"}));this.fire(new t.j(e))}}))}loaded(){return 0===this._pendingLoads}loadTile(e){return t._(this,void 0,void 0,(function*(){const t=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const i=yield this.actor.sendAsync({type:t,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(i,this.map.painter,"RT"===t)}))}abortTile(e){return t._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return t._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Y=t.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class K extends t.E{constructor(e,t,n,i){super(),this.id=e,this.dispatcher=n,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=t}load(e){return t._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const t=yield p.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,t&&t.data&&(this.image=t.data,e&&(this.coordinates=e),this._finishLoading())}catch(e){this._request=null,this._loaded=!0,this.fire(new t.j(e))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(t.Y.fromLngLat);this.tileID=function(e){let n=1/0,i=1/0,r=-1/0,o=-1/0;for(const t of e)n=Math.min(n,t.x),i=Math.min(i,t.y),r=Math.max(r,t.x),o=Math.max(o,t.y);const s=Math.max(r-n,o-i),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),l=Math.pow(2,a);return new t.a0(a,Math.floor((n+r)/2*l),Math.floor((i+o)/2*l))}(n),this.minzoom=this.maxzoom=this.tileID.z;const i=n.map((e=>this.tileID.getTilePoint(e)._round()));return this._boundsArray=new t.Z,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.W,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.W),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.W,t.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=t.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new x(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return t._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class J extends K{constructor(e,t,n,i){super(e,t,n,i),this.roundZoom=!0,this.type="video",this.options=t}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const t of e.urls)this.urls.push(this.map._requestManager.transformRequest(t,"Source").url);try{const e=yield t.a2(this.urls);if(this._loaded=!0,!e)return;this.video=e,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(e){this.fire(new t.j(e))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.j(new t.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=t.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new x(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let i=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,i=!0)}i&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Q extends K{constructor(e,n,i,r){super(e,n,i,r),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new t.j(new t.a1(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.j(new t.a1(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.j(new t.a1(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof HTMLCanvasElement||this.fire(new t.j(new t.a1(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.j(new t.a1(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){return t._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,i=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,Y.members)),this.boundsSegments||(this.boundsSegments=t.$.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new x(n,this.canvas,i.RGBA,{premultiply:!0});let r=!1;for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture,r=!0)}r&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ee={},te=e=>{switch(e){case"geojson":return Z;case"image":return K;case"raster":return q;case"raster-dem":return X;case"vector":return H;case"video":return J;case"canvas":return Q}return ee[e]},ne="RTLPluginLoaded";class ie extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=z()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((e=>{throw this.status="error",e}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return t._(this,arguments,void 0,(function*(e,t=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=o.resolveURL(e),!this.url)throw new Error(`requested url ${e} is invalid`);if("unavailable"===this.status){if(!t)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if("requested"===this.status)return this._requestImport()}))}_requestImport(){return t._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.k(ne))}))}lazyLoad(){"unavailable"===this.status?this.status="requested":"deferred"===this.status&&this._requestImport()}}let re=null;function oe(){return re||(re=new ie),re}class se{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=t.a3(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const t=e+this.timeAdded;t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,i){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){const n={};if(!t)return n;for(const i of e){const e=i.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){i.layers=e,i.stateDependentLayerIds&&(i.stateDependentLayers=i.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)n[t.id]=i}}return n}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.a5){if(this.hasSymbolBuckets=!0,!i)break;n.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const e in this.buckets){const n=this.buckets[e];if(n instanceof t.a5&&n.hasRTLText){this.hasRTLText=!0,oe().lazyLoad();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(e).queryRadius(t))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new t.a4}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const t in this.buckets){const n=this.buckets[t];n.uploadPending()&&n.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new x(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new x(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,r,o,s,a,l,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:i,cameraQueryGeometry:r,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:a,params:s,queryPadding:this.queryPadding*l},e,t,n):{}}querySourceFeatures(e,n){const i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;const r=i.loadVTLayers(),o=n&&n.sourceLayer?n.sourceLayer:"",s=r._geojsonTileLayer||r[o];if(!s)return;const a=t.a6(n&&n.filter),{z:l,x:c,y:u}=this.tileID.canonical,h={z:l,x:c,y:u};for(let n=0;n<s.length;n++){const r=s.feature(n);if(a.needGeometry){const e=t.a7(r,!0);if(!a.filter(new t.a8(this.tileID.overscaledZ),e,this.tileID.canonical))continue}else if(!a.filter(new t.a8(this.tileID.overscaledZ),r))continue;const d=i.getId(r,o),p=new t.a9(r,l,c,u,d);p.tile=h,e.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const n=t.aa(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(n)if(this.expirationTime<n)t=!0;else{const i=this.expirationTime-n;i?this.expirationTime=e+Math.max(i,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const n=this.latestFeatureIndex.loadVTLayers();for(const i in this.buckets){if(!t.style.hasLayer(i))continue;const r=this.buckets[i],o=r.layers[0].sourceLayer||"_geojsonTileLayer",s=n[o],a=e[o];if(!s||!a||0===Object.keys(a).length)continue;r.update(a,s,this.imageAtlas&&this.imageAtlas.patternPositions||{});const l=t&&t.style&&t.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(r)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=o.now()+e}setDependencies(e,t){const n={};for(const e of t)n[e]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const e=this.dependencies[n];if(e)for(const n of t)if(e[n])return!0}return!1}}class ae{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const r={value:t,timeout:void 0};if(void 0!==n&&(r.timeout=setTimeout((()=>{this.remove(e,r)}),n)),this.data[i].push(r),this.order.push(i),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),r=this.data[n][i];return this.data[n].splice(i,1),r.timeout&&clearTimeout(r.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(r.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const e of t)this.remove(e.value.tileID,e)}}class le{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){const r=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},t.e(this.stateChanges[e][r],i),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==r&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][r]){this.deletedStates[e][r]={};for(const t in this.state[e][r])i[t]||(this.deletedStates[e][r][t]=null)}else for(const t in i)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][t]&&delete this.deletedStates[e][r][t]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,n){const i=String(n),r=t.e({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const t=this.deletedStates[e][n];if(null===t)return{};for(const e in t)delete r[e]}return r}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,n){const i={};for(const e in this.stateChanges){this.state[e]=this.state[e]||{};const n={};for(const i in this.stateChanges[e])this.state[e][i]||(this.state[e][i]={}),t.e(this.state[e][i],this.stateChanges[e][i]),n[i]=this.state[e][i];i[e]=n}for(const e in this.deletedStates){this.state[e]=this.state[e]||{};const n={};if(null===this.deletedStates[e])for(const t in this.state[e])n[t]={},this.state[e][t]={};else for(const t in this.deletedStates[e]){if(null===this.deletedStates[e][t])this.state[e][t]={};else for(const n of Object.keys(this.deletedStates[e][t]))delete this.state[e][t][n];n[t]=this.state[e][t]}i[e]=i[e]||{},t.e(i[e],n)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(i).length)for(const t in e)e[t].setFeatureState(i,n)}}class ce extends t.E{constructor(e,t,n){super(),this.id=e,this.dispatcher=n,this.on("data",(e=>this._dataHandler(e))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((e,t,n,i)=>{const r=new(te(t.type))(e,t,n,i);if(r.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${r.id}`);return r})(e,t,n,this),this._tiles={},this._cache=new ae(0,(e=>this._unloadTile(e))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new le,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;if(!(void 0===this.used&&void 0===this.usedForTerrain||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,i){return t._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,i)}catch(n){e.state="errored",404!==n.status?this._source.fire(new t.j(n,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new t.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(ue).map((e=>e.key))}getRenderableIds(e){const n=[];for(const t in this._tiles)this._isIdRenderable(t,e)&&n.push(this._tiles[t]);return e?n.sort(((e,n)=>{const i=e.tileID,r=n.tileID,o=new t.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle),s=new t.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return i.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x})).map((e=>e.tileID.key)):n.map((e=>e.tileID)).sort(ue).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading")}}_reloadTile(e,n){return t._(this,void 0,void 0,(function*(){const t=this._tiles[e];t&&("loading"!==t.state&&(t.state=n),yield this._loadTile(t,e,n))}))}_tileLoaded(e,n,i){e.timeAdded=o.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new t.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const r=t[i];if(e.neighboringTiles&&e.neighboringTiles[r]){const t=this.getTileByID(r);n(e,t),n(t,e)}}function n(e,t){e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0;let n=t.tileID.canonical.x-e.tileID.canonical.x;const i=t.tileID.canonical.y-e.tileID.canonical.y,r=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===n&&0===i||Math.abs(i)>1||(Math.abs(n)>1&&(1===Math.abs(n+r)?n+=r:1===Math.abs(n-r)&&(n-=r)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,i),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const r in this._tiles){let o=this._tiles[r];if(i[r]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(s=e)}let a=s;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){i[s.key]=s;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const t=e.scaledTo(n),i=this._getLoadedTile(t);if(i)return i}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,i=Math.ceil(e.height/this._source.tileSize)+1,r=Math.floor(n*i*(null===this._maxTileCacheZoomLevels?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const n in this._tiles){const i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),e[i.tileID.key]=i}this._tiles=e;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}}_updateCoveredAndRetainedTiles(e,t,n,i,r,s){const a={},l={},c=Object.keys(e),u=o.now();for(const n of c){const i=e[n],r=this._tiles[n];if(!r||0!==r.fadeEndTime&&r.fadeEndTime<=u)continue;const o=this.findLoadedParent(i,t),s=this.findLoadedSibling(i),c=o||s||null;c&&(this._addTile(c.tileID),a[c.tileID.key]=c.tileID),l[n]=i}this._retainLoadedChildren(l,i,n,e);for(const t in a)e[t]||(this._coveredTiles[t]=!0,e[t]=a[t]);if(s){const t={},n={};for(const e of r)this._tiles[e.key].hasData()?t[e.key]=e:n[e.key]=e;for(const i in n){const r=n[i].children(this._source.maxzoom);this._tiles[r[0].key]&&this._tiles[r[1].key]&&this._tiles[r[2].key]&&this._tiles[r[3].key]&&(t[r[0].key]=e[r[0].key]=r[0],t[r[1].key]=e[r[1].key]=r[1],t[r[2].key]=e[r[2].key]=r[2],t[r[3].key]=e[r[3].key]=r[3],delete n[i])}for(const i in n){const r=n[i],o=this.findLoadedParent(r,this._source.minzoom),s=this.findLoadedSibling(r),a=o||s||null;if(a){t[a.tileID.key]=e[a.tileID.key]=a.tileID;for(const e in t)t[e].isChildOf(a.tileID)&&delete t[e]}}for(const e in this._tiles)t[e]||(this._coveredTiles[e]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let i;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((e=>new t.Q(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y))):(i=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n}),this._source.hasTile&&(i=i.filter((e=>this._source.hasTile(e))))):i=[];const r=e.coveringZoomLevel(this._source),o=Math.max(r-ce.maxOverzooming,this._source.minzoom),s=Math.max(r+ce.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const e={};for(const t of i)if(t.canonical.z>this._source.minzoom){const n=t.scaledTo(t.canonical.z-1);e[n.key]=n;const i=t.scaledTo(Math.max(this._source.minzoom,Math.min(t.canonical.z,5)));e[i.key]=i}i=i.concat(Object.values(e))}const a=0===i.length&&!this._updated&&this._didEmitContent;this._updated=!0,a&&this.fire(new t.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const l=this._updateRetainedTiles(i,r);he(this._source.type)&&this._updateCoveredAndRetainedTiles(l,o,s,r,i,n);for(const e in l)this._tiles[e].clearFadeHold();const c=t.ab(this._tiles,l);for(const e of c){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(e)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,t){var n;const i={},r={},o=Math.max(t-ce.maxOverzooming,this._source.minzoom),s=Math.max(t+ce.maxUnderzooming,this._source.minzoom),a={};for(const n of e){const e=this._addTile(n);i[n.key]=n,e.hasData()||t<this._source.maxzoom&&(a[n.key]=n)}this._retainLoadedChildren(a,t,s,i);for(const s of e){let e=this._tiles[s.key];if(e.hasData())continue;if(t+1>this._source.maxzoom){const e=s.children(this._source.maxzoom)[0],t=this.getTile(e);if(t&&t.hasData()){i[e.key]=e;continue}}else{const e=s.children(this._source.maxzoom);if(i[e[0].key]&&i[e[1].key]&&i[e[2].key]&&i[e[3].key])continue}let a=e.wasRequested();for(let t=s.overscaledZ-1;t>=o;--t){const o=s.scaledTo(t);if(r[o.key])break;if(r[o.key]=!0,e=this.getTile(o),!e&&a&&(e=this._addTile(o)),e){const t=e.hasData();if((t||!(null===(n=this.map)||void 0===n?void 0:n.cancelPendingTileRequestsWhileZooming)||a)&&(i[o.key]=o),a=e.wasRequested(),t)break}}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const e=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(e),n)break;i=e}for(const e of t)this._loadedParentTiles[e]=n}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const t=this._tiles[e].tileID,n=this._getLoadedTile(t);this._loadedSiblingTiles[t.key]=n}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const i=n;return n||(n=new se(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,i||this._source.fire(new t.k("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}_dataHandler(e){const t=e.sourceDataType;"source"===e.dataType&&"metadata"===t&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===t&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,i){const r=[],o=this.transform;if(!o)return r;const s=i?o.getCameraQueryGeometry(e):e,a=e.map((e=>o.pointCoordinate(e,this.terrain))),l=s.map((e=>o.pointCoordinate(e,this.terrain))),c=this.getIds();let u=1/0,h=1/0,d=-1/0,p=-1/0;for(const e of l)u=Math.min(u,e.x),h=Math.min(h,e.y),d=Math.max(d,e.x),p=Math.max(p,e.y);for(let e=0;e<c.length;e++){const i=this._tiles[c[e]];if(i.holdingForFade())continue;const s=i.tileID,f=Math.pow(2,o.zoom-i.tileID.overscaledZ),m=n*i.queryPadding*t.W/i.tileSize/f,g=[s.getTilePoint(new t.Y(u,h)),s.getTilePoint(new t.Y(d,p))];if(g[0].x-m<t.W&&g[0].y-m<t.W&&g[1].x+m>=0&&g[1].y+m>=0){const e=a.map((e=>s.getTilePoint(e))),t=l.map((e=>s.getTilePoint(e)));r.push({tile:i,tileID:s,queryGeometry:e,cameraQueryGeometry:t,scale:f})}}return r}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map((e=>this._tiles[e].tileID));for(const e of t)e.posMatrix=this.transform.calculatePosMatrix(e.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(he(this._source.type)){const e=o.now();for(const t in this._tiles)if(this._tiles[t].fadeEndTime>=e)return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(n,"reloading");this._cache.filter((n=>!n.hasDependency(e,t)))}}function ue(e,t){const n=Math.abs(2*e.wrap)-+(e.wrap<0),i=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||i-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function he(e){return"raster"===e||"image"===e||"video"===e}ce.maxOverzooming=10,ce.maxUnderzooming=3;class de{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let e=1;e<this.points.length;e++)this._distances[e]=this._distances[e-1]+this.points[e].dist(this.points[e-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.ac(e,0,1);let n=1,i=this._distances[n];const r=e*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];const o=n-1,s=this._distances[o],a=i-s,l=a>0?(r-s)/a:0;return this.points[o].mult(1-l).add(this.points[n].mult(l))}}function pe(e,t){let n=!0;return"always"===e||"never"!==e&&"never"!==t||(n=!1),n}class fe{constructor(e,t,n){const i=this.boxCells=[],r=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(t/n);for(let e=0;e<this.xCellCount*this.yCellCount;e++)i.push([]),r.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,n,i,r){this._forEachCell(t,n,i,r,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)}insertCircle(e,t,n,i){this._forEachCell(t-i,n-i,t+i,n+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(i)}_insertBoxCell(e,t,n,i,r,o){this.boxCells[r].push(o)}_insertCircleCell(e,t,n,i,r,o){this.circleCells[r].push(o)}_query(e,t,n,i,r,o,s){if(n<0||e>this.width||i<0||t>this.height)return[];const a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=i){if(r)return[{key:null,x1:e,y1:t,x2:n,y2:i}];for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],n=this.circles[3*e+1],i=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-i,y1:n-i,x2:t+i,y2:n+i})}}else this._forEachCell(e,t,n,i,this._queryCell,a,{hitTest:r,overlapMode:o,seenUids:{box:{},circle:{}}},s);return a}query(e,t,n,i){return this._query(e,t,n,i,!1,null)}hitTest(e,t,n,i,r,o){return this._query(e,t,n,i,!0,r,o).length>0}hitTestCircle(e,t,n,i,r){const o=e-n,s=e+n,a=t-n,l=t+n;if(s<0||o>this.width||l<0||a>this.height)return!1;const c=[];return this._forEachCell(o,a,s,l,this._queryCellCircle,c,{hitTest:!0,overlapMode:i,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},r),c.length>0}_queryCell(e,t,n,i,r,o,s,a){const{seenUids:l,hitTest:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const r=this.bboxes;for(const s of h)if(!l.box[s]){l.box[s]=!0;const h=4*s,d=this.boxKeys[s];if(e<=r[h+2]&&t<=r[h+3]&&n>=r[h+0]&&i>=r[h+1]&&(!a||a(d))&&(!c||!pe(u,d.overlapMode))&&(o.push({key:d,x1:r[h],y1:r[h+1],x2:r[h+2],y2:r[h+3]}),c))return!0}}const d=this.circleCells[r];if(null!==d){const r=this.circles;for(const s of d)if(!l.circle[s]){l.circle[s]=!0;const h=3*s,d=this.circleKeys[s];if(this._circleAndRectCollide(r[h],r[h+1],r[h+2],e,t,n,i)&&(!a||a(d))&&(!c||!pe(u,d.overlapMode))){const e=r[h],t=r[h+1],n=r[h+2];if(o.push({key:d,x1:e-n,y1:t-n,x2:e+n,y2:t+n}),c)return!0}}}return!1}_queryCellCircle(e,t,n,i,r,o,s,a){const{circle:l,seenUids:c,overlapMode:u}=s,h=this.boxCells[r];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const n=4*t,i=this.boxKeys[t];if(this._circleAndRectCollide(l.x,l.y,l.radius,e[n+0],e[n+1],e[n+2],e[n+3])&&(!a||a(i))&&!pe(u,i.overlapMode))return o.push(!0),!0}}const d=this.circleCells[r];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const n=3*t,i=this.circleKeys[t];if(this._circlesCollide(e[n],e[n+1],e[n+2],l.x,l.y,l.radius)&&(!a||a(i))&&!pe(u,i.overlapMode))return o.push(!0),!0}}}_forEachCell(e,t,n,i,r,o,s,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(i);for(let d=l;d<=u;d++)for(let l=c;l<=h;l++)if(r.call(this,e,t,n,i,this.xCellCount*l+d,o,s,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,n,i,r,o){const s=i-e,a=r-t,l=n+o;return l*l>s*s+a*a}_circleAndRectCollide(e,t,n,i,r,o,s){const a=(o-i)/2,l=Math.abs(e-(i+a));if(l>a+n)return!1;const c=(s-r)/2,u=Math.abs(t-(r+c));if(u>c+n)return!1;if(l<=a||u<=c)return!0;const h=l-a,d=u-c;return h*h+d*d<=n*n}}function me(e,n,i,r,o){const s=t.F();return n?(t.J(s,s,[1/o,1/o,1]),i||t.ad(s,s,r.angle)):t.K(s,r.labelPlaneMatrix,e),s}function ge(e,n,i,r,o){if(n){const n=t.ae(e);return t.J(n,n,[o,o,1]),i||t.ad(n,n,-r.angle),n}return r.glCoordMatrix}function _e(e,n,i){let r;i?(r=[e.x,e.y,i(e.x,e.y),1],t.af(r,r,n)):(r=[e.x,e.y,0,1],function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e[3]=n[3]*i+n[7]*r+n[15]}(r,r,n));const o=r[3];return{point:new t.P(r[0]/o,r[1]/o),signedDistanceFromCamera:o,isOccluded:!1}}function ye(e,t){return.5+e/t*.5}function ve(e,t){return e.x>=-t[0]&&e.x<=t[0]&&e.y>=-t[1]&&e.y<=t[1]}function be(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m){const g=r?e.textSizeData:e.iconSizeData,_=t.ag(g,i.transform.zoom),y=[256/i.width*2+1,256/i.height*2+1],v=r?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;v.clear();const b=e.lineVertexArray,x=r?e.text.placedSymbolArray:e.icon.placedSymbolArray,w=i.transform.width/i.transform.height;let E=!1;for(let r=0;r<x.length;r++){const S=x.get(r);if(S.hidden||S.writingMode===t.ah.vertical&&!E){Re(S.numGlyphs,v);continue}E=!1;const T=_e(new t.P(S.anchorX,S.anchorY),n,m);if(!ve(T.point,y)){Re(S.numGlyphs,v);continue}const A=ye(i.transform.cameraToCenterDistance,T.signedDistanceFromCamera),C=t.ai(g,_,S),P=a?C/A:C*A,I={getElevation:m,labelPlaneMatrix:o,lineVertexArray:b,pitchWithMap:a,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:u,tileAnchorPoint:new t.P(S.anchorX,S.anchorY),unwrappedTileID:h,width:d,height:p,translation:f},M=Ee(I,S,P,!1,l,n,s,e.glyphOffsetArray,v,w,c);E=M.useVertical,(M.notEnoughRoom||E||M.needsFlipping&&Ee(I,S,P,!0,l,n,s,e.glyphOffsetArray,v,w,c).notEnoughRoom)&&Re(S.numGlyphs,v)}r?e.text.dynamicLayoutVertexBuffer.updateData(v):e.icon.dynamicLayoutVertexBuffer.updateData(v)}function xe(e,t,n,i,r,o,s,a){const l=o.glyphStartIndex+o.numGlyphs,c=o.lineStartIndex,u=o.lineStartIndex+o.lineLength,h=t.getoffsetX(o.glyphStartIndex),d=t.getoffsetX(l-1),p=Ie(e*h,n,i,r,o.segment,c,u,a,s);if(!p)return null;const f=Ie(e*d,n,i,r,o.segment,c,u,a,s);return f?a.projectionCache.anyProjectionOccluded?null:{first:p,last:f}:null}function we(e,n,i,r){return e===t.ah.horizontal&&Math.abs(i.y-n.y)>Math.abs(i.x-n.x)*r?{useVertical:!0}:(e===t.ah.vertical?n.y<i.y:n.x>i.x)?{needsFlipping:!0}:null}function Ee(e,n,i,r,o,s,a,l,c,u,h){const d=i/24,p=n.lineOffsetX*d,f=n.lineOffsetY*d;let m;if(n.numGlyphs>1){const t=n.glyphStartIndex+n.numGlyphs,i=n.lineStartIndex,s=n.lineStartIndex+n.lineLength,c=xe(d,l,p,f,r,n,h,e);if(!c)return{notEnoughRoom:!0};const g=_e(c.first.point,a,e.getElevation).point,_=_e(c.last.point,a,e.getElevation).point;if(o&&!r){const e=we(n.writingMode,g,_,u);if(e)return e}m=[c.first];for(let o=n.glyphStartIndex+1;o<t-1;o++)m.push(Ie(d*l.getoffsetX(o),p,f,r,n.segment,i,s,e,h));m.push(c.last)}else{if(o&&!r){const i=_e(e.tileAnchorPoint,s,e.getElevation).point,r=n.lineStartIndex+n.segment+1,o=new t.P(e.lineVertexArray.getx(r),e.lineVertexArray.gety(r)),a=_e(o,s,e.getElevation),l=a.signedDistanceFromCamera>0?a.point:function(e,t,n,i,r,o){return Se(e,t,n,1,r,o)}(e.tileAnchorPoint,o,i,0,s,e),c=we(n.writingMode,i,l,u);if(c)return c}const i=Ie(d*l.getoffsetX(n.glyphStartIndex),p,f,r,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,e,h);if(!i||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};m=[i]}for(const e of m)t.aj(c,e.point,e.angle);return{}}function Se(e,t,n,i,r,o){const s=e.add(e.sub(t)._unit()),a=void 0!==r?_e(s,r,o.getElevation).point:Ae(s.x,s.y,o).point,l=n.sub(a);return n.add(l._mult(i/l.mag()))}function Te(e,n,i){const r=n.projectionCache;if(r.projections[e])return r.projections[e];const o=new t.P(n.lineVertexArray.getx(e),n.lineVertexArray.gety(e)),s=Ae(o.x,o.y,n);if(s.signedDistanceFromCamera>0)return r.projections[e]=s.point,r.anyProjectionOccluded=r.anyProjectionOccluded||s.isOccluded,s.point;const a=e-i.direction;return function(e,t,n,i,r){return Se(e,t,n,i,void 0,r)}(0===i.distanceFromAnchor?n.tileAnchorPoint:new t.P(n.lineVertexArray.getx(a),n.lineVertexArray.gety(a)),o,i.previousVertex,i.absOffsetX-i.distanceFromAnchor+1,n)}function Ae(e,n,i){const r=e+i.translation[0],o=n+i.translation[1];let s;return!i.pitchWithMap&&i.projection.useSpecialProjectionForSymbols?(s=i.projection.projectTileCoordinates(r,o,i.unwrappedTileID,i.getElevation),s.point.x=(.5*s.point.x+.5)*i.width,s.point.y=(.5*-s.point.y+.5)*i.height):(s=_e(new t.P(r,o),i.labelPlaneMatrix,i.getElevation),s.isOccluded=!1),s}function Ce(e,t,n){return e._unit()._perp()._mult(t*n)}function Pe(e,n,i,r,o,s,a,l,c){if(l.projectionCache.offsets[e])return l.projectionCache.offsets[e];const u=i.add(n);if(e+c.direction<r||e+c.direction>=o)return l.projectionCache.offsets[e]=u,u;const h=Te(e+c.direction,l,c),d=Ce(h.sub(i),a,c.direction),p=i.add(d),f=h.add(d);return l.projectionCache.offsets[e]=t.ak(s,u,p,f)||u,l.projectionCache.offsets[e]}function Ie(e,t,n,i,r,o,s,a,l){const c=i?e-t:e+t;let u=c>0?1:-1,h=0;i&&(u*=-1,h=Math.PI),u<0&&(h+=Math.PI);let d,p=u>0?o+r:o+r+1;a.projectionCache.cachedAnchorPoint?d=a.projectionCache.cachedAnchorPoint:(d=Ae(a.tileAnchorPoint.x,a.tileAnchorPoint.y,a).point,a.projectionCache.cachedAnchorPoint=d);let f,m,g=d,_=d,y=0,v=0;const b=Math.abs(c),x=[];let w;for(;y+v<=b;){if(p+=u,p<o||p>=s)return null;y+=v,_=g,m=f;const e={absOffsetX:b,direction:u,distanceFromAnchor:y,previousVertex:_};if(g=Te(p,a,e),0===n)x.push(_),w=g.sub(_);else{let t;const i=g.sub(_);t=0===i.mag()?Ce(Te(p+u,a,e).sub(g),n,u):Ce(i,n,u),m||(m=_.add(t)),f=Pe(p,t,g,o,s,m,n,a,e),x.push(m),w=f.sub(m)}v=w.mag()}const E=w._mult((b-y)/v)._add(m||_),S=h+Math.atan2(g.y-_.y,g.x-_.x);return x.push(E),{point:E,angle:l?S:0,path:x}}const Me=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Re(e,t){for(let n=0;n<e;n++){const e=t.length;t.resize(e+4),t.float32.set(Me,3*e)}}const Oe=100;class ke{constructor(e,t,n=new fe(e.width+200,e.height+200,25),i=new fe(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=t,this.grid=n,this.ignoredGrid=i,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Oe,this.screenBottomBoundary=e.height+Oe,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,t,n,i,r,o,s,a,l,c,u){const h=e.anchorPointX+a[0],d=e.anchorPointY+a[1],p=this.projectAndGetPerspectiveRatio(i,h,d,r,c),f=this._projectCollisionBox(e,n,i,r,o,s,a,p,c,u),[m,g,_,y]=f.box;return this.mapProjection.useSpecialProjectionForSymbols&&(o?f.allPointsOccluded:this.mapProjection.isOccluded(h,d,r))||p.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(m,g,_,y)||"always"!==t&&this.grid.hitTest(m,g,_,y,t,l)?{box:[m,g,_,y],placeable:!1,offscreen:!1}:{box:[m,g,_,y],placeable:!0,offscreen:this.isOffscreen(m,g,_,y)}}placeCollisionCircles(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){const _=[],y=new t.P(n.anchorX,n.anchorY),v=this.getPerspectiveRatio(s,y.x,y.y,a,g),b=(h?o/v:o*v)/t.ap,x={getElevation:g,labelPlaneMatrix:l,lineVertexArray:i,pitchWithMap:h,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:y,unwrappedTileID:a,width:this.transform.width,height:this.transform.height,translation:m},w=xe(b,r,n.lineOffsetX*b,n.lineOffsetY*b,!1,n,!1,x);let E=!1,S=!1,T=!0;if(w){const n=.5*p*v+f,i=new t.P(-100,-100),r=new t.P(this.screenRightBoundary,this.screenBottomBoundary),o=new de,s=w.first,a=w.last;let l=[];for(let e=s.path.length-1;e>=1;e--)l.push(s.path[e]);for(let e=1;e<a.path.length;e++)l.push(a.path[e]);const h=2.5*n;if(c){const e=this.projectPathToScreenSpace(l,x,c);l=e.some((e=>e.signedDistanceFromCamera<=0))?[]:e.map((e=>e.point))}let m=[];if(l.length>0){const e=l[0].clone(),n=l[0].clone();for(let t=1;t<l.length;t++)e.x=Math.min(e.x,l[t].x),e.y=Math.min(e.y,l[t].y),n.x=Math.max(n.x,l[t].x),n.y=Math.max(n.y,l[t].y);m=e.x>=i.x&&n.x<=r.x&&e.y>=i.y&&n.y<=r.y?[l]:n.x<i.x||e.x>r.x||n.y<i.y||e.y>r.y?[]:t.al([l],i.x,i.y,r.x,r.y)}for(const t of m){o.reset(t,.25*n);let i=0;i=o.length<=.5*n?1:Math.ceil(o.paddedLength/h)+1;for(let t=0;t<i;t++){const r=t/Math.max(i-1,1),s=o.lerp(r),a=s.x+Oe,l=s.y+Oe;_.push(a,l,n,0);const c=a-n,h=l-n,p=a+n,f=l+n;if(T=T&&this.isOffscreen(c,h,p,f),S=S||this.isInsideGrid(c,h,p,f),"always"!==e&&this.grid.hitTestCircle(a,l,n,e,d)&&(E=!0,!u))return{circles:[],offscreen:!1,collisionDetected:E}}}}return{circles:!u&&E||!S||v<this.perspectiveRatioCutoff?[]:_,offscreen:T,collisionDetected:E}}projectPathToScreenSpace(e,t,n){return e.map((e=>_e(e,n,t.getElevation)))}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let i=1/0,r=1/0,o=-1/0,s=-1/0;for(const a of e){const e=new t.P(a.x+Oe,a.y+Oe);i=Math.min(i,e.x),r=Math.min(r,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),n.push(e)}const a=this.grid.query(i,r,o,s).concat(this.ignoredGrid.query(i,r,o,s)),l={},c={};for(const e of a){const i=e.key;if(void 0===l[i.bucketInstanceId]&&(l[i.bucketInstanceId]={}),l[i.bucketInstanceId][i.featureIndex])continue;const r=[new t.P(e.x1,e.y1),new t.P(e.x2,e.y1),new t.P(e.x2,e.y2),new t.P(e.x1,e.y2)];t.am(n,r)&&(l[i.bucketInstanceId][i.featureIndex]=!0,void 0===c[i.bucketInstanceId]&&(c[i.bucketInstanceId]=[]),c[i.bucketInstanceId].push(i.featureIndex))}return c}insertCollisionBox(e,t,n,i,r,o){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:o,overlapMode:t},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,n,i,r,o){const s=n?this.ignoredGrid:this.grid,a={bucketInstanceId:i,featureIndex:r,collisionGroupID:o,overlapMode:t};for(let t=0;t<e.length;t+=4)s.insertCircle(a,e[t],e[t+1],e[t+2])}projectAndGetPerspectiveRatio(e,n,i,r,o){const s=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,i,r,o):_e(new t.P(n,i),e,o);return{point:new t.P((s.point.x+1)/2*this.transform.width+Oe,(1-s.point.y)/2*this.transform.height+Oe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/s.signedDistanceFromCamera*.5,isOccluded:s.isOccluded,signedDistanceFromCamera:s.signedDistanceFromCamera}}getPerspectiveRatio(e,n,i,r,o){const s=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(n,i,r,o):_e(new t.P(n,i),e,o);return.5+this.transform.cameraToCenterDistance/s.signedDistanceFromCamera*.5}isOffscreen(e,t,n,i){return n<Oe||e>=this.screenRightBoundary||i<Oe||t>this.screenBottomBoundary}isInsideGrid(e,t,n,i){return n>=0&&e<this.gridRightBoundary&&i>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const e=t.an([]);return t.H(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,i,r,o,s,a,l,c,u){const h=n*l.perspectiveRatio;let d=new t.P(1,0),p=new t.P(0,1);const f=new t.P(e.anchorPointX+a[0],e.anchorPointY+a[1]);if(s&&!o){const e=this.projectAndGetPerspectiveRatio(i,f.x+1,f.y,r,c).point.sub(l.point).unit(),n=Math.atan(e.y/e.x)+(e.x<0?Math.PI:0),o=Math.sin(n),s=Math.cos(n);d=new t.P(s,o),p=new t.P(-o,s)}else if(!s&&o){const e=-this.transform.angle,n=Math.sin(e),i=Math.cos(e);d=new t.P(i,n),p=new t.P(-n,i)}let m=l.point,g=h;if(o){m=f;const e=this.transform.zoom-Math.floor(this.transform.zoom);g=Math.pow(2,-e),g*=this.mapProjection.getPitchedTextCorrection(this.transform,f,r),u||(g*=t.ac(.5+l.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}u&&(m=m.add(d.mult(u.x*g)).add(p.mult(u.y*g)));const _=e.x1*g,y=e.x2*g,v=(_+y)/2,b=e.y1*g,x=e.y2*g,w=(b+x)/2,E=[{offsetX:_,offsetY:b},{offsetX:v,offsetY:b},{offsetX:y,offsetY:b},{offsetX:y,offsetY:w},{offsetX:y,offsetY:x},{offsetX:v,offsetY:x},{offsetX:_,offsetY:x},{offsetX:_,offsetY:w}];let S=[];for(const{offsetX:e,offsetY:n}of E)S.push(new t.P(m.x+d.x*e+p.x*n,m.y+d.y*e+p.y*n));let T=!1;if(o){const e=S.map((e=>this.projectAndGetPerspectiveRatio(i,e.x,e.y,r,c)));T=e.some((e=>!e.isOccluded)),S=e.map((e=>e.point))}else T=!0;return{box:t.ao(S),allPointsOccluded:!T}}}function Le(e,n,i){return n*(t.W/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}class De{constructor(e,t,n,i){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):i&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class Fe{constructor(e,t,n,i,r){this.text=new De(e?e.text:null,t,n,r),this.icon=new De(e?e.icon:null,t,i,r)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ne{constructor(e,t,n){this.text=e,this.icon=t,this.skipFade=n}}class Be{constructor(){this.invProjMatrix=t.F(),this.viewportMatrix=t.F(),this.circles=[]}}class ze{constructor(e,t,n,i,r){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=n,this.bucketIndex=i,this.tileID=r}}class je{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Ue(e,n,i,r,o){const{horizontalAlign:s,verticalAlign:a}=t.au(e);return new t.P(-(s-.5)*n+r[0]*o,-(a-.5)*i+r[1]*o)}class Ve{constructor(e,t,n,i,r,o){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new ke(this.transform,t),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=i,this.retainedQueryData={},this.collisionGroups=new je(r),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=o,o&&(o.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const t=this.terrain;return t?(n,i)=>t.getElevation(e,n,i):null}getBucketParts(e,n,i,r){const o=i.getBucket(n),s=i.latestFeatureIndex;if(!o||!s||n.id!==o.layerIds[0])return;const a=i.collisionBoxArray,l=o.layers[0].layout,c=o.layers[0].paint,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),h=i.tileSize/t.W,d=i.tileID.toUnwrapped(),p=this.transform.calculatePosMatrix(d),f="map"===l.get("text-pitch-alignment"),m="map"===l.get("text-rotation-alignment"),g=Le(i,1,this.transform.zoom),_=this.collisionIndex.mapProjection.translatePosition(this.transform,i,c.get("text-translate"),c.get("text-translate-anchor")),y=this.collisionIndex.mapProjection.translatePosition(this.transform,i,c.get("icon-translate"),c.get("icon-translate-anchor")),v=me(p,f,m,this.transform,g);let b=null;if(f){const e=ge(p,f,m,this.transform,g);b=t.K([],this.transform.labelPlaneMatrix,e)}this.retainedQueryData[o.bucketInstanceId]=new ze(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,i.tileID);const x={bucket:o,layout:l,translationText:_,translationIcon:y,posMatrix:p,unwrappedTileID:d,textLabelPlaneMatrix:v,labelToScreenMatrix:b,scale:u,textPixelRatio:h,holdingForFade:i.holdingForFade(),collisionBoxArray:a,partiallyEvaluatedTextSize:t.ag(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r}=t;e.push({sortKey:n,symbolInstanceStart:i,symbolInstanceEnd:r,parameters:x})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:x})}attemptAnchorPlacement(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v){const b=t.aq[e.textAnchor],x=[e.textOffset0,e.textOffset1],w=Ue(b,i,r,x,o),E=this.collisionIndex.placeCollisionBox(n,d,l,c,u,a,s,g,h.predicate,v,w);if((!y||this.collisionIndex.placeCollisionBox(y,d,l,c,u,a,s,_,h.predicate,v,w).placeable)&&E.placeable){let e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID]&&this.prevPlacement.placements[p.crossTileID].text&&(e=this.prevPlacement.variableOffsets[p.crossTileID].anchor),0===p.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[p.crossTileID]={textOffset:x,width:i,height:r,anchor:b,textBoxScale:o,prevAnchor:e},this.markUsedJustification(f,b,p,m),f.allowVerticalPlacement&&(this.markUsedOrientation(f,m,p),this.placedOrientations[p.crossTileID]=m),{shift:w,placedGlyphBoxes:E}}}placeLayerBucketPart(e,n,i){const{bucket:r,layout:o,translationText:s,translationIcon:a,posMatrix:l,unwrappedTileID:c,textLabelPlaneMatrix:u,labelToScreenMatrix:h,textPixelRatio:d,holdingForFade:p,collisionBoxArray:f,partiallyEvaluatedTextSize:m,collisionGroup:g}=e.parameters,_=o.get("text-optional"),y=o.get("icon-optional"),v=t.ar(o,"text-overlap","text-allow-overlap"),b="always"===v,x=t.ar(o,"icon-overlap","icon-allow-overlap"),w="always"===x,E="map"===o.get("text-rotation-alignment"),S="map"===o.get("text-pitch-alignment"),T="none"!==o.get("icon-text-fit"),A="viewport-y"===o.get("symbol-z-order"),C=b&&(w||!r.hasIconData()||y),P=w&&(b||!r.hasTextData()||_);!r.collisionArrays&&f&&r.deserializeCollisionBoxes(f);const I=this._getTerrainElevationFunc(this.retainedQueryData[r.bucketInstanceId].tileID),M=(e,f,w)=>{var A,M;if(n[e.crossTileID])return;if(p)return void(this.placements[e.crossTileID]=new Ne(!1,!1,!1));let R=!1,O=!1,k=!0,L=null,D={box:null,placeable:!1,offscreen:null},F={box:null,placeable:!1,offscreen:null},N=null,B=null,z=null,j=0,U=0,V=0;f.textFeatureIndex?j=f.textFeatureIndex:e.useRuntimeCollisionCircles&&(j=e.featureIndex),f.verticalTextFeatureIndex&&(U=f.verticalTextFeatureIndex);const G=f.textBox;if(G){const n=n=>{let i=t.ah.horizontal;if(r.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,i=t,this.markUsedOrientation(r,i,e))}return i},o=(n,i)=>{if(r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&f.verticalTextBox){for(const e of r.writingModes)if(e===t.ah.vertical?(D=i(),F=D):D=n(),D&&D.placeable)break}else D=n()},u=e.textAnchorOffsetStartIndex,h=e.textAnchorOffsetEndIndex;if(h===u){const i=(t,n)=>{const i=this.collisionIndex.placeCollisionBox(t,v,d,l,c,S,E,s,g.predicate,I);return i&&i.placeable&&(this.markUsedOrientation(r,n,e),this.placedOrientations[e.crossTileID]=n),i};o((()=>i(G,t.ah.horizontal)),(()=>{const n=f.verticalTextBox;return r.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?i(n,t.ah.vertical):{box:null,offscreen:null}})),n(D&&D.placeable)}else{let p=t.aq[null===(M=null===(A=this.prevPlacement)||void 0===A?void 0:A.variableOffsets[e.crossTileID])||void 0===M?void 0:M.anchor];const m=(n,o,f)=>{const m=n.x2-n.x1,_=n.y2-n.y1,y=e.textBoxScale,b=T&&"never"===x?o:null;let w=null,A="never"===v?1:2,C="never";p&&A++;for(let t=0;t<A;t++){for(let t=u;t<h;t++){const i=r.textAnchorOffsets.get(t);if(p&&i.textAnchor!==p)continue;const o=this.attemptAnchorPlacement(i,n,m,_,y,E,S,d,l,c,g,C,e,r,f,s,a,b,I);if(o&&(w=o.placedGlyphBoxes,w&&w.placeable))return R=!0,L=o.shift,w}p?p=null:C=v}return i&&!w&&(w={box:this.collisionIndex.placeCollisionBox(G,"always",d,l,c,S,E,s,g.predicate,I,new t.P(0,0)).box,offscreen:!1,placeable:!1}),w};o((()=>m(G,f.iconBox,t.ah.horizontal)),(()=>{const n=f.verticalTextBox;return r.allowVerticalPlacement&&(!D||!D.placeable)&&e.numVerticalGlyphVertices>0&&n?m(n,f.verticalIconBox,t.ah.vertical):{box:null,occluded:!0,offscreen:null}})),D&&(R=D.placeable,k=D.offscreen);const _=n(D&&D.placeable);if(!R&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(r,t.anchor,e,_))}}}if(N=D,R=N&&N.placeable,k=N&&N.offscreen,e.useRuntimeCollisionCircles){const n=r.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),a=t.ai(r.textSizeData,m,n),d=o.get("text-padding");B=this.collisionIndex.placeCollisionCircles(v,n,r.lineVertexArray,r.glyphOffsetArray,a,l,c,u,h,i,S,g.predicate,e.collisionCircleDiameter,d,s,I),B.circles.length&&B.collisionDetected&&!i&&t.w("Collisions detected, but collision boxes are not shown"),R=b||B.circles.length>0&&!B.collisionDetected,k=k&&B.offscreen}if(f.iconFeatureIndex&&(V=f.iconFeatureIndex),f.iconBox){const e=e=>this.collisionIndex.placeCollisionBox(e,x,d,l,c,S,E,a,g.predicate,I,T&&L?L:void 0);F&&F.placeable&&f.verticalIconBox?(z=e(f.verticalIconBox),O=z.placeable):(z=e(f.iconBox),O=z.placeable),k=k&&z.offscreen}const $=_||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,W=y||0===e.numIconVertices;$||W?W?$||(O=O&&R):R=O&&R:O=R=O&&R;const H=O&&z.placeable;if(R&&N.placeable&&this.collisionIndex.insertCollisionBox(N.box,v,o.get("text-ignore-placement"),r.bucketInstanceId,F&&F.placeable&&U?U:j,g.ID),H&&this.collisionIndex.insertCollisionBox(z.box,x,o.get("icon-ignore-placement"),r.bucketInstanceId,V,g.ID),B&&R&&this.collisionIndex.insertCollisionCircles(B.circles,v,o.get("text-ignore-placement"),r.bucketInstanceId,j,g.ID),i&&this.storeCollisionData(r.bucketInstanceId,w,f,N,z,B),0===e.crossTileID)throw new Error("symbolInstance.crossTileID can't be 0");if(0===r.bucketInstanceId)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[e.crossTileID]=new Ne(R||C,O||P,k||r.justReloaded),n[e.crossTileID]=!0};if(A){if(0!==e.symbolInstanceStart)throw new Error("bucket.bucketInstanceId should be 0");const t=r.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];M(r.symbolInstances.get(n),r.collisionArrays[n],n)}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)M(r.symbolInstances.get(t),r.collisionArrays[t],t);if(i&&r.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[r.bucketInstanceId];t.as(e.invProjMatrix,l),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}r.justReloaded=!1}storeCollisionData(e,t,n,i,r,o){if(n.textBox||n.iconBox){let o,s;this.collisionBoxArrays.has(e)?o=this.collisionBoxArrays.get(e):(o=new Map,this.collisionBoxArrays.set(e,o)),o.has(t)?s=o.get(t):(s={text:null,icon:null},o.set(t,s)),n.textBox&&(s.text=i.box),n.iconBox&&(s.icon=r.box)}if(o){let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Be);for(let e=0;e<o.circles.length;e+=4)t.circles.push(o.circles[e+0]),t.circles.push(o.circles[e+1]),t.circles.push(o.circles[e+2]),t.circles.push(o.collisionDetected?1:0)}}markUsedJustification(e,n,i,r){let o;o=r===t.ah.vertical?i.verticalPlacedTextSymbolIndex:{left:i.leftJustifiedTextSymbolIndex,center:i.centerJustifiedTextSymbolIndex,right:i.rightJustifiedTextSymbolIndex}[t.at(n)];const s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex,i.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:i.crossTileID)}markUsedOrientation(e,n,i){const r=n===t.ah.horizontal||n===t.ah.horizontalOnly?n:0,o=n===t.ah.vertical?n:0,s=[i.leftJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=r;i.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(i.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const i=t?t.symbolFadeChange(e):1,r=t?t.opacities:{},o=t?t.variableOffsets:{},s=t?t.placedOrientations:{};for(const e in this.placements){const t=this.placements[e],o=r[e];o?(this.opacities[e]=new Fe(o,i,t.text,t.icon),n=n||t.text!==o.text.placed||t.icon!==o.icon.placed):(this.opacities[e]=new Fe(null,i,t.text,t.icon,t.skipFade),n=n||t.text||t.icon)}for(const e in r){const t=r[e];if(!this.opacities[e]){const r=new Fe(t,i,!1,!1);r.isHidden()||(this.opacities[e]=r,n=n||t.text.placed||t.icon.placed)}}for(const e in o)this.variableOffsets[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.variableOffsets[e]=o[e]);for(const e in s)this.placedOrientations[e]||!this.opacities[e]||this.opacities[e].isHidden()||(this.placedOrientations[e]=s[e]);if(t&&void 0===t.lastPlacementChangeTime)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const n={};for(const i of t){const t=i.getBucket(e);t&&i.latestFeatureIndex&&e.id===t.layerIds[0]&&this.updateBucketOpacities(t,i.tileID,n,i.collisionBoxArray)}}updateBucketOpacities(e,n,i,r){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const o=e.layers[0],s=o.layout,a=new Fe(null,0,!1,!1,!0),l=s.get("text-allow-overlap"),c=s.get("icon-allow-overlap"),u=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),h="map"===s.get("text-rotation-alignment"),d="map"===s.get("text-pitch-alignment"),p="none"!==s.get("icon-text-fit"),f=new Fe(null,0,l&&(c||!e.hasIconData()||s.get("icon-optional")),c&&(l||!e.hasTextData()||s.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const m=(e,t,n)=>{for(let i=0;i<t/4;i++)e.opacityVertexArray.emplaceBack(n);e.hasVisibleVertices=e.hasVisibleVertices||n!==Je},g=this.collisionBoxArrays.get(e.bucketInstanceId);for(let n=0;n<e.symbolInstances.length;n++){const r=e.symbolInstances.get(n),{numHorizontalGlyphVertices:o,numVerticalGlyphVertices:s,crossTileID:l}=r;let c=this.opacities[l];i[l]?c=a:c||(c=f,this.opacities[l]=c),i[l]=!0;const _=r.numIconVertices>0,y=this.placedOrientations[r.crossTileID],v=y===t.ah.vertical,b=y===t.ah.horizontal||y===t.ah.horizontalOnly;if(o>0||s>0){const t=Ke(c.text);m(e.text,o,v?Je:t),m(e.text,s,b?Je:t);const n=c.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach((t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||v?1:0)})),r.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=n||b?1:0);const i=this.variableOffsets[r.crossTileID];i&&this.markUsedJustification(e,i.anchor,r,y);const a=this.placedOrientations[r.crossTileID];a&&(this.markUsedJustification(e,"left",r,a),this.markUsedOrientation(e,a,r))}if(_){const t=Ke(c.icon),n=!(p&&r.verticalPlacedIconSymbolIndex&&v);r.placedIconSymbolIndex>=0&&(m(e.icon,r.numIconVertices,n?t:Je),e.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=c.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(m(e.icon,r.numVerticalIconVertices,n?Je:t),e.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=c.icon.isHidden())}const x=g&&g.has(n)?g.get(n):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const i=e.collisionArrays[n];if(i){let n=new t.P(0,0);if(i.textBox||i.verticalTextBox){let t=!0;if(u){const e=this.variableOffsets[l];e?(n=Ue(e.anchor,e.width,e.height,e.textOffset,e.textBoxScale),h&&n._rotate(d?this.transform.angle:-this.transform.angle)):t=!1}if(i.textBox||i.verticalTextBox){let r;i.textBox&&(r=v),i.verticalTextBox&&(r=b),Ge(e.textCollisionBox.collisionVertexArray,c.text.placed,!t||r,x.text,n.x,n.y)}}if(i.iconBox||i.verticalIconBox){const t=Boolean(!b&&i.verticalIconBox);let r;i.iconBox&&(r=t),i.verticalIconBox&&(r=!t),Ge(e.iconCollisionBox.collisionVertexArray,c.icon.placed,r,x.icon,p?n.x:0,p?n.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function Ge(e,t,n,i,r,o){i&&0!==i.length||(i=[0,0,0,0]);const s=i[0]-Oe,a=i[1]-Oe,l=i[2]-Oe,c=i[3]-Oe;e.emplaceBack(t?1:0,n?1:0,r||0,o||0,s,a),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,l,a),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,l,c),e.emplaceBack(t?1:0,n?1:0,r||0,o||0,s,c)}const $e=Math.pow(2,25),We=Math.pow(2,24),He=Math.pow(2,17),qe=Math.pow(2,16),Xe=Math.pow(2,9),Ze=Math.pow(2,8),Ye=Math.pow(2,1);function Ke(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*$e+t*We+n*He+t*qe+n*Xe+t*Ze+n*Ye+t}const Je=0;function Qe(){return{isOccluded:(e,t,n)=>!1,getPitchedTextCorrection:(e,t,n)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(e,t,n,i){throw new Error("Not implemented.")},translatePosition:(e,t,n,i)=>function(e,t,n,i,r=!1){if(!n[0]&&!n[1])return[0,0];const o=r?"map"===i?e.angle:0:"viewport"===i?-e.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}return[r?n[0]:Le(t,n[0],e.zoom),r?n[1]:Le(t,n[1],e.zoom)]}(e,t,n,i),getCircleRadiusCorrection:e=>1}}class et{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,t,n,i,r){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,i,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,r())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<o.length;)if(t.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,r())return!0;return!1}}class tt{constructor(e,t,n,i,r,o,s,a){this.placement=new Ve(e,Qe(),t,o,s,a),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,t,n){const i=o.now(),r=()=>!this._forceFullPlacement&&o.now()-i>2;for(;this._currentPlacementIndex>=0;){const i=t[e[this._currentPlacementIndex]],o=this.placement.collisionIndex.transform.zoom;if("symbol"===i.type&&(!i.minzoom||i.minzoom<=o)&&(!i.maxzoom||i.maxzoom>o)){if(this._inProgressLayer||(this._inProgressLayer=new et(i)),this._inProgressLayer.continuePlacement(n[i.source],this.placement,this._showCollisionBoxes,i,r))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const nt=512/t.W/2;class it{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this._symbolsByKey={};const r=new Map;for(let e=0;e<n.length;e++){const t=n.get(e),i=t.key,o=r.get(i);o?o.push(t):r.set(i,[t])}for(const[e,n]of r){const i={positions:n.map((e=>({x:Math.floor(e.anchorX*nt),y:Math.floor(e.anchorY*nt)}))),crossTileIDs:n.map((e=>e.crossTileID))};if(i.positions.length>128){const e=new t.av(i.positions.length,16,Uint16Array);for(const{x:t,y:n}of i.positions)e.add(t,n);e.finish(),delete i.positions,i.index=e}this._symbolsByKey[e]=i}}getScaledCoordinates(e,n){const{x:i,y:r,z:o}=this.tileID.canonical,{x:s,y:a,z:l}=n.canonical,c=nt/Math.pow(2,l-o),u=(a*t.W+e.anchorY)*c,h=r*t.W*nt;return{x:Math.floor((s*t.W+e.anchorX)*c-i*t.W*nt),y:Math.floor(u-h)}}findMatches(e,t,n){const i=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z);for(let r=0;r<e.length;r++){const o=e.get(r);if(o.crossTileID)continue;const s=this._symbolsByKey[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,t);if(s.index){const e=s.index.range(a.x-i,a.y-i,a.x+i,a.y+i).sort();for(const t of e){const e=s.crossTileIDs[t];if(!n[e]){n[e]=!0,o.crossTileID=e;break}}}else if(s.positions)for(let e=0;e<s.positions.length;e++){const t=s.positions[e],r=s.crossTileIDs[e];if(Math.abs(t.x-a.x)<=i&&Math.abs(t.y-a.y)<=i&&!n[r]){n[r]=!0,o.crossTileID=r;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class rt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ot{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const e in this.indexes){const n=this.indexes[e],i={};for(const e in n){const r=n[e];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),i[r.tileID.key]=r}this.indexes[e]=i}this.lng=e}addBucket(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let e=0;e<t.symbolInstances.length;e++)t.symbolInstances.get(e).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const i=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const r=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in r){const o=r[n];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,i)}else{const o=r[e.scaledTo(Number(n)).key];o&&o.findMatches(t.symbolInstances,e,i)}}for(let e=0;e<t.symbolInstances.length;e++){const r=t.symbolInstances.get(e);r.crossTileID||(r.crossTileID=n.generate(),i[r.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new it(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const n of t.getCrossTileIDsLists())for(const t of n)delete this.usedCrossTileIDs[e][t]}removeStaleBuckets(e){let t=!1;for(const n in this.indexes){const i=this.indexes[n];for(const r in i)e[i[r].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,i[r]),delete i[r],t=!0)}return t}}class st{constructor(){this.layerIndexes={},this.crossTileIDs=new rt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,n){let i=this.layerIndexes[e.id];void 0===i&&(i=this.layerIndexes[e.id]=new ot);let r=!1;const o={};i.handleWrapJump(n);for(const n of t){const t=n.getBucket(e);t&&e.id===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(n.tileID,t,this.crossTileIDs)&&(r=!0),o[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(r=!0),r}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const e in this.layerIndexes)t[e]||delete this.layerIndexes[e]}}const at=(e,n)=>t.t(e,n&&n.filter((e=>"source.canvas"!==e.identifier))),lt=t.aw();class ct extends t.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const e in this.sourceCaches){const t=this.sourceCaches[e].getSource().type;"vector"!==t&&"geojson"!==t||this.sourceCaches[e].reload()}},this.map=e,this.dispatcher=new B(N(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((e,t)=>this.getGlyphs(e,t))),this.dispatcher.registerMessageHandler("GI",((e,t)=>this.getImages(e,t))),this.imageManager=new E,this.imageManager.setEventedParent(this),this.glyphManager=new C(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new R(256,512),this.crossTileSymbolIndex=new st,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",t.ay()),oe().on(ne,this._rtlPluginLoaded),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.sourceCaches[e.sourceId];if(!t)return;const n=t.getSource();if(n&&n.vectorLayerIds)for(const e in this._layers){const t=this._layers[e];t.source===n.id&&this._validateLayer(t)}}))}loadURL(e,n={},i){this.fire(new t.k("dataloading",{dataType:"style"})),n.validate="boolean"!=typeof n.validate||n.validate;const r=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController,t.h(r,this._loadStyleRequest).then((e=>{this._loadStyleRequest=null,this._load(e.data,n,i)})).catch((e=>{this._loadStyleRequest=null,e&&this.fire(new t.j(e))}))}loadJSON(e,n={},i){this.fire(new t.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,n.validate=!1!==n.validate,this._load(e,n,i)})).catch((()=>{}))}loadEmpty(){this.fire(new t.k("dataloading",{dataType:"style"})),this._load(lt,{validate:!1})}_load(e,n,i){var r;const o=n.transformStyle?n.transformStyle(i,e):e;if(!n.validate||!at(this,t.x(o))){this._loaded=!0,this.stylesheet=o;for(const e in o.sources)this.addSource(e,o.sources[e],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs),this._createLayers(),this.light=new M(this.stylesheet.light),this.map.setTerrain(null!==(r=this.stylesheet.terrain)&&void 0!==r?r:null),this.fire(new t.k("data",{dataType:"style"})),this.fire(new t.k("style.load"))}}_createLayers(){const e=t.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((e=>e.id)),this._layers={},this._serializedLayers=null;for(const n of e){const e=t.aA(n);e.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=e}}_loadSprite(e,n=!1,i=void 0){let r;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(e,n,i,r){return t._(this,void 0,void 0,(function*(){const s=v(e),a=i>1?"@2x":"",l={},c={};for(const{id:e,url:i}of s){const o=n.transformRequest(b(i,a,".json"),"SpriteJSON");l[e]=t.h(o,r);const s=n.transformRequest(b(i,a,".png"),"SpriteImage");c[e]=p.getImage(s,r)}return yield Promise.all([...Object.values(l),...Object.values(c)]),function(e,n){return t._(this,void 0,void 0,(function*(){const t={};for(const i in e){t[i]={};const r=o.getImageCanvasContext((yield n[i]).data),s=(yield e[i]).data;for(const e in s){const{width:n,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m}=s[e];t[i][e]={data:null,pixelRatio:u,sdf:c,stretchX:h,stretchY:d,content:p,textFitWidth:f,textFitHeight:m,spriteData:{width:n,height:o,x:a,y:l,context:r}}}}return t}))}(l,c)}))}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((e=>{if(this._spriteRequest=null,e)for(const t in e){this._spritesImagesIds[t]=[];const i=this._spritesImagesIds[t]?this._spritesImagesIds[t].filter((t=>!(t in e))):[];for(const e of i)this.imageManager.removeImage(e),this._changedImages[e]=!0;for(const i in e[t]){const r="default"===t?i:`${t}:${i}`;this._spritesImagesIds[t].push(r),r in this.imageManager.images?this.imageManager.updateImage(r,e[t][i],!1):this.imageManager.addImage(r,e[t][i]),n&&(this._changedImages[r]=!0)}}})).catch((e=>{this._spriteRequest=null,r=e,this.fire(new t.j(r))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"})),i&&i(r)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const i=e.sourceLayer;if(!i)return;const r=n.getSource();("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(i))&&this.fire(new t.j(new Error(`Source layer "${i}" does not exist on source "${r.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e){const t=this._serializedAllLayers();if(!e||0===e.length)return Object.values(t);const n=[];for(const i of e)t[i]&&n.push(t[i]);return n}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const t=Object.keys(this._layers);for(const n of t){const t=this._layers[n];"custom"!==t.type&&(e[n]=t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];if("reload"===t)this._reloadSource(e);else{if("clear"!==t)throw new Error(`Invalid action ${t}`);this._clearSource(e)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const t in this._updatedPaintProps)this._layers[t].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}const i={};for(const e in this.sourceCaches){const t=this.sourceCaches[e];i[e]=t.used,t.used=!1}for(const t of this._order){const n=this._layers[t];n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)&&n.source&&(this.sourceCaches[n.source].used=!0)}for(const e in i){const n=this.sourceCaches[e];!!i[e]!=!!n.used&&n.fire(new t.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:e}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,t){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e),removedIds:t})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var i;this._checkLoaded();const r=this.serialize();if(e=n.transformStyle?n.transformStyle(r,e):e,(null===(i=n.validate)||void 0===i||i)&&at(this,t.x(e)))return!1;(e=t.aB(e)).layers=t.az(e.layers);const o=t.aC(r,e),s=this._getOperationsToPerform(o);if(s.unimplemented.length>0)throw new Error(`Unimplemented: ${s.unimplemented.join(", ")}.`);if(0===s.operations.length)return!1;for(const e of s.operations)e();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const t=[],n=[];for(const i of e)switch(i.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":t.push((()=>this.addLayer.apply(this,i.args)));break;case"removeLayer":t.push((()=>this.removeLayer.apply(this,i.args)));break;case"setPaintProperty":t.push((()=>this.setPaintProperty.apply(this,i.args)));break;case"setLayoutProperty":t.push((()=>this.setLayoutProperty.apply(this,i.args)));break;case"setFilter":t.push((()=>this.setFilter.apply(this,i.args)));break;case"addSource":t.push((()=>this.addSource.apply(this,i.args)));break;case"removeSource":t.push((()=>this.removeSource.apply(this,i.args)));break;case"setLayerZoomRange":t.push((()=>this.setLayerZoomRange.apply(this,i.args)));break;case"setLight":t.push((()=>this.setLight.apply(this,i.args)));break;case"setGeoJSONSourceData":t.push((()=>this.setGeoJSONSourceData.apply(this,i.args)));break;case"setGlyphs":t.push((()=>this.setGlyphs.apply(this,i.args)));break;case"setSprite":t.push((()=>this.setSprite.apply(this,i.args)));break;case"setTerrain":t.push((()=>this.map.setTerrain.apply(this,i.args)));break;case"setTransition":t.push((()=>{}));break;default:n.push(i.command)}return{operations:t,unimplemented:n}}addImage(e,n){if(this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,t){this.imageManager.updateImage(e,t)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new t.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,i={}){if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.x.source,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const r=this.sourceCaches[e]=new ce(e,n,this.dispatcher);r.style=this,r.setEventedParent(this,(()=>({isSourceLoaded:r.loaded(),source:r.serialize(),sourceId:e}))),r.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new t.j(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,t){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error(`There is no source with this ID=${e}`);const n=this.sourceCaches[e].getSource();if("geojson"!==n.type)throw new Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(t),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,i={}){this._checkLoaded();const r=e.id;if(this.getLayer(r))return void this.fire(new t.j(new Error(`Layer "${r}" already exists on this map.`)));let o;if("custom"===e.type){if(at(this,t.aD(e)))return;o=t.aA(e)}else{if("source"in e&&"object"==typeof e.source&&(this.addSource(r,e.source),e=t.aB(e),e=t.e(e,{source:r})),this._validate(t.x.layer,`layers.${r}`,e,{arrayIndex:-1},i))return;o=t.aA(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}})}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)this.fire(new t.j(new Error(`Cannot add layer "${r}" before non-existing layer "${n}".`)));else{if(this._order.splice(s,0,r),this._layerOrderChanged=!0,this._layers[r]=o,this._removedLayers[r]&&o.source&&"custom"!==o.type){const e=this._removedLayers[r];delete this._removedLayers[r],e.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const i=this._order.indexOf(e);this._order.splice(i,1);const r=n?this._order.indexOf(n):this._order.length;n&&-1===r?this.fire(new t.j(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(r,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.j(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,i){this._checkLoaded();const r=this.getLayer(e);r?r.minzoom===n&&r.maxzoom===i||(null!=n&&(r.minzoom=n),null!=i&&(r.maxzoom=i),this._updateLayer(r)):this.fire(new t.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,i={}){this._checkLoaded();const r=this.getLayer(e);if(r){if(!t.aE(r.filter,n))return null==n?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(t.x.filter,`layers.${r.id}.filter`,n,null,i)||(r.filter=t.aB(n),this._updateLayer(r)))}else this.fire(new t.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return t.aB(this.getLayer(e).filter)}setLayoutProperty(e,n,i,r={}){this._checkLoaded();const o=this.getLayer(e);o?t.aE(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,r),this._updateLayer(o)):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const i=this.getLayer(e);if(i)return i.getLayoutProperty(n);this.fire(new t.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,i,r={}){this._checkLoaded();const o=this.getLayer(e);o?t.aE(o.getPaintProperty(n),i)||(o.setPaintProperty(n,i,r)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new t.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,t){return this.getLayer(e).getPaintProperty(t)}setFeatureState(e,n){this._checkLoaded();const i=e.source,r=e.sourceLayer,o=this.sourceCaches[i];if(void 0===o)return void this.fire(new t.j(new Error(`The source '${i}' does not exist in the map's style.`)));const s=o.getSource().type;"geojson"===s&&r?this.fire(new t.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||r?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),o.setFeatureState(r,e.id,n)):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const i=e.source,r=this.sourceCaches[i];if(void 0===r)return void this.fire(new t.j(new Error(`The source '${i}' does not exist in the map's style.`)));const o=r.getSource().type,s="vector"===o?e.sourceLayer:void 0;"vector"!==o||s?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.j(new Error("A feature id is required to remove its specific state property."))):r.removeFeatureState(s,e.id,n):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,i=e.sourceLayer,r=this.sourceCaches[n];if(void 0!==r)return"vector"!==r.getSource().type||i?(void 0===e.id&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),r.getFeatureState(i,e.id)):void this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.j(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=t.aF(this.sourceCaches,(e=>e.serialize())),n=this._serializeByIds(this._order),i=this.map.getTerrain()||void 0,r=this.stylesheet;return t.aG({version:r.version,name:r.name,metadata:r.metadata,light:r.light,center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch,sprite:r.sprite,glyphs:r.glyphs,transition:r.transition,sources:e,layers:n,terrain:i},(e=>void 0!==e))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&"raster"!==this.sourceCaches[e.source].getSource().type&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._layers[e].type,n={},i=[];for(let r=this._order.length-1;r>=0;r--){const o=this._order[r];if(t(o)){n[o]=r;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const r=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(t(s))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(n[t.layer.id]<o)break;r.push(t),i.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)r.push(t.feature)}}return r}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(t.x.filter,"queryRenderedFeatures.filter",n.filter,null,n);const r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.j(new Error("parameters.layers must be an Array."))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];r[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const s=this._serializedAllLayers();for(const t in this.sourceCaches)n.layers&&!r[t]||o.push(U(this.sourceCaches[t],this._layers,s,e,n,i));return this.placement&&o.push(function(e,t,n,i,r,o,s){const a={},l=o.queryRenderedSymbols(i),c=[];for(const e of Object.keys(l).map(Number))c.push(s[e]);c.sort(V);for(const n of c){const i=n.featureIndex.lookupSymbolFeatures(l[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,r.filter,r.layers,r.availableImages,e);for(const e in i){const t=a[e]=a[e]||[],r=i[e];r.sort(((e,t)=>{const i=n.featureSortOrder;if(i){const n=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const t in a)a[t].forEach((i=>{const r=i.feature,o=n[e[t].source].getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=o}));return a}(this._layers,s,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.x.filter,"querySourceFeatures.filter",n.filter,null,n);const i=this.sourceCaches[e];return i?function(e,t){const n=e.getRenderableIds().map((t=>e.getTileByID(t))),i=[],r={};for(let e=0;e<n.length;e++){const o=n[e],s=o.tileID.canonical.key;r[s]||(r[s]=!0,o.querySourceFeatures(i,t))}return i}(i,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const i=this.light.getLight();let r=!1;for(const n in e)if(!t.aE(e[n],i[n])){r=!0;break}if(!r)return;const s={now:o.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(s)}_validate(e,n,i,r,o={}){return(!o||!1!==o.validate)&&at(this,e.call(t.x,t.e({key:n,style:this.serialize(),value:i,styleSpec:t.v},r)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),oe().off(ne,this._rtlPluginLoaded);for(const e in this._layers)this._layers[e].setEventedParent(null);for(const e in this.sourceCaches){const t=this.sourceCaches[e];t.setEventedParent(null),t.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const t in this.sourceCaches)this.sourceCaches[t].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,t,n,i,r=!1){let s=!1,a=!1;const l={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!l[n.source]){const e=this.sourceCaches[n.source];l[n.source]=e.getRenderableIds(!0).map((t=>e.getTileByID(t))).sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const i=this.crossTileSymbolIndex.addLayer(n,l[n.source],e.center.lng);s=s||i}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((r=r||this._layerOrderChanged||0===n)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.now(),e.zoom))&&(this.pauseablePlacement=new tt(e,this.map.terrain,this._order,r,t,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,l),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const e of this._order){const t=this._layers[e];"symbol"===t.type&&this.placement.updateLayerOpacities(t,l[t.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return t._(this,void 0,void 0,(function*(){const e=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const t=this.sourceCaches[n.source];return t&&t.setDependencies(n.tileID.key,n.type,n.icons),e}))}getGlyphs(e,n){return t._(this,void 0,void 0,(function*(){const e=yield this.glyphManager.getGlyphs(n.stacks),t=this.sourceCaches[n.source];return t&&t.setDependencies(n.tileID.key,n.type,[""]),e}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(t.x.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,i={},r){this._checkLoaded();const o=[{id:e,url:n}],s=[...v(this.stylesheet.sprite),...o];this._validate(t.x.sprite,"sprite",s,null,i)||(this.stylesheet.sprite=s,this._loadSprite(o,!0,r))}removeSprite(e){this._checkLoaded();const n=v(this.stylesheet.sprite);if(n.find((t=>t.id===e))){if(this._spritesImagesIds[e])for(const t of this._spritesImagesIds[e])this.imageManager.removeImage(t),this._changedImages[t]=!0;n.splice(n.findIndex((t=>t.id===e)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}else this.fire(new t.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return v(this.stylesheet.sprite)}setSprite(e,n={},i){this._checkLoaded(),e&&this._validate(t.x.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,i):(this._unloadSprite(),i&&i(null)))}}var ut=t.X([{name:"a_pos",type:"Int16",components:2}]),ht="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const dt={prelude:pt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}\n#ifdef TERRAIN3D\nuniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;\n#endif\nconst highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {\n#ifdef TERRAIN3D\nhighp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));\n#else\nreturn 1.0;\n#endif\n}float calculate_visibility(vec4 pos) {\n#ifdef TERRAIN3D\nvec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;\n#else\nreturn 1.0;\n#endif\n}float ele(vec2 pos) {\n#ifdef TERRAIN3D\nvec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;\n#else\nreturn 0.0;\n#endif\n}float get_elevation(vec2 pos) {\n#ifdef TERRAIN3D\nvec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;\n#else\nreturn 0.0;\n#endif\n}"),background:pt("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:pt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:pt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),clippingMask:pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:pt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),heatmapTexture:pt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:pt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:pt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),fillOutline:pt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillOutlinePattern:pt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),fillPattern:pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),fillExtrusion:pt("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),fillExtrusionPattern:pt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;\n#ifdef TERRAIN3D\nattribute vec2 a_centroid;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;\n#ifdef TERRAIN3D\nfloat height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);\n#else\nfloat height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;\n#endif\nbase=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),hillshadePrepare:pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:pt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:pt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),lineGradient:pt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_width2=vec2(outset,inset);}"),linePattern:pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),lineSDF:pt("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifdef TERRAIN3D\nv_gamma_scale=1.0;\n#else\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),raster:pt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:pt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}"),symbolSDF:pt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:pt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrain:pt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ht),terrainDepth:pt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ht),terrainCoords:pt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ht)};function pt(e,t){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=t.match(/attribute ([\w]+) ([\w]+)/g),r=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(r):r,a={};return{fragmentSource:e=e.replace(n,((e,t,n,i,r)=>(a[r]=!0,"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = u_${r};\n#endif\n`))),vertexSource:t=t.replace(n,((e,t,n,i,r)=>{const o="float"===i?"vec2":"vec4",s=r.match(/color/)?"color":o;return a[r]?"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\nvarying ${n} ${i} ${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:"define"===t?`\n#ifndef HAS_UNIFORM_u_${r}\nuniform lowp float u_${r}_t;\nattribute ${n} ${o} a_${r};\n#else\nuniform ${n} ${i} u_${r};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = a_${r};\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${r}\n    ${n} ${i} ${r} = unpack_mix_${s}(a_${r}, u_${r}_t);\n#else\n    ${n} ${i} ${r} = u_${r};\n#endif\n`})),staticAttributes:i,staticUniforms:s}}class ft{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,t,n,i,r,o,s,a,l){this.context=e;let c=this.boundPaintVertexBuffers.length!==i.length;for(let e=0;!c&&e<i.length;e++)this.boundPaintVertexBuffers[e]!==i[e]&&(c=!0);!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==n||c||this.boundIndexBuffer!==r||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==s||this.boundDynamicVertexBuffer2!==a||this.boundDynamicVertexBuffer3!==l?this.freshBind(t,n,i,r,o,s,a,l):(e.bindVertexArray.set(this.vao),s&&s.bind(),r&&r.dynamicDraw&&r.bind(),a&&a.bind(),l&&l.bind())}freshBind(e,t,n,i,r,o,s,a){const l=e.numAttributes,c=this.context,u=c.gl;this.vao&&this.destroy(),this.vao=c.createVertexArray(),c.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=i,this.boundVertexOffset=r,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s,this.boundDynamicVertexBuffer3=a,t.enableAttributes(u,e);for(const t of n)t.enableAttributes(u,e);o&&o.enableAttributes(u,e),s&&s.enableAttributes(u,e),a&&a.enableAttributes(u,e),t.bind(),t.setVertexAttribPointers(u,e,r);for(const t of n)t.bind(),t.setVertexAttribPointers(u,e,r);o&&(o.bind(),o.setVertexAttribPointers(u,e,r)),i&&i.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,e,r)),a&&(a.bind(),a.setVertexAttribPointers(u,e,r)),c.currentNumAttributes=l}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function mt(e){const t=[];for(let n=0;n<e.length;n++){if(null===e[n])continue;const i=e[n].split(" ");t.push(i.pop())}return t}class gt{constructor(e,n,i,r,o,s){const a=e.gl;this.program=a.createProgram();const l=mt(n.staticAttributes),c=i?i.getBinderAttributes():[],u=l.concat(c),h=dt.prelude.staticUniforms?mt(dt.prelude.staticUniforms):[],d=n.staticUniforms?mt(n.staticUniforms):[],p=i?i.getBinderUniforms():[],f=h.concat(d).concat(p),m=[];for(const e of f)m.indexOf(e)<0&&m.push(e);const g=i?i.defines():[];o&&g.push("#define OVERDRAW_INSPECTOR;"),s&&g.push("#define TERRAIN3D;");const _=g.concat(dt.prelude.fragmentSource,n.fragmentSource).join("\n"),y=g.concat(dt.prelude.vertexSource,n.vertexSource).join("\n"),v=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(v,_),a.compileShader(v),!a.getShaderParameter(v,a.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${a.getShaderInfoLog(v)}`);a.attachShader(this.program,v);const b=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);if(a.shaderSource(b,y),a.compileShader(b),!a.getShaderParameter(b,a.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${a.getShaderInfoLog(b)}`);a.attachShader(this.program,b),this.attributes={};const x={};this.numAttributes=u.length;for(let e=0;e<this.numAttributes;e++)u[e]&&(a.bindAttribLocation(this.program,e,u[e]),this.attributes[u[e]]=e);if(a.linkProgram(this.program),!a.getProgramParameter(this.program,a.LINK_STATUS))throw new Error(`Program failed to link: ${a.getProgramInfoLog(this.program)}`);a.deleteShader(b),a.deleteShader(v);for(let e=0;e<m.length;e++){const t=m[e];if(t&&!x[t]){const e=a.getUniformLocation(this.program,t);e&&(x[t]=e)}}this.fixedUniforms=r(e,x),this.terrainUniforms=((e,n)=>({u_depth:new t.aH(e,n.u_depth),u_terrain:new t.aH(e,n.u_terrain),u_terrain_dim:new t.aI(e,n.u_terrain_dim),u_terrain_matrix:new t.aJ(e,n.u_terrain_matrix),u_terrain_unpack:new t.aK(e,n.u_terrain_unpack),u_terrain_exaggeration:new t.aI(e,n.u_terrain_exaggeration)}))(e,x),this.binderUniforms=i?i.getUniforms(e,x):[]}draw(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,_){const y=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(i),e.setColorMode(r),e.setCullFace(o),a){e.activeTexture.set(y.TEXTURE2),y.bindTexture(y.TEXTURE_2D,a.depthTexture),e.activeTexture.set(y.TEXTURE3),y.bindTexture(y.TEXTURE_2D,a.texture);for(const e in this.terrainUniforms)this.terrainUniforms[e].set(a[e])}for(const e in this.fixedUniforms)this.fixedUniforms[e].set(s[e]);f&&f.setUniforms(e,this.binderUniforms,d,{zoom:p});let v=0;switch(t){case y.LINES:v=2;break;case y.TRIANGLES:v=3;break;case y.LINE_STRIP:v=1}for(const n of h.get()){const i=n.vaos||(n.vaos={});(i[l]||(i[l]=new ft)).bind(e,this,c,f?f.getPaintVertexBuffers():[],u,n.vertexOffset,m,g,_),y.drawElements(t,n.primitiveLength*v,y.UNSIGNED_SHORT,n.primitiveOffset*v*2)}}}function _t(e,t,n){const i=1/Le(n,1,t.transform.tileZoom),r=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,t.transform.tileZoom)/r,s=o*(n.tileID.canonical.x+n.tileID.wrap*r),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const yt=(e,n,i,r)=>{const o=n.style.light,s=o.properties.get("position"),a=[s.x,s.y,s.z],l=function(){var e=new t.A(9);return t.A!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}();"viewport"===o.properties.get("anchor")&&function(e,t){var n=Math.sin(t),i=Math.cos(t);e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1}(l,-n.transform.angle),function(e,t,n){var i=t[0],r=t[1],o=t[2];e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8]}(a,a,l);const c=o.properties.get("color");return{u_matrix:e,u_lightpos:a,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+i,u_opacity:r}},vt=(e,n,i,r,o,s,a)=>t.e(yt(e,n,i,r),_t(s,n,a),{u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8}),bt=e=>({u_matrix:e}),xt=(e,n,i,r)=>t.e(bt(e),_t(i,n,r)),wt=(e,t)=>({u_matrix:e,u_world:t}),Et=(e,n,i,r,o)=>t.e(xt(e,n,i,r),{u_world:o}),St=(e,t,n,i)=>{const r=e.transform;let o,s;if("map"===i.paint.get("circle-pitch-alignment")){const e=Le(n,1,r.zoom);o=!0,s=[e,e]}else o=!1,s=r.pixelsToGLUnits;return{u_camera_to_center_distance:r.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(t.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:e.pixelRatio,u_extrude_scale:s}},Tt=(e,t,n)=>({u_matrix:e,u_inv_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}),At=(e,t,n=1)=>({u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:n}),Ct=e=>({u_matrix:e}),Pt=(e,t,n,i)=>({u_matrix:e,u_extrude_scale:Le(t,1,n),u_intensity:i});function It(e,n){const i=Math.pow(2,n.canonical.z),r=n.canonical.y;return[new t.Y(0,r/i).toLngLat().lat,new t.Y(0,(r+1)/i).toLngLat().lat]}const Mt=(e,t,n,i)=>{const r=e.transform;return{u_matrix:Dt(e,t,n,i),u_ratio:1/Le(t,1,r.zoom),u_device_pixel_ratio:e.pixelRatio,u_units_to_pixels:[1/r.pixelsToGLUnits[0],1/r.pixelsToGLUnits[1]]}},Rt=(e,n,i,r,o)=>t.e(Mt(e,n,i,o),{u_image:0,u_image_height:r}),Ot=(e,t,n,i,r)=>{const o=e.transform,s=Lt(t,o);return{u_matrix:Dt(e,t,n,r),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Le(t,1,o.zoom),u_device_pixel_ratio:e.pixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},kt=(e,n,i,r,o,s)=>{const a=e.lineAtlas,l=Lt(n,e.transform),c="round"===i.layout.get("line-cap"),u=a.getDash(r.from,c),h=a.getDash(r.to,c),d=u.width*o.fromScale,p=h.width*o.toScale;return t.e(Mt(e,n,i,s),{u_patternscale_a:[l/d,-u.height/2],u_patternscale_b:[l/p,-h.height/2],u_sdfgamma:a.width/(256*Math.min(d,p)*e.pixelRatio)/2,u_image:0,u_tex_y_a:u.y,u_tex_y_b:h.y,u_mix:o.t})};function Lt(e,t){return 1/Le(e,1,t.tileZoom)}function Dt(e,t,n,i){return e.translatePosMatrix(i?i.posMatrix:t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ft=(e,t,n,i,r)=>{return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:i.mix,u_opacity:i.opacity*r.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:r.paint.get("raster-brightness-min"),u_brightness_high:r.paint.get("raster-brightness-max"),u_saturation_factor:(s=r.paint.get("raster-saturation"),s>0?1-1/(1.001-s):-s),u_contrast_factor:(o=r.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Nt(r.paint.get("raster-hue-rotate"))};var o,s};function Nt(e){e*=Math.PI/180;const t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Bt=(e,t,n,i,r,o,s,a,l,c,u,h,d,p)=>{const f=s.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:f.cameraToCenterDistance,u_pitch:f.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:f.width/f.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:l,u_coord_matrix:c,u_is_text:+h,u_pitch_with_map:+i,u_is_along_line:r,u_is_variable_anchor:o,u_texsize:d,u_texture:0,u_translation:u,u_pitched_scale:p}},zt=(e,n,i,r,o,s,a,l,c,u,h,d,p,f,m)=>{const g=a.transform;return t.e(Bt(e,n,i,r,o,s,a,l,c,u,h,d,p,m),{u_gamma_scale:r?Math.cos(g._pitch)*g.cameraToCenterDistance:1,u_device_pixel_ratio:a.pixelRatio,u_is_halo:+f})},jt=(e,n,i,r,o,s,a,l,c,u,h,d,p,f)=>t.e(zt(e,n,i,r,o,s,a,l,c,u,h,!0,d,!0,f),{u_texsize_icon:p,u_texture_icon:1}),Ut=(e,t,n)=>({u_matrix:e,u_opacity:t,u_color:n}),Vt=(e,n,i,r,o,s)=>t.e(function(e,t,n,i){const r=n.imageManager.getPattern(e.from.toString()),o=n.imageManager.getPattern(e.to.toString()),{width:s,height:a}=n.imageManager.getPixelSize(),l=Math.pow(2,i.tileID.overscaledZ),c=i.tileSize*Math.pow(2,n.transform.tileZoom)/l,u=c*(i.tileID.canonical.x+i.tileID.wrap*l),h=c*i.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:r.tl,u_pattern_br_a:r.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:t.t,u_pattern_size_a:r.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/Le(i,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(r,s,i,o),{u_matrix:e,u_opacity:n}),Gt={fillExtrusion:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_lightpos:new t.aL(e,n.u_lightpos),u_lightintensity:new t.aI(e,n.u_lightintensity),u_lightcolor:new t.aL(e,n.u_lightcolor),u_vertical_gradient:new t.aI(e,n.u_vertical_gradient),u_opacity:new t.aI(e,n.u_opacity)}),fillExtrusionPattern:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_lightpos:new t.aL(e,n.u_lightpos),u_lightintensity:new t.aI(e,n.u_lightintensity),u_lightcolor:new t.aL(e,n.u_lightcolor),u_vertical_gradient:new t.aI(e,n.u_vertical_gradient),u_height_factor:new t.aI(e,n.u_height_factor),u_image:new t.aH(e,n.u_image),u_texsize:new t.aM(e,n.u_texsize),u_pixel_coord_upper:new t.aM(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.aM(e,n.u_pixel_coord_lower),u_scale:new t.aL(e,n.u_scale),u_fade:new t.aI(e,n.u_fade),u_opacity:new t.aI(e,n.u_opacity)}),fill:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix)}),fillPattern:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_image:new t.aH(e,n.u_image),u_texsize:new t.aM(e,n.u_texsize),u_pixel_coord_upper:new t.aM(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.aM(e,n.u_pixel_coord_lower),u_scale:new t.aL(e,n.u_scale),u_fade:new t.aI(e,n.u_fade)}),fillOutline:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_world:new t.aM(e,n.u_world)}),fillOutlinePattern:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_world:new t.aM(e,n.u_world),u_image:new t.aH(e,n.u_image),u_texsize:new t.aM(e,n.u_texsize),u_pixel_coord_upper:new t.aM(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.aM(e,n.u_pixel_coord_lower),u_scale:new t.aL(e,n.u_scale),u_fade:new t.aI(e,n.u_fade)}),circle:(e,n)=>({u_camera_to_center_distance:new t.aI(e,n.u_camera_to_center_distance),u_scale_with_map:new t.aH(e,n.u_scale_with_map),u_pitch_with_map:new t.aH(e,n.u_pitch_with_map),u_extrude_scale:new t.aM(e,n.u_extrude_scale),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_matrix:new t.aJ(e,n.u_matrix)}),collisionBox:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_pixel_extrude_scale:new t.aM(e,n.u_pixel_extrude_scale)}),collisionCircle:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_inv_matrix:new t.aJ(e,n.u_inv_matrix),u_camera_to_center_distance:new t.aI(e,n.u_camera_to_center_distance),u_viewport_size:new t.aM(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.aN(e,n.u_color),u_matrix:new t.aJ(e,n.u_matrix),u_overlay:new t.aH(e,n.u_overlay),u_overlay_scale:new t.aI(e,n.u_overlay_scale)}),clippingMask:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix)}),heatmap:(e,n)=>({u_extrude_scale:new t.aI(e,n.u_extrude_scale),u_intensity:new t.aI(e,n.u_intensity),u_matrix:new t.aJ(e,n.u_matrix)}),heatmapTexture:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_world:new t.aM(e,n.u_world),u_image:new t.aH(e,n.u_image),u_color_ramp:new t.aH(e,n.u_color_ramp),u_opacity:new t.aI(e,n.u_opacity)}),hillshade:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_image:new t.aH(e,n.u_image),u_latrange:new t.aM(e,n.u_latrange),u_light:new t.aM(e,n.u_light),u_shadow:new t.aN(e,n.u_shadow),u_highlight:new t.aN(e,n.u_highlight),u_accent:new t.aN(e,n.u_accent)}),hillshadePrepare:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_image:new t.aH(e,n.u_image),u_dimension:new t.aM(e,n.u_dimension),u_zoom:new t.aI(e,n.u_zoom),u_unpack:new t.aK(e,n.u_unpack)}),line:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_ratio:new t.aI(e,n.u_ratio),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.aM(e,n.u_units_to_pixels)}),lineGradient:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_ratio:new t.aI(e,n.u_ratio),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.aM(e,n.u_units_to_pixels),u_image:new t.aH(e,n.u_image),u_image_height:new t.aI(e,n.u_image_height)}),linePattern:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_texsize:new t.aM(e,n.u_texsize),u_ratio:new t.aI(e,n.u_ratio),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_image:new t.aH(e,n.u_image),u_units_to_pixels:new t.aM(e,n.u_units_to_pixels),u_scale:new t.aL(e,n.u_scale),u_fade:new t.aI(e,n.u_fade)}),lineSDF:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_ratio:new t.aI(e,n.u_ratio),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.aM(e,n.u_units_to_pixels),u_patternscale_a:new t.aM(e,n.u_patternscale_a),u_patternscale_b:new t.aM(e,n.u_patternscale_b),u_sdfgamma:new t.aI(e,n.u_sdfgamma),u_image:new t.aH(e,n.u_image),u_tex_y_a:new t.aI(e,n.u_tex_y_a),u_tex_y_b:new t.aI(e,n.u_tex_y_b),u_mix:new t.aI(e,n.u_mix)}),raster:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_tl_parent:new t.aM(e,n.u_tl_parent),u_scale_parent:new t.aI(e,n.u_scale_parent),u_buffer_scale:new t.aI(e,n.u_buffer_scale),u_fade_t:new t.aI(e,n.u_fade_t),u_opacity:new t.aI(e,n.u_opacity),u_image0:new t.aH(e,n.u_image0),u_image1:new t.aH(e,n.u_image1),u_brightness_low:new t.aI(e,n.u_brightness_low),u_brightness_high:new t.aI(e,n.u_brightness_high),u_saturation_factor:new t.aI(e,n.u_saturation_factor),u_contrast_factor:new t.aI(e,n.u_contrast_factor),u_spin_weights:new t.aL(e,n.u_spin_weights)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.aH(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aH(e,n.u_is_size_feature_constant),u_size_t:new t.aI(e,n.u_size_t),u_size:new t.aI(e,n.u_size),u_camera_to_center_distance:new t.aI(e,n.u_camera_to_center_distance),u_pitch:new t.aI(e,n.u_pitch),u_rotate_symbol:new t.aH(e,n.u_rotate_symbol),u_aspect_ratio:new t.aI(e,n.u_aspect_ratio),u_fade_change:new t.aI(e,n.u_fade_change),u_matrix:new t.aJ(e,n.u_matrix),u_label_plane_matrix:new t.aJ(e,n.u_label_plane_matrix),u_coord_matrix:new t.aJ(e,n.u_coord_matrix),u_is_text:new t.aH(e,n.u_is_text),u_pitch_with_map:new t.aH(e,n.u_pitch_with_map),u_is_along_line:new t.aH(e,n.u_is_along_line),u_is_variable_anchor:new t.aH(e,n.u_is_variable_anchor),u_texsize:new t.aM(e,n.u_texsize),u_texture:new t.aH(e,n.u_texture),u_translation:new t.aM(e,n.u_translation),u_pitched_scale:new t.aI(e,n.u_pitched_scale)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.aH(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aH(e,n.u_is_size_feature_constant),u_size_t:new t.aI(e,n.u_size_t),u_size:new t.aI(e,n.u_size),u_camera_to_center_distance:new t.aI(e,n.u_camera_to_center_distance),u_pitch:new t.aI(e,n.u_pitch),u_rotate_symbol:new t.aH(e,n.u_rotate_symbol),u_aspect_ratio:new t.aI(e,n.u_aspect_ratio),u_fade_change:new t.aI(e,n.u_fade_change),u_matrix:new t.aJ(e,n.u_matrix),u_label_plane_matrix:new t.aJ(e,n.u_label_plane_matrix),u_coord_matrix:new t.aJ(e,n.u_coord_matrix),u_is_text:new t.aH(e,n.u_is_text),u_pitch_with_map:new t.aH(e,n.u_pitch_with_map),u_is_along_line:new t.aH(e,n.u_is_along_line),u_is_variable_anchor:new t.aH(e,n.u_is_variable_anchor),u_texsize:new t.aM(e,n.u_texsize),u_texture:new t.aH(e,n.u_texture),u_gamma_scale:new t.aI(e,n.u_gamma_scale),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_is_halo:new t.aH(e,n.u_is_halo),u_translation:new t.aM(e,n.u_translation),u_pitched_scale:new t.aI(e,n.u_pitched_scale)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.aH(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.aH(e,n.u_is_size_feature_constant),u_size_t:new t.aI(e,n.u_size_t),u_size:new t.aI(e,n.u_size),u_camera_to_center_distance:new t.aI(e,n.u_camera_to_center_distance),u_pitch:new t.aI(e,n.u_pitch),u_rotate_symbol:new t.aH(e,n.u_rotate_symbol),u_aspect_ratio:new t.aI(e,n.u_aspect_ratio),u_fade_change:new t.aI(e,n.u_fade_change),u_matrix:new t.aJ(e,n.u_matrix),u_label_plane_matrix:new t.aJ(e,n.u_label_plane_matrix),u_coord_matrix:new t.aJ(e,n.u_coord_matrix),u_is_text:new t.aH(e,n.u_is_text),u_pitch_with_map:new t.aH(e,n.u_pitch_with_map),u_is_along_line:new t.aH(e,n.u_is_along_line),u_is_variable_anchor:new t.aH(e,n.u_is_variable_anchor),u_texsize:new t.aM(e,n.u_texsize),u_texsize_icon:new t.aM(e,n.u_texsize_icon),u_texture:new t.aH(e,n.u_texture),u_texture_icon:new t.aH(e,n.u_texture_icon),u_gamma_scale:new t.aI(e,n.u_gamma_scale),u_device_pixel_ratio:new t.aI(e,n.u_device_pixel_ratio),u_is_halo:new t.aH(e,n.u_is_halo),u_translation:new t.aM(e,n.u_translation),u_pitched_scale:new t.aI(e,n.u_pitched_scale)}),background:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_opacity:new t.aI(e,n.u_opacity),u_color:new t.aN(e,n.u_color)}),backgroundPattern:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_opacity:new t.aI(e,n.u_opacity),u_image:new t.aH(e,n.u_image),u_pattern_tl_a:new t.aM(e,n.u_pattern_tl_a),u_pattern_br_a:new t.aM(e,n.u_pattern_br_a),u_pattern_tl_b:new t.aM(e,n.u_pattern_tl_b),u_pattern_br_b:new t.aM(e,n.u_pattern_br_b),u_texsize:new t.aM(e,n.u_texsize),u_mix:new t.aI(e,n.u_mix),u_pattern_size_a:new t.aM(e,n.u_pattern_size_a),u_pattern_size_b:new t.aM(e,n.u_pattern_size_b),u_scale_a:new t.aI(e,n.u_scale_a),u_scale_b:new t.aI(e,n.u_scale_b),u_pixel_coord_upper:new t.aM(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.aM(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.aI(e,n.u_tile_units_to_pixels)}),terrain:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_texture:new t.aH(e,n.u_texture),u_ele_delta:new t.aI(e,n.u_ele_delta)}),terrainDepth:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_ele_delta:new t.aI(e,n.u_ele_delta)}),terrainCoords:(e,n)=>({u_matrix:new t.aJ(e,n.u_matrix),u_texture:new t.aH(e,n.u_texture),u_terrain_coords_id:new t.aI(e,n.u_terrain_coords_id),u_ele_delta:new t.aI(e,n.u_ele_delta)})};class $t{constructor(e,t,n){this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Wt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ht{constructor(e,t,n,i){this.length=t.length,this.attributes=n,this.itemSize=t.bytesPerElement,this.dynamicDraw=i,this.context=e;const r=e.gl;this.buffer=r.createBuffer(),e.bindVertexBuffer.set(this.buffer),r.bufferData(r.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let n=0;n<this.attributes.length;n++){const i=t.attributes[this.attributes[n].name];void 0!==i&&e.enableVertexAttribArray(i)}}setVertexAttribPointers(e,t,n){for(let i=0;i<this.attributes.length;i++){const r=this.attributes[i],o=t.attributes[r.name];void 0!==o&&e.vertexAttribPointer(o,r.components,e[Wt[r.type]],!1,this.itemSize,r.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qt=new WeakMap;function Xt(e){var t;if(qt.has(e))return qt.get(e);{const n=null===(t=e.getParameter(e.VERSION))||void 0===t?void 0:t.startsWith("WebGL 2.0");return qt.set(e,n),n}}class Zt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yt extends Zt{getDefault(){return t.aP.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Kt extends Zt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Jt extends Zt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Qt extends Zt{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class en extends Zt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class tn extends Zt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class nn extends Zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class rn extends Zt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class on extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class sn extends Zt{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class an extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class ln extends Zt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class cn extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class un extends Zt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class hn extends Zt{getDefault(){return t.aP.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class dn extends Zt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class pn extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class fn extends Zt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class mn extends Zt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class gn extends Zt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class _n extends Zt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class yn extends Zt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class vn extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class bn extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class xn extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class wn extends Zt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class En extends Zt{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Sn extends Zt{getDefault(){return null}set(e){var t;if(e===this.current&&!this.dirty)return;const n=this.gl;Xt(n)?n.bindVertexArray(e):null===(t=n.getExtension("OES_vertex_array_object"))||void 0===t||t.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Tn extends Zt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class An extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Cn extends Zt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Pn extends Zt{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class In extends Pn{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Mn extends Pn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rn extends Pn{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class On{constructor(e,t,n,i,r){this.context=e,this.width=t,this.height=n;const o=e.gl,s=this.framebuffer=o.createFramebuffer();if(this.colorAttachment=new In(e,s),i)this.depthAttachment=r?new Rn(e,s):new Mn(e,s);else if(r)throw new Error("Stencil cannot be set without depth");if(o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}e.deleteFramebuffer(this.framebuffer)}}class kn{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}kn.Replace=[1,0],kn.disabled=new kn(kn.Replace,t.aP.transparent,[!1,!1,!1,!1]),kn.unblended=new kn(kn.Replace,t.aP.transparent,[!0,!0,!0,!0]),kn.alphaBlended=new kn([1,771],t.aP.transparent,[!0,!0,!0,!0]);class Ln{constructor(e){var t,n;if(this.gl=e,this.clearColor=new Yt(this),this.clearDepth=new Kt(this),this.clearStencil=new Jt(this),this.colorMask=new Qt(this),this.depthMask=new en(this),this.stencilMask=new tn(this),this.stencilFunc=new nn(this),this.stencilOp=new rn(this),this.stencilTest=new on(this),this.depthRange=new sn(this),this.depthTest=new an(this),this.depthFunc=new ln(this),this.blend=new cn(this),this.blendFunc=new un(this),this.blendColor=new hn(this),this.blendEquation=new dn(this),this.cullFace=new pn(this),this.cullFaceSide=new fn(this),this.frontFace=new mn(this),this.program=new gn(this),this.activeTexture=new _n(this),this.viewport=new yn(this),this.bindFramebuffer=new vn(this),this.bindRenderbuffer=new bn(this),this.bindTexture=new xn(this),this.bindVertexBuffer=new wn(this),this.bindElementBuffer=new En(this),this.bindVertexArray=new Sn(this),this.pixelStoreUnpack=new Tn(this),this.pixelStoreUnpackPremultiplyAlpha=new An(this),this.pixelStoreUnpackFlipY=new Cn(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Xt(e)){this.HALF_FLOAT=e.HALF_FLOAT;const i=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=null!==(t=e.RGBA16F)&&void 0!==t?t:null==i?void 0:i.RGBA16F_EXT,this.RGB16F=null!==(n=e.RGB16F)&&void 0!==n?n:null==i?void 0:i.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const t=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=null==t?void 0:t.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t){return new $t(this,e,t)}createVertexBuffer(e,t,n){return new Ht(this,e,t,n)}createRenderbuffer(e,t,n){const i=this.gl,r=i.createRenderbuffer();return this.bindRenderbuffer.set(r),i.renderbufferStorage(i.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),r}createFramebuffer(e,t,n,i){return new On(this,e,t,n,i)}clear({color:e,depth:t,stencil:n}){const i=this.gl;let r=0;e&&(r|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==t&&(r|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(t),this.depthMask.set(!0)),void 0!==n&&(r|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),i.clear(r)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t.aE(e.blendFunction,kn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Xt(this.gl)?this.gl.createVertexArray():null===(e=this.gl.getExtension("OES_vertex_array_object"))||void 0===e?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var t;return Xt(this.gl)?this.gl.deleteVertexArray(e):null===(t=this.gl.getExtension("OES_vertex_array_object"))||void 0===t?void 0:t.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class Dn{constructor(e,t,n){this.func=e,this.mask=t,this.range=n}}Dn.ReadOnly=!1,Dn.ReadWrite=!0,Dn.disabled=new Dn(519,Dn.ReadOnly,[0,1]);const Fn=7680;class Nn{constructor(e,t,n,i,r,o){this.test=e,this.ref=t,this.mask=n,this.fail=i,this.depthFail=r,this.pass=o}}Nn.disabled=new Nn({func:519,mask:0},0,0,Fn,Fn,Fn);class Bn{constructor(e,t,n){this.enable=e,this.mode=t,this.frontFace=n}}let zn;function jn(e,n,i,r,o){const s=e.context,a=s.gl,l=e.useProgram("collisionBox"),c=[];let u=0,h=0;for(let p=0;p<r.length;p++){const f=r[p],m=n.getTile(f).getBucket(i);if(!m)continue;const g=o?m.textCollisionBox:m.iconCollisionBox,_=m.collisionCircleArray;if(_.length>0){const n=t.F();t.aQ(n,m.placementInvProjMatrix,e.transform.glCoordMatrix),t.aQ(n,n,m.placementViewportMatrix),c.push({circleArray:_,circleOffset:h,transform:f.posMatrix,invTransform:n,coord:f}),u+=_.length/4,h=u}g&&l.draw(s,a.LINES,Dn.disabled,Nn.disabled,e.colorModeForRenderPass(),Bn.disabled,{u_matrix:f.posMatrix,u_pixel_extrude_scale:[1/(d=e.transform).width,1/d.height]},e.style.map.terrain&&e.style.map.terrain.getTerrainData(f),i.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,null,e.transform.zoom,null,null,g.collisionVertexBuffer)}var d;if(!o||!c.length)return;const p=e.useProgram("collisionCircle"),f=new t.aR;f.resize(4*u),f._trim();let m=0;for(const e of c)for(let t=0;t<e.circleArray.length/4;t++){const n=4*t,i=e.circleArray[n+0],r=e.circleArray[n+1],o=e.circleArray[n+2],s=e.circleArray[n+3];f.emplace(m++,i,r,o,s,0),f.emplace(m++,i,r,o,s,1),f.emplace(m++,i,r,o,s,2),f.emplace(m++,i,r,o,s,3)}(!zn||zn.length<2*u)&&(zn=function(e){const n=2*e,i=new t.aT;i.resize(n),i._trim();for(let e=0;e<n;e++){const t=6*e;i.uint16[t+0]=4*e+0,i.uint16[t+1]=4*e+1,i.uint16[t+2]=4*e+2,i.uint16[t+3]=4*e+2,i.uint16[t+4]=4*e+3,i.uint16[t+5]=4*e+0}return i}(u));const g=s.createIndexBuffer(zn,!0),_=s.createVertexBuffer(f,t.aS.members,!0);for(const n of c){const r=Tt(n.transform,n.invTransform,e.transform);p.draw(s,a.TRIANGLES,Dn.disabled,Nn.disabled,e.colorModeForRenderPass(),Bn.disabled,r,e.style.map.terrain&&e.style.map.terrain.getTerrainData(n.coord),i.id,_,g,t.$.simpleSegment(0,2*n.circleOffset,n.circleArray.length,n.circleArray.length/2),null,e.transform.zoom,null,null,null)}_.destroy(),g.destroy()}Bn.disabled=new Bn(!1,1029,2305),Bn.backCCW=new Bn(!0,1029,2305);const Un=t.an(new Float32Array(16));function Vn(e,n,i,r,o,s){const{horizontalAlign:a,verticalAlign:l}=t.au(e);return new t.P((-(a-.5)*n/o+r[0])*s,(-(l-.5)*i/o+r[1])*s)}function Gn(e,n,i,r,o,s){const a=n.tileAnchorPoint.add(new t.P(n.translation[0],n.translation[1]));if(n.pitchWithMap){let e=r.mult(s);return i||(e=e.rotate(-o)),_e(a.add(e),n.labelPlaneMatrix,n.getElevation).point}if(i){const t=Ae(n.tileAnchorPoint.x+1,n.tileAnchorPoint.y,n).point.sub(e),i=Math.atan(t.y/t.x)+(t.x<0?Math.PI:0);return e.add(r.rotate(i))}return e.add(r)}function $n(e,n,i,r,o,s,a,l,c,u,h,d,p,f){const m=e.text.placedSymbolArray,g=e.text.dynamicLayoutVertexArray,_=e.icon.dynamicLayoutVertexArray,y={};g.clear();for(let _=0;_<m.length;_++){const v=m.get(_),b=v.hidden||!v.crossTileID||e.allowVerticalPlacement&&!v.placedOrientation?null:r[v.crossTileID];if(b){const r=new t.P(v.anchorX,v.anchorY),m={getElevation:f,width:o.width,height:o.height,labelPlaneMatrix:s,lineVertexArray:null,pitchWithMap:i,projection:h,projectionCache:null,tileAnchorPoint:r,translation:d,unwrappedTileID:p},_=i?_e(r,a,f):Ae(r.x,r.y,m),x=ye(o.cameraToCenterDistance,_.signedDistanceFromCamera);let w=t.ai(e.textSizeData,c,v)*x/t.ap;i&&(w*=e.tilePixelRatio/l);const{width:E,height:S,anchor:T,textOffset:A,textBoxScale:C}=b,P=Vn(T,E,S,A,C,w),I=h.getPitchedTextCorrection(o,r.add(new t.P(d[0],d[1])),p),M=Gn(_.point,m,n,P,o.angle,I),R=e.allowVerticalPlacement&&v.placedOrientation===t.ah.vertical?Math.PI/2:0;for(let e=0;e<v.numGlyphs;e++)t.aj(g,M,R);u&&v.associatedIconIndex>=0&&(y[v.associatedIconIndex]={shiftedAnchor:M,angle:R})}else Re(v.numGlyphs,g)}if(u){_.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const i=n.get(e);if(i.hidden)Re(i.numGlyphs,_);else{const n=y[e];if(n)for(let e=0;e<i.numGlyphs;e++)t.aj(_,n.shiftedAnchor,n.angle);else Re(i.numGlyphs,_)}}e.icon.dynamicLayoutVertexBuffer.updateData(_)}e.text.dynamicLayoutVertexBuffer.updateData(g)}function Wn(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Hn(e,n,i,r,o,s,a,l,c,u,h,d){const p=e.context,f=p.gl,m=e.transform,g=Qe(),_="map"===l,y="map"===c,v="viewport"!==l&&"point"!==i.layout.get("symbol-placement"),b=_&&!y&&!v,x=!y&&v,w=!i.layout.get("symbol-sort-key").isConstant();let E=!1;const S=e.depthModeForSublayer(0,Dn.ReadOnly),T=i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=[],C=g.getCircleRadiusCorrection(m);for(const l of r){const r=n.getTile(l),c=r.getBucket(i);if(!c)continue;const h=o?c.text:c.icon;if(!h||!h.segments.get().length||!h.hasVisibleVertices)continue;const d=h.programConfigurations.get(i.id),p=o||c.sdfIcons,S=o?c.textSizeData:c.iconSizeData,P=y||0!==m.pitch,I=e.useProgram(Wn(p,o,c),d),M=t.ag(S,m.zoom),R=e.style.map.terrain&&e.style.map.terrain.getTerrainData(l);let O,k,L,D,F=[0,0],N=null;if(o)k=r.glyphAtlasTexture,L=f.LINEAR,O=r.glyphAtlasTexture.size,c.iconsInText&&(F=r.imageAtlasTexture.size,N=r.imageAtlasTexture,D=P||e.options.rotating||e.options.zooming||"composite"===S.kind||"camera"===S.kind?f.LINEAR:f.NEAREST);else{const t=1!==i.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;k=r.imageAtlasTexture,L=p||e.options.rotating||e.options.zooming||t||P?f.LINEAR:f.NEAREST,O=r.imageAtlasTexture.size}const B=Le(r,1,e.transform.zoom),z=x?l.posMatrix:Un,j=me(z,y,_,e.transform,B),U=ge(z,y,_,e.transform,B),V=ge(l.posMatrix,y,_,e.transform,B),G=g.translatePosition(e.transform,r,s,a),$=T&&c.hasTextData(),W="none"!==i.layout.get("icon-text-fit")&&$&&c.hasIconData();if(v){const t=e.style.map.terrain?(t,n)=>e.style.map.terrain.getElevation(l,t,n):null,n="map"===i.layout.get("text-rotation-alignment");be(c,l.posMatrix,e,o,j,V,y,u,n,g,l.toUnwrapped(),m.width,m.height,G,t)}const H=l.posMatrix,q=o&&T||W,X=v||q?Un:j,Z=U,Y=p&&0!==i.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let K;K=p?c.iconsInText?jt(S.kind,M,b,y,v,q,e,H,X,Z,G,O,F,C):zt(S.kind,M,b,y,v,q,e,H,X,Z,G,o,O,!0,C):Bt(S.kind,M,b,y,v,q,e,H,X,Z,G,o,O,C);const J={program:I,buffers:h,uniformValues:K,atlasTexture:k,atlasTextureIcon:N,atlasInterpolation:L,atlasInterpolationIcon:D,isSDF:p,hasHalo:Y};if(w&&c.canOverlap){E=!0;const e=h.segments.get();for(const n of e)A.push({segments:new t.$([n]),sortKey:n.sortKey,state:J,terrainData:R})}else A.push({segments:h.segments,sortKey:0,state:J,terrainData:R})}E&&A.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of A){const n=t.state;if(p.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const r=n.uniformValues;n.hasHalo&&(r.u_is_halo=1,qn(n.buffers,t.segments,i,e,n.program,S,h,d,r,t.terrainData)),r.u_is_halo=0}qn(n.buffers,t.segments,i,e,n.program,S,h,d,n.uniformValues,t.terrainData)}}function qn(e,t,n,i,r,o,s,a,l,c){const u=i.context;r.draw(u,u.gl.TRIANGLES,o,s,a,Bn.disabled,l,c,n.id,e.layoutVertexBuffer,e.indexBuffer,t,n.paint,i.transform.zoom,e.programConfigurations.get(n.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function Xn(e,t,n,i,r){if(!n||!i||!i.imageAtlas)return;const o=i.imageAtlas.patternPositions;let s=o[n.to.toString()],a=o[n.from.toString()];if(!s&&a&&(s=a),!a&&s&&(a=s),!s||!a){const e=r.getPaintProperty(t);s=o[e],a=o[e]}s&&a&&e.setConstantPatternPositions(s,a)}function Zn(e,t,n,i,r,o,s){const a=e.context.gl,l="fill-pattern",c=n.paint.get(l),u=c&&c.constantOr(1),h=n.getCrossfadeParameters();let d,p,f,m,g;s?(p=u&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=a.LINES):(p=u?"fillPattern":"fill",d=a.TRIANGLES);const _=c.constantOr(null);for(const c of i){const i=t.getTile(c);if(u&&!i.patternsLoaded())continue;const y=i.getBucket(n);if(!y)continue;const v=y.programConfigurations.get(n.id),b=e.useProgram(p,v),x=e.style.map.terrain&&e.style.map.terrain.getTerrainData(c);u&&(e.context.activeTexture.set(a.TEXTURE0),i.imageAtlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),v.updatePaintBuffers(h)),Xn(v,l,_,i,n);const w=x?c:null,E=e.translatePosMatrix(w?w.posMatrix:c.posMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(s){m=y.indexBuffer2,g=y.segments2;const t=[a.drawingBufferWidth,a.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Et(E,e,h,i,t):wt(E,t)}else m=y.indexBuffer,g=y.segments,f=u?xt(E,e,h,i):bt(E);b.draw(e.context,d,r,e.stencilModeForClipping(c),o,Bn.disabled,f,x,n.id,y.layoutVertexBuffer,m,g,n.paint,e.transform.zoom,v)}}function Yn(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c="fill-extrusion-pattern",u=n.paint.get(c),h=u.constantOr(1),d=n.getCrossfadeParameters(),p=n.paint.get("fill-extrusion-opacity"),f=u.constantOr(null);for(const u of i){const i=t.getTile(u),m=i.getBucket(n);if(!m)continue;const g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(u),_=m.programConfigurations.get(n.id),y=e.useProgram(h?"fillExtrusionPattern":"fillExtrusion",_);h&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),_.updatePaintBuffers(d)),Xn(_,c,f,i,n);const v=e.translatePosMatrix(u.posMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),b=n.paint.get("fill-extrusion-vertical-gradient"),x=h?vt(v,e,b,p,u,d,i):yt(v,e,b,p);y.draw(a,a.gl.TRIANGLES,r,o,s,Bn.backCCW,x,g,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,_,e.style.map.terrain&&m.centroidVertexBuffer)}}function Kn(e,t,n,i,r,o,s){const a=e.context,l=a.gl,c=n.fbo;if(!c)return;const u=e.useProgram("hillshade"),h=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t);a.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.colorAttachment.get()),u.draw(a,l.TRIANGLES,r,o,s,Bn.disabled,((e,t,n,i)=>{const r=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color");let a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=e.transform.angle);const l=!e.options.moving;return{u_matrix:i?i.posMatrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:It(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:r,u_highlight:o,u_accent:s}})(e,n,i,h?t:null),h,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}function Jn(e,n,i,r,o,s){const a=e.context,l=a.gl,c=n.dem;if(c&&c.data){const u=c.dim,h=c.stride,d=c.getPixels();if(a.activeTexture.set(l.TEXTURE1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){const e=n.demTexture;e.update(d,{premultiply:!1}),e.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else n.demTexture=new x(a,d,l.RGBA,{premultiply:!1}),n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);a.activeTexture.set(l.TEXTURE0);let p=n.fbo;if(!p){const e=new x(a,{width:u,height:u,data:null},l.RGBA);e.bind(l.LINEAR,l.CLAMP_TO_EDGE),p=n.fbo=a.createFramebuffer(u,u,!0,!1),p.colorAttachment.set(e.texture)}a.bindFramebuffer.set(p.framebuffer),a.viewport.set([0,0,u,u]),e.useProgram("hillshadePrepare").draw(a,l.TRIANGLES,r,o,s,Bn.disabled,((e,n)=>{const i=n.stride,r=t.F();return t.aO(r,0,t.W,-t.W,0,0,1),t.H(r,r,[0,-t.W,0]),{u_matrix:r,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}})(n.tileID,c),null,i.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Qn(e,n,i,r,s,a){const l=r.paint.get("raster-fade-duration");if(!a&&l>0){const r=o.now(),a=(r-e.timeAdded)/l,c=n?(r-n.timeAdded)/l:-1,u=i.getSource(),h=s.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),d=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=d&&e.refreshedUponExpiration?1:t.ac(d?a:1-c,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}const ei=new t.aP(1,0,0,1),ti=new t.aP(0,1,0,1),ni=new t.aP(0,0,1,1),ii=new t.aP(1,0,1,1),ri=new t.aP(0,1,1,1);function oi(e,t,n,i){ai(e,0,t+n/2,e.transform.width,n,i)}function si(e,t,n,i){ai(e,t-n/2,0,n,e.transform.height,i)}function ai(e,t,n,i,r,o){const s=e.context,a=s.gl;a.enable(a.SCISSOR_TEST),a.scissor(t*e.pixelRatio,n*e.pixelRatio,i*e.pixelRatio,r*e.pixelRatio),s.clear({color:o}),a.disable(a.SCISSOR_TEST)}function li(e,n,i){const r=e.context,o=r.gl,s=i.posMatrix,a=e.useProgram("debug"),l=Dn.disabled,c=Nn.disabled,u=e.colorModeForRenderPass(),h="$debug",d=e.style.map.terrain&&e.style.map.terrain.getTerrainData(i);r.activeTexture.set(o.TEXTURE0);const p=n.getTileByID(i.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),m=n.getTile(i).tileSize,g=512/Math.min(m,512)*(i.overscaledZ/e.transform.zoom)*.5;let _=i.canonical.toString();i.overscaledZ!==i.canonical.z&&(_+=` => ${i.overscaledZ}`),function(e,t){e.initDebugOverlayCanvas();const n=e.debugOverlayCanvas,i=e.context.gl,r=e.debugOverlayCanvas.getContext("2d");r.clearRect(0,0,n.width,n.height),r.shadowColor="white",r.shadowBlur=2,r.lineWidth=1.5,r.strokeStyle="white",r.textBaseline="top",r.font="bold 36px Open Sans, sans-serif",r.fillText(t,5,5),r.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)}(e,`${_} ${f}kB`),a.draw(r,o.TRIANGLES,l,c,kn.alphaBlended,Bn.disabled,At(s,t.aP.transparent,g),null,h,e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments),a.draw(r,o.LINE_STRIP,l,c,u,Bn.disabled,At(s,t.aP.red),d,h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments)}function ci(e,t,n){const i=e.context,r=i.gl,o=e.colorModeForRenderPass(),s=new Dn(r.LEQUAL,Dn.ReadWrite,e.depthRangeFor3D),a=e.useProgram("terrain"),l=t.getTerrainMesh();i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height]);for(const c of n){const n=e.renderToTexture.getTexture(c),u=t.getTerrainData(c.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,n.texture);const h={u_matrix:e.transform.calculatePosMatrix(c.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(e.transform.zoom)};a.draw(i,r.TRIANGLES,s,Nn.disabled,o,Bn.backCCW,h,u,"terrain",l.vertexBuffer,l.indexBuffer,l.segments)}}class ui{constructor(e,n){this.context=new Ln(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ce.maxUnderzooming+ce.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new st}resize(e,t,n){if(this.width=Math.floor(e*n),this.height=Math.floor(t*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style._order)this.style._layers[e].resize()}setup(){const e=this.context,n=new t.aW;n.emplaceBack(0,0),n.emplaceBack(t.W,0),n.emplaceBack(0,t.W),n.emplaceBack(t.W,t.W),this.tileExtentBuffer=e.createVertexBuffer(n,ut.members),this.tileExtentSegments=t.$.simpleSegment(0,0,4,2);const i=new t.aW;i.emplaceBack(0,0),i.emplaceBack(t.W,0),i.emplaceBack(0,t.W),i.emplaceBack(t.W,t.W),this.debugBuffer=e.createVertexBuffer(i,ut.members),this.debugSegments=t.$.simpleSegment(0,0,4,5);const r=new t.Z;r.emplaceBack(0,0,0,0),r.emplaceBack(t.W,0,t.W,0),r.emplaceBack(0,t.W,0,t.W),r.emplaceBack(t.W,t.W,t.W,t.W),this.rasterBoundsBuffer=e.createVertexBuffer(r,Y.members),this.rasterBoundsSegments=t.$.simpleSegment(0,0,4,2);const o=new t.aW;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,ut.members),this.viewportSegments=t.$.simpleSegment(0,0,4,2);const s=new t.aX;s.emplaceBack(0),s.emplaceBack(1),s.emplaceBack(3),s.emplaceBack(2),s.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(s);const a=new t.aY;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(a);const l=this.context.gl;this.stencilClearMode=new Nn({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const i=t.F();t.aO(i,0,this.width,this.height,0,0,1),t.J(i,i,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Dn.disabled,this.stencilClearMode,kn.disabled,Bn.disabled,Ct(i),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,t){if(this.currentStencilSource===e.source||!e.isTileClipped()||!t||!t.length)return;this.currentStencilSource=e.source;const n=this.context,i=n.gl;this.nextStencilID+t.length>256&&this.clearStencil(),n.setColorMode(kn.disabled),n.setDepthMode(Dn.disabled);const r=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const e of t){const t=this._tileClippingMaskIDs[e.key]=this.nextStencilID++,o=this.style.map.terrain&&this.style.map.terrain.getTerrainData(e);r.draw(n,i.TRIANGLES,Dn.disabled,new Nn({func:i.ALWAYS,mask:0},t,255,i.KEEP,i.KEEP,i.REPLACE),kn.disabled,Bn.disabled,Ct(e.posMatrix),o,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Nn({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){const t=this.context.gl;return new Nn({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,n=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),i=n[n.length-1].overscaledZ,r=n[0].overscaledZ-i+1;if(r>1){this.currentStencilSource=void 0,this.nextStencilID+r>256&&this.clearStencil();const e={};for(let n=0;n<r;n++)e[n+i]=new Nn({func:t.GEQUAL,mask:255},n+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=r,[e,n]}return[{[i]:Nn.disabled},n]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new kn([e.CONSTANT_COLOR,e.ONE],new t.aP(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?kn.unblended:kn.alphaBlended}depthModeForSublayer(e,t,n){if(!this.opaquePassEnabledForLayer())return Dn.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Dn(n||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(o.now()),this.imageManager.beginFrame();const i=this.style._order,r=this.style.sourceCaches,s={},a={},l={};for(const e in r){const t=r[e];t.used&&t.prepare(this.context),s[e]=t.getVisibleCoordinates(),a[e]=s[e].slice().reverse(),l[e]=t.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let e=0;e<i.length;e++)if(this.style._layers[i[e]].is3D()){this.opaquePassCutoff=e;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const e of i){const t=this.style._layers[e];if(!t.hasOffscreenPass()||t.isHidden(this.transform.zoom))continue;const n=a[t.source];("custom"===t.type||n.length)&&this.renderLayer(this,r[t.source],t,n)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.aP.black:t.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){const e=this.style._layers[i[this.currentLayer]],t=r[e.source],n=s[e.source];this._renderTileClippingMasks(e,n),this.renderLayer(this,t,e,n)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){const e=this.style._layers[i[this.currentLayer]],t=r[e.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(e))continue;const n=("symbol"===e.type?l:a)[e.source];this._renderTileClippingMasks(e,s[e.source]),this.renderLayer(this,t,e,n)}if(this.options.showTileBoundaries){const e=function(e,t){let n=null;const i=Object.values(e._layers).flatMap((n=>n.source&&!n.isHidden(t)?[e.sourceCaches[n.source]]:[])),r=i.filter((e=>"vector"===e.getSource().type)),o=i.filter((e=>"vector"!==e.getSource().type)),s=e=>{(!n||n.getSource().maxzoom<e.getSource().maxzoom)&&(n=e)};return r.forEach((e=>s(e))),n||o.forEach((e=>s(e))),n}(this.style,this.transform.zoom);e&&function(e,t,n){for(let i=0;i<n.length;i++)li(e,t,n[i])}(this,e,e.getVisibleCoordinates())}this.options.showPadding&&function(e){const t=e.transform.padding;oi(e,e.transform.height-(t.top||0),3,ei),oi(e,t.bottom||0,3,ti),si(e,t.left||0,3,ni),si(e,e.transform.width-(t.right||0),3,ii);const n=e.transform.centerPoint;!function(e,t,n,i){ai(e,t-1,n-10,2,20,i),ai(e,t-10,n-1,20,2,i)}(e,n.x,e.transform.height-n.y,ri)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,i=this.transform.projMatrix;let r=this.terrainFacilitator.dirty;r||(r=e?!t.aZ(n,i):!t.a_(n,i)),r||(r=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),r&&(t.a$(n,i),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(e,n){const i=e.context,r=i.gl,o=kn.unblended,s=new Dn(r.LEQUAL,Dn.ReadWrite,[0,1]),a=n.getTerrainMesh(),l=n.sourceCache.getRenderableTiles(),c=e.useProgram("terrainDepth");i.bindFramebuffer.set(n.getFramebuffer("depth").framebuffer),i.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),i.clear({color:t.aP.transparent,depth:1});for(const t of l){const l=n.getTerrainData(t.tileID),u={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_ele_delta:n.getMeshFrameDelta(e.transform.zoom)};c.draw(i,r.TRIANGLES,s,Nn.disabled,o,Bn.backCCW,u,l,"terrain",a.vertexBuffer,a.indexBuffer,a.segments)}i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain),function(e,n){const i=e.context,r=i.gl,o=kn.unblended,s=new Dn(r.LEQUAL,Dn.ReadWrite,[0,1]),a=n.getTerrainMesh(),l=n.getCoordsTexture(),c=n.sourceCache.getRenderableTiles(),u=e.useProgram("terrainCoords");i.bindFramebuffer.set(n.getFramebuffer("coords").framebuffer),i.viewport.set([0,0,e.width/devicePixelRatio,e.height/devicePixelRatio]),i.clear({color:t.aP.transparent,depth:1}),n.coordsIndex=[];for(const t of c){const c=n.getTerrainData(t.tileID);i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,l.texture);const h={u_matrix:e.transform.calculatePosMatrix(t.tileID.toUnwrapped()),u_terrain_coords_id:(255-n.coordsIndex.length)/255,u_texture:0,u_ele_delta:n.getMeshFrameDelta(e.transform.zoom)};u.draw(i,r.TRIANGLES,s,Nn.disabled,o,Bn.backCCW,h,c,"terrain",a.vertexBuffer,a.indexBuffer,a.segments),n.coordsIndex.push(t.tileID.key)}i.bindFramebuffer.set(null),i.viewport.set([0,0,e.width,e.height])}(this,this.style.map.terrain))}renderLayer(e,n,i,r){if(!i.isHidden(this.transform.zoom)&&("background"===i.type||"custom"===i.type||(r||[]).length))switch(this.id=i.id,i.type){case"symbol":!function(e,n,i,r,o){if("translucent"!==e.renderPass)return;const s=Nn.disabled,a=e.colorModeForRenderPass();(i._unevaluatedLayout.hasValue("text-variable-anchor")||i._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(e,n,i,r,o,s,a,l,c){const u=n.transform,h=Qe(),d="map"===o,p="map"===s;for(const o of e){const e=r.getTile(o),s=e.getBucket(i);if(!s||!s.text||!s.text.segments.get().length)continue;const f=t.ag(s.textSizeData,u.zoom),m=Le(e,1,n.transform.zoom),g=me(o.posMatrix,p,d,n.transform,m),_="none"!==i.layout.get("icon-text-fit")&&s.hasIconData();if(f){const t=Math.pow(2,u.zoom-e.tileID.overscaledZ),i=n.style.map.terrain?(e,t)=>n.style.map.terrain.getElevation(o,e,t):null,r=h.translatePosition(u,e,a,l);$n(s,d,p,c,u,g,o.posMatrix,t,f,_,h,r,o.toUnwrapped(),i)}}}(r,e,i,n,i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),o),0!==i.paint.get("icon-opacity").constantOr(1)&&Hn(e,n,i,r,!1,i.paint.get("icon-translate"),i.paint.get("icon-translate-anchor"),i.layout.get("icon-rotation-alignment"),i.layout.get("icon-pitch-alignment"),i.layout.get("icon-keep-upright"),s,a),0!==i.paint.get("text-opacity").constantOr(1)&&Hn(e,n,i,r,!0,i.paint.get("text-translate"),i.paint.get("text-translate-anchor"),i.layout.get("text-rotation-alignment"),i.layout.get("text-pitch-alignment"),i.layout.get("text-keep-upright"),s,a),n.map.showCollisionBoxes&&(jn(e,n,i,r,!0),jn(e,n,i,r,!1))}(e,n,i,r,this.style.placement.variableOffsets);break;case"circle":!function(e,n,i,r){if("translucent"!==e.renderPass)return;const o=i.paint.get("circle-opacity"),s=i.paint.get("circle-stroke-width"),a=i.paint.get("circle-stroke-opacity"),l=!i.layout.get("circle-sort-key").isConstant();if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const c=e.context,u=c.gl,h=e.depthModeForSublayer(0,Dn.ReadOnly),d=Nn.disabled,p=e.colorModeForRenderPass(),f=[];for(let o=0;o<r.length;o++){const s=r[o],a=n.getTile(s),c=a.getBucket(i);if(!c)continue;const u=c.programConfigurations.get(i.id),h=e.useProgram("circle",u),d=c.layoutVertexBuffer,p=c.indexBuffer,m=e.style.map.terrain&&e.style.map.terrain.getTerrainData(s),g={programConfiguration:u,program:h,layoutVertexBuffer:d,indexBuffer:p,uniformValues:St(e,s,a,i),terrainData:m};if(l){const e=c.segments.get();for(const n of e)f.push({segments:new t.$([n]),sortKey:n.sortKey,state:g})}else f.push({segments:c.segments,sortKey:0,state:g})}l&&f.sort(((e,t)=>e.sortKey-t.sortKey));for(const t of f){const{programConfiguration:n,program:r,layoutVertexBuffer:o,indexBuffer:s,uniformValues:a,terrainData:l}=t.state;r.draw(c,u.TRIANGLES,h,d,p,Bn.disabled,a,l,i.id,o,s,t.segments,i.paint,e.transform.zoom,n)}}(e,n,i,r);break;case"heatmap":!function(e,n,i,r){if(0!==i.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=Nn.disabled,l=new kn([s.ONE,s.ONE],t.aP.transparent,[!0,!0,!0,!0]);!function(e,t,n){const i=e.gl;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);let r=n.heatmapFbo;if(r)i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),e.bindFramebuffer.set(r.framebuffer);else{const o=i.createTexture();i.bindTexture(i.TEXTURE_2D,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),r=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1,!1),function(e,t,n,i){var r,o;const s=e.gl,a=null!==(r=e.HALF_FLOAT)&&void 0!==r?r:s.UNSIGNED_BYTE,l=null!==(o=e.RGBA16F)&&void 0!==o?o:s.RGBA;s.texImage2D(s.TEXTURE_2D,0,l,t.width/4,t.height/4,0,s.RGBA,a,null),i.colorAttachment.set(n)}(e,t,o,r)}}(o,e,i),o.clear({color:t.aP.transparent});for(let t=0;t<r.length;t++){const c=r[t];if(n.hasRenderableParent(c))continue;const u=n.getTile(c),h=u.getBucket(i);if(!h)continue;const d=h.programConfigurations.get(i.id),p=e.useProgram("heatmap",d),{zoom:f}=e.transform;p.draw(o,s.TRIANGLES,Dn.disabled,a,l,Bn.disabled,Pt(c.posMatrix,u,f,i.paint.get("heatmap-intensity")),null,i.id,h.layoutVertexBuffer,h.indexBuffer,h.segments,i.paint,e.transform.zoom,d)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){const i=e.context,r=i.gl,o=n.heatmapFbo;if(!o)return;i.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,o.colorAttachment.get()),i.activeTexture.set(r.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new x(i,n.colorRamp,r.RGBA)),s.bind(r.LINEAR,r.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(i,r.TRIANGLES,Dn.disabled,Nn.disabled,e.colorModeForRenderPass(),Bn.disabled,((e,n,i,r)=>{const o=t.F();t.aO(o,0,e.width,e.height,0,0,1);const s=e.context.gl;return{u_matrix:o,u_world:[s.drawingBufferWidth,s.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}})(e,n),null,n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}(e,i))}(e,n,i,r);break;case"line":!function(e,n,i,r){if("translucent"!==e.renderPass)return;const o=i.paint.get("line-opacity"),s=i.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,Dn.ReadOnly),l=e.colorModeForRenderPass(),c=i.paint.get("line-dasharray"),u=i.paint.get("line-pattern"),h=u.constantOr(1),d=i.paint.get("line-gradient"),p=i.getCrossfadeParameters(),f=h?"linePattern":c?"lineSDF":d?"lineGradient":"line",m=e.context,g=m.gl;let _=!0;for(const o of r){const r=n.getTile(o);if(h&&!r.patternsLoaded())continue;const s=r.getBucket(i);if(!s)continue;const y=s.programConfigurations.get(i.id),v=e.context.program.get(),b=e.useProgram(f,y),w=_||b.program!==v,E=e.style.map.terrain&&e.style.map.terrain.getTerrainData(o),S=u.constantOr(null);if(S&&r.imageAtlas){const e=r.imageAtlas,t=e.patternPositions[S.to.toString()],n=e.patternPositions[S.from.toString()];t&&n&&y.setConstantPatternPositions(t,n)}const T=E?o:null,A=h?Ot(e,r,i,p,T):c?kt(e,r,i,c,p,T):d?Rt(e,r,i,s.lineClipsArray.length,T):Mt(e,r,i,T);if(h)m.activeTexture.set(g.TEXTURE0),r.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),y.updatePaintBuffers(p);else if(c&&(w||e.lineAtlas.dirty))m.activeTexture.set(g.TEXTURE0),e.lineAtlas.bind(m);else if(d){const r=s.gradients[i.id];let a=r.texture;if(i.gradientVersion!==r.version){let l=256;if(i.stepInterpolant){const i=n.getSource().maxzoom,r=o.canonical.z===i?Math.ceil(1<<e.transform.maxZoom-o.canonical.z):1;l=t.ac(t.aU(s.maxLineLength/t.W*1024*r),256,m.maxTextureSize)}r.gradient=t.aV({expression:i.gradientExpression(),evaluationKey:"lineProgress",resolution:l,image:r.gradient||void 0,clips:s.lineClipsArray}),r.texture?r.texture.update(r.gradient):r.texture=new x(m,r.gradient,g.RGBA),r.version=i.gradientVersion,a=r.texture}m.activeTexture.set(g.TEXTURE0),a.bind(i.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}b.draw(m,g.TRIANGLES,a,e.stencilModeForClipping(o),l,Bn.disabled,A,E,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segments,i.paint,e.transform.zoom,y,s.layoutVertexBuffer2),_=!1}}(e,n,i,r);break;case"fill":!function(e,n,i,r){const o=i.paint.get("fill-color"),s=i.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),l=i.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===o.constantOr(t.aP.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){const t=e.depthModeForSublayer(1,"opaque"===e.renderPass?Dn.ReadWrite:Dn.ReadOnly);Zn(e,n,i,r,t,a,!1)}if("translucent"===e.renderPass&&i.paint.get("fill-antialias")){const t=e.depthModeForSublayer(i.getPaintProperty("fill-outline-color")?2:0,Dn.ReadOnly);Zn(e,n,i,r,t,a,!0)}}(e,n,i,r);break;case"fill-extrusion":!function(e,t,n,i){const r=n.paint.get("fill-extrusion-opacity");if(0!==r&&"translucent"===e.renderPass){const o=new Dn(e.context.gl.LEQUAL,Dn.ReadWrite,e.depthRangeFor3D);if(1!==r||n.paint.get("fill-extrusion-pattern").constantOr(1))Yn(e,t,n,i,o,Nn.disabled,kn.disabled),Yn(e,t,n,i,o,e.stencilModeFor3D(),e.colorModeForRenderPass());else{const r=e.colorModeForRenderPass();Yn(e,t,n,i,o,Nn.disabled,r)}}}(e,n,i,r);break;case"hillshade":!function(e,t,n,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const r=e.context,o=e.depthModeForSublayer(0,Dn.ReadOnly),s=e.colorModeForRenderPass(),[a,l]="translucent"===e.renderPass?e.stencilConfigForOverlap(i):[{},i];for(const i of l){const r=t.getTile(i);void 0!==r.needsHillshadePrepare&&r.needsHillshadePrepare&&"offscreen"===e.renderPass?Jn(e,r,n,o,Nn.disabled,s):"translucent"===e.renderPass&&Kn(e,i,r,n,o,a[i.overscaledZ],s)}r.viewport.set([0,0,e.width,e.height])}(e,n,i,r);break;case"raster":!function(e,t,n,i){if("translucent"!==e.renderPass)return;if(0===n.paint.get("raster-opacity"))return;if(!i.length)return;const r=e.context,o=r.gl,s=t.getSource(),a=e.useProgram("raster"),l=e.colorModeForRenderPass(),[c,u]=s instanceof K?[{},i]:e.stencilConfigForOverlap(i),h=u[u.length-1].overscaledZ,d=!e.options.moving;for(const i of u){const u=e.depthModeForSublayer(i.overscaledZ-h,1===n.paint.get("raster-opacity")?Dn.ReadWrite:Dn.ReadOnly,o.LESS),p=t.getTile(i);p.registerFadeDuration(n.paint.get("raster-fade-duration"));const f=t.findLoadedParent(i,0),m=t.findLoadedSibling(i),g=Qn(p,f||m||null,t,n,e.transform,e.style.map.terrain);let _,y;const v="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;r.activeTexture.set(o.TEXTURE0),p.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),r.activeTexture.set(o.TEXTURE1),f?(f.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),_=Math.pow(2,f.tileID.overscaledZ-p.tileID.overscaledZ),y=[p.tileID.canonical.x*_%1,p.tileID.canonical.y*_%1]):p.texture.bind(v,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);const b=e.style.map.terrain&&e.style.map.terrain.getTerrainData(i),x=b?i:null,w=x?x.posMatrix:e.transform.calculatePosMatrix(i.toUnwrapped(),d),E=Ft(w,y||[0,0],_||1,g,n);s instanceof K?a.draw(r,o.TRIANGLES,u,Nn.disabled,l,Bn.disabled,E,b,n.id,s.boundsBuffer,e.quadTriangleIndexBuffer,s.boundsSegments):a.draw(r,o.TRIANGLES,u,c[i.overscaledZ],l,Bn.disabled,E,b,n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}(e,n,i,r);break;case"background":!function(e,t,n,i){const r=n.paint.get("background-color"),o=n.paint.get("background-opacity");if(0===o)return;const s=e.context,a=s.gl,l=e.transform,c=l.tileSize,u=n.paint.get("background-pattern");if(e.isPatternMissing(u))return;const h=!u&&1===r.a&&1===o&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==h)return;const d=Nn.disabled,p=e.depthModeForSublayer(0,"opaque"===h?Dn.ReadWrite:Dn.ReadOnly),f=e.colorModeForRenderPass(),m=e.useProgram(u?"backgroundPattern":"background"),g=i||l.coveringTiles({tileSize:c,terrain:e.style.map.terrain});u&&(s.activeTexture.set(a.TEXTURE0),e.imageManager.bind(e.context));const _=n.getCrossfadeParameters();for(const t of g){const l=i?t.posMatrix:e.transform.calculatePosMatrix(t.toUnwrapped()),h=u?Vt(l,o,e,u,{tileID:t,tileSize:c},_):Ut(l,o,r),g=e.style.map.terrain&&e.style.map.terrain.getTerrainData(t);m.draw(s,a.TRIANGLES,p,d,f,Bn.disabled,h,g,n.id,e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments)}}(e,0,i,r);break;case"custom":!function(e,t,n){const i=e.context,r=n.implementation;if("offscreen"===e.renderPass){const t=r.prerender;t&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),t.call(r,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(Nn.disabled);const t="3d"===r.renderingMode?new Dn(e.context.gl.LEQUAL,Dn.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,Dn.ReadOnly);i.setDepthMode(t),r.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}(e,0,i)}}translatePosMatrix(e,n,i,r,o){if(!i[0]&&!i[1])return e;const s=o?"map"===r?this.transform.angle:0:"viewport"===r?-this.transform.angle:0;if(s){const e=Math.sin(s),t=Math.cos(s);i=[i[0]*t-i[1]*e,i[0]*e+i[1]*t]}const a=[o?i[0]:Le(n,i[0],this.transform.zoom),o?i[1]:Le(n,i[1],this.transform.zoom),0],l=new Float32Array(16);return t.H(l,e,a),l}saveTileTexture(e){const t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}useProgram(e,t){this.cache=this.cache||{};const n=e+(t?t.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[n]||(this.cache[n]=new gt(this.context,dt[e],t,Gt[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[n]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new x(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:t}=this.context.gl;return this.width!==e||this.height!==t}}class hi{constructor(e,t){this.points=e,this.planes=t}static fromInvProjectionMatrix(e,n,i){const r=Math.pow(2,i),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((i=>{const o=1/(i=t.af([],i,e))[3]/n*r;return t.b0(i,i,[o,o,1/i[3],o])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((e=>{const t=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}([],function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s,e}([],_([],o[e[0]],o[e[1]]),_([],o[e[2]],o[e[1]]))),n=-((i=t)[0]*(r=o[e[1]])[0]+i[1]*r[1]+i[2]*r[2]);var i,r;return t.concat(n)}));return new hi(o,s)}}class di{constructor(e,t){this.min=e,this.max=t,this.center=function(e,t,n){return e[0]=.5*t[0],e[1]=.5*t[1],e[2]=.5*t[2],e}([],function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}([],this.min,this.max))}quadrant(e){const t=[e%2==0,e<2],n=m(this.min),i=m(this.max);for(let e=0;e<t.length;e++)n[e]=t[e]?this.min[e]:this.center[e],i[e]=t[e]?this.center[e]:this.max[e];return i[2]=this.max[2],new di(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const n=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let i=!0;for(let r=0;r<e.planes.length;r++){const o=e.planes[r];let s=0;for(let e=0;e<n.length;e++)t.b1(o,n[e])>=0&&s++;if(0===s)return 0;s!==n.length&&(i=!1)}if(i)return 2;for(let t=0;t<3;t++){let n=Number.MAX_VALUE,i=-Number.MAX_VALUE;for(let r=0;r<e.points.length;r++){const o=e.points[r][t]-this.min[t];n=Math.min(n,o),i=Math.max(i,o)}if(i<0||n>this.max[t]-this.min[t])return 0}return 1}}class pi{constructor(e=0,t=0,n=0,i=0){if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=n,this.right=i}interpolate(e,n,i){return null!=n.top&&null!=e.top&&(this.top=t.z.number(e.top,n.top,i)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.z.number(e.bottom,n.bottom,i)),null!=n.left&&null!=e.left&&(this.left=t.z.number(e.left,n.left,i)),null!=n.right&&null!=e.right&&(this.right=t.z.number(e.right,n.right,i)),this}getCenter(e,n){const i=t.ac((this.left+e-this.right)/2,0,e),r=t.ac((this.top+n-this.bottom)/2,0,n);return new t.P(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new pi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const fi=85.051129;class mi{constructor(e,n,i,r,o){this.tileSize=512,this._renderWorldCopies=void 0===o||!!o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==i?0:i,this._maxPitch=null==r?60:r,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pi,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new mi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const n=-t.b2(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=function(){var e=new t.A(4);return t.A!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}(),function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);e[0]=i*l+o*a,e[1]=r*l+s*a,e[2]=i*-a+o*l,e[3]=r*-a+s*l}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=t.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.tileZoom=Math.max(0,Math.floor(t)),this.scale=this.zoomScale(t),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(e){const n=[new t.b3(0,e)];if(this._renderWorldCopies){const i=this.pointCoordinate(new t.P(0,0)),r=this.pointCoordinate(new t.P(this.width,0)),o=this.pointCoordinate(new t.P(this.width,this.height)),s=this.pointCoordinate(new t.P(0,this.height)),a=Math.floor(Math.min(i.x,r.x,o.x,s.x)),l=Math.floor(Math.max(i.x,r.x,o.x,s.x)),c=1;for(let i=a-c;i<=l+c;i++)0!==i&&n.push(new t.b3(i,e))}return n}coveringTiles(e){var n,i;let r=this.coveringZoomLevel(e);const o=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);const s=this.pointCoordinate(this.getCameraPoint()),a=t.Y.fromLngLat(this.center),l=Math.pow(2,r),c=[l*s.x,l*s.y,0],u=[l*a.x,l*a.y,0],h=hi.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r);let d=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(d=r);const p=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,f=e=>({aabb:new di([e*l,0,0],[(e+1)*l,l,0]),zoom:0,x:0,y:0,wrap:e,fullyVisible:!1}),m=[],g=[],_=r,v=e.reparseOverscaled?o:r;if(this._renderWorldCopies)for(let e=1;e<=3;e++)m.push(f(-e)),m.push(f(e));for(m.push(f(0));m.length>0;){const r=m.pop(),o=r.x,s=r.y;let a=r.fullyVisible;if(!a){const e=r.aabb.intersects(h);if(0===e)continue;a=2===e}const l=e.terrain?c:u,f=r.aabb.distanceX(l),b=r.aabb.distanceY(l),x=Math.max(Math.abs(f),Math.abs(b));if(r.zoom===_||x>p+(1<<_-r.zoom)-2&&r.zoom>=d){const e=_-r.zoom,n=c[0]-.5-(o<<e),i=c[1]-.5-(s<<e);g.push({tileID:new t.Q(r.zoom===_?v:r.zoom,r.wrap,r.zoom,o,s),distanceSq:y([u[0]-.5-o,u[1]-.5-s]),tileDistanceToCamera:Math.sqrt(n*n+i*i)})}else for(let l=0;l<4;l++){const c=(o<<1)+l%2,u=(s<<1)+(l>>1),h=r.zoom+1;let d=r.aabb.quadrant(l);if(e.terrain){const o=new t.Q(h,r.wrap,h,c,u),s=e.terrain.getMinMaxElevation(o),a=null!==(n=s.minElevation)&&void 0!==n?n:this.elevation,l=null!==(i=s.maxElevation)&&void 0!==i?i:this.elevation;d=new di([d.min[0],d.min[1],a],[d.max[0],d.max[1],l])}m.push({aabb:d,zoom:h,x:c,y:u,wrap:r.wrap,fullyVisible:a})}}return g.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const n=t.ac(e.lat,-85.051129,fi);return new t.P(t.N(e.lng)*this.worldSize,t.O(n)*this.worldSize)}unproject(e){return new t.Y(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const n=this.elevation,i=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,r=this.pointLocation(this.centerPoint,e),o=e.getElevationForLngLatZoom(r,this.tileZoom);if(!(this.elevation-o))return;const s=i+n-o,a=Math.cos(this._pitch)*this.cameraToCenterDistance/s/t.b4(1,r.lat),l=this.scaleZoom(a/this.tileSize);this._elevation=o,this._center=r,this.zoom=l}setLocationAtPoint(e,n){const i=this.pointCoordinate(n),r=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),s=new t.Y(o.x-(i.x-r.x),o.y-(i.y-r.y));this.center=this.coordinateLocation(s),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,t){return t?this.coordinatePoint(this.locationCoordinate(e),t.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,t){return this.coordinateLocation(this.pointCoordinate(e,t))}locationCoordinate(e){return t.Y.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,n){if(n){const t=n.pointCoordinate(e);if(null!=t)return t}const i=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.af(i,i,this.pixelMatrixInverse),t.af(r,r,this.pixelMatrixInverse);const o=i[3],s=r[3],a=i[1]/o,l=r[1]/s,c=i[2]/o,u=r[2]/s,h=c===u?0:(0-c)/(u-c);return new t.Y(t.z.number(i[0]/o,r[0]/s,h)/this.worldSize,t.z.number(a,l,h)/this.worldSize)}coordinatePoint(e,n=0,i=this.pixelMatrix){const r=[e.x*this.worldSize,e.y*this.worldSize,n,1];return t.af(r,r,i),new t.P(r[0]/r[3],r[1]/r[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return(new $).extend(this.pointLocation(new t.P(0,e))).extend(this.pointLocation(new t.P(this.width,e))).extend(this.pointLocation(new t.P(this.width,this.height))).extend(this.pointLocation(new t.P(0,this.height)))}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new $([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,fi])}calculatePosMatrix(e,n=!1){const i=e.key,r=n?this._alignedPosMatrixCache:this._posMatrixCache;if(r[i])return r[i];const o=e.canonical,s=this.worldSize/this.zoomScale(o.z),a=o.x+Math.pow(2,o.z)*e.wrap,l=t.an(new Float64Array(16));return t.H(l,l,[a*s,o.y*s,0]),t.J(l,l,[s/t.W,s/t.W,1]),t.K(l,n?this.alignedProjMatrix:this.projMatrix,l),r[i]=new Float32Array(l),r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,n){n=t.ac(+n,this.minZoom,this.maxZoom);const i={center:new t.M(e.lng,e.lat),zoom:n};let r=this.lngRange;if(!this._renderWorldCopies&&null===r){const e=180-1e-10;r=[-e,e]}const o=this.tileSize*this.zoomScale(i.zoom);let s=0,a=o,l=0,c=o,u=0,h=0;const{x:d,y:p}=this.size;if(this.latRange){const e=this.latRange;s=t.O(e[1])*o,a=t.O(e[0])*o,a-s<p&&(u=p/(a-s))}r&&(l=t.b2(t.N(r[0])*o,0,o),c=t.b2(t.N(r[1])*o,0,o),c<l&&(c+=o),c-l<d&&(h=d/(c-l)));const{x:f,y:m}=this.project.call({worldSize:o},e);let g,_;const y=Math.max(h||0,u||0);if(y){const e=new t.P(h?(c+l)/2:f,u?(a+s)/2:m);return i.center=this.unproject.call({worldSize:o},e).wrap(),i.zoom+=this.scaleZoom(y),i}if(this.latRange){const e=p/2;m-e<s&&(_=s+e),m+e>a&&(_=a-e)}if(r){const e=(l+c)/2;let n=f;this._renderWorldCopies&&(n=t.b2(f,e-o/2,e+o/2));const i=d/2;n-i<l&&(g=l+i),n+i>c&&(g=c-i)}if(void 0!==g||void 0!==_){const e=new t.P(null!=g?g:f,null!=_?_:m);i.center=this.unproject.call({worldSize:o},e).wrap()}return i}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:t,zoom:n}=this.getConstrained(this.center,this.zoom);this.center=t,this.zoom=n,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,n=this.point.x,i=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=t.b4(1,this.center.lat)*this.worldSize;let r=t.an(new Float64Array(16));t.J(r,r,[this.width/2,-this.height/2,1]),t.H(r,r,[1,-1,0]),this.labelPlaneMatrix=r,r=t.an(new Float64Array(16)),t.J(r,r,[1,-1,1]),t.H(r,r,[-1,-1,0]),t.J(r,r,[2/this.width,2/this.height,1]),this.glCoordMatrix=r;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),a=o-s*this._pixelPerMeter/Math.cos(this._pitch),l=s<0?a:o,c=Math.PI/2+this._pitch,u=this._fov*(.5+e.y/this.height),h=Math.sin(u)*l/Math.sin(t.ac(Math.PI-c-u,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+e.y/(2*d)),f=Math.sin(p)*l/Math.sin(t.ac(Math.PI-c-p,.01,Math.PI-.01)),m=Math.min(h,f),g=1.01*(Math.cos(Math.PI/2-this._pitch)*m+l),_=this.height/50;r=new Float64Array(16),t.b5(r,this._fov,this.width/this.height,_,g),r[8]=2*-e.x/this.width,r[9]=2*e.y/this.height,t.J(r,r,[1,-1,1]),t.H(r,r,[0,0,-this.cameraToCenterDistance]),t.b6(r,r,this._pitch),t.ad(r,r,this.angle),t.H(r,r,[-n,-i,0]),this.mercatorMatrix=t.J([],r,[this.worldSize,this.worldSize,this.worldSize]),t.J(r,r,[1,1,this._pixelPerMeter]),this.pixelMatrix=t.K(new Float64Array(16),this.labelPlaneMatrix,r),t.H(r,r,[0,0,-this.elevation]),this.projMatrix=r,this.invProjMatrix=t.as([],r),this.pixelMatrix3D=t.K(new Float64Array(16),this.labelPlaneMatrix,r);const y=this.width%2/2,v=this.height%2/2,b=Math.cos(this.angle),x=Math.sin(this.angle),w=n-Math.round(n)+b*y+x*v,E=i-Math.round(i)+b*v+x*y,S=new Float64Array(r);if(t.H(S,S,[w>.5?w-1:w,E>.5?E-1:E,0]),this.alignedProjMatrix=S,r=t.as(new Float64Array(16),this.pixelMatrix),!r)throw new Error("failed to invert matrix");this.pixelMatrixInverse=r,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new t.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.af(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,e))}getCameraQueryGeometry(e){const n=this.getCameraPoint();if(1===e.length)return[e[0],n];{let i=n.x,r=n.y,o=n.x,s=n.y;for(const t of e)i=Math.min(i,t.x),r=Math.min(r,t.y),o=Math.max(o,t.x),s=Math.max(s,t.y);return[new t.P(i,r),new t.P(o,r),new t.P(o,s),new t.P(i,s),new t.P(i,r)]}}lngLatToCameraDepth(e,n){const i=this.locationCoordinate(e),r=[i.x*this.worldSize,i.y*this.worldSize,n,1];return t.af(r,r,this.projMatrix),r[2]/r[3]}}function gi(e,t){let n,i=!1,r=null,o=null;const s=()=>{r=null,i&&(e.apply(o,n),r=setTimeout(s,t),i=!1)};return(...e)=>(i=!0,o=this,n=e,r||s(),r)}class _i{constructor(e){this._getCurrentHash=()=>{const e=window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")},this._onHashChange=()=>{const e=this._getCurrentHash();if(e.length>=3&&!e.some((e=>isNaN(e)))){const t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const e=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,e)}catch(e){}},this._updateHash=gi(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(e){const t=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),r=Math.pow(10,i),o=Math.round(t.lng*r)/r,s=Math.round(t.lat*r)/r,a=this._map.getBearing(),l=this._map.getPitch();let c="";if(c+=e?`/${o}/${s}/${n}`:`${n}/${s}/${o}`,(a||l)&&(c+="/"+Math.round(10*a)/10),l&&(c+=`/${Math.round(l)}`),this._hashName){const e=this._hashName;let t=!1;const n=window.location.hash.slice(1).split("&").map((n=>{const i=n.split("=")[0];return i===e?(t=!0,`${i}=${c}`):n})).filter((e=>e));return t||n.push(`${e}=${c}`),`#${n.join("&")}`}return`#${c}`}}const yi={linearity:.3,easing:t.b7(0,0,.3,1)},vi=t.e({deceleration:2500,maxSpeed:1400},yi),bi=t.e({deceleration:20,maxSpeed:1400},yi),xi=t.e({deceleration:1e3,maxSpeed:360},yi),wi=t.e({deceleration:1e3,maxSpeed:90},yi);class Ei{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,t=o.now();for(;e.length>0&&t-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)n.zoom+=e.zoomDelta||0,n.bearing+=e.bearingDelta||0,n.pitch+=e.pitchDelta||0,e.panDelta&&n.pan._add(e.panDelta),e.around&&(n.around=e.around),e.pinchAround&&(n.pinchAround=e.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){const o=Ti(n.pan.mag(),i,t.e({},vi,e||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Si(r,o)}if(n.zoom){const e=Ti(n.zoom,i,bi);r.zoom=this._map.transform.zoom+e.amount,Si(r,e)}if(n.bearing){const e=Ti(n.bearing,i,xi);r.bearing=this._map.transform.bearing+t.ac(e.amount,-179,179),Si(r,e)}if(n.pitch){const e=Ti(n.pitch,i,wi);r.pitch=this._map.transform.pitch+e.amount,Si(r,e)}if(r.zoom||r.bearing){const e=void 0===n.pinchAround?n.around:n.pinchAround;r.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),t.e(r,{noMoveStart:!0})}}function Si(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Ti(e,n,i){const{maxSpeed:r,linearity:o,deceleration:s}=i,a=t.ac(e*o/(n/1e3),-r,r),l=Math.abs(a)/(s*o);return{easing:i.easing,duration:1e3*l,amount:a*(l/2)}}class Ai extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,r={}){const o=s.mousePos(n.getCanvas(),i),a=n.unproject(o);super(e,t.e({point:o,lngLat:a,originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Ci extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){const r="touchend"===e?i.changedTouches:i.touches,o=s.touchPos(n.getCanvasContainer(),r),a=o.map((e=>n.unproject(e))),l=o.reduce(((e,t,n,i)=>e.add(t.div(i.length))),new t.P(0,0));super(e,{points:o,point:l,lngLats:a,lngLat:n.unproject(l),originalEvent:i}),this._defaultPrevented=!1}}class Pi extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class Ii{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Pi(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ai(e.type,this._map,e))}mouseup(e){this._map.fire(new Ai(e.type,this._map,e))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Ai(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ai(e.type,this._map,e))}mouseover(e){this._map.fire(new Ai(e.type,this._map,e))}mouseout(e){this._map.fire(new Ai(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ci(e.type,this._map,e))}touchmove(e){this._map.fire(new Ci(e.type,this._map,e))}touchend(e){this._map.fire(new Ci(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ci(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ai(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ai(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ri{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(t.P.convert(e),this._map.terrain)}}class Oi{constructor(e,t){this._map=e,this._tr=new Ri(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(s.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const n=t;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=s.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const r=Math.min(i.x,n.x),o=Math.max(i.x,n.x),a=Math.min(i.y,n.y),l=Math.max(i.y,n.y);s.setTransform(this._box,`translate(${r}px,${a}px)`),this._box.style.width=o-r+"px",this._box.style.height=l-a+"px"}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const i=this._startPos,r=n;if(this.reset(),s.suppressClick(),i.x!==r.x||i.y!==r.y)return this._map.fire(new t.k("boxzoomend",{originalEvent:e})),{cameraAnimation:e=>e.fitScreenCoordinates(i,r,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(s.remove(this._box),this._box=null),s.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.k(e,{originalEvent:n}))}}function ki(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const n={};for(let i=0;i<e.length;i++)n[e[i].identifier]=t[i];return n}class Li{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(e){const n=new t.P(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=ki(i,n)))}touchmove(e,t,n){if(this.aborted||!this.centroid)return;const i=ki(n,t);for(const e in this.touches){const t=i[e];(!t||t.dist(this.touches[e])>30)&&(this.aborted=!0)}}touchend(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class Di{constructor(e){this.singleTap=new Li(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,t,n){this.singleTap.touchstart(e,t,n)}touchmove(e,t,n){this.singleTap.touchmove(e,t,n)}touchend(e,t,n){const i=this.singleTap.touchend(e,t,n);if(i){const t=e.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(i)<30;if(t&&n||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class Fi{constructor(e){this._tr=new Ri(e),this._zoomIn=new Di({numTouches:1,numTaps:2}),this._zoomOut=new Di({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}touchmove(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}touchend(e,t,n){const i=this._zoomIn.touchend(e,t,n),r=this._zoomOut.touchend(e,t,n),o=this._tr;return i?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(i)},{originalEvent:e})}):r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(r)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ni{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const t=this._moveFunction(...e);if(t.bearingDelta||t.pitchDelta||t.around||t.panDelta)return this._active=!0,t}dragStart(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=t.length?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,t){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const i=t.length?t[0]:t;return!this._moved&&i.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=i,this._move(n,i))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&s.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Bi={0:1,2:2};class zi{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const t=s.mouseButton(e);this._eventButton=t}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(e,t){const n=Bi[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton)}isValidEndEvent(e){return s.mouseButton(e)===this._eventButton}}class ji{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return 1===e.targetTouches.length}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ui=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=e=>{e.preventDefault()}},Vi=({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const i=new zi({checkCorrectEvent:e=>0===s.mouseButton(e)&&e.ctrlKey||2===s.mouseButton(e)});return new Ni({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*n}),moveStateManager:i,enable:e,assignEvents:Ui})},Gi=({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const i=new zi({checkCorrectEvent:e=>0===s.mouseButton(e)&&e.ctrlKey||2===s.mouseButton(e)});return new Ni({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:i,enable:e,assignEvents:Ui})};class $i{constructor(e,t){this._clickTolerance=e.clickTolerance||1,this._map=t,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(e,t,n){return this._calculateTransform(e,t,n)}touchmove(e,t,n){if(this._active&&!(n.length<this.minTouchs()))return e.preventDefault(),this._calculateTransform(e,t,n)}touchend(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);const r=ki(i,n),o=new t.P(0,0),s=new t.P(0,0);let a=0;for(const e in r){const t=r[e],n=this._touches[e];n&&(o._add(t),s._add(t.sub(n)),a++,r[e]=t)}if(this._touches=r,a<this.minTouchs()||!s.mag())return;const l=s.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wi{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,n){if(!this._firstTwoTouches)return;e.preventDefault();const[i,r]=this._firstTwoTouches,o=Hi(n,t,i),s=Hi(n,t,r);if(!o||!s)return;const a=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],a,e)}touchend(e,t,n){if(!this._firstTwoTouches)return;const[i,r]=this._firstTwoTouches,o=Hi(n,t,i),a=Hi(n,t,r);o&&a||(this._active&&s.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Hi(e,t,n){for(let i=0;i<e.length;i++)if(e[i].identifier===n)return t[i]}function qi(e,t){return Math.log(e/t)/Math.LN2}class Xi extends Wi{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(qi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qi(this._distance,n),pinchAround:t}}}function Zi(e,t){return 180*e.angleWith(t)/Math.PI}class Yi extends Wi{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t,n){const i=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zi(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,n=Zi(e,this._startVector);return Math.abs(n)<t}}function Ki(e){return Math.abs(e.y)>Math.abs(e.x)}class Ji extends Wi{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,t,n){super.touchstart(e,t,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,Ki(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,t,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const i=e[0].sub(this._lastPoints[0]),r=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,r,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(i.y+r.y)/2*-.5}):void 0}gestureBeginsVertically(e,t,n){if(void 0!==this._valid)return this._valid;const i=e.mag()>=2,r=t.mag()>=2;if(!i&&!r)return;if(!i||!r)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return Ki(e)&&Ki(t)&&o}}const Qi={panStep:100,bearingStep:15,pitchStep:10};class er{constructor(e){this._tr=new Ri(e);const t=Qi;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,n=0,i=0,r=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const a=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:tr,zoom:t?Math.round(a.zoom)+t*(e.shiftKey?2:1):a.zoom,bearing:a.bearing+n*this._bearingStep,pitch:a.pitch+i*this._pitchStep,offset:[-r*this._panStep,-o*this._panStep],center:a.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function tr(e){return e*(2-e)}const nr=4.000244140625;class ir{constructor(e,t){this._onTimeout=e=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)},this._map=e,this._tr=new Ri(e),this._triggerRenderFrame=t,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(e){if(!this.isEnabled())return;if(this._map.cooperativeGestures.isEnabled()&&!e[this._map.cooperativeGestures._bypassKey])return;let t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=o.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==t&&t%nr==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=s.mousePos(this._map.getCanvas(),e),i=this._tr;this._around=n.y>i.transform.height/2-i.transform.getHorizon()?t.M.convert(this._aroundCenter?i.center:i.unproject(n)):t.M.convert(i.center),this._aroundPoint=i.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._tr.transform;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>nr?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==n&&(n=1/n);const i="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(i*n))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:e.zoom,i=this._startZoom,r=this._easing;let s,a=!1;if("wheel"===this._type&&i&&r){const e=Math.min((o.now()-this._lastWheelEventTime)/200,1),l=r(e);s=t.z.number(i,n,l),e<1?this._frameId||(this._frameId=!0):a=!0}else s=n,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.b8;if(this._prevEase){const e=this._prevEase,i=(o.now()-e.start)/e.duration,r=e.easing(i+.01)-e.easing(i),s=.27/Math.sqrt(r*r+1e-4)*.01,a=Math.sqrt(.0729-s*s);n=t.b7(s,a,.25,1)}return this._prevEase={start:o.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class rr{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class or{constructor(e){this._tr=new Ri(e),this.reset()}reset(){this._active=!1}dblclick(e,t){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sr{constructor(){this._tap=new Di({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,t,n){if(!this._swipePoint)if(this._tapTime){const i=t[0],r=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(i)<30;r&&o?n.length>0&&(this._swipePoint=i,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}touchmove(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=t[0],r=i.y-this._swipePoint.y;return this._swipePoint=i,e.preventDefault(),this._active=!0,{zoomDelta:r/128}}}else this._tap.touchmove(e,t,n)}touchend(e,t,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{const i=this._tap.touchend(e,t,n);i&&(this._tapTime=e.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ar{constructor(e,t,n){this._el=e,this._mousePan=t,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lr{constructor(e,t,n){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cr{constructor(e,t,n,i){this._el=e,this._touchZoom=t,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ur{constructor(e,t){this._bypassKey=-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey",this._map=e,this._options=t,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=s.create("div","maplibregl-cooperative-gesture-screen",e);let t=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");"metaKey"===this._bypassKey&&(t=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),i=document.createElement("div");i.className="maplibregl-desktop-message",i.textContent=t,this._container.appendChild(i);const r=document.createElement("div");r.className="maplibregl-mobile-message",r.textContent=n,this._container.appendChild(r),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(s.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(e){this._onCooperativeGesture(1===e.touches.length)}wheel(e){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!e[this._bypassKey])}_onCooperativeGesture(e){this._enabled&&e&&(this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const hr=e=>e.zoom||e.drag||e.pitch||e.rotate;class dr extends t.k{}function pr(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class fr{constructor(e,t){this.handleWindowEvent=e=>{this.handleEvent(e,`${e.type}Window`)},this.handleEvent=(e,t)=>{if("blur"===e.type)return void this.stop(!0);this._updatingCamera=!0;const n="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},r={},o={},a=e.touches,l=a?this._getMapTouches(a):void 0,c=l?s.touchPos(this._map.getCanvas(),l):s.mousePos(this._map.getCanvas(),e);for(const{handlerName:s,handler:a,allowed:u}of this._handlers){if(!a.isEnabled())continue;let h;this._blockedByActive(o,u,s)?a.reset():a[t||e.type]&&(h=a[t||e.type](e,c,l),this.mergeHandlerResult(i,r,h,s,n),h&&h.needsRenderFrame&&this._triggerRenderFrame()),(h||a.isActive())&&(o[s]=a)}const u={};for(const e in this._previousActiveHandlers)o[e]||(u[e]=n);this._previousActiveHandlers=o,(Object.keys(u).length||pr(i))&&(this._changes.push([i,r,u]),this._triggerRenderFrame()),(Object.keys(o).length||pr(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=i;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ei(e),this._bearingSnap=t.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(t);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,t,n]of this._listeners)s.addEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}destroy(){for(const[e,t,n]of this._listeners)s.removeEventListener(e,t,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Ii(t,e));const i=t.boxZoom=new Oi(t,e);this._add("boxZoom",i),e.interactive&&e.boxZoom&&i.enable();const r=t.cooperativeGestures=new ur(t,e.cooperativeGestures);this._add("cooperativeGestures",r),e.cooperativeGestures&&r.enable();const o=new Fi(t),a=new or(t);t.doubleClickZoom=new rr(a,o),this._add("tapZoom",o),this._add("clickZoom",a),e.interactive&&e.doubleClickZoom&&t.doubleClickZoom.enable();const l=new sr;this._add("tapDragZoom",l);const c=t.touchPitch=new Ji(t);this._add("touchPitch",c),e.interactive&&e.touchPitch&&t.touchPitch.enable(e.touchPitch);const u=Vi(e),h=Gi(e);t.dragRotate=new lr(e,u,h),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),e.interactive&&e.dragRotate&&t.dragRotate.enable();const d=(({enable:e,clickTolerance:t})=>{const n=new zi({checkCorrectEvent:e=>0===s.mouseButton(e)&&!e.ctrlKey});return new Ni({clickTolerance:t,move:(e,t)=>({around:t,panDelta:t.sub(e)}),activateOnStart:!0,moveStateManager:n,enable:e,assignEvents:Ui})})(e),p=new $i(e,t);t.dragPan=new ar(n,d,p),this._add("mousePan",d),this._add("touchPan",p,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&t.dragPan.enable(e.dragPan);const f=new Yi,m=new Xi;t.touchZoomRotate=new cr(n,m,f,l),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",m,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&t.touchZoomRotate.enable(e.touchZoomRotate);const g=t.scrollZoom=new ir(t,(()=>this._triggerRenderFrame()));this._add("scrollZoom",g,["mousePan"]),e.interactive&&e.scrollZoom&&t.scrollZoom.enable(e.scrollZoom);const _=t.keyboard=new er(t);this._add("keyboard",_),e.interactive&&e.keyboard&&t.keyboard.enable(),this._add("blockableMapEvent",new Mi(t))}_add(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(hr(this._eventsInProgress))||this.isZooming()}_blockedByActive(e,t,n){for(const i in e)if(i!==n&&(!t||t.indexOf(i)<0))return!0;return!1}_getMapTouches(e){const t=[];for(const n of e)this._el.contains(n.target)&&t.push(n);return t}mergeHandlerResult(e,n,i,r,o){if(!i)return;t.e(e,i);const s={handlerName:r,originalEvent:i.originalEvent||o};void 0!==i.zoomDelta&&(n.zoom=s),void 0!==i.panDelta&&(n.drag=s),void 0!==i.pitchDelta&&(n.pitch=s),void 0!==i.bearingDelta&&(n.rotate=s)}_applyChanges(){const e={},n={},i={};for(const[r,o,s]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new t.P(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),void 0!==r.around&&(e.around=r.around),void 0!==r.pinchAround&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),t.e(n,o),t.e(i,s);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,t,n){const i=this._map,r=i._getTransformForUpdate(),o=i.terrain;if(!(pr(e)||o&&this._terrainMovement))return this._fireEvents(t,n,!0);let{panDelta:s,zoomDelta:a,bearingDelta:l,pitchDelta:c,around:u,pinchAround:h}=e;void 0!==h&&(u=h),i._stop(!0),u=u||i.transform.centerPoint;const d=r.pointLocation(s?u.sub(s):u);l&&(r.bearing+=l),c&&(r.pitch+=c),a&&(r.zoom+=a),o?this._terrainMovement||!t.drag&&!t.zoom?t.drag&&this._terrainMovement?r.center=r.pointLocation(r.centerPoint.sub(s)):r.setLocationAtPoint(d,u):(this._terrainMovement=!0,this._map._elevationFreeze=!0,r.setLocationAtPoint(d,u)):r.setLocationAtPoint(d,u),i._applyUpdatedTransform(r),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}_fireEvents(e,n,i){const r=hr(this._eventsInProgress),s=hr(e),a={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(a[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!r&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in a)this._fireEvent(e,a[e]);s&&this._fireEvent("move",s.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const l={};let c;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:i}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],c=n[t]||i,l[`${e}end`]=c)}for(const e in l)this._fireEvent(e,l[e]);const u=hr(this._eventsInProgress),h=(r||s)&&!u;if(h&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),i&&h){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;!e||!e.essential&&o.prefersReducedMotion?(this._map.fire(new t.k("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()):(n(e.bearing||this._map.getBearing())&&(e.bearing=0),e.freezeElevation=!0,this._map.easeTo(e,{originalEvent:c})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.k(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new dr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class mr extends t.E{constructor(e,t){super(),this._renderFrameCallback=()=>{const e=Math.min((o.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=t.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new t.M(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(e,n,i){return e=t.P.convert(e).mult(-1),this.panTo(this.transform.center,t.e({offset:e},n),i)}panTo(e,n,i){return this.easeTo(t.e({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,n,i){return this.easeTo(t.e({zoom:e},n),i)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,n,i){return this.easeTo(t.e({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,t.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(e,t){e=$.convert(e);const n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}_cameraForBoxAndBearing(e,n,i,r){const o={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=t.e({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const e=r.padding;r.padding={top:e,bottom:e,right:e,left:e}}r.padding=t.e(o,r.padding);const s=this.transform,a=s.padding,l=new $(e,n),c=s.project(l.getNorthWest()),u=s.project(l.getNorthEast()),h=s.project(l.getSouthEast()),d=s.project(l.getSouthWest()),p=t.b9(-i),f=c.rotate(p),m=u.rotate(p),g=h.rotate(p),_=d.rotate(p),y=new t.P(Math.max(f.x,m.x,_.x,g.x),Math.max(f.y,m.y,_.y,g.y)),v=new t.P(Math.min(f.x,m.x,_.x,g.x),Math.min(f.y,m.y,_.y,g.y)),b=y.sub(v),x=(s.width-(a.left+a.right+r.padding.left+r.padding.right))/b.x,w=(s.height-(a.top+a.bottom+r.padding.top+r.padding.bottom))/b.y;if(w<0||x<0)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const E=Math.min(s.scaleZoom(s.scale*Math.min(x,w)),r.maxZoom),S=t.P.convert(r.offset),T=new t.P((r.padding.left-r.padding.right)/2,(r.padding.top-r.padding.bottom)/2).rotate(t.b9(i)),A=S.add(T).mult(s.scale/s.zoomScale(E));return{center:s.unproject(c.add(h).div(2).sub(A)),zoom:E,bearing:i}}fitBounds(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}fitScreenCoordinates(e,n,i,r,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.P.convert(e)),this.transform.pointLocation(t.P.convert(n)),i,r),r,o)}_fitInternal(e,n,i){return e?(delete(n=t.e(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();const i=this._getTransformForUpdate();let r=!1,o=!1,s=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),void 0!==e.center&&(i.center=t.M.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(s=!0,i.pitch=+e.pitch),null==e.padding||i.isPaddingEqual(e.padding)||(i.padding=e.padding),this._applyUpdatedTransform(i),this.fire(new t.k("movestart",n)).fire(new t.k("move",n)),r&&this.fire(new t.k("zoomstart",n)).fire(new t.k("zoom",n)).fire(new t.k("zoomend",n)),o&&this.fire(new t.k("rotatestart",n)).fire(new t.k("rotate",n)).fire(new t.k("rotateend",n)),s&&this.fire(new t.k("pitchstart",n)).fire(new t.k("pitch",n)).fire(new t.k("pitchend",n)),this.fire(new t.k("moveend",n))}calculateCameraOptionsFromTo(e,n,i,r=0){const o=t.Y.fromLngLat(e,n),s=t.Y.fromLngLat(i,r),a=s.x-o.x,l=s.y-o.y,c=s.z-o.z,u=Math.hypot(a,l,c);if(0===u)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(a,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/u/this.transform.tileSize),p=180*Math.atan2(a,-l)/Math.PI;let f=180*Math.acos(h/u)/Math.PI;return f=c<0?90-f:90+f,{center:s.toLngLat(),zoom:d,pitch:f,bearing:p}}easeTo(e,n){var i;this._stop(!1,e.easeId),(!1===(e=t.e({offset:[0,0],duration:500,easing:t.b8},e)).animate||!e.essential&&o.prefersReducedMotion)&&(e.duration=0);const r=this._getTransformForUpdate(),s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),{center:g,zoom:_}=r.getConstrained(t.M.convert(e.center||m),null!==(i=e.zoom)&&void 0!==i?i:s);this._normalizeCenter(g);const y=r.project(m),v=r.project(g).sub(y),b=r.zoomScale(_-s);let x,w;e.around&&(x=t.M.convert(e.around),w=r.locationPoint(x));const E={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||_!==s,this._rotating=this._rotating||a!==u,this._pitching=this._pitching||h!==l,this._padding=!r.isPaddingEqual(d),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,E),this.terrain&&this._prepareElevation(g),this._ease((i=>{if(this._zooming&&(r.zoom=t.z.number(s,_,i)),this._rotating&&(r.bearing=t.z.number(a,u,i)),this._pitching&&(r.pitch=t.z.number(l,h,i)),this._padding&&(r.interpolatePadding(c,d,i),f=r.centerPoint.add(p)),this.terrain&&!e.freezeElevation&&this._updateElevation(i),x)r.setLocationAtPoint(x,w);else{const e=r.zoomScale(r.zoom-s),t=_>s?Math.min(2,b):Math.max(.5,b),n=Math.pow(t,1-i),o=r.unproject(y.add(v.mult(i*n)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,f)}this._applyUpdatedTransform(r),this._fireMoveEvents(n)}),(t=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,t)}),e),this}_prepareEase(e,n,i={}){this._moving=!0,n||i.moving||this.fire(new t.k("movestart",e)),this._zooming&&!i.zooming&&this.fire(new t.k("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new t.k("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new t.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const t=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(t-(n-(t*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.elevation=t.z.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(e){if(!this.transformCameraUpdate)return;const t=e.clone(),{center:n,zoom:i,pitch:r,bearing:o,elevation:s}=this.transformCameraUpdate(t);n&&(t.center=n),void 0!==i&&(t.zoom=i),void 0!==r&&(t.pitch=r),void 0!==o&&(t.bearing=o),void 0!==s&&(t.elevation=s),this.transform.apply(t)}_fireMoveEvents(e){this.fire(new t.k("move",e)),this._zooming&&this.fire(new t.k("zoom",e)),this._rotating&&this.fire(new t.k("rotate",e)),this._pitching&&this.fire(new t.k("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new t.k("zoomend",e)),r&&this.fire(new t.k("rotateend",e)),o&&this.fire(new t.k("pitchend",e)),this.fire(new t.k("moveend",e))}flyTo(e,n){var i;if(!e.essential&&o.prefersReducedMotion){const i=t.L(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.b8},e);const r=this._getTransformForUpdate(),s=this.getZoom(),a=this.getBearing(),l=this.getPitch(),c=this.getPadding(),u="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:l,d="padding"in e?e.padding:r.padding,p=t.P.convert(e.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),{center:g,zoom:_}=r.getConstrained(t.M.convert(e.center||m),null!==(i=e.zoom)&&void 0!==i?i:s);this._normalizeCenter(g);const y=r.zoomScale(_-s),v=r.project(m),b=r.project(g).sub(v);let x=e.curve;const w=Math.max(r.width,r.height),E=w/y,S=b.mag();if("minZoom"in e){const n=t.ac(Math.min(e.minZoom,s,_),r.minZoom,r.maxZoom),i=w/r.zoomScale(n-s);x=Math.sqrt(i/S*2)}const T=x*x;function A(e){const t=(E*E-w*w+(e?-1:1)*T*T*S*S)/(2*(e?E:w)*T*S);return Math.log(Math.sqrt(t*t+1)-t)}function C(e){return(Math.exp(e)-Math.exp(-e))/2}function P(e){return(Math.exp(e)+Math.exp(-e))/2}const I=A(!1);let M=function(e){return P(I)/P(I+x*e)},R=function(e){return w*((P(I)*(C(t=I+x*e)/P(t))-C(I))/T)/S;var t},O=(A(!0)-I)/x;if(Math.abs(S)<1e-6||!isFinite(O)){if(Math.abs(w-E)<1e-6)return this.easeTo(e,n);const t=E<w?-1:1;O=Math.abs(Math.log(E/w))/x,R=()=>0,M=e=>Math.exp(t*x*e)}return e.duration="duration"in e?+e.duration:1e3*O/("screenSpeed"in e?+e.screenSpeed/x:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=a!==u,this._pitching=h!==l,this._padding=!r.isPaddingEqual(d),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(g),this._ease((i=>{const o=i*O,m=1/M(o);r.zoom=1===i?_:s+r.scaleZoom(m),this._rotating&&(r.bearing=t.z.number(a,u,i)),this._pitching&&(r.pitch=t.z.number(l,h,i)),this._padding&&(r.interpolatePadding(c,d,i),f=r.centerPoint.add(p)),this.terrain&&!e.freezeElevation&&this._updateElevation(i);const y=1===i?g:r.unproject(v.add(b.mult(R(o))).mult(m));r.setLocationAtPoint(r.renderWorldCopies?y.wrap():y,f),this._applyUpdatedTransform(r),this._fireMoveEvents(n)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,t){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const e=this._onEaseEnd;delete this._onEaseEnd,e.call(this,t)}return e||null===(n=this.handlers)||void 0===n||n.stop(!1),this}_ease(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=o.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=t.b2(e,-180,180);const i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(e){const t=this.transform;if(!t.renderWorldCopies||t.lngRange)return;const n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(t.M.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const gr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class _r{constructor(e=gr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=e=>{!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType&&"terrain"!==e.type||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1===this._compact?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=s.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=s.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=s.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){s.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const n=this._map._getUIString(`AttributionControl.${t}`);e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((e=>"string"!=typeof e?"":e))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style.sourceCaches;for(const n in t){const i=t[n];if(i.used||i.usedForTerrain){const t=i.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e=e.filter((e=>String(e).trim())),e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,n)=>{for(let i=n+1;i<e.length;i++)if(e[i].indexOf(t)>=0)return!1;return!0}));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class yr{constructor(e={}){this._updateCompact=()=>{const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?!1!==this._compact&&t.classList.add("maplibregl-compact"):t.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=s.create("div","maplibregl-ctrl");const t=s.create("a","maplibregl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://maplibre.org/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){s.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,n=t?this._queue.concat(t):this._queue;for(const t of n)if(t.id===e)return void(t.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const t=this._currentlyRunning=this._queue;this._queue=[];for(const n of t)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var br=t.X([{name:"a_pos3d",type:"Int16",components:3}]);class xr extends t.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const i={};for(const r of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n}))i[r.key]=!0,this._renderableTilesKeys.push(r.key),this._tiles[r.key]||(r.posMatrix=new Float64Array(16),t.aO(r.posMatrix,0,t.W,0,t.W,0,1),this._tiles[r.key]=new se(r,this.tileSize));for(const e in this._tiles)i[e]||delete this._tiles[e]}freeRtt(e){for(const t in this._tiles){const n=this._tiles[t];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const n={};for(const i of this._renderableTilesKeys){const r=this._tiles[i].tileID;if(r.canonical.equals(e.canonical)){const r=e.clone();r.posMatrix=new Float64Array(16),t.aO(r.posMatrix,0,t.W,0,t.W,0,1),n[i]=r}else if(r.canonical.isChildOf(e.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=r.canonical.z-e.canonical.z,a=r.canonical.x-(r.canonical.x>>s<<s),l=r.canonical.y-(r.canonical.y>>s<<s),c=t.W>>s;t.aO(o.posMatrix,0,c,0,c,0,1),t.H(o.posMatrix,o.posMatrix,[-a*c,-l*c,0]),n[i]=o}else if(e.canonical.isChildOf(r.canonical)){const o=e.clone();o.posMatrix=new Float64Array(16);const s=e.canonical.z-r.canonical.z,a=e.canonical.x-(e.canonical.x>>s<<s),l=e.canonical.y-(e.canonical.y>>s<<s),c=t.W>>s;t.aO(o.posMatrix,0,t.W,0,t.W,0,1),t.H(o.posMatrix,o.posMatrix,[a*c,l*c,0]),t.J(o.posMatrix,o.posMatrix,[1/2**s,1/2**s,0]),n[i]=o}}return n}getSourceTile(e,t){const n=this.sourceCache._source;let i=e.overscaledZ-this.deltaZoom;if(i>n.maxzoom&&(i=n.maxzoom),i<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(i).key);let r=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!r||!r.dem)&&t)for(;i>=n.minzoom&&(!r||!r.dem);)r=this.sourceCache.getTileByID(e.scaledTo(i--).key);return r}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter((t=>t.timeAdded>=e))}}class wr{constructor(e,t,n){this.painter=e,this.sourceCache=new xr(t),this.options=n,this.exaggeration="number"==typeof n.exaggeration?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,i,r=t.W){var o;if(!(n>=0&&n<r&&i>=0&&i<r))return 0;const s=this.getTerrainData(e),a=null===(o=s.tile)||void 0===o?void 0:o.dem;if(!a)return 0;const l=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}([],[n/r*t.W,i/r*t.W],s.u_terrain_matrix),c=[l[0]*a.dim,l[1]*a.dim],u=Math.floor(c[0]),h=Math.floor(c[1]),d=c[0]-u,p=c[1]-h;return a.get(u,h)*(1-d)*(1-p)+a.get(u+1,h)*d*(1-p)+a.get(u,h+1)*(1-d)*p+a.get(u+1,h+1)*d*p}getElevationForLngLatZoom(e,n){const{tileID:i,mercatorX:r,mercatorY:o}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(i,r%t.W,o%t.W,t.W)}getElevation(e,n,i,r=t.W){return this.getDEMElevation(e,n,i,r)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const e=this.painter.context,n=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new x(e,n,e.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new x(e,new t.R({width:1,height:1}),e.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.an([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const e=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new x(e,n.dem.getPixels(),e.gl.RGBA,{premultiply:!1}),n.demTexture.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const i=n&&n+n.tileID.key+e.key;if(i&&!this._demMatrixCache[i]){const i=this.sourceCache.sourceCache._source.maxzoom;let r=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=i?r=e.canonical.z-i:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const o=e.canonical.x-(e.canonical.x>>r<<r),s=e.canonical.y-(e.canonical.y>>r<<r),a=t.ba(new Float64Array(16),[1/(t.W<<r),1/(t.W<<r),0]);t.H(a,a,[o*t.W,s*t.W,0]),this._demMatrixCache[e.key]={matrix:a,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:i?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const t=this.painter,n=t.width/devicePixelRatio,i=t.height/devicePixelRatio;return!this._fbo||this._fbo.width===n&&this._fbo.height===i||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new x(t.context,{width:n,height:i,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new x(t.context,{width:n,height:i,data:null},t.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(t.context.gl.NEAREST,t.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=t.context.createFramebuffer(n,i,!0,!1),this._fbo.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,n,i))),this._fbo.colorAttachment.set("coords"===e?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let e=0,t=0;e<this._coordsTextureSize;e++)for(let i=0;i<this._coordsTextureSize;i++,t+=4)n[t+0]=255&i,n[t+1]=255&e,n[t+2]=i>>8<<4|e>>8,n[t+3]=0;const i=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),r=new x(e,i,e.gl.RGBA,{premultiply:!1});return r.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=r,r}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),i=this.painter.context,r=i.gl,o=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),s=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),a=Math.round(this.painter.height/devicePixelRatio);i.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),r.readPixels(o,a-s-1,1,1,r.RGBA,r.UNSIGNED_BYTE,n),i.bindFramebuffer.set(null);const l=n[0]+(n[2]>>4<<8),c=n[1]+((15&n[2])<<8),u=this.coordsIndex[255-n[3]],h=u&&this.sourceCache.getTileByID(u);if(!h)return null;const d=this._coordsTextureSize,p=(1<<h.tileID.canonical.z)*d;return new t.Y((h.tileID.canonical.x*d+l)/p+h.tileID.wrap,(h.tileID.canonical.y*d+c)/p,this.getElevation(h.tileID,l,c,d))}depthAtPoint(e){const t=new Uint8Array(4),n=this.painter.context,i=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),i.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,i.RGBA,i.UNSIGNED_BYTE,t),n.bindFramebuffer.set(null),(t[0]/16777216+t[1]/65536+t[2]/256+t[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,n=new t.bb,i=new t.aY,r=this.meshSize,o=t.W/r,s=r*r;for(let e=0;e<=r;e++)for(let t=0;t<=r;t++)n.emplaceBack(t*o,e*o,0);for(let e=0;e<s;e+=r+1)for(let t=0;t<r;t++)i.emplaceBack(t+e,r+t+e+1,r+t+e+2),i.emplaceBack(t+e,r+t+e+2,t+e+1);const a=n.length,l=a+2*(r+1);for(const e of[0,1])for(let i=0;i<=r;i++)for(const r of[0,1])n.emplaceBack(i*o,e*t.W,r);for(let e=0;e<2*r;e+=2)i.emplaceBack(l+e,l+e+1,l+e+3),i.emplaceBack(l+e,l+e+3,l+e+2),i.emplaceBack(a+e,a+e+3,a+e+1),i.emplaceBack(a+e,a+e+2,a+e+3);const c=n.length,u=c+2*(r+1);for(const e of[0,1])for(let i=0;i<=r;i++)for(const r of[0,1])n.emplaceBack(e*t.W,i*o,r);for(let e=0;e<2*r;e+=2)i.emplaceBack(c+e,c+e+1,c+e+3),i.emplaceBack(c+e,c+e+3,c+e+2),i.emplaceBack(u+e,u+e+3,u+e+1),i.emplaceBack(u+e,u+e+2,u+e+3);return this._mesh={indexBuffer:e.createIndexBuffer(i),vertexBuffer:e.createVertexBuffer(n,br.members),segments:t.$.simpleSegment(0,0,n.length,i.length)},this._mesh}getMeshFrameDelta(e){return 2*Math.PI*t.bc/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,t){var n;const{tileID:i}=this._getOverscaledTileIDFromLngLatZoom(e,t);return null!==(n=this.getMinMaxElevation(i).minElevation)&&void 0!==n?n:0}getMinMaxElevation(e){const t=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return t&&t.dem&&(n.minElevation=t.dem.min*this.exaggeration,n.maxElevation=t.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,n){const i=t.Y.fromLngLat(e.wrap()),r=(1<<n)*t.W,o=i.x*r,s=i.y*r,a=Math.floor(o/t.W),l=Math.floor(s/t.W);return{tileID:new t.Q(n,0,n,a,l),mercatorX:o,mercatorY:s}}}class Er{constructor(e,t,n){this._context=e,this._size=t,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const t=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),n=new x(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return n.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),t.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),t.colorAttachment.set(n.texture),{id:e,fbo:t,texture:n,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((t=>e.id!==t)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const e of this._recentlyUsed)if(!this._objects[e].inUse)return this._objects[e];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&!1===this._objects.some((e=>!e.inUse))}}const Sr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Tr{constructor(e,t){this.painter=e,this.terrain=t,this.pool=new Er(e.context,30,t.sourceCache.tileSize*t.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,t){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((n=>!e._layers[n].isHidden(t))),this._coordsDescendingInv={};for(const t in e.sourceCaches){this._coordsDescendingInv[t]={};const n=e.sourceCaches[t].getVisibleCoordinates();for(const e of n){const n=this.terrain.sourceCache.getTerrainCoords(e);for(const e in n)this._coordsDescendingInv[t][e]||(this._coordsDescendingInv[t][e]=[]),this._coordsDescendingInv[t][e].push(n[e])}}this._coordsDescendingInvStr={};for(const t of e._order){const n=e._layers[t],i=n.source;if(Sr[n.type]&&!this._coordsDescendingInvStr[i]){this._coordsDescendingInvStr[i]={};for(const e in this._coordsDescendingInv[i])this._coordsDescendingInvStr[i][e]=this._coordsDescendingInv[i][e].map((e=>e.key)).sort().join()}}for(const e of this._renderableTiles)for(const t in this._coordsDescendingInvStr){const n=this._coordsDescendingInvStr[t][e.tileID.key];n&&n!==e.rttCoords[t]&&(e.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const n=e.type,i=this.painter,r=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Sr[n]&&(this._prevType&&Sr[this._prevType]||this._stacks.push([]),this._prevType=n,this._stacks[this._stacks.length-1].push(e.id),!r))return!0;if(Sr[this._prevType]||Sr[n]&&r){this._prevType=n;const e=this._stacks.length-1,r=this._stacks[e]||[];for(const n of this._renderableTiles){if(this.pool.isFull()&&(ci(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(n),n.rtt[e]){const t=this.pool.getObjectForId(n.rtt[e].id);if(t.stamp===n.rtt[e].stamp){this.pool.useObject(t);continue}}const o=this.pool.getOrCreateFreeObject();this.pool.useObject(o),this.pool.stampObject(o),n.rtt[e]={id:o.id,stamp:o.stamp},i.context.bindFramebuffer.set(o.fbo.framebuffer),i.context.clear({color:t.aP.transparent,stencil:0}),i.currentStencilSource=void 0;for(let e=0;e<r.length;e++){const t=i.style._layers[r[e]],s=t.source?this._coordsDescendingInv[t.source][n.tileID.key]:[n.tileID];i.context.viewport.set([0,0,o.fbo.width,o.fbo.height]),i._renderTileClippingMasks(t,s),i.renderLayer(i,i.style.sourceCaches[t.source],t,s),t.source&&(n.rttCoords[t.source]=this._coordsDescendingInvStr[t.source][n.tileID.key])}}return ci(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Sr[n]}return!1}}const Ar={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Cr=n,Pr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:gr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Ir=e=>{e.touchstart=e.dragStart,e.touchmoveWindow=e.dragMove,e.touchend=e.dragEnd},Mr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Rr{constructor(e,n,i=!1){this.mousedown=e=>{this.startMouse(t.e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),s.mousePos(this.element,e)),s.addEventListener(window,"mousemove",this.mousemove),s.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=e=>{this.moveMouse(e,s.mousePos(this.element,e))},this.mouseup=e=>{this.mouseRotate.dragEnd(e),this.mousePitch&&this.mousePitch.dragEnd(e),this.offTemp()},this.touchstart=e=>{1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=s.touchPos(this.element,e.targetTouches)[0],this.startTouch(e,this._startPos),s.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.addEventListener(window,"touchend",this.touchend))},this.touchmove=e=>{1!==e.targetTouches.length?this.reset():(this._lastPos=s.touchPos(this.element,e.targetTouches)[0],this.moveTouch(e,this._lastPos))},this.touchend=e=>{0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const r=e.dragRotate._mouseRotate.getClickTolerance(),o=e.dragRotate._mousePitch.getClickTolerance();this.element=n,this.mouseRotate=Vi({clickTolerance:r,enable:!0}),this.touchRotate=(({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:n=.8})=>{const i=new ji;return new Ni({clickTolerance:t,move:(e,t)=>({bearingDelta:(t.x-e.x)*n}),moveStateManager:i,enable:e,assignEvents:Ir})})({clickTolerance:r,enable:!0}),this.map=e,i&&(this.mousePitch=Gi({clickTolerance:o,enable:!0}),this.touchPitch=(({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:n=-.5})=>{const i=new ji;return new Ni({clickTolerance:t,move:(e,t)=>({pitchDelta:(t.y-e.y)*n}),moveStateManager:i,enable:e,assignEvents:Ir})})({clickTolerance:o,enable:!0})),s.addEventListener(n,"mousedown",this.mousedown),s.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),s.addEventListener(n,"touchcancel",this.reset)}startMouse(e,t){this.mouseRotate.dragStart(e,t),this.mousePitch&&this.mousePitch.dragStart(e,t),s.disableDrag()}startTouch(e,t){this.touchRotate.dragStart(e,t),this.touchPitch&&this.touchPitch.dragStart(e,t),s.disableDrag()}moveMouse(e,t){const n=this.map,{bearingDelta:i}=this.mouseRotate.dragMove(e,t)||{};if(i&&n.setBearing(n.getBearing()+i),this.mousePitch){const{pitchDelta:i}=this.mousePitch.dragMove(e,t)||{};i&&n.setPitch(n.getPitch()+i)}}moveTouch(e,t){const n=this.map,{bearingDelta:i}=this.touchRotate.dragMove(e,t)||{};if(i&&n.setBearing(n.getBearing()+i),this.touchPitch){const{pitchDelta:i}=this.touchPitch.dragMove(e,t)||{};i&&n.setPitch(n.getPitch()+i)}}off(){const e=this.element;s.removeEventListener(e,"mousedown",this.mousedown),s.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend),s.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){s.enableDrag(),s.removeEventListener(window,"mousemove",this.mousemove),s.removeEventListener(window,"mouseup",this.mouseup),s.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),s.removeEventListener(window,"touchend",this.touchend)}}let Or;function kr(e,n,i){const r=new t.M(e.lng,e.lat);if(e=new t.M(e.lng,e.lat),n){const r=new t.M(e.lng-360,e.lat),o=new t.M(e.lng+360,e.lat),s=i.locationPoint(e).distSqr(n);i.locationPoint(r).distSqr(n)<s?e=r:i.locationPoint(o).distSqr(n)<s&&(e=o)}for(;Math.abs(e.lng-i.center.lng)>180;){const t=i.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=i.width&&t.y<=i.height)break;e.lng>i.center.lng?e.lng-=360:e.lng+=360}return e.lng!==r.lng&&i.locationPoint(e).y>i.height/2-i.getHorizon()?e:r}const Lr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Dr(e,t,n){const i=e.classList;for(const e in Lr)i.remove(`maplibregl-${n}-anchor-${e}`);i.add(`maplibregl-${n}-anchor-${t}`)}class Fr extends t.E{constructor(e){if(super(),this._onKeyPress=e=>{const t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()},this._onMapClick=e=>{const t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()},this._update=e=>{var t;if(!this._map)return;const n=this._map.loaded()&&!this._map.isMoving();("terrain"===(null==e?void 0:e.type)||"render"===(null==e?void 0:e.type)&&!n)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?kr(this._lngLat,this._flatPos,this._map.transform):null===(t=this._lngLat)||void 0===t?void 0:t.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let i="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?i=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(i=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r=`rotateX(${this._map.getPitch()}deg)`),e&&"moveend"!==e.type||(this._pos=this._pos.round()),s.setTransform(this._element,`${Lr[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${r} ${i}`),o.frameAsync(new AbortController).then((()=>{this._updateOpacity(e&&"moveend"===e.type)})).catch((()=>{}))},this._onMove=e=>{if(!this._isDragging){const t=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.k("dragstart"))),this.fire(new t.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.k("dragend")),this._state="inactive"},this._addDragHandler=e=>{this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(null==e?void 0:e.opacity,null==e?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=t.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=s.create("div"),this._element.setAttribute("aria-label","Map marker");const n=s.createNS("http://www.w3.org/2000/svg","svg"),i=41,r=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${i}px`),n.setAttributeNS(null,"width",`${r}px`),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${i}`);const o=s.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");const a=s.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"fill-rule","nonzero");const l=s.createNS("http://www.w3.org/2000/svg","g");l.setAttributeNS(null,"transform","translate(3.0, 29.0)"),l.setAttributeNS(null,"fill","#000000");const c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const e of c){const t=s.createNS("http://www.w3.org/2000/svg","ellipse");t.setAttributeNS(null,"opacity","0.04"),t.setAttributeNS(null,"cx","10.5"),t.setAttributeNS(null,"cy","5.80029008"),t.setAttributeNS(null,"rx",e.rx),t.setAttributeNS(null,"ry",e.ry),l.appendChild(t)}const u=s.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"fill",this._color);const h=s.createNS("http://www.w3.org/2000/svg","path");h.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),u.appendChild(h);const d=s.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"opacity","0.25"),d.setAttributeNS(null,"fill","#000000");const p=s.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),d.appendChild(p);const f=s.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"transform","translate(6.0, 7.0)"),f.setAttributeNS(null,"fill","#FFFFFF");const m=s.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"transform","translate(8.0, 8.0)");const g=s.createNS("http://www.w3.org/2000/svg","circle");g.setAttributeNS(null,"fill","#000000"),g.setAttributeNS(null,"opacity","0.25"),g.setAttributeNS(null,"cx","5.5"),g.setAttributeNS(null,"cy","5.5"),g.setAttributeNS(null,"r","5.4999962");const _=s.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#FFFFFF"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962"),m.appendChild(g),m.appendChild(_),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(f),a.appendChild(m),n.appendChild(a),n.setAttributeNS(null,"height",i*this._scale+"px"),n.setAttributeNS(null,"width",r*this._scale+"px"),this._element.appendChild(n),this._offset=t.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()})),Dr(this._element,this._anchor,"marker"),e&&e.className)for(const t of e.className.split(" "))this._element.classList.add(t);this._popup=null}addTo(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),s.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.M.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,n=13.5,i=Math.abs(n)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[i,-1*(t-n+i)],"bottom-right":[-i,-1*(t-n+i)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,i;if(!(null===(n=this._map)||void 0===n?void 0:n.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const r=this._map,o=r.terrain.depthAtPoint(this._pos),s=r.terrain.getElevationForLngLatZoom(this._lngLat,r.transform.tileZoom);if(r.transform.lngLatToCameraDepth(this._lngLat,s)-o<.006)return void(this._element.style.opacity=this._opacity);const a=-this._offset.y/r.transform._pixelPerMeter,l=Math.sin(r.getPitch()*Math.PI/180)*a,c=r.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),u=r.transform.lngLatToCameraDepth(this._lngLat,s+l)-c>.006;(null===(i=this._popup)||void 0===i?void 0:i.isOpen())&&u&&this._popup.remove(),this._element.style.opacity=u?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=t.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,t){return void 0===e&&void 0===t&&(this._opacity="1",this._opacityWhenCovered="0.2"),void 0!==e&&(this._opacity=e),void 0!==t&&(this._opacityWhenCovered=t),this._map&&this._updateOpacity(!0),this}}const Nr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Br=0,zr=!1;const jr={maxWidth:100,unit:"metric"};function Ur(e,t,n){const i=n&&n.maxWidth||100,r=e._container.clientHeight/2,o=e.unproject([0,r]),s=e.unproject([i,r]),a=o.distanceTo(s);if(n&&"imperial"===n.unit){const n=3.2808*a;n>5280?Vr(t,i,n/5280,e._getUIString("ScaleControl.Miles")):Vr(t,i,n,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Vr(t,i,a/1852,e._getUIString("ScaleControl.NauticalMiles")):a>=1e3?Vr(t,i,a/1e3,e._getUIString("ScaleControl.Kilometers")):Vr(t,i,a,e._getUIString("ScaleControl.Meters"))}function Vr(e,t,n,i){const r=function(e){const t=Math.pow(10,`${Math.floor(e)}`.length-1);let n=e/t;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n),t*n}(n);e.style.width=t*(r/n)+"px",e.innerHTML=`${r}&nbsp;${i}`}const Gr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},$r=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wr(e){if(e){if("number"==typeof e){const n=Math.round(Math.abs(e)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,e),"top-left":new t.P(n,n),"top-right":new t.P(-n,n),bottom:new t.P(0,-e),"bottom-left":new t.P(n,-n),"bottom-right":new t.P(-n,-n),left:new t.P(e,0),right:new t.P(-e,0)}}if(e instanceof t.P||Array.isArray(e)){const n=t.P.convert(e);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:t.P.convert(e.center||[0,0]),top:t.P.convert(e.top||[0,0]),"top-left":t.P.convert(e["top-left"]||[0,0]),"top-right":t.P.convert(e["top-right"]||[0,0]),bottom:t.P.convert(e.bottom||[0,0]),"bottom-left":t.P.convert(e["bottom-left"]||[0,0]),"bottom-right":t.P.convert(e["bottom-right"]||[0,0]),left:t.P.convert(e.left||[0,0]),right:t.P.convert(e.right||[0,0])}}return Wr(new t.P(0,0))}const Hr=n;e.AJAXError=t.bf,e.Evented=t.E,e.LngLat=t.M,e.MercatorCoordinate=t.Y,e.Point=t.P,e.addProtocol=t.bg,e.config=t.a,e.removeProtocol=t.bh,e.AttributionControl=_r,e.BoxZoomHandler=Oi,e.CanvasSource=Q,e.CooperativeGesturesHandler=ur,e.DoubleClickZoomHandler=rr,e.DragPanHandler=ar,e.DragRotateHandler=lr,e.EdgeInsets=pi,e.FullscreenControl=class extends t.E{constructor(e={}){super(),this._onFullscreenChange=()=>{var e;let t=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;null===(e=null==t?void 0:t.shadowRoot)||void 0===e?void 0:e.fullscreenElement;)t=t.shadowRoot.fullscreenElement;t===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,e&&e.container&&(e.container instanceof HTMLElement?this._container=e.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){s.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const e=this._fullscreenButton=s.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);s.create("span","maplibregl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},e.GeoJSONSource=Z,e.GeolocateControl=class extends t.E{constructor(e){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new t.M(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,r=this._map.getBearing(),o=t.e({bearing:r},this.options.fitBoundsOptions),s=$.fromLngLat(n,i);this._map.fitBounds(s,o,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new t.M(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&zr)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=e=>{if(this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=s.create("button","maplibregl-ctrl-geolocate",this._container),s.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=e,this._geolocateButton.setAttribute("aria-label",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=s.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fr({element:this._dotElement}),this._circleElement=s.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.k("trackuserlocationend")))}))}},this.options=t.e({},Nr,e)}onAdd(e){return this._map=e,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return t._(this,arguments,void 0,(function*(e=!1){if(void 0!==Or&&!e)return Or;if(void 0===window.navigator.permissions)return Or=!!window.navigator.geolocation,Or;try{const e=yield window.navigator.permissions.query({name:"geolocation"});Or="denied"!==e.state}catch(e){Or=!!window.navigator.geolocation}return Or}))}().then((e=>this._setupUI(e))),this._container}onRemove(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),s.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Br=0,zr=!1}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const e=this._map.getBounds(),t=e.getSouthEast(),n=e.getNorthEast(),i=t.distanceTo(n),r=Math.ceil(this._accuracy/(i/this._map._container.clientHeight)*2);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Br--,zr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Br++,Br>1?(e={maximumAge:6e5,timeout:0},zr=!0):(e=this.options.positionOptions,zr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},e.Hash=_i,e.ImageSource=K,e.KeyboardHandler=er,e.LngLatBounds=$,e.LogoControl=yr,e.Map=class extends mr{constructor(e){if(t.bd.mark(t.be.create),null!=(e=t.e({},Pr,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new mi(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._contextLost=e=>{e.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new t.k("webglcontextlost",{originalEvent:e}))},this._contextRestored=e=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.k("webglcontextrestored",{originalEvent:e}))},this._onMapScroll=e=>{if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new vr,this._controls=[],this._mapId=t.a3(),this._locale=t.e({},Ar,e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming,this._imageQueueHandle=p.addThrottleControl((()=>this.isMoving())),this._requestManager=new f(e.transformRequest),"string"==typeof e.container){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),"undefined"!=typeof window){addEventListener("online",this._onWindowOnline,!1);let e=!1;const t=gi((e=>{this._trackResize&&!this._removed&&this.resize(e)._update()}),50);this._resizeObserver=new ResizeObserver((n=>{e?t(n):e=!0})),this._resizeObserver.observe(this._container)}this.handlers=new fr(this,e),this._hash=e.hash&&new _i("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new _r("boolean"==typeof e.attributionControl?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new yr,e.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(e=>{this._update("style"===e.dataType),this.fire(new t.k(`${e.dataType}data`,e))})),this.on("dataloading",(e=>{this.fire(new t.k(`${e.dataType}dataloading`,e))})),this.on("dataabort",(e=>{this.fire(new t.k("sourcedataabort",e))}))}_getMapId(){return this._mapId}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const i=e.onAdd(this);this._controls.push(e);const r=this._controlPositions[n];return-1!==n.indexOf("bottom")?r.insertBefore(i,r.firstChild):r.appendChild(i),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}calculateCameraOptionsFromTo(e,t,n,i){return null==i&&this.terrain&&(i=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(e,t,n,i)}resize(e){var n;const i=this._containerDimensions(),r=i[0],o=i[1],s=this._getClampedPixelRatio(r,o);if(this._resizeCanvas(r,o,s),this.painter.resize(r,o,s),this.painter.overLimit()){const e=this.painter.context.gl;this._maxCanvasSize=[e.drawingBufferWidth,e.drawingBufferHeight];const t=this._getClampedPixelRatio(r,o);this._resizeCanvas(r,o,t),this.painter.resize(r,o,t)}this.transform.resize(r,o),null===(n=this._requestedCameraState)||void 0===n||n.resize(r,o);const a=!this._moving;return a&&(this.stop(),this.fire(new t.k("movestart",e)).fire(new t.k("move",e))),this.fire(new t.k("resize",e)),a&&this.fire(new t.k("moveend",e)),this}_getClampedPixelRatio(e,t){const{0:n,1:i}=this._maxCanvasSize,r=this.getPixelRatio(),o=e*r,s=t*r;return Math.min(o>n?n/o:1,s>i?i/s:1)*r}getPixelRatio(){var e;return null!==(e=this._overridePixelRatio)&&void 0!==e?e:devicePixelRatio}setPixelRatio(e){this._overridePixelRatio=e,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(e){return this.transform.setMaxBounds($.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?60:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this._update()}project(e){return this.transform.locationPoint(t.M.convert(e),this.style&&this.terrain)}unproject(e){return this.transform.pointLocation(t.P.convert(e),this.terrain)}isMoving(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}isZooming(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}isRotating(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}_createDelegatedListener(e,t,n){if("mouseenter"===e||"mouseover"===e){let i=!1;const r=r=>{const o=this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[];o.length?i||(i=!0,n.call(this,new Ai(e,this,r.originalEvent,{features:o}))):i=!1};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const r=r=>{(this.getLayer(t)?this.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?i=!0:i&&(i=!1,n.call(this,new Ai(e,this,r.originalEvent)))},o=t=>{i&&(i=!1,n.call(this,new Ai(e,this,t.originalEvent)))};return{layer:t,listener:n,delegates:{mousemove:r,mouseout:o}}}{const i=e=>{const i=this.getLayer(t)?this.queryRenderedFeatures(e.point,{layers:[t]}):[];i.length&&(e.features=i,n.call(this,e),delete e.features)};return{layer:t,listener:n,delegates:{[e]:i}}}}on(e,t,n){if(void 0===n)return super.on(e,t);const i=this._createDelegatedListener(e,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(i);for(const e in i.delegates)this.on(e,i.delegates[e]);return this}once(e,t,n){if(void 0===n)return super.once(e,t);const i=this._createDelegatedListener(e,t,n);for(const e in i.delegates)this.once(e,i.delegates[e]);return this}off(e,t,n){return void 0===n?super.off(e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&(i=>{const r=this._delegatedListeners[e];for(let e=0;e<r.length;e++){const i=r[e];if(i.layer===t&&i.listener===n){for(const e in i.delegates)this.off(e,i.delegates[e]);return r.splice(e,1),this}}})(),this)}queryRenderedFeatures(e,n){if(!this.style)return[];let i;const r=e instanceof t.P||Array.isArray(e),o=r?e:[[0,0],[this.transform.width,this.transform.height]];if(n=n||(r?{}:e)||{},o instanceof t.P||"number"==typeof o[0])i=[t.P.convert(o)];else{const e=t.P.convert(o[0]),n=t.P.convert(o[1]);i=[e,new t.P(n.x,e.y),n,new t.P(e.x,n.y),e]}return this.style.queryRenderedFeatures(i,n,this.transform)}querySourceFeatures(e,t){return this.style.querySourceFeatures(e,t)}setStyle(e,n){return!1!==(n=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))}setTransformRequest(e){return this._requestManager.setTransformRequest(e),this}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error(`Missing UI string '${e}'`);return t}_updateStyle(e,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(e,t)));const n=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!e)),e?(this.style=new ct(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e,t,n):this.style.loadJSON(e,t,n),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ct(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const i=this._requestManager.transformRequest(e,"Style");t.h(i,new AbortController).then((e=>{this._updateDiff(e.data,n)})).catch((e=>{e&&this.fire(new t.j(e))}))}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e,n)&&this._update(!0)}catch(i){t.w(`Unable to perform style diff: ${i.message||i.error||i}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}isSourceLoaded(e){const n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.j(new Error(`There is no source with ID '${e}'`)))}setTerrain(e){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),e){const n=this.style.sourceCaches[e.source];if(!n)throw new Error(`cannot load terrain, because there exists no source with ID: ${e.source}`);null===this.terrain&&n.reload();for(const n in this.style._layers){const i=this.style._layers[n];"hillshade"===i.type&&i.source===e.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new wr(this.painter,n,e),this.painter.renderToTexture=new Tr(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=t=>{"style"===t.dataType?this.terrain.sourceCache.freeRtt():"source"===t.dataType&&t.tile&&(t.sourceId!==e.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(t.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new t.k("terrain",{terrain:e})),this}getTerrain(){var e,t;return null!==(t=null===(e=this.terrain)||void 0===e?void 0:e.options)&&void 0!==t?t:null}areTilesLoaded(){const e=this.style&&this.style.sourceCaches;for(const t in e){const n=e[t]._tiles;for(const e in n){const t=n[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}removeSource(e){return this.style.removeSource(e),this._update(!0)}getSource(e){return this.style.getSource(e)}addImage(e,n,i={}){const{pixelRatio:r=1,sdf:s=!1,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h}=i;if(this._lazyInitEmptyStyle(),!(n instanceof HTMLImageElement||t.b(n))){if(void 0===n.width||void 0===n.height)return this.fire(new t.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:i,height:o,data:d}=n,p=n;return this.style.addImage(e,{data:new t.R({width:i,height:o},new Uint8Array(d)),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0,userImage:p}),p.onAdd&&p.onAdd(this,e),this}}{const{width:i,height:d,data:p}=o.getImageData(n);this.style.addImage(e,{data:new t.R({width:i,height:d},p),pixelRatio:r,stretchX:a,stretchY:l,content:c,textFitWidth:u,textFitHeight:h,sdf:s,version:0})}}updateImage(e,n){const i=this.style.getImage(e);if(!i)return this.fire(new t.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const r=n instanceof HTMLImageElement||t.b(n)?o.getImageData(n):n,{width:s,height:a,data:l}=r;if(void 0===s||void 0===a)return this.fire(new t.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(s!==i.data.width||a!==i.data.height)return this.fire(new t.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const c=!(n instanceof HTMLImageElement||t.b(n));return i.data.replace(l,c),this.style.updateImage(e,i),this}getImage(e){return this.style.getImage(e)}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.j(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(e){return p.getImage(this._requestManager.transformRequest(e,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}moveLayer(e,t){return this.style.moveLayer(e,t),this._update(!0)}removeLayer(e){return this.style.removeLayer(e),this._update(!0)}getLayer(e){return this.style.getLayer(e)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}setFilter(e,t,n={}){return this.style.setFilter(e,t,n),this._update(!0)}getFilter(e){return this.style.getFilter(e)}setPaintProperty(e,t,n,i={}){return this.style.setPaintProperty(e,t,n,i),this._update(!0)}getPaintProperty(e,t){return this.style.getPaintProperty(e,t)}setLayoutProperty(e,t,n,i={}){return this.style.setLayoutProperty(e,t,n,i),this._update(!0)}getLayoutProperty(e,t){return this.style.getLayoutProperty(e,t)}setGlyphs(e,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(e,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(e,t,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(e,t,n,(e=>{e||this._update(!0)})),this}removeSprite(e){return this._lazyInitEmptyStyle(),this.style.removeSprite(e),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(e,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(e,t,(e=>{e||this._update(!0)})),this}setLight(e,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(e,t){return this.style.setFeatureState(e,t),this._update()}removeFeatureState(e,t){return this.style.removeFeatureState(e,t),this._update()}getFeatureState(e){return this.style.getFeatureState(e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}_setupContainer(){const e=this._container;e.classList.add("maplibregl-map");const t=this._canvasContainer=s.create("div","maplibregl-canvas-container",e);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=s.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),i=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],i);const r=this._controlContainer=s.create("div","maplibregl-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{o[e]=s.create("div",`maplibregl-ctrl-${e} `,r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,t,n){this._canvas.width=Math.floor(n*e),this._canvas.height=Math.floor(n*t),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const e={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",(n=>{t={requestedAttributes:e},n&&(t.statusMessage=n.statusMessage,t.type=n.type)}),{once:!0});const n=this._canvas.getContext("webgl2",e)||this._canvas.getContext("webgl",e);if(!n){const e="Failed to initialize WebGL";throw t?(t.message=e,new Error(JSON.stringify(t))):new Error(e)}this.painter=new ui(n,this.transform),a.testSupport(n)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_render(e){const n=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._removed)return;let i=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,r=o.now();this.style.zoomHistory.update(e,r);const s=new t.a8(e,{now:r,fadeDuration:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=s.crossFadingFactor();1===a&&a===this._crossFadingFactor||(i=!0,this._crossFadingFactor=a),this.style.update(s)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,n,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:n,showPadding:this.showPadding}),this.fire(new t.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.bd.mark(t.be.load),this.fire(new t.k("load"))),this.style&&(this.style.hasTransitions()||i)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const r=this._sourcesDirty||this._styleDirty||this._placementDirty;return r||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.k("idle")),!this._loaded||this._fullyLoaded||r||(this._fullyLoaded=!0,t.bd.mark(t.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var e;this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),"undefined"!=typeof window&&removeEventListener("online",this._onWindowOnline,!1),p.removeThrottleControl(this._imageQueueHandle),null===(e=this._resizeObserver)||void 0===e||e.disconnect();const n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),s.remove(this._canvasContainer),s.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),t.bd.clearMetrics(),this._removed=!0,this.fire(new t.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,o.frameAsync(this._frameRequest).then((e=>{t.bd.frame(e),this._frameRequest=null,this._render(e)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get version(){return Cr}getCameraTargetElevation(){return this.transform.elevation}},e.MapMouseEvent=Ai,e.MapTouchEvent=Ci,e.MapWheelEvent=Pi,e.Marker=Fr,e.NavigationControl=class{constructor(e){this._updateZoomButtons=()=>{const e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,t)=>{const n=this._map._getUIString(`NavigationControl.${t}`);e.title=n,e.setAttribute("aria-label",n)},this.options=t.e({},Mr,e),this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),s.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),s.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=s.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Rr(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){s.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(e,t){const n=s.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},e.Popup=class extends t.E{constructor(e){super(),this.remove=()=>(this._content&&s.remove(this._content),this._container&&(s.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var t;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=s.create("div","maplibregl-popup",this._map.getContainer()),this._tip=s.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const e of this.options.className.split(" "))this._container.classList.add(e);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?kr(this._lngLat,this._flatPos,this._map.transform):null===(t=this._lngLat)||void 0===t?void 0:t.wrap(),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let i=this.options.anchor;const r=Wr(this.options.offset);if(!i){const e=this._container.offsetWidth,t=this._container.offsetHeight;let o;o=n.y+r.bottom.y<t?["top"]:n.y>this._map.transform.height-t?["bottom"]:[],n.x<e/2?o.push("left"):n.x>this._map.transform.width-e/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}let o=n.add(r[i]);this.options.subpixelPositioning||(o=o.round()),s.setTransform(this._container,`${Lr[i]} translate(${o.x}px,${o.y}px)`),Dr(this._container,i,"popup")},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(Gr),e)}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.M.convert(e),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),n=document.createElement("body");let i;for(n.innerHTML=e;i=n.firstChild,i;)t.appendChild(i);return this.setDOMContent(t)}getMaxWidth(){var e;return null===(e=this._container)||void 0===e?void 0:e.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=s.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(e){return this._container&&this._container.classList.add(e),this}removeClassName(e){return this._container&&this._container.classList.remove(e),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){if(this._container)return this._container.classList.toggle(e)}setSubpixelPositioning(e){this.options.subpixelPositioning=e}_createCloseButton(){this.options.closeButton&&(this._closeButton=s.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector($r);e&&e.focus()}},e.RasterDEMTileSource=X,e.RasterTileSource=q,e.ScaleControl=class{constructor(e){this._onMove=()=>{Ur(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ur(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},jr),e)}getDefaultPosition(){return"bottom-left"}onAdd(e){return this._map=e,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){s.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},e.ScrollZoomHandler=ir,e.Style=ct,e.TerrainControl=class{constructor(e){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=e}onAdd(e){return this._map=e,this._container=s.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=s.create("button","maplibregl-ctrl-terrain",this._container),s.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){s.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},e.TwoFingersTouchPitchHandler=Ji,e.TwoFingersTouchRotateHandler=Yi,e.TwoFingersTouchZoomHandler=Xi,e.TwoFingersTouchZoomRotateHandler=cr,e.VectorTileSource=H,e.VideoSource=J,e.addSourceType=(e,n)=>t._(void 0,void 0,void 0,(function*(){if(te(e))throw new Error(`A source type called "${e}" already exists.`);((e,t)=>{ee[e]=t})(e,n)})),e.clearPrewarmedResources=function(){const e=D;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(O),D=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},e.getRTLTextPluginStatus=function(){return oe().getRTLTextPluginStatus()},e.getVersion=function(){return Hr},e.getWorkerCount=function(){return k.workerCount},e.getWorkerUrl=function(){return t.a.WORKER_URL},e.importScriptInWorkers=function(e){return z().broadcast("IS",e)},e.prewarm=function(){N().acquire(O)},e.setMaxParallelImageRequests=function(e){t.a.MAX_PARALLEL_IMAGE_REQUESTS=e},e.setRTLTextPlugin=function(e,t){return oe().setRTLTextPlugin(e,t)},e.setWorkerCount=function(e){k.workerCount=e},e.setWorkerUrl=function(e){t.a.WORKER_URL=e}})),e}()}},h={};function d(e){var t=h[e];if(void 0!==t)return t.exports;var n=h[e]={id:e,exports:{}};return u[e].call(n.exports,n,n.exports,d),n.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},c=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,d.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);d.r(n);var i={};l=l||[null,c({}),c([]),c(c)];for(var r=2&t&&e;"object"==typeof r&&!~l.indexOf(r);r=c(r))Object.getOwnPropertyNames(r).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,d.d(n,i),n},d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.nc=void 0;var p={};return(()=>{"use strict";d.r(p),d.d(p,{plugin:()=>MO});var e,t=d(7781);!function(e){e.Zero="zero",e.Coordinates="coords",e.Auto="auto"}(e||(e={}));const n=new t.Registry((()=>[{id:"auto",name:"Fit to data"},{id:"zero",name:"(0°, 0°)",lat:0,lon:0},{id:"north-america",name:"North America",lat:40,lon:-100,zoom:4},{id:"europe",name:"Europe",lat:46,lon:14,zoom:4},{id:"west-asia",name:"West Asia",lat:26,lon:53,zoom:4},{id:"se-asia",name:"South-east Asia",lat:10,lon:106,zoom:4},{id:"coords",name:"Coordinates"}])),i={id:e.Zero,lat:0,lon:0,zoom:1};var r=d(5959),o=d.n(r),s=d(3498),a=Object.defineProperty,l=(e,t)=>a(e,"name",{value:t,configurable:!0});function c(e,t){return e.coordinates?e.coordinates.length===t.coordinates.length:e.length===t.length}function u(e){return e.coordinates.map((t=>({type:e.type.replace("Multi",""),coordinates:t})))}l(class{constructor(e){var t,n,i;this.direction=!1,this.compareProperties=!0,this.precision=10**-(null!=(t=null==e?void 0:e.precision)?t:17),this.direction=null!=(n=null==e?void 0:e.direction)&&n,this.compareProperties=null==(i=null==e?void 0:e.compareProperties)||i}compare(e,t){if(e.type!==t.type)return!1;if(!c(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const n=u(e),i=u(t);return n.every((e=>i.some((t=>this.compare(e,t)))))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every(((e,n)=>Math.abs(e-t[n])<this.precision))}compareLine(e,t,n=0,i=!1){if(!c(e,t))return!1;const r=e;let o=t;if(i&&!this.compareCoord(r[0],o[0])){const e=this.fixStartIndex(o,r);if(!e)return!1;o=e}const s=this.compareCoord(r[n],o[n]);return this.direction||s?this.comparePath(r,o):!!this.compareCoord(r[n],o[o.length-(1+n)])&&this.comparePath(r.slice().reverse(),o)}fixStartIndex(e,t){let n,i=-1;for(let n=0;n<e.length;n++)if(this.compareCoord(e[n],t[0])){i=n;break}return i>=0&&(n=[].concat(e.slice(i,e.length),e.slice(1,i+1))),n}comparePath(e,t){return e.every(((e,n)=>this.compareCoord(e,t[n])))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),i=t.coordinates.slice(1,t.coordinates.length);return n.every((e=>i.some((t=>this.compareLine(e,t,1,!0)))))}return!1}compareGeometryCollection(e,t){return c(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every(((e,n)=>this.compare(e,t.geometries[n])))}compareFeature(e,t){return e.id===t.id&&(!this.compareProperties||s(e.properties,t.properties))&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return c(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every(((e,n)=>this.compare(e,t.features[n])))}compareBBox(e,t){return Boolean(!e.bbox&&!t.bbox)||!(!e.bbox||!t.bbox)&&this.compareCoord(e.bbox,t.bbox)}},"GeojsonEquality"),l(c,"sameLength"),l(u,"explode");var h=6371008.8,f={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*h,kilometers:6371.0088,kilometres:6371.0088,meters:h,metres:h,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:h/1852,radians:1,yards:6967335.223679999},m={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:2.9155334959812285e-7,millimeters:1e6,millimetres:1e6,yards:1.195990046};function g(e,t,n={}){const i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=e,i}function _(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!I(e[0])||!I(e[1]))throw new Error("coordinates must contain numbers");return g({type:"Point",coordinates:e},t,n)}function y(e,t,n={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return g({type:"Polygon",coordinates:e},t,n)}function v(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return g({type:"LineString",coordinates:e},t,n)}function b(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function x(e,t,n={}){return g({type:"MultiLineString",coordinates:e},t,n)}function w(e,t,n={}){return g({type:"MultiPoint",coordinates:e},t,n)}function E(e,t,n={}){return g({type:"MultiPolygon",coordinates:e},t,n)}function S(e,t="kilometers"){const n=f[t];if(!n)throw new Error(t+" units is invalid");return e*n}function T(e,t="kilometers"){const n=f[t];if(!n)throw new Error(t+" units is invalid");return e/n}function A(e,t){return C(T(e,t))}function C(e){return e%(2*Math.PI)*180/Math.PI}function P(e){return e%360*Math.PI/180}function I(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function M(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}l(g,"feature"),l((function(e,t,n={}){switch(e){case"Point":return _(t).geometry;case"LineString":return v(t).geometry;case"Polygon":return y(t).geometry;case"MultiPoint":return w(t).geometry;case"MultiLineString":return x(t).geometry;case"MultiPolygon":return E(t).geometry;default:throw new Error(e+" is invalid")}}),"geometry"),l(_,"point"),l((function(e,t,n={}){return b(e.map((e=>_(e,t))),n)}),"points"),l(y,"polygon"),l((function(e,t,n={}){return b(e.map((e=>y(e,t))),n)}),"polygons"),l(v,"lineString"),l((function(e,t,n={}){return b(e.map((e=>v(e,t))),n)}),"lineStrings"),l(b,"featureCollection"),l(x,"multiLineString"),l(w,"multiPoint"),l(E,"multiPolygon"),l((function(e,t,n={}){return g({type:"GeometryCollection",geometries:e},t,n)}),"geometryCollection"),l((function(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,t||0);return Math.round(e*n)/n}),"round"),l(S,"radiansToLength"),l(T,"lengthToRadians"),l(A,"lengthToDegrees"),l((function(e){let t=e%360;return t<0&&(t+=360),t}),"bearingToAzimuth"),l(C,"radiansToDegrees"),l(P,"degreesToRadians"),l((function(e,t="kilometers",n="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return S(T(e,t),n)}),"convertLength"),l((function(e,t="meters",n="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const i=m[t];if(!i)throw new Error("invalid original units");const r=m[n];if(!r)throw new Error("invalid final units");return e/i*r}),"convertArea"),l(I,"isNumber"),l(M,"isObject"),l((function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach((e=>{if(!I(e))throw new Error("bbox must only contain numbers")}))}),"validateBBox"),l((function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}),"validateId");var R=Object.defineProperty,O=(e,t)=>R(e,"name",{value:t,configurable:!0});function k(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function L(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function D(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}O(k,"getCoord"),O(L,"getCoords"),O((function e(t){if(t.length>1&&I(t[0])&&I(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return e(t[0]);throw new Error("coordinates must only contain numbers")}),"containsNumber"),O((function(e,t,n){if(!t||!n)throw new Error("type and name required");if(!e||e.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.type)}),"geojsonType"),O((function(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)}),"featureOf"),O((function(e,t,n){if(!e)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!e||"FeatureCollection"!==e.type)throw new Error("Invalid input to "+n+", FeatureCollection required");for(const i of e.features){if(!i||"Feature"!==i.type||!i.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!i.geometry||i.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+i.geometry.type)}}),"collectionOf"),O((function(e){return"Feature"===e.type?e.geometry:e}),"getGeom"),O(D,"getType");var F=Object.defineProperty,N=(e,t)=>F(e,"name",{value:t,configurable:!0});function B(e,t,n={}){if(!0===n.final)return z(e,t);const i=k(e),r=k(t),o=P(i[0]),s=P(r[0]),a=P(i[1]),l=P(r[1]),c=Math.sin(s-o)*Math.cos(l),u=Math.cos(a)*Math.sin(l)-Math.sin(a)*Math.cos(l)*Math.cos(s-o);return C(Math.atan2(c,u))}function z(e,t){let n=B(t,e);return n=(n+180)%360,n}N(B,"bearing"),N(z,"calculateFinalBearing");var j=B,U=Object.defineProperty,V=(e,t)=>U(e,"name",{value:t,configurable:!0});function G(e,t,n){if(null!==e)for(var i,r,o,s,a,l,c,u,h=0,d=0,p=e.type,f="FeatureCollection"===p,m="Feature"===p,g=f?e.features.length:1,_=0;_<g;_++){a=(u=!!(c=f?e.features[_].geometry:m?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;y<a;y++){var v=0,b=0;if(null!==(s=u?c.geometries[y]:c)){l=s.coordinates;var x=s.type;switch(h=!n||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===t(l,d,_,v,b))return!1;d++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(!1===t(l[i],d,_,v,b))return!1;d++,"MultiPoint"===x&&v++}"LineString"===x&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(r=0;r<l[i].length-h;r++){if(!1===t(l[i][r],d,_,v,b))return!1;d++}"MultiLineString"===x&&v++,"Polygon"===x&&b++}"Polygon"===x&&v++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(b=0,r=0;r<l[i].length;r++){for(o=0;o<l[i][r].length-h;o++){if(!1===t(l[i][r][o],d,_,v,b))return!1;d++}b++}v++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===G(s.geometries[i],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&!1!==t(e.features[n].properties,n);n++);break;case"Feature":t(e.properties,0)}}function W(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function H(e,t){var n,i,r,o,s,a,l,c,u,h,d=0,p="FeatureCollection"===e.type,f="Feature"===e.type,m=p?e.features.length:1;for(n=0;n<m;n++){for(a=p?e.features[n].geometry:f?e.geometry:e,c=p?e.features[n].properties:f?e.properties:{},u=p?e.features[n].bbox:f?e.bbox:void 0,h=p?e.features[n].id:f?e.id:void 0,s=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=l?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,d,c,u,h))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===t(o.geometries[i],d,c,u,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,d,c,u,h))return!1;d++}}function q(e,t){H(e,(function(e,n,i,r,o){var s,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return!1!==t(g(e,i,{bbox:r,id:o}),n,0)&&void 0}switch(a){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c=e.coordinates[l];if(!1===t(g({type:s,coordinates:c},i),n,l))return!1}}))}function X(e,t){q(e,(function(e,n,i){var r=0;if(e.geometry){var o=e.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,a=0,l=0,c=0;return!1!==G(e,(function(o,u,h,d,p){if(void 0===s||n>a||d>l||p>c)return s=o,a=n,l=d,c=p,void(r=0);var f=v([s,o],e.properties);if(!1===t(f,n,i,p,r))return!1;r++,s=o}))&&void 0}}}))}function Z(e,t){if(!e)throw new Error("geojson is required");q(e,(function(e,n,i){if(null!==e.geometry){var r=e.geometry.type,o=e.geometry.coordinates;switch(r){case"LineString":if(!1===t(e,n,i,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===t(v(o[s],e.properties),n,i,s))return!1}}}))}function Y(e,t={}){if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return G(e,(e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])})),n}V(G,"coordEach"),V((function(e,t,n,i){var r=n;return G(e,(function(e,i,o,s,a){r=0===i&&void 0===n?e:t(r,e,i,o,s,a)}),i),r}),"coordReduce"),V($,"propEach"),V((function(e,t,n){var i=n;return $(e,(function(e,r){i=0===r&&void 0===n?e:t(i,e,r)})),i}),"propReduce"),V(W,"featureEach"),V((function(e,t,n){var i=n;return W(e,(function(e,r){i=0===r&&void 0===n?e:t(i,e,r)})),i}),"featureReduce"),V((function(e){var t=[];return G(e,(function(e){t.push(e)})),t}),"coordAll"),V(H,"geomEach"),V((function(e,t,n){var i=n;return H(e,(function(e,r,o,s,a){i=0===r&&void 0===n?e:t(i,e,r,o,s,a)})),i}),"geomReduce"),V(q,"flattenEach"),V((function(e,t,n){var i=n;return q(e,(function(e,r,o){i=0===r&&0===o&&void 0===n?e:t(i,e,r,o)})),i}),"flattenReduce"),V(X,"segmentEach"),V((function(e,t,n){var i=n,r=!1;return X(e,(function(e,o,s,a,l){i=!1===r&&void 0===n?e:t(i,e,o,s,a,l),r=!0})),i}),"segmentReduce"),V(Z,"lineEach"),V((function(e,t,n){var i=n;return Z(e,(function(e,r,o,s){i=0===r&&void 0===n?e:t(i,e,r,o,s)})),i}),"lineReduce"),V((function(e,t){if(!M(t=t||{}))throw new Error("options is invalid");var n,i=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,s=t.segmentIndex||0,a=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),a=a||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":a=a||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=l.length+s-1),v([l[s],l[s+1]],a,t);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s-1),v([l[o][s],l[o][s+1]],a,t);case"MultiLineString":return r<0&&(r=l.length+r),s<0&&(s=l[r].length+s-1),v([l[r][s],l[r][s+1]],a,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),s<0&&(s=l[r][o].length-s-1),v([l[r][o][s],l[r][o][s+1]],a,t)}throw new Error("geojson is invalid")}),"findSegment"),V((function(e,t){if(!M(t=t||{}))throw new Error("options is invalid");var n,i=t.featureIndex||0,r=t.multiFeatureIndex||0,o=t.geometryIndex||0,s=t.coordIndex||0,a=t.properties;switch(e.type){case"FeatureCollection":i<0&&(i=e.features.length+i),a=a||e.features[i].properties,n=e.features[i].geometry;break;case"Feature":a=a||e.properties,n=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=e;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var l=n.coordinates;switch(n.type){case"Point":return _(l,a,t);case"MultiPoint":return r<0&&(r=l.length+r),_(l[r],a,t);case"LineString":return s<0&&(s=l.length+s),_(l[s],a,t);case"Polygon":return o<0&&(o=l.length+o),s<0&&(s=l[o].length+s),_(l[o][s],a,t);case"MultiLineString":return r<0&&(r=l.length+r),s<0&&(s=l[r].length+s),_(l[r][s],a,t);case"MultiPolygon":return r<0&&(r=l.length+r),o<0&&(o=l[r].length+o),s<0&&(s=l[r][o].length-s),_(l[r][o][s],a,t)}throw new Error("geojson is invalid")}),"findPoint"),(0,Object.defineProperty)(Y,"name",{value:"bbox",configurable:!0});var K=Y;const J={Alerting:"rgb(224, 34, 110)",Pending:"rgba(255, 153, 0)",Normal:"rgb(27, 133, 94)"},Q="-:",ee={},te=["node","connector"];var ne,ie;function re(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function oe(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){re(o,i,r,s,a,"next",e)}function a(e){re(o,i,r,s,a,"throw",e)}s(void 0)}))}}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){se(e,t,n[t])}))}return e}function le(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ce(e,t){if(!(null==e?void 0:e.length))return[];if(!t)return e.map((e=>e.at(-1)));const n=[];for(const i of e){let e=0,r=i.length-1,o=null;for(;e<=r;){const n=Math.floor((e+r)/2),s=i[n];s.timeEnd<=t?(o=s,e=n+1):r=n-1}o&&n.push(o)}const i=n.sort(((e,t)=>{const n={Alerting:1,Pending:2,Normal:3},i=e.newState.startsWith("Alerting")?"Alerting":e.newState.startsWith("Pending")?"Pending":"Normal",r=t.newState.startsWith("Alerting")?"Alerting":t.newState.startsWith("Pending")?"Pending":"Normal";return n[i]-n[r]}));return i}!function(e){e.Icons="icons",e.Points="markers",e.Lines="edit-lines",e.Polygons="polygons",e.Path="path",e.GeoJson="geojson",e.Text="text",e.Hull="convex-hull"}(ne||(ne={})),function(e){e.MoveNode="dragNode",e.DragLine="dragLine",e.SetLineId="setLineId",e.DeleteSource="deleteSource"}(ie||(ie={}));const ue=e=>{const t=e.match(/[\d.]+/g);if(null===t||t.length<3)return[0,0,0];const n=t.slice(0).map(Number);return n[3]=255*(n[3]||1),n};function he(e){e.startsWith("#")&&(e=e.slice(1));let t=1;8===e.length&&(t=parseInt(e.substr(6,2),16)/255,e=e.substr(0,6));const n=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),r=parseInt(e.substr(4,2),16);return 1!==t?`rgba(${n}, ${i}, ${r}, ${t.toFixed(2)})`:`rgb(${n}, ${i}, ${r})`}function de(e){if(!e||!e.startsWith("[")&&parseInt(e,10))return null!=e?e:null;try{var t;return null!==(t=JSON.parse(e))&&void 0!==t?t:e}catch(t){return null!=e?e:null}}function pe({features:e,switchMap:t,lineSwitchMap:n,getisOffset:i,time:r}){if(!e||!Array.isArray(e)||(null==e?void 0:e.length)<1)return[[],[]];const o=[],s=[...e];return e.forEach(((e,r)=>{if(!(null==e?void 0:e.properties))return;const{parPath:a}=null==e?void 0:e.properties;if(a&&!((null==a?void 0:a.length)<1))if(i)for(let i=1;i<(null==a?void 0:a.length);i++){var l,c,u,h,d,p,f,m,g,_,y;let r=a[i],j=a[i-1];const U="string"==typeof r&&t.get(null==r?void 0:r.split(Q)[0]),V="string"==typeof j&&t.get(null==j?void 0:j.split(Q)[0]);var v;const G=null!==(v=(null==U||null===(l=U.properties)||void 0===l?void 0:l.sources)&&Object.values(U.properties.sources))&&void 0!==v?v:[];var b;const $=null!==(b=(null==V||null===(c=V.properties)||void 0===c?void 0:c.sources)&&Object.values(V.properties.sources))&&void 0!==b?b:[];let W=null,H=null;(null==G?void 0:G.length)>0&&(null==$?void 0:$.length)>0?G.forEach(((e,t)=>{const{parPath:n}=e;$.forEach(((e,t)=>{const{parPath:i}=e;i[0]===(null==n?void 0:n.at(-1))&&(W=n),n[0]===(null==i?void 0:i.at(-1))&&(H=i)}))})):(null==G?void 0:G.length)<1&&(null==$?void 0:$.length)>0&&$.forEach(((e,t)=>{const{parPath:n}=e;n.at(-1)===r&&(W=n)}));const q="string"==typeof r?null==t?void 0:t.get(r):null;s.push(q);let X=null==q||null===(h=q.properties)||void 0===h||null===(u=h.threshold)||void 0===u?void 0:u.color,Z=null==q||null===(p=q.properties)||void 0===p||null===(d=p.threshold)||void 0===d?void 0:d.lineWidth;const Y=null==q?void 0:q.properties.aggrType,K="string"==typeof j?null==t?void 0:t.get(j):null,J=null==K||null===(f=K.properties)||void 0===f?void 0:f.aggrType;let ee=null==K||null===(g=K.properties)||void 0===g||null===(m=g.threshold)||void 0===m?void 0:m.color,ne=null==K||null===(y=K.properties)||void 0===y||null===(_=y.threshold)||void 0===_?void 0:_.lineWidth;if("string"==typeof r&&"string"==typeof j||Array.isArray(r)||Array.isArray(j)&&(q||K)){var x,w,E,S;let i,s,a,l,c,u;if(te.includes(J)&&te.includes(Y)&&(W||H)){const e=W||(null!=H?H:[]),i=ee||X,r=ne||Z,s=[];if(null==e||e.forEach((e=>{if("string"==typeof e){var i,r;const a=null!==(r=null==n?void 0:n.get(e))&&void 0!==r?r:null==n?void 0:n.get(e+Q+0),l=(null==a||a.properties.aggrType,null==a?void 0:a.geometry);var o;const c=l&&l.coordinates&&l.coordinates.length>0?l.coordinates[0][0]:null!==(o=null==t||null===(i=t.get(e))||void 0===i?void 0:i.geometry.coordinates)&&void 0!==o?o:null;c&&s.push(c)}else{if(!Array.isArray(e))return null;s.push(e)}})),o.push([s,i,r]),e)continue}if("string"==typeof r){var T,A,C,P,I,M,R;const e=null!==(R=null==n?void 0:n.get(r))&&void 0!==R?R:null==n?void 0:n.get(r+Q+0);s=null==e||null===(A=e.properties)||void 0===A||null===(T=A.threshold)||void 0===T?void 0:T.color,a=null==e||null===(P=e.properties)||void 0===P||null===(C=P.threshold)||void 0===C?void 0:C.lineWidth;const o=null==e?void 0:e.geometry;var O;i=(null==o||null===(I=o.coordinates)||void 0===I?void 0:I.length)>0?o.coordinates[0][0]:null!==(O=null==t||null===(M=t.get(r))||void 0===M?void 0:M.geometry.coordinates)&&void 0!==O?O:null}else i=r;if("string"==typeof j){var k,L,D,F,N,B;const e=null!==(B=null==n?void 0:n.get(j))&&void 0!==B?B:null==n?void 0:n.get(j+Q+0);l=null==e||null===(L=e.properties)||void 0===L||null===(k=L.threshold)||void 0===k?void 0:k.color,c=null==e||null===(F=e.properties)||void 0===F||null===(D=F.threshold)||void 0===D?void 0:D.lineWidth;const i=null==e?void 0:e.geometry;var z;u=i&&i.coordinates&&i.coordinates.length>0?i.coordinates[0][0]:null!==(z=null==t||null===(N=t.get(j))||void 0===N?void 0:N.geometry.coordinates)&&void 0!==z?z:null}else u=j;o.push([[u,i],te.includes(J)&&te.includes(Y)?l:null==e||null===(w=e.properties)||void 0===w||null===(x=w.threshold)||void 0===x?void 0:x.color,te.includes(J)?c:null==e||null===(S=e.properties)||void 0===S||null===(E=S.threshold)||void 0===E?void 0:E.lineWidth])}}else{var j,U,V,G,$;const t=n.get(a.at(-1));s.push(e),s.push(t);const i=null==e?void 0:e.geometry,r=null==i?void 0:i.coordinates,l=null===(j=r[0])||void 0===j?void 0:j[0],c=r[r.length-1],u=null==c?void 0:c.at(-1),h=l&&u&&(null==e||null===(V=e.properties)||void 0===V||null===(U=V.threshold)||void 0===U?void 0:U.color),d=l&&u&&(null==e||null===($=e.properties)||void 0===$||null===(G=$.threshold)||void 0===G?void 0:G.lineWidth);l&&u&&h&&o.push([[l,u],h,d])}})),[s.filter((e=>null!==e)),o.filter((e=>e[0].every((e=>null!==e))))]}function fe(e){if(e)return"Point"===e.type?e.coordinates:"MultiPoint"===e.type||"LineString"===e.type?e.coordinates[0]:"Polygon"===e.type||"MultiLineString"===e.type?e.coordinates[0][0]:"MultiPolygon"===e.type?e.coordinates[0][0][0]:void 0}function me(e){return e>=0&&e<=20?"rgba(14, 205, 50,1)":e<=30?"rgba(255, 221, 87, 0.9)":e<=40?"rgba(237, 129, 40, 1)":e<=50?"rgba(219, 92, 158,1)":e<=75?"rgba(163, 27, 50,1)":e<=100?"rgba(164, 50, 168,1)":"rgb(72, 190, 194)"}function ge(e,t=!1){const n=new DOMParser,i=n.parseFromString(e,"image/svg+xml");t&&(i.querySelector("symbol"),i.querySelectorAll("use").forEach((e=>{const t=e.getAttribute("xlink:href");if(t&&t.startsWith("#")){const o=t.substring(1),s=i.getElementById(o);if(s){var r;const t=s.innerHTML;null===(r=e.parentNode)||void 0===r||r.replaceChild(n.parseFromString(t,"image/svg+xml").documentElement,e)}}})));let r=i.getElementsByTagName("svg")[0],o=r.getAttribute("width"),s=r.getAttribute("height");const a=r.getAttribute("viewBox");if((!o||!s)&&a){var l,c;const e=a.split(" ").map(parseFloat);o=null===(l=e[2])||void 0===l?void 0:l.toString(),s=null===(c=e[3])||void 0===c?void 0:c.toString(),r.setAttribute("width",o),r.setAttribute("height",s)}return{svgText:(new XMLSerializer).serializeToString(i),width:o,height:s}}function _e(e){return ye.apply(this,arguments)}function ye(){return ye=oe((function*(e){const{iconName:t,svgColor:n}=e;if(!t)return null;let i=t.startsWith("public/")?t:"public/plugins/vaduga-mapgl-panel/img/icons/"+t+".svg";const r=t.startsWith("http")?t:i;try{const e=yield fetch(r);if(!e.ok)throw new Error(`Failed to fetch SVG file. Status: ${e.status}`);let n=yield e.text();const{svgText:i,width:o,height:s}=ge(n);return[t,{svgText:i,width:o,height:s}]}catch(e){return console.error("Error fetching SVG file:",e),null}})),ye.apply(this,arguments)}function ve(){return(ve=oe((function*(e){if(e.length){const t=e.filter((e=>e)).map(_e),n=(yield Promise.all(t)).filter((e=>e));return n.length?Object.fromEntries(n):{}}return{}}))).apply(this,arguments)}const be=(e,t,n,i=!1)=>{const r=[];let o=i?.1:n;for(let i=e;i<=t;i+=o){const e=parseFloat(i.toFixed(1));r.push({value:e,label:e.toString()}),1===e&&(o=n)}return r};function xe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw new Error("number"==typeof e?"[MobX] minified error nr: "+e+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}var we={};function Ee(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==d.g?d.g:"undefined"!=typeof self?self:we}var Se=Object.assign,Te=Object.getOwnPropertyDescriptor,Ae=Object.defineProperty,Ce=Object.prototype,Pe=[];Object.freeze(Pe);var Ie={};Object.freeze(Ie);var Me="undefined"!=typeof Proxy,Re=Object.toString();function Oe(){Me||xe("Proxy not available")}function ke(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var Le=function(){};function De(e){return"function"==typeof e}function Fe(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function Ne(e){return null!==e&&"object"==typeof e}function Be(e){if(!Ne(e))return!1;var t=Object.getPrototypeOf(e);if(null==t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n.toString()===Re}function ze(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function je(e,t,n){Ae(e,t,{enumerable:!1,writable:!0,configurable:!0,value:n})}function Ue(e,t,n){Ae(e,t,{enumerable:!1,writable:!1,configurable:!0,value:n})}function Ve(e,t){var n="isMobX"+e;return t.prototype[n]=!0,function(e){return Ne(e)&&!0===e[n]}}function Ge(e){return e instanceof Map}function $e(e){return e instanceof Set}var We=void 0!==Object.getOwnPropertySymbols,He="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:We?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function qe(e){return null===e?null:"object"==typeof e?""+e:e}function Xe(e,t){return Ce.hasOwnProperty.call(e,t)}var Ze=Object.getOwnPropertyDescriptors||function(e){var t={};return He(e).forEach((function(n){t[n]=Te(e,n)})),t};function Ye(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key))?r:String(r)),i)}var r}function Ke(e,t,n){return t&&Ye(e.prototype,t),n&&Ye(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Je.apply(this,arguments)}function Qe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,et(e,t)}function et(e,t){return et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function it(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var rt=Symbol("mobx-stored-annotations");function ot(e){return Object.assign((function(t,n){if(at(n))return e.decorate_20223_(t,n);st(t,n,e)}),e)}function st(e,t,n){Xe(e,rt)||je(e,rt,Je({},e[rt])),function(e){return e.annotationType_===mt}(n)||(e[rt][t]=n)}function at(e){return"object"==typeof e&&"string"==typeof e.kind}var lt=Symbol("mobx administration"),ct=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=fn.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.reportObserved=function(){return Nn(this)},t.reportChanged=function(){Dn(),Bn(this),Fn()},t.toString=function(){return this.name_},e}(),ut=Ve("Atom",ct);function ht(e,t,n){void 0===t&&(t=Le),void 0===n&&(n=Le);var i=new ct(e);return t!==Le&&oi(ni,i,t,undefined),n!==Le&&ri(i,n),i}var dt={identity:function(e,t){return e===t},structural:function(e,t){return Er(e,t)},default:function(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e==1/t:e!=e&&t!=t},shallow:function(e,t){return Er(e,t,1)}};function pt(e,t,n){return _i(e)?e:Array.isArray(e)?Jt.array(e,{name:n}):Be(e)?Jt.object(e,void 0,{name:n}):Ge(e)?Jt.map(e,{name:n}):$e(e)?Jt.set(e,{name:n}):"function"!=typeof e||ei(e)||gi(e)?e:ze(e)?fi(e):Qn(n,e)}function ft(e){return e}var mt="override";function gt(e,t){return{annotationType_:e,options_:t,make_:_t,extend_:yt,decorate_20223_:vt}}function _t(e,t,n,i){var r;if(null!=(r=this.options_)&&r.bound)return null===this.extend_(e,t,n,!1)?0:1;if(i===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(ei(n.value))return 1;var o=bt(e,this,t,n,!1);return Ae(i,t,o),2}function yt(e,t,n,i){var r=bt(e,this,t,n);return e.defineProperty_(t,r,i)}function vt(e,t){var n,i,r,o,s,a=t.kind,l=t.name,c=t.addInitializer,u=this;if("field"!=a){var h;if("method"==a)return ei(e)||(n=e,e=cn(null!=(i=null==(r=u.options_)?void 0:r.name)?i:l.toString(),n,null!=(o=null==(s=u.options_)?void 0:s.autoAction)&&o)),null!=(h=this.options_)&&h.bound&&c((function(){var e=this,t=e[l].bind(e);t.isMobxAction=!0,e[l]=t})),e;xe("Cannot apply '"+u.annotationType_+"' to '"+String(l)+"' (kind: "+a+"):\n'"+u.annotationType_+"' can only be used on properties with a function value.")}else c((function(){st(this,l,u)}))}function bt(e,t,n,i,r){var o,s,a,l,c,u,h,d;void 0===r&&(r=On.safeDescriptors),d=i,t.annotationType_,d.value;var p,f=i.value;return null!=(o=t.options_)&&o.bound&&(f=f.bind(null!=(p=e.proxy_)?p:e.target_)),{value:cn(null!=(s=null==(a=t.options_)?void 0:a.name)?s:n.toString(),f,null!=(l=null==(c=t.options_)?void 0:c.autoAction)&&l,null!=(u=t.options_)&&u.bound?null!=(h=e.proxy_)?h:e.target_:void 0),configurable:!r||e.isPlainObject_,enumerable:!1,writable:!r}}function xt(e,t){return{annotationType_:e,options_:t,make_:wt,extend_:Et,decorate_20223_:St}}function wt(e,t,n,i){var r;if(i===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(null!=(r=this.options_)&&r.bound&&(!Xe(e.target_,t)||!gi(e.target_[t]))&&null===this.extend_(e,t,n,!1))return 0;if(gi(n.value))return 1;var o=Tt(e,this,0,n,!1,!1);return Ae(i,t,o),2}function Et(e,t,n,i){var r,o=Tt(e,this,0,n,null==(r=this.options_)?void 0:r.bound);return e.defineProperty_(t,o,i)}function St(e,t){var n,i=t.name,r=t.addInitializer;return gi(e)||(e=fi(e)),null!=(n=this.options_)&&n.bound&&r((function(){var e=this,t=e[i].bind(e);t.isMobXFlow=!0,e[i]=t})),e}function Tt(e,t,n,i,r,o){var s;void 0===o&&(o=On.safeDescriptors),s=i,t.annotationType_,s.value;var a,l=i.value;return gi(l)||(l=fi(l)),r&&((l=l.bind(null!=(a=e.proxy_)?a:e.target_)).isMobXFlow=!0),{value:l,configurable:!o||e.isPlainObject_,enumerable:!1,writable:!o}}function At(e,t){return{annotationType_:e,options_:t,make_:Ct,extend_:Pt,decorate_20223_:It}}function Ct(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function Pt(e,t,n,i){return function(e,t,n,i){t.annotationType_,i.get}(0,this,0,n),e.defineComputedProperty_(t,Je({},this.options_,{get:n.get,set:n.set}),i)}function It(e,t){var n=this,i=t.name;return(0,t.addInitializer)((function(){var t=nr(this)[lt],r=Je({},n.options_,{get:e,context:this});r.name||(r.name="ObservableObject."+i.toString()),t.values_.set(i,new gn(r))})),function(){return this[lt].getObservablePropValue_(i)}}function Mt(e,t){return{annotationType_:e,options_:t,make_:Rt,extend_:Ot,decorate_20223_:kt}}function Rt(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function Ot(e,t,n,i){var r,o;return function(e,t,n,i){t.annotationType_}(0,this),e.defineObservableProperty_(t,n.value,null!=(r=null==(o=this.options_)?void 0:o.enhancer)?r:pt,i)}function kt(e,t){var n=this,i=t.kind,r=t.name,o=new WeakSet;function s(e,t){var i,s,a=nr(e)[lt],l=new pn(t,null!=(i=null==(s=n.options_)?void 0:s.enhancer)?i:pt,"ObservableObject."+r.toString(),!1);a.values_.set(r,l),o.add(e)}if("accessor"==i)return{get:function(){return o.has(this)||s(this,e.get.call(this)),this[lt].getObservablePropValue_(r)},set:function(e){return o.has(this)||s(this,e),this[lt].setObservablePropValue_(r,e)},init:function(e){return o.has(this)||s(this,e),e}}}var Lt="true",Dt=Ft();function Ft(e){return{annotationType_:Lt,options_:e,make_:Nt,extend_:Bt,decorate_20223_:zt}}function Nt(e,t,n,i){var r,o,s,a;if(n.get)return nn.make_(e,t,n,i);if(n.set){var l=cn(t.toString(),n.set);return i===e.target_?null===e.defineProperty_(t,{configurable:!On.safeDescriptors||e.isPlainObject_,set:l})?0:2:(Ae(i,t,{configurable:!0,set:l}),2)}if(i!==e.target_&&"function"==typeof n.value)return ze(n.value)?(null!=(a=this.options_)&&a.autoBind?fi.bound:fi).make_(e,t,n,i):(null!=(s=this.options_)&&s.autoBind?Qn.bound:Qn).make_(e,t,n,i);var c,u=!1===(null==(r=this.options_)?void 0:r.deep)?Jt.ref:Jt;return"function"==typeof n.value&&null!=(o=this.options_)&&o.autoBind&&(n.value=n.value.bind(null!=(c=e.proxy_)?c:e.target_)),u.make_(e,t,n,i)}function Bt(e,t,n,i){var r,o,s;return n.get?nn.extend_(e,t,n,i):n.set?e.defineProperty_(t,{configurable:!On.safeDescriptors||e.isPlainObject_,set:cn(t.toString(),n.set)},i):("function"==typeof n.value&&null!=(r=this.options_)&&r.autoBind&&(n.value=n.value.bind(null!=(s=e.proxy_)?s:e.target_)),(!1===(null==(o=this.options_)?void 0:o.deep)?Jt.ref:Jt).extend_(e,t,n,i))}function zt(e,t){xe("'"+this.annotationType_+"' cannot be used as a decorator")}var jt={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function Ut(e){return e||jt}Object.freeze(jt);var Vt=Mt("observable"),Gt=Mt("observable.ref",{enhancer:ft}),$t=Mt("observable.shallow",{enhancer:function(e,t,n){return null==e||or(e)||Vi(e)||Zi(e)||Ji(e)?e:Array.isArray(e)?Jt.array(e,{name:n,deep:!1}):Be(e)?Jt.object(e,void 0,{name:n,deep:!1}):Ge(e)?Jt.map(e,{name:n,deep:!1}):$e(e)?Jt.set(e,{name:n,deep:!1}):void 0}}),Wt=Mt("observable.struct",{enhancer:function(e,t){return Er(e,t)?t:e}}),Ht=ot(Vt);function qt(e){return!0===e.deep?pt:!1===e.deep?ft:(t=e.defaultDecorator)&&null!=(n=null==(i=t.options_)?void 0:i.enhancer)?n:pt;var t,n,i}function Xt(e,t,n){return at(t)?Vt.decorate_20223_(e,t):Fe(t)?void st(e,t,Vt):_i(e)?e:Be(e)?Jt.object(e,t,n):Array.isArray(e)?Jt.array(e,t):Ge(e)?Jt.map(e,t):$e(e)?Jt.set(e,t):"object"==typeof e&&null!==e?e:Jt.box(e,t)}Se(Xt,Ht);var Zt,Yt,Kt={box:function(e,t){var n=Ut(t);return new pn(e,qt(n),n.name,!0,n.equals)},array:function(e,t){var n=Ut(t);return(!1===On.useProxies||!1===n.proxy?_r:ki)(e,qt(n),n.name)},map:function(e,t){var n=Ut(t);return new Xi(e,qt(n),n.name)},set:function(e,t){var n=Ut(t);return new Ki(e,qt(n),n.name)},object:function(e,t,n){return xr((function(){return li(!1===On.useProxies||!1===(null==n?void 0:n.proxy)?nr({},n):function(e,t){var n,i;return Oe(),null!=(i=(n=(e=nr(e,t))[lt]).proxy_)?i:n.proxy_=new Proxy(e,bi)}({},n),e,t)}))},ref:ot(Gt),shallow:ot($t),deep:Ht,struct:ot(Wt)},Jt=Se(Xt,Kt),Qt="computed",en=At(Qt),tn=At("computed.struct",{equals:dt.structural}),nn=function(e,t){if(at(t))return en.decorate_20223_(e,t);if(Fe(t))return st(e,t,en);if(Be(e))return ot(At(Qt,e));var n=Be(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new gn(n)};Object.assign(nn,en),nn.struct=ot(tn);var rn,on=0,sn=1,an=null!=(Zt=null==(Yt=Te((function(){}),"name"))?void 0:Yt.configurable)&&Zt,ln={value:"action",configurable:!0,writable:!1,enumerable:!1};function cn(e,t,n,i){function r(){return function(e,t,n,i,r){var o=function(e,t,n,i){var r=!1,o=0,s=On.trackingDerivation,a=!t||!s;Dn();var l=On.allowStateChanges;a&&(Sn(),l=un(!0));var c={runAsAction_:a,prevDerivation_:s,prevAllowStateChanges_:l,prevAllowStateReads_:An(!0),notifySpy_:r,startTime_:o,actionId_:sn++,parentActionId_:on};return on=c.actionId_,c}(0,t);try{return n.apply(i,r)}catch(e){throw o.error_=e,e}finally{!function(e){on!==e.actionId_&&xe(30),on=e.parentActionId_,void 0!==e.error_&&(On.suppressReactionErrors=!0),hn(e.prevAllowStateChanges_),Cn(e.prevAllowStateReads_),Fn(),e.runAsAction_&&Tn(e.prevDerivation_),On.suppressReactionErrors=!1}(o)}}(0,n,t,i||this,arguments)}return void 0===n&&(n=!1),r.isMobxAction=!0,r.toString=function(){return t.toString()},an&&(ln.value=e,Ae(r,"name",ln)),r}function un(e){var t=On.allowStateChanges;return On.allowStateChanges=e,t}function hn(e){On.allowStateChanges=e}rn=Symbol.toPrimitive;var dn,pn=function(e){function t(t,n,i,r,o){var s;return void 0===i&&(i="ObservableValue"),void 0===r&&(r=!0),void 0===o&&(o=dt.default),(s=e.call(this,i)||this).enhancer=void 0,s.name_=void 0,s.equals=void 0,s.hasUnreportedChange_=!1,s.interceptors_=void 0,s.changeListeners_=void 0,s.value_=void 0,s.dehancer=void 0,s.enhancer=n,s.name_=i,s.equals=o,s.value_=n(t,void 0,i),s}Qe(t,e);var n=t.prototype;return n.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},n.set=function(e){this.value_,(e=this.prepareNewValue_(e))!==On.UNCHANGED&&this.setNewValue_(e)},n.prepareNewValue_=function(e){if(xi(this)){var t=Ei(this,{object:this,type:Mi,newValue:e});if(!t)return On.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?On.UNCHANGED:e},n.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),Si(this)&&Ai(this,{type:Mi,object:this,newValue:e,oldValue:t})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(e){return wi(this,e)},n.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:Mi,newValue:this.value_,oldValue:void 0}),Ti(this,e)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return qe(this.get())},n[rn]=function(){return this.valueOf()},t}(ct);dn=Symbol.toPrimitive;var fn,mn,gn=function(){function e(e){this.dependenciesState_=fn.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=fn.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new yn(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=mn.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||xe(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=cn("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?dt.structural:dt.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){var e;(e=this).lowestObserverState_===fn.UP_TO_DATE_&&(e.lowestObserverState_=fn.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===fn.UP_TO_DATE_&&(e.dependenciesState_=fn.POSSIBLY_STALE_,e.onBecomeStale_())})))},t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.get=function(){if(this.isComputing_&&xe(32,this.name_,this.derivation),0!==On.inBatch||0!==this.observers_.size||this.keepAlive_){if(Nn(this),bn(this)){var e=On.trackingContext;this.keepAlive_&&!e&&(On.trackingContext=this),this.trackAndCompute()&&((t=this).lowestObserverState_!==fn.STALE_&&(t.lowestObserverState_=fn.STALE_,t.observers_.forEach((function(e){e.dependenciesState_===fn.POSSIBLY_STALE_?e.dependenciesState_=fn.STALE_:e.dependenciesState_===fn.UP_TO_DATE_&&(t.lowestObserverState_=fn.UP_TO_DATE_)})))),On.trackingContext=e}}else bn(this)&&(this.warnAboutUntrackedRead_(),Dn(),this.value_=this.computeValue_(!1),Fn());var t,n=this.value_;if(vn(n))throw n.cause;return n},t.set=function(e){if(this.setter_){this.isRunningSetter_&&xe(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter_=!1}}else xe(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===fn.NOT_TRACKING_,n=this.computeValue_(!0),i=t||vn(e)||vn(n)||!this.equals_(e,n);return i&&(this.value_=n),i},t.computeValue_=function(e){this.isComputing_=!0;var t,n=un(!1);if(e)t=xn(this,this.derivation,this.scope_);else if(!0===On.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(e){t=new yn(e)}return hn(n),this.isComputing_=!1,t},t.suspend_=function(){this.keepAlive_||(wn(this),this.value_=void 0)},t.observe_=function(e,t){var n=this,i=!0,r=void 0;return function(e,t){var n,i,r,o,s;void 0===t&&(t=Ie);var a,l=null!=(n=null==(i=t)?void 0:i.name)?n:"Autorun";if(t.scheduler||t.delay){var c=function(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:ti}(t),u=!1;a=new zn(l,(function(){u||(u=!0,c((function(){u=!1,a.isDisposed_||a.track(h)})))}),t.onError,t.requiresObservable)}else a=new zn(l,(function(){this.track(h)}),t.onError,t.requiresObservable);function h(){e(a)}return null!=(r=t)&&null!=(o=r.signal)&&o.aborted||a.schedule_(),a.getDisposer_(null==(s=t)?void 0:s.signal)}((function(){var o=n.get();if(!i||t){var s=Sn();e({observableKind:"computed",debugObjectName:n.name_,type:Mi,object:n,newValue:o,oldValue:r}),Tn(s)}i=!1,r=o}))},t.warnAboutUntrackedRead_=function(){},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return qe(this.get())},t[dn]=function(){return this.valueOf()},e}(),_n=Ve("ComputedValue",gn);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}(fn||(fn={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(mn||(mn={}));var yn=function(e){this.cause=void 0,this.cause=e};function vn(e){return e instanceof yn}function bn(e){switch(e.dependenciesState_){case fn.UP_TO_DATE_:return!1;case fn.NOT_TRACKING_:case fn.STALE_:return!0;case fn.POSSIBLY_STALE_:for(var t=An(!0),n=Sn(),i=e.observing_,r=i.length,o=0;o<r;o++){var s=i[o];if(_n(s)){if(On.disableErrorBoundaries)s.get();else try{s.get()}catch(e){return Tn(n),Cn(t),!0}if(e.dependenciesState_===fn.STALE_)return Tn(n),Cn(t),!0}}return Pn(e),Tn(n),Cn(t),!1}}function xn(e,t,n){var i=An(!0);Pn(e),e.newObserving_=new Array(0===e.runId_?100:e.observing_.length),e.unboundDepsCount_=0,e.runId_=++On.runId;var r,o=On.trackingDerivation;if(On.trackingDerivation=e,On.inBatch++,!0===On.disableErrorBoundaries)r=t.call(n);else try{r=t.call(n)}catch(e){r=new yn(e)}return On.inBatch--,On.trackingDerivation=o,function(e){for(var t=e.observing_,n=e.observing_=e.newObserving_,i=fn.UP_TO_DATE_,r=0,o=e.unboundDepsCount_,s=0;s<o;s++){var a=n[s];0===a.diffValue_&&(a.diffValue_=1,r!==s&&(n[r]=a),r++),a.dependenciesState_>i&&(i=a.dependenciesState_)}for(n.length=r,e.newObserving_=null,o=t.length;o--;){var l=t[o];0===l.diffValue_&&kn(l,e),l.diffValue_=0}for(;r--;){var c=n[r];1===c.diffValue_&&(c.diffValue_=0,h=e,(u=c).observers_.add(h),u.lowestObserverState_>h.dependenciesState_&&(u.lowestObserverState_=h.dependenciesState_))}var u,h;i!==fn.UP_TO_DATE_&&(e.dependenciesState_=i,e.onBecomeStale_())}(e),Cn(i),r}function wn(e){var t=e.observing_;e.observing_=[];for(var n=t.length;n--;)kn(t[n],e);e.dependenciesState_=fn.NOT_TRACKING_}function En(e){var t=Sn();try{return e()}finally{Tn(t)}}function Sn(){var e=On.trackingDerivation;return On.trackingDerivation=null,e}function Tn(e){On.trackingDerivation=e}function An(e){var t=On.allowStateReads;return On.allowStateReads=e,t}function Cn(e){On.allowStateReads=e}function Pn(e){if(e.dependenciesState_!==fn.UP_TO_DATE_){e.dependenciesState_=fn.UP_TO_DATE_;for(var t=e.observing_,n=t.length;n--;)t[n].lowestObserverState_=fn.UP_TO_DATE_}}var In=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},Mn=!0,Rn=!1,On=function(){var e=Ee();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(Mn=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new In).version&&(Mn=!1),Mn?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new In):(setTimeout((function(){Rn||xe(35)}),1),new In)}();function kn(e,t){e.observers_.delete(t),0===e.observers_.size&&Ln(e)}function Ln(e){!1===e.isPendingUnobservation_&&(e.isPendingUnobservation_=!0,On.pendingUnobservations.push(e))}function Dn(){On.inBatch++}function Fn(){if(0==--On.inBatch){Vn();for(var e=On.pendingUnobservations,t=0;t<e.length;t++){var n=e[t];n.isPendingUnobservation_=!1,0===n.observers_.size&&(n.isBeingObserved_&&(n.isBeingObserved_=!1,n.onBUO()),n instanceof gn&&n.suspend_())}On.pendingUnobservations=[]}}function Nn(e){var t=On.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved_&&On.trackingContext&&(e.isBeingObserved_=!0,e.onBO())),e.isBeingObserved_):(0===e.observers_.size&&On.inBatch>0&&Ln(e),!1)}function Bn(e){e.lowestObserverState_!==fn.STALE_&&(e.lowestObserverState_=fn.STALE_,e.observers_.forEach((function(e){e.dependenciesState_===fn.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=fn.STALE_})))}var zn=function(){function e(e,t,n,i){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=fn.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=mn.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=n,this.requiresObservable_=i}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,On.pendingReactions.push(this),Vn())},t.isScheduled=function(){return this.isScheduled_},t.runReaction_=function(){if(!this.isDisposed_){Dn(),this.isScheduled_=!1;var e=On.trackingContext;if(On.trackingContext=this,bn(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(e){this.reportExceptionInDerivation_(e)}}On.trackingContext=e,Fn()}},t.track=function(e){if(!this.isDisposed_){Dn(),this.isRunning_=!0;var t=On.trackingContext;On.trackingContext=this;var n=xn(this,e,void 0);On.trackingContext=t,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&wn(this),vn(n)&&this.reportExceptionInDerivation_(n.cause),Fn()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(On.disableErrorBoundaries)throw e;var n="[mobx] uncaught error in '"+this+"'";On.suppressReactionErrors||console.error(n,e),On.globalReactionErrorHandlers.forEach((function(n){return n(e,t)}))}},t.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(Dn(),wn(this),Fn()))},t.getDisposer_=function(e){var t=this,n=function n(){t.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",n)};return null==e||null==e.addEventListener||e.addEventListener("abort",n),n[lt]=this,n},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){void 0===e&&(e=!1)},e}(),jn=100,Un=function(e){return e()};function Vn(){On.inBatch>0||On.isRunningReactions||Un(Gn)}function Gn(){On.isRunningReactions=!0;for(var e=On.pendingReactions,t=0;e.length>0;){++t===jn&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var n=e.splice(0),i=0,r=n.length;i<r;i++)n[i].runReaction_()}On.isRunningReactions=!1}var $n=Ve("Reaction",zn),Wn="action",Hn="autoAction",qn=gt(Wn),Xn=gt("action.bound",{bound:!0}),Zn=gt(Hn,{autoAction:!0}),Yn=gt("autoAction.bound",{autoAction:!0,bound:!0});function Kn(e){return function(t,n){return De(t)?cn(t.name||"<unnamed action>",t,e):De(n)?cn(t,n,e):at(n)?(e?Zn:qn).decorate_20223_(t,n):Fe(n)?st(t,n,e?Zn:qn):Fe(t)?ot(gt(e?Hn:Wn,{name:t,autoAction:e})):void 0}}var Jn=Kn(!1);Object.assign(Jn,qn);var Qn=Kn(!0);function ei(e){return De(e)&&!0===e.isMobxAction}Object.assign(Qn,Zn),Jn.bound=ot(Xn),Qn.bound=ot(Yn);var ti=function(e){return e()};var ni="onBO",ii="onBUO";function ri(e,t,n){return oi(ii,e,t,n)}function oi(e,t,n,i){var r="function"==typeof i?yr(t,n):yr(t),o=De(i)?i:n,s=e+"L";return r[s]?r[s].add(o):r[s]=new Set([o]),function(){var e=r[s];e&&(e.delete(o),0===e.size&&delete r[s])}}var si="always";function ai(e){!0===e.isolateGlobalState&&function(){if((On.pendingReactions.length||On.inBatch||On.isRunningReactions)&&xe(36),Rn=!0,Mn){var e=Ee();0==--e.__mobxInstanceCount&&(e.__mobxGlobals=void 0),On=new In}}();var t,n,i=e.useProxies,r=e.enforceActions;if(void 0!==i&&(On.useProxies=i===si||"never"!==i&&"undefined"!=typeof Proxy),"ifavailable"===i&&(On.verifyProxies=!0),void 0!==r){var o=r===si?si:"observed"===r;On.enforceActions=o,On.allowStateChanges=!0!==o&&o!==si}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach((function(t){t in e&&(On[t]=!!e[t])})),On.allowStateReads=!On.observableRequiresReaction,e.reactionScheduler&&(t=e.reactionScheduler,n=Un,Un=function(e){return t((function(){return n(e)}))})}function li(e,t,n,i){var r=Ze(t);return xr((function(){var t=nr(e,i)[lt];He(r).forEach((function(e){t.extend_(e,r[e],!n||!(e in n)||n[e])}))})),e}function ci(e){var t,n={name:e.name_};return e.observing_&&e.observing_.length>0&&(n.dependencies=(t=e.observing_,Array.from(new Set(t))).map(ci)),n}var ui=0;function hi(){this.message="FLOW_CANCELLED"}hi.prototype=Object.create(Error.prototype);var di=xt("flow"),pi=xt("flow.bound",{bound:!0}),fi=Object.assign((function(e,t){if(at(t))return di.decorate_20223_(e,t);if(Fe(t))return st(e,t,di);var n=e,i=n.name||"<unnamed flow>",r=function(){var e,t=arguments,r=++ui,o=Jn(i+" - runid: "+r+" - init",n).apply(this,t),s=void 0,a=new Promise((function(t,n){var a=0;function l(e){var t;s=void 0;try{t=Jn(i+" - runid: "+r+" - yield "+a++,o.next).call(o,e)}catch(e){return n(e)}u(t)}function c(e){var t;s=void 0;try{t=Jn(i+" - runid: "+r+" - yield "+a++,o.throw).call(o,e)}catch(e){return n(e)}u(t)}function u(e){if(!De(null==e?void 0:e.then))return e.done?t(e.value):(s=Promise.resolve(e.value)).then(l,c);e.then(u,n)}e=n,l(void 0)}));return a.cancel=Jn(i+" - runid: "+r+" - cancel",(function(){try{s&&mi(s);var t=o.return(void 0),n=Promise.resolve(t.value);n.then(Le,Le),mi(n),e(new hi)}catch(t){e(t)}})),a};return r.isMobXFlow=!0,r}),di);function mi(e){De(e.cancel)&&e.cancel()}function gi(e){return!0===(null==e?void 0:e.isMobXFlow)}function _i(e){return function(e,t){return!!e&&(void 0!==t?!!or(e)&&e[lt].values_.has(t):or(e)||!!e[lt]||ut(e)||$n(e)||_n(e))}(e)}function yi(e,t){void 0===t&&(t=void 0),Dn();try{return e.apply(t)}finally{Fn()}}function vi(e){return e[lt]}fi.bound=ot(pi);var bi={has:function(e,t){return vi(e).has_(t)},get:function(e,t){return vi(e).get_(t)},set:function(e,t,n){var i;return!!Fe(t)&&(null==(i=vi(e).set_(t,n,!0))||i)},deleteProperty:function(e,t){var n;return!!Fe(t)&&(null==(n=vi(e).delete_(t,!0))||n)},defineProperty:function(e,t,n){var i;return null==(i=vi(e).defineProperty_(t,n))||i},ownKeys:function(e){return vi(e).ownKeys_()},preventExtensions:function(e){xe(13)}};function xi(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function wi(e,t){var n=e.interceptors_||(e.interceptors_=[]);return n.push(t),ke((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function Ei(e,t){var n=Sn();try{for(var i=[].concat(e.interceptors_||[]),r=0,o=i.length;r<o&&((t=i[r](t))&&!t.type&&xe(14),t);r++);return t}finally{Tn(n)}}function Si(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function Ti(e,t){var n=e.changeListeners_||(e.changeListeners_=[]);return n.push(t),ke((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function Ai(e,t){var n=Sn(),i=e.changeListeners_;if(i){for(var r=0,o=(i=i.slice()).length;r<o;r++)i[r](t);Tn(n)}}var Ci=Symbol("mobx-keys");function Pi(e,t,n){return Be(e)?li(e,e,t,n):(xr((function(){var i=nr(e,n)[lt];if(!e[Ci]){var r=Object.getPrototypeOf(e),o=new Set([].concat(He(e),He(r)));o.delete("constructor"),o.delete(lt),je(r,Ci,o)}e[Ci].forEach((function(e){return i.make_(e,!t||!(e in t)||t[e])}))})),e)}var Ii="splice",Mi="update",Ri={get:function(e,t){var n=e[lt];return t===lt?n:"length"===t?n.getArrayLength_():"string"!=typeof t||isNaN(t)?Xe(Li,t)?Li[t]:e[t]:n.get_(parseInt(t))},set:function(e,t,n){var i=e[lt];return"length"===t&&i.setArrayLength_(n),"symbol"==typeof t||isNaN(t)?e[t]=n:i.set_(parseInt(t),n),!0},preventExtensions:function(){xe(15)}},Oi=function(){function e(e,t,n,i){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=n,this.legacyMode_=i,this.atom_=new ct(e),this.enhancer_=function(e,n){return t(e,n,"ObservableArray[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return wi(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),Ti(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!=typeof e||isNaN(e)||e<0)&&xe("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var n=new Array(e-t),i=0;i<e-t;i++)n[i]=void 0;this.spliceWithArray_(t,0,n)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&xe(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&gr(e+t+1)},t.spliceWithArray_=function(e,t,n){var i=this;this.atom_;var r=this.values_.length;if(void 0===e?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),t=1===arguments.length?r-e:null==t?0:Math.max(0,Math.min(t,r-e)),void 0===n&&(n=Pe),xi(this)){var o=Ei(this,{object:this.proxy_,type:Ii,index:e,removedCount:t,added:n});if(!o)return Pe;t=o.removedCount,n=o.added}if(n=0===n.length?n:n.map((function(e){return i.enhancer_(e,void 0)})),this.legacyMode_){var s=n.length-t;this.updateArrayLength_(r,s)}var a=this.spliceItemsIntoValues_(e,t,n);return 0===t&&0===n.length||this.notifyArraySplice_(e,n,a),this.dehanceValues_(a)},t.spliceItemsIntoValues_=function(e,t,n){var i;if(n.length<1e4)return(i=this.values_).splice.apply(i,[e,t].concat(n));var r=this.values_.slice(e,e+t),o=this.values_.slice(e+t);this.values_.length+=n.length-t;for(var s=0;s<n.length;s++)this.values_[e+s]=n[s];for(var a=0;a<o.length;a++)this.values_[e+n.length+a]=o[a];return r},t.notifyArrayChildUpdate_=function(e,t,n){var i=!this.owned_&&!1,r=Si(this),o=r||i?{observableKind:"array",object:this.proxy_,type:Mi,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:n}:null;this.atom_.reportChanged(),r&&Ai(this,o)},t.notifyArraySplice_=function(e,t,n){var i=!this.owned_&&!1,r=Si(this),o=r||i?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:Ii,index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom_.reportChanged(),r&&Ai(this,o)},t.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var n=this.values_;if(this.legacyMode_&&e>n.length&&xe(17,e,n.length),e<n.length){this.atom_;var i=n[e];if(xi(this)){var r=Ei(this,{type:Mi,object:this.proxy_,index:e,newValue:t});if(!r)return;t=r.newValue}(t=this.enhancer_(t,i))!==i&&(n[e]=t,this.notifyArrayChildUpdate_(e,t,i))}else{for(var o=new Array(e+1-n.length),s=0;s<o.length-1;s++)o[s]=void 0;o[o.length-1]=t,this.spliceWithArray_(n.length,0,o)}},e}();function ki(e,t,n,i){return void 0===n&&(n="ObservableArray"),void 0===i&&(i=!1),Oe(),xr((function(){var r=new Oi(n,t,i,!1);Ue(r.values_,lt,r);var o=new Proxy(r.values_,Ri);return r.proxy_=o,e&&e.length&&r.spliceWithArray_(0,0,e),o}))}var Li={clear:function(){return this.splice(0)},replace:function(e){var t=this[lt];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var o=this[lt];switch(arguments.length){case 0:return[];case 1:return o.spliceWithArray_(e);case 2:return o.spliceWithArray_(e,t)}return o.spliceWithArray_(e,t,i)},spliceWithArray:function(e,t,n){return this[lt].spliceWithArray_(e,t,n)},push:function(){for(var e=this[lt],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[lt].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[lt],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return On.trackingDerivation&&xe(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){On.trackingDerivation&&xe(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[lt],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1&&(this.splice(n,1),!0)}};function Di(e,t){"function"==typeof Array.prototype[e]&&(Li[e]=t(e))}function Fi(e){return function(){var t=this[lt];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_);return n[e].apply(n,arguments)}}function Ni(e){return function(t,n){var i=this,r=this[lt];return r.atom_.reportObserved(),r.dehanceValues_(r.values_)[e]((function(e,r){return t.call(n,e,r,i)}))}}function Bi(e){return function(){var t=this,n=this[lt];n.atom_.reportObserved();var i=n.dehanceValues_(n.values_),r=arguments[0];return arguments[0]=function(e,n,i){return r(e,n,i,t)},i[e].apply(i,arguments)}}Di("at",Fi),Di("concat",Fi),Di("flat",Fi),Di("includes",Fi),Di("indexOf",Fi),Di("join",Fi),Di("lastIndexOf",Fi),Di("slice",Fi),Di("toString",Fi),Di("toLocaleString",Fi),Di("toSorted",Fi),Di("toSpliced",Fi),Di("with",Fi),Di("every",Ni),Di("filter",Ni),Di("find",Ni),Di("findIndex",Ni),Di("findLast",Ni),Di("findLastIndex",Ni),Di("flatMap",Ni),Di("forEach",Ni),Di("map",Ni),Di("some",Ni),Di("toReversed",Ni),Di("reduce",Bi),Di("reduceRight",Bi);var zi,ji,Ui=Ve("ObservableArrayAdministration",Oi);function Vi(e){return Ne(e)&&Ui(e[lt])}var Gi={},$i="add",Wi="delete";zi=Symbol.iterator,ji=Symbol.toStringTag;var Hi,qi,Xi=function(){function e(e,t,n){var i=this;void 0===t&&(t=pt),void 0===n&&(n="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[lt]=Gi,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=n,De(Map)||xe(18),xr((function(){i.keysAtom_=ht("ObservableMap.keys()"),i.data_=new Map,i.hasMap_=new Map,e&&i.merge(e)}))}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!On.trackingDerivation)return this.has_(e);var n=this.hasMap_.get(e);if(!n){var i=n=new pn(this.has_(e),ft,"ObservableMap.key?",!1);this.hasMap_.set(e,i),ri(i,(function(){return t.hasMap_.delete(e)}))}return n.get()},t.set=function(e,t){var n=this.has_(e);if(xi(this)){var i=Ei(this,{type:n?Mi:$i,object:this,newValue:t,name:e});if(!i)return this;t=i.newValue}return n?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if(this.keysAtom_,xi(this)&&!Ei(this,{type:Wi,object:this,name:e}))return!1;if(this.has_(e)){var n=Si(this),i=n?{observableKind:"map",debugObjectName:this.name_,type:Wi,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return yi((function(){var n;t.keysAtom_.reportChanged(),null==(n=t.hasMap_.get(e))||n.setNewValue_(!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)})),n&&Ai(this,i),!0}return!1},t.updateValue_=function(e,t){var n=this.data_.get(e);if((t=n.prepareNewValue_(t))!==On.UNCHANGED){var i=Si(this),r=i?{observableKind:"map",debugObjectName:this.name_,type:Mi,object:this,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),i&&Ai(this,r)}},t.addValue_=function(e,t){var n=this;this.keysAtom_,yi((function(){var i,r=new pn(t,n.enhancer_,"ObservableMap.key",!1);n.data_.set(e,r),t=r.value_,null==(i=n.hasMap_.get(e))||i.setNewValue_(!0),n.keysAtom_.reportChanged()}));var i=Si(this),r=i?{observableKind:"map",debugObjectName:this.name_,type:$i,object:this,name:e,newValue:t}:null;i&&Ai(this,r)},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return Ar({next:function(){var n=t.next(),i=n.done,r=n.value;return{done:i,value:i?void 0:e.get(r)}}})},t.entries=function(){var e=this,t=this.keys();return Ar({next:function(){var n=t.next(),i=n.done,r=n.value;return{done:i,value:i?void 0:[r,e.get(r)]}}})},t[zi]=function(){return this.entries()},t.forEach=function(e,t){for(var n,i=it(this);!(n=i()).done;){var r=n.value,o=r[0],s=r[1];e.call(t,s,o,this)}},t.merge=function(e){var t=this;return Zi(e)&&(e=new Map(e)),yi((function(){Be(e)?function(e){var t=Object.keys(e);if(!We)return t;var n=Object.getOwnPropertySymbols(e);return n.length?[].concat(t,n.filter((function(t){return Ce.propertyIsEnumerable.call(e,t)}))):t}(e).forEach((function(n){return t.set(n,e[n])})):Array.isArray(e)?e.forEach((function(e){var n=e[0],i=e[1];return t.set(n,i)})):Ge(e)?(e.constructor!==Map&&xe(19,e),e.forEach((function(e,n){return t.set(n,e)}))):null!=e&&xe(20,e)})),this},t.clear=function(){var e=this;yi((function(){En((function(){for(var t,n=it(e.keys());!(t=n()).done;){var i=t.value;e.delete(i)}}))}))},t.replace=function(e){var t=this;return yi((function(){for(var n,i=function(e){if(Ge(e)||Zi(e))return e;if(Array.isArray(e))return new Map(e);if(Be(e)){var t=new Map;for(var n in e)t.set(n,e[n]);return t}return xe(21,e)}(e),r=new Map,o=!1,s=it(t.data_.keys());!(n=s()).done;){var a=n.value;if(!i.has(a))if(t.delete(a))o=!0;else{var l=t.data_.get(a);r.set(a,l)}}for(var c,u=it(i.entries());!(c=u()).done;){var h=c.value,d=h[0],p=h[1],f=t.data_.has(d);if(t.set(d,p),t.data_.has(d)){var m=t.data_.get(d);r.set(d,m),f||(o=!0)}}if(!o)if(t.data_.size!==r.size)t.keysAtom_.reportChanged();else for(var g=t.data_.keys(),_=r.keys(),y=g.next(),v=_.next();!y.done;){if(y.value!==v.value){t.keysAtom_.reportChanged();break}y=g.next(),v=_.next()}t.data_=r})),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return Ti(this,e)},t.intercept_=function(e){return wi(this,e)},Ke(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:ji,get:function(){return"Map"}}]),e}(),Zi=Ve("ObservableMap",Xi),Yi={};Hi=Symbol.iterator,qi=Symbol.toStringTag;var Ki=function(){function e(e,t,n){var i=this;void 0===t&&(t=pt),void 0===n&&(n="ObservableSet"),this.name_=void 0,this[lt]=Yi,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=n,De(Set)||xe(22),this.enhancer_=function(e,i){return t(e,i,n)},xr((function(){i.atom_=ht(i.name_),e&&i.replace(e)}))}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;yi((function(){En((function(){for(var t,n=it(e.data_.values());!(t=n()).done;){var i=t.value;e.delete(i)}}))}))},t.forEach=function(e,t){for(var n,i=it(this);!(n=i()).done;){var r=n.value;e.call(t,r,r,this)}},t.add=function(e){var t=this;if(this.atom_,xi(this)&&!Ei(this,{type:$i,object:this,newValue:e}))return this;if(!this.has(e)){yi((function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()}));var n=Si(this),i=n?{observableKind:"set",debugObjectName:this.name_,type:$i,object:this,newValue:e}:null;n&&Ai(this,i)}return this},t.delete=function(e){var t=this;if(xi(this)&&!Ei(this,{type:Wi,object:this,oldValue:e}))return!1;if(this.has(e)){var n=Si(this),i=n?{observableKind:"set",debugObjectName:this.name_,type:Wi,object:this,oldValue:e}:null;return yi((function(){t.atom_.reportChanged(),t.data_.delete(e)})),n&&Ai(this,i),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return Ar({next:function(){var i=e;return e+=1,i<n.length?{value:[t[i],n[i]],done:!1}:{done:!0}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=0,n=Array.from(this.data_.values());return Ar({next:function(){return t<n.length?{value:e.dehanceValue_(n[t++]),done:!1}:{done:!0}}})},t.replace=function(e){var t=this;return Ji(e)&&(e=new Set(e)),yi((function(){Array.isArray(e)||$e(e)?(t.clear(),e.forEach((function(e){return t.add(e)}))):null!=e&&xe("Cannot initialize set from "+e)})),this},t.observe_=function(e,t){return Ti(this,e)},t.intercept_=function(e){return wi(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[Hi]=function(){return this.values()},Ke(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:qi,get:function(){return"Set"}}]),e}(),Ji=Ve("ObservableSet",Ki),Qi=Object.create(null),er="remove",tr=function(){function e(e,t,n,i){void 0===t&&(t=new Map),void 0===i&&(i=Dt),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=n,this.defaultAnnotation_=i,this.keysAtom_=new ct("ObservableObject.keys"),this.isPlainObject_=Be(this.target_)}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var n=this.values_.get(e);if(n instanceof gn)return n.set(t),!0;if(xi(this)){var i=Ei(this,{type:Mi,object:this.proxy_||this.target_,name:e,newValue:t});if(!i)return null;t=i.newValue}if((t=n.prepareNewValue_(t))!==On.UNCHANGED){var r=Si(this),o=r?{type:Mi,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:n.value_,name:e,newValue:t}:null;n.setNewValue_(t),r&&Ai(this,o)}return!0},t.get_=function(e){return On.trackingDerivation&&!Xe(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,n){return void 0===n&&(n=!1),Xe(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):n?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,n)},t.has_=function(e){if(!On.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new pn(e in this.target_,ft,"ObservableObject.key?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(!(e in this.target_)){var n;if(null!=(n=this.target_[rt])&&n[e])return;xe(1,t.annotationType_,this.name_+"."+e.toString())}for(var i=this.target_;i&&i!==Ce;){var r=Te(i,e);if(r){var o=t.make_(this,e,r,i);if(0===o)return;if(1===o)break}i=Object.getPrototypeOf(i)}sr(this,0,e)}},t.extend_=function(e,t,n,i){if(void 0===i&&(i=!1),!0===n&&(n=this.defaultAnnotation_),!1===n)return this.defineProperty_(e,t,i);var r=n.extend_(this,e,t,i);return r&&sr(this,0,e),r},t.defineProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{Dn();var i=this.delete_(e);if(!i)return i;if(xi(this)){var r=Ei(this,{object:this.proxy_||this.target_,name:e,type:$i,newValue:t.value});if(!r)return null;var o=r.newValue;t.value!==o&&(t=Je({},t,{value:o}))}if(n){if(!Reflect.defineProperty(this.target_,e,t))return!1}else Ae(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{Fn()}return!0},t.defineObservableProperty_=function(e,t,n,i){void 0===i&&(i=!1),this.keysAtom_;try{Dn();var r=this.delete_(e);if(!r)return r;if(xi(this)){var o=Ei(this,{object:this.proxy_||this.target_,name:e,type:$i,newValue:t});if(!o)return null;t=o.newValue}var s=rr(e),a={configurable:!On.safeDescriptors||this.isPlainObject_,enumerable:!0,get:s.get,set:s.set};if(i){if(!Reflect.defineProperty(this.target_,e,a))return!1}else Ae(this.target_,e,a);var l=new pn(t,n,"ObservableObject.key",!1);this.values_.set(e,l),this.notifyPropertyAddition_(e,l.value_)}finally{Fn()}return!0},t.defineComputedProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{Dn();var i=this.delete_(e);if(!i)return i;if(xi(this)&&!Ei(this,{object:this.proxy_||this.target_,name:e,type:$i,newValue:void 0}))return null;t.name||(t.name="ObservableObject.key"),t.context=this.proxy_||this.target_;var r=rr(e),o={configurable:!On.safeDescriptors||this.isPlainObject_,enumerable:!1,get:r.get,set:r.set};if(n){if(!Reflect.defineProperty(this.target_,e,o))return!1}else Ae(this.target_,e,o);this.values_.set(e,new gn(t)),this.notifyPropertyAddition_(e,void 0)}finally{Fn()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),this.keysAtom_,!Xe(this.target_,e))return!0;if(xi(this)&&!Ei(this,{object:this.proxy_||this.target_,name:e,type:er}))return null;try{var n,i;Dn();var r,o=Si(this),s=this.values_.get(e),a=void 0;if(!s&&o&&(a=null==(r=Te(this.target_,e))?void 0:r.value),t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(s&&(this.values_.delete(e),s instanceof pn&&(a=s.value_),Bn(s)),this.keysAtom_.reportChanged(),null==(n=this.pendingKeys_)||null==(i=n.get(e))||i.set(e in this.target_),o){var l={type:er,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:a,name:e};o&&Ai(this,l)}}finally{Fn()}return!0},t.observe_=function(e,t){return Ti(this,e)},t.intercept_=function(e){return wi(this,e)},t.notifyPropertyAddition_=function(e,t){var n,i,r=Si(this);if(r){var o=r?{type:$i,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;r&&Ai(this,o)}null==(n=this.pendingKeys_)||null==(i=n.get(e))||i.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),He(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function nr(e,t){var n;if(Xe(e,lt))return e;var i=null!=(n=null==t?void 0:t.name)?n:"ObservableObject",r=new tr(e,new Map,String(i),function(e){var t;return e?null!=(t=e.defaultDecorator)?t:Ft(e):void 0}(t));return je(e,lt,r),e}var ir=Ve("ObservableObjectAdministration",tr);function rr(e){return Qi[e]||(Qi[e]={get:function(){return this[lt].getObservablePropValue_(e)},set:function(t){return this[lt].setObservablePropValue_(e,t)}})}function or(e){return!!Ne(e)&&ir(e[lt])}function sr(e,t,n){var i;null==(i=e.target_[rt])||delete i[n]}var ar,lr,cr=fr(0),ur=function(){var e=!1,t={};return Object.defineProperty(t,"0",{set:function(){e=!0}}),Object.create(t)[0]=1,!1===e}(),hr=0,dr=function(){};ar=dr,lr=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(ar.prototype,lr):void 0!==ar.prototype.__proto__?ar.prototype.__proto__=lr:ar.prototype=lr;var pr=function(e,t,n){function i(t,n,i,r){var o;return void 0===i&&(i="ObservableArray"),void 0===r&&(r=!1),o=e.call(this)||this,xr((function(){var e=new Oi(i,n,r,!0);e.proxy_=tt(o),Ue(tt(o),lt,e),t&&t.length&&o.spliceWithArray(0,0,t),ur&&Object.defineProperty(tt(o),"0",cr)})),o}Qe(i,e);var r=i.prototype;return r.concat=function(){this[lt].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.concat.apply(this.slice(),t.map((function(e){return Vi(e)?e.slice():e})))},r[n]=function(){var e=this,t=0;return Ar({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},Ke(i,[{key:"length",get:function(){return this[lt].getArrayLength_()},set:function(e){this[lt].setArrayLength_(e)}},{key:t,get:function(){return"Array"}}]),i}(dr,Symbol.toStringTag,Symbol.iterator);function fr(e){return{enumerable:!1,configurable:!0,get:function(){return this[lt].get_(e)},set:function(t){this[lt].set_(e,t)}}}function mr(e){Ae(pr.prototype,""+e,fr(e))}function gr(e){if(e>hr){for(var t=hr;t<e+100;t++)mr(t);hr=e}}function _r(e,t,n){return new pr(e,t,n)}function yr(e,t){if("object"==typeof e&&null!==e){if(Vi(e))return void 0!==t&&xe(23),e[lt].atom_;if(Ji(e))return e.atom_;if(Zi(e)){if(void 0===t)return e.keysAtom_;var n=e.data_.get(t)||e.hasMap_.get(t);return n||xe(25,t,br(e)),n}if(or(e)){if(!t)return xe(26);var i=e[lt].values_.get(t);return i||xe(27,t,br(e)),i}if(ut(e)||_n(e)||$n(e))return e}else if(De(e)&&$n(e[lt]))return e[lt];xe(28)}function vr(e,t){return e||xe(29),void 0!==t?vr(yr(e,t)):ut(e)||_n(e)||$n(e)||Zi(e)||Ji(e)?e:e[lt]?e[lt]:void xe(24,e)}function br(e,t){var n;if(void 0!==t)n=yr(e,t);else{if(ei(e))return e.name;n=or(e)||Zi(e)||Ji(e)?vr(e):yr(e)}return n.name_}function xr(e){var t=Sn(),n=un(!0);Dn();try{return e()}finally{Fn(),hn(n),Tn(t)}}Object.entries(Li).forEach((function(e){var t=e[0],n=e[1];"concat"!==t&&je(pr.prototype,t,n)})),gr(1e3);var wr=Ce.toString;function Er(e,t,n){return void 0===n&&(n=-1),Sr(e,t,n)}function Sr(e,t,n,i,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;if("function"!==o&&"object"!==o&&"object"!=typeof t)return!1;var s=wr.call(e);if(s!==wr.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":n>=0&&n++}e=Tr(e),t=Tr(t);var a="[object Array]"===s;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(De(l)&&l instanceof l&&De(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}if(0===n)return!1;n<0&&(n=-1),r=r||[];for(var u=(i=i||[]).length;u--;)if(i[u]===e)return r[u]===t;if(i.push(e),r.push(t),a){if((u=e.length)!==t.length)return!1;for(;u--;)if(!Sr(e[u],t[u],n-1,i,r))return!1}else{var h,d=Object.keys(e);if(u=d.length,Object.keys(t).length!==u)return!1;for(;u--;)if(!Xe(t,h=d[u])||!Sr(e[h],t[h],n-1,i,r))return!1}return i.pop(),r.pop(),!0}function Tr(e){return Vi(e)?e.slice():Ge(e)||Zi(e)||$e(e)||Ji(e)?Array.from(e.entries()):e}function Ar(e){return e[Symbol.iterator]=Cr,e}function Cr(){return this}["Symbol","Map","Set"].forEach((function(e){void 0===Ee()[e]&&xe("MobX requires global '"+e+"' to be available or polyfilled")})),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:function(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}},extras:{getDebugName:br},$mobx:lt});var Pr=Object.defineProperty,Ir=(e,t)=>Pr(e,"name",{value:t,configurable:!0});function Mr(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function Rr(e,t){return e[0]*t[1]-t[0]*e[1]}function Or(e,t){return[e[0]+t[0],e[1]+t[1]]}function kr(e,t){return[e[0]-t[0],e[1]-t[1]]}function Lr(e,t){return[e*t[0],e*t[1]]}function Dr(e,t){var n=e[0],i=Mr(e),r=t[0],o=Mr(t),s=Rr(i,o);return Or(n,Lr(Rr(kr(r,n),o)/s,i))}function Fr(e,t){return 0===Rr(Mr(e),Mr(t))}function Nr(e,t){return!Fr(e,t)&&Dr(e,t)}function Br(e,t,n){if(!M(n=n||{}))throw new Error("options is invalid");var i=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var r=D(e),o=e.properties;switch(r){case"LineString":return zr(e,t,i);case"MultiLineString":var s=[];return q(e,(function(e){s.push(zr(e,t,i).geometry.coordinates)})),x(s,o);default:throw new Error("geometry "+r+" is not supported")}}function zr(e,t,n){var i=[],r=A(t,n),o=L(e),s=[];return o.forEach((function(e,t){if(t!==o.length-1){var n=jr(e,o[t+1],r);if(i.push(n),t>0){var a=i[t-1],l=Nr(n,a);!1!==l&&(a[1]=l,n[0]=l),s.push(a[0]),t===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}})),v(s,e.properties)}function jr(e,t,n){var i=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),r=e[0]+n*(t[1]-e[1])/i,o=t[0]+n*(t[1]-e[1])/i;return[[r,e[1]+n*(e[0]-t[0])/i],[o,t[1]+n*(e[0]-t[0])/i]]}Ir(Mr,"ab"),Ir(Rr,"crossProduct"),Ir(Or,"add"),Ir(kr,"sub"),Ir(Lr,"scalarMult"),Ir(Dr,"intersectSegments"),Ir(Fr,"isParallel"),Ir(Nr,"intersection"),Ir(Br,"lineOffset"),Ir(zr,"lineOffsetFeature"),Ir(jr,"processSegment");var Ur=Br,Vr=d(2794),Gr=d.n(Vr);function $r(e,t){return e.map((e=>function(e,t){if("string"==typeof e){const n=null==t?void 0:t.get(e),i=null==n?void 0:n.geometry;return(null==i?void 0:i.coordinates)||null}return Array.isArray(e)?e:null}(e.item,t))).filter((e=>e))}function Wr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hr(e,n){if(n.every((t=>{const n=t.name;return e.hasOwnProperty(n)}))){if(n.every((n=>{const i=n.name;let r=[];r=n.type===t.FieldType.number?n.value.split(",").map((e=>parseInt(e,10))):n.value.split(",").map((e=>e.trim()));const o=e[i];return r.includes(o)})))return n.length}return-1}const qr=(e,t)=>t.map((t=>{return n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){Wr(e,t,n[t])}))}return e}({},t),i=null!=(i={overrides:Hr(e,t.overrides)})?i:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(i)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(i,e))})),n;var n,i})).filter((e=>-1!==e.overrides));function Xr(e,t,n=[],i="rgba(154, 205, 50)",r=1,o="fixed color"){const s=qr(e,n).sort(((e,t)=>e.value===t.value?e.overrides-t.overrides:e.value-t.value));let a=i,l=r,c="unknown",u=-1;if(null==t)return{color:i,lineWidth:r,label:o};const h=s.length;if(0===h)return{color:i,lineWidth:r,label:o};for(let e=h-1;e>=0;e--){const n=s[e];if(n.value<=t){u=n.overrides,a=n.color,l=n.lineWidth,c=n.label;break}}return{color:a,lineWidth:l,label:c}}var Zr,Yr,Kr,Jr,Qr,eo,to,no,io,ro,oo={},so=[],ao=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,lo=Array.isArray;function co(e,t){for(var n in t)e[n]=t[n];return e}function uo(e){var t=e.parentNode;t&&t.removeChild(e)}function ho(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==r?++Kr:r,__i:-1,__u:0};return null==r&&null!=Yr.vnode&&Yr.vnode(o),o}function po(e){return e.children}function fo(e,t){this.props=e,this.context=t}function mo(e,t){if(null==t)return e.__?mo(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?mo(e):null}function go(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return go(e)}}function _o(e){(!e.__d&&(e.__d=!0)&&Jr.push(e)&&!yo.__r++||Qr!==Yr.debounceRendering)&&((Qr=Yr.debounceRendering)||eo)(yo)}function yo(){var e,t,n,i,r,o,s,a;for(Jr.sort(to);e=Jr.shift();)e.__d&&(t=Jr.length,i=void 0,o=(r=(n=e).__v).__e,s=[],a=[],n.__P&&((i=co({},r)).__v=r.__v+1,Yr.vnode&&Yr.vnode(i),Ao(n.__P,i,r,n.__n,n.__P.namespaceURI,32&r.__u?[o]:null,s,null==o?mo(r):o,!!(32&r.__u),a),i.__v=r.__v,i.__.__k[i.__i]=i,Co(s,i,a),i.__e!=o&&go(i)),Jr.length>t&&Jr.sort(to));yo.__r=0}function vo(e,t,n,i,r,o,s,a,l,c,u){var h,d,p,f,m,g=i&&i.__k||so,_=t.length;for(n.__d=l,bo(n,t,g),l=n.__d,h=0;h<_;h++)null!=(p=n.__k[h])&&"boolean"!=typeof p&&"function"!=typeof p&&(d=-1===p.__i?oo:g[p.__i]||oo,p.__i=h,Ao(e,p,d,r,o,s,a,l,c,u),f=p.__e,p.ref&&d.ref!=p.ref&&(d.ref&&Io(d.ref,null,p),u.push(p.ref,p.__c||f,p)),null==m&&null!=f&&(m=f),65536&p.__u||d.__k===p.__k?(l&&!l.isConnected&&(l=mo(d)),l=xo(p,l,e)):"function"==typeof p.type&&void 0!==p.__d?l=p.__d:f&&(l=f.nextSibling),p.__d=void 0,p.__u&=-196609);n.__d=l,n.__e=m}function bo(e,t,n){var i,r,o,s,a,l=t.length,c=n.length,u=c,h=0;for(e.__k=[],i=0;i<l;i++)s=i+h,null!=(r=e.__k[i]=null==(r=t[i])||"boolean"==typeof r||"function"==typeof r?null:"string"==typeof r||"number"==typeof r||"bigint"==typeof r||r.constructor==String?ho(null,r,null,null,null):lo(r)?ho(po,{children:r},null,null,null):void 0===r.constructor&&r.__b>0?ho(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):r)?(r.__=e,r.__b=e.__b+1,a=wo(r,n,s,u),r.__i=a,o=null,-1!==a&&(u--,(o=n[a])&&(o.__u|=131072)),null==o||null===o.__v?(-1==a&&h--,"function"!=typeof r.type&&(r.__u|=65536)):a!==s&&(a===s+1?h++:a>s?u>l-s?h+=a-s:h--:a<s?a==s-1&&(h=a-s):h=0,a!==i+h&&(r.__u|=65536))):(o=n[s])&&null==o.key&&o.__e&&!(131072&o.__u)&&(o.__e==e.__d&&(e.__d=mo(o)),Mo(o,o,!1),n[s]=null,u--);if(u)for(i=0;i<c;i++)null!=(o=n[i])&&!(131072&o.__u)&&(o.__e==e.__d&&(e.__d=mo(o)),Mo(o,o))}function xo(e,t,n){var i,r;if("function"==typeof e.type){for(i=e.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=e,t=xo(i[r],t,n));return t}e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function wo(e,t,n,i){var r=e.key,o=e.type,s=n-1,a=n+1,l=t[n];if(null===l||l&&r==l.key&&o===l.type&&!(131072&l.__u))return n;if(i>(null==l||131072&l.__u?0:1))for(;s>=0||a<t.length;){if(s>=0){if((l=t[s])&&!(131072&l.__u)&&r==l.key&&o===l.type)return s;s--}if(a<t.length){if((l=t[a])&&!(131072&l.__u)&&r==l.key&&o===l.type)return a;a++}}return-1}function Eo(e,t,n){"-"===t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||ao.test(t)?n:n+"px"}function So(e,t,n,i,r){var o;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof i&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Eo(e.style,t,"");if(n)for(t in n)i&&n[t]===i[t]||Eo(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])o=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||"onFocusOut"===t||"onFocusIn"===t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=no,e.addEventListener(t,o?ro:io,o)):e.removeEventListener(t,o?ro:io,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,n))}}function To(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=no++;else if(t.t<n.u)return;return n(Yr.event?Yr.event(t):t)}}}function Ao(e,t,n,i,r,o,s,a,l,c){var u,h,d,p,f,m,g,_,y,v,b,x,w,E,S,T=t.type;if(void 0!==t.constructor)return null;128&n.__u&&(l=!!(32&n.__u),o=[a=t.__e=n.__e]),(u=Yr.__b)&&u(t);e:if("function"==typeof T)try{if(_=t.props,y=(u=T.contextType)&&i[u.__c],v=u?y?y.props.value:u.__:i,n.__c?g=(h=t.__c=n.__c).__=h.__E:("prototype"in T&&T.prototype.render?t.__c=h=new T(_,v):(t.__c=h=new fo(_,v),h.constructor=T,h.render=Ro),y&&y.sub(h),h.props=_,h.state||(h.state={}),h.context=v,h.__n=i,d=h.__d=!0,h.__h=[],h._sb=[]),null==h.__s&&(h.__s=h.state),null!=T.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=co({},h.__s)),co(h.__s,T.getDerivedStateFromProps(_,h.__s))),p=h.props,f=h.state,h.__v=t,d)null==T.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(null==T.getDerivedStateFromProps&&_!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(_,v),!h.__e&&(null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(_,h.__s,v)||t.__v===n.__v)){for(t.__v!==n.__v&&(h.props=_,h.state=h.__s,h.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),b=0;b<h._sb.length;b++)h.__h.push(h._sb[b]);h._sb=[],h.__h.length&&s.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(_,h.__s,v),null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(p,f,m)}))}if(h.context=v,h.props=_,h.__P=e,h.__e=!1,x=Yr.__r,w=0,"prototype"in T&&T.prototype.render){for(h.state=h.__s,h.__d=!1,x&&x(t),u=h.render(h.props,h.state,h.context),E=0;E<h._sb.length;E++)h.__h.push(h._sb[E]);h._sb=[]}else do{h.__d=!1,x&&x(t),u=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++w<25);h.state=h.__s,null!=h.getChildContext&&(i=co(co({},i),h.getChildContext())),d||null==h.getSnapshotBeforeUpdate||(m=h.getSnapshotBeforeUpdate(p,f)),vo(e,lo(S=null!=u&&u.type===po&&null==u.key?u.props.children:u)?S:[S],t,n,i,r,o,s,a,l,c),h.base=t.__e,t.__u&=-161,h.__h.length&&s.push(h),g&&(h.__E=h.__=null)}catch(e){t.__v=null,l||null!=o?(t.__e=a,t.__u|=l?160:32,o[o.indexOf(a)]=null):(t.__e=n.__e,t.__k=n.__k),Yr.__e(e,t,n)}else null==o&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=Po(n.__e,t,n,i,r,o,s,l,c);(u=Yr.diffed)&&u(t)}function Co(e,t,n){t.__d=void 0;for(var i=0;i<n.length;i++)Io(n[i],n[++i],n[++i]);Yr.__c&&Yr.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){Yr.__e(e,t.__v)}}))}function Po(e,t,n,i,r,o,s,a,l){var c,u,h,d,p,f,m,g=n.props,_=t.props,y=t.type;if("svg"===y?r="http://www.w3.org/2000/svg":"math"===y?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),null!=o)for(c=0;c<o.length;c++)if((p=o[c])&&"setAttribute"in p==!!y&&(y?p.localName===y:3===p.nodeType)){e=p,o[c]=null;break}if(null==e){if(null===y)return document.createTextNode(_);e=document.createElementNS(r,y,_.is&&_),o=null,a=!1}if(null===y)g===_||a&&e.data===_||(e.data=_);else{if(o=o&&Zr.call(e.childNodes),g=n.props||oo,!a&&null!=o)for(g={},c=0;c<e.attributes.length;c++)g[(p=e.attributes[c]).name]=p.value;for(c in g)if(p=g[c],"children"==c);else if("dangerouslySetInnerHTML"==c)h=p;else if("key"!==c&&!(c in _)){if("value"==c&&"defaultValue"in _||"checked"==c&&"defaultChecked"in _)continue;So(e,c,null,p,r)}for(c in _)p=_[c],"children"==c?d=p:"dangerouslySetInnerHTML"==c?u=p:"value"==c?f=p:"checked"==c?m=p:"key"===c||a&&"function"!=typeof p||g[c]===p||So(e,c,p,g[c],r);if(u)a||h&&(u.__html===h.__html||u.__html===e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(h&&(e.innerHTML=""),vo(e,lo(d)?d:[d],t,n,i,"foreignObject"===y?"http://www.w3.org/1999/xhtml":r,o,s,o?o[0]:n.__k&&mo(n,0),a,l),null!=o)for(c=o.length;c--;)null!=o[c]&&uo(o[c]);a||(c="value",void 0!==f&&(f!==e[c]||"progress"===y&&!f||"option"===y&&f!==g[c])&&So(e,c,f,g[c],r),c="checked",void 0!==m&&m!==e[c]&&So(e,c,m,g[c],r))}return e}function Io(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){Yr.__e(e,n)}}function Mo(e,t,n){var i,r;if(Yr.unmount&&Yr.unmount(e),(i=e.ref)&&(i.current&&i.current!==e.__e||Io(i,null,t)),null!=(i=e.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(e){Yr.__e(e,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&Mo(i[r],t,n||"function"!=typeof e.type);n||null==e.__e||uo(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function Ro(e,t,n){return this.constructor(e,n)}function Oo(e,t,n){var i,r,o,s;Yr.__&&Yr.__(e,t),r=(i="function"==typeof n)?null:n&&n.__k||t.__k,o=[],s=[],Ao(t,e=(!i&&n||t).__k=function(e,t,n){var i,r,o,s={};for(o in t)"key"==o?i=t[o]:"ref"==o?r=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?Zr.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===s[o]&&(s[o]=e.defaultProps[o]);return ho(e,s,i,r,null)}(po,null,[e]),r||oo,oo,t.namespaceURI,!i&&n?[n]:r?null:t.firstChild?Zr.call(t.childNodes):null,o,!i&&n?n:r?r.__e:t.firstChild,i,s),Co(o,e,s)}Zr=so.slice,Yr={__e:function(e,t,n,i){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,i||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},Kr=0,fo.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=co({},this.state),"function"==typeof e&&(e=e(co({},n),this.props)),e&&co(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),_o(this))},fo.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),_o(this))},fo.prototype.render=po,Jr=[],eo="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,to=function(e,t){return e.__v.__b-t.__v.__b},yo.__r=0,no=0,io=To(!1),ro=To(!0);var ko=0;function Lo(e,t,n,i,r,o){t||(t={});var s,a,l=t;if("ref"in l)for(a in l={},t)"ref"==a?s=t[a]:l[a]=t[a];var c={type:e,props:l,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--ko,__i:-1,__u:0,__source:r,__self:o};if("function"==typeof e&&(s=e.defaultProps))for(a in s)void 0===l[a]&&(l[a]=s[a]);return Yr.vnode&&Yr.vnode(c),c}function Do(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!Do(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i){if(!t.hasOwnProperty(r))return!1;if(!Do(e[r],t[r],n-1))return!1}return!0}return!1}Array.isArray;const Fo=e=>{const{className:t,label:n,onClick:i}=e;return Lo("div",{className:"deck-widget-button",children:Lo("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:i,title:n,children:Lo("div",{className:"deck-widget-icon"})})})};class No{constructor(e){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=e.id||"fullscreen",this.placement=e.placement||"top-left",e.enterLabel=e.enterLabel||"Enter Fullscreen",e.exitLabel=e.exitLabel||"Exit Fullscreen",e.style=e.style||{},this.props=e}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-fullscreen"),n&&i.classList.add(n),t&&Object.entries(t).map((([e,t])=>i.style.setProperty(e,t))),this.deck=e,this.element=i,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),i}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){const{enterLabel:e,exitLabel:t}=this.props,n=this.element;n&&Oo(Lo(Fo,{onClick:this.handleClick.bind(this),label:this.fullscreen?t:e,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"}),n)}setProps(e){const t=this.props,n=this.element;n&&(t.className!==e.className&&(t.className&&n.classList.remove(t.className),e.className&&n.classList.add(e.className)),Do(t.style,e.style,1)||(t.style&&Object.entries(t.style).map((([e])=>n.style.removeProperty(e))),e.style&&Object.entries(e.style).map((([e,t])=>n.style.setProperty(e,t))))),Object.assign(this.props,e)}getContainer(){return this.props.container||this.deck?.getCanvas()?.parentElement}onFullscreenChange(){this.fullscreen!==(document.fullscreenElement===this.getContainer())&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){const e=this.getContainer();e?.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){this.getContainer()?.classList.toggle("deck-pseudo-fullscreen")}}function Bo(e){if("undefined"!=typeof window&&"renderer"===window.process?.type)return!0;if("undefined"!=typeof process&&Boolean(process.versions?.electron))return!0;const t="undefined"!=typeof navigator&&navigator.userAgent,n=e||t;return Boolean(n&&n.indexOf("Electron")>=0)}function zo(){return!("object"==typeof process&&"[object process]"===String(process)&&!process?.browser)||Bo()}const jo="4.0.7";class Uo{constructor(e,t,n="sessionStorage"){this.storage=function(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(n),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var Vo;!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Vo||(Vo={}));function Go(e){return"string"!=typeof e?e:(e=e.toUpperCase(),Vo[e]||Vo.WHITE)}function $o(e,t){if(!e)throw new Error(t||"Assertion failed")}const Wo=globalThis,Ho=(globalThis.document,globalThis.process||{}),qo=(globalThis.console,globalThis.navigator||{});function Xo(){let e;if(zo()&&Wo.performance)e=Wo?.performance?.now?.();else if("hrtime"in Ho){const t=Ho?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Zo={debug:zo()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Yo={enabled:!0,level:0};function Ko(){}const Jo={},Qo={once:!0};class es{constructor({id:e}={id:""}){this.VERSION=jo,this._startTs=Xo(),this._deltaTs=Xo(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Uo(`__probe-${this.id}__`,Yo),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const n=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(n),r=e;for(const n of i){const i=r[n];"function"==typeof i&&(t.find((e=>n===e))||(r[n]=i.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Xo()-this._startTs).toPrecision(10))}getDelta(){return Number((Xo()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Zo.warn,arguments,Qo)}error(e){return this._getLogFunction(0,e,Zo.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Zo.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Zo.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Zo.debug||Zo.info,arguments,Qo)}table(e,t,n){return t?this._getLogFunction(e,t,console.table||Ko,n&&[n],{tag:is(t)}):Ko}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Ko)}group(e,t,n={collapsed:!1}){const i=ns({logLevel:e,message:t,opts:n}),{collapsed:r}=n;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,n={}){return this.group(e,t,Object.assign({},n,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ko)}withGroup(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ts(e)}_getLogFunction(e,t,n,i,r){if(this._shouldLog(e)){r=ns({logLevel:e,message:t,args:i,opts:r}),$o(n=n||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Xo();const o=r.tag||r.message;if(r.once&&o){if(Jo[o])return Ko;Jo[o]=Xo()}return t=function(e,t,n){if("string"==typeof t){const s=n.time?function(e,t=8){const n=Math.max(t-e.length,0);return`${" ".repeat(n)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(n.total)):"";i=t=n.time?`${e}: ${s}  ${t}`:`${e}: ${t}`,r=n.color,o=n.background,zo||"string"!=typeof i||(r&&(i=`[${Go(r)}m${i}[39m`),o&&(i=`[${Go(o)+10}m${i}[49m`)),t=i}var i,r,o;return t}(this.id,r.message,r),n.bind(console,t,...r.args)}return Ko}}function ts(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return $o(Number.isFinite(t)&&t>=0),t}function ns(e){const{logLevel:t,message:n}=e;e.logLevel=ts(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==n;);switch(typeof t){case"string":case"function":void 0!==n&&i.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return $o("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function is(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}es.VERSION=jo;const rs=new es({id:"deck"}),os=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:n=1,type:i,padding:r=0,copy:o=!1,initialize:s=!1,maxCount:a}){const l=i||e&&e.constructor||Float32Array,c=t*n+r;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;a&&(u=a*n+r);const h=this._allocate(l,c,s,u);return e&&o?h.set(e):s||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,n,i){let r=Math.max(Math.ceil(t*this.opts.overAlloc),1);r>i&&(r=i);const o=this._pool,s=e.BYTES_PER_ELEMENT*r,a=o.findIndex((e=>e.byteLength>=s));if(a>=0){const t=new e(o.splice(a,1)[0],0,r);return n&&t.fill(0),t}return new e(r)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:n}=e,{byteLength:i}=n,r=t.findIndex((e=>e.byteLength>=i));r<0?t.push(n):(r>0||t.length<this.opts.poolSize)&&t.splice(r,0,n),t.length>this.opts.poolSize&&t.shift()}};Math.PI,Math.PI,globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const ss=globalThis.mathgl.config;function as(e,{precision:t=ss.precision}={}){return e=function(e){return Math.round(e/ss.EPSILON)*ss.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function ls(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function cs(e,t,n){return function(e,t,n){if(ls(e)){const i=e;n=n||function(e){return e.clone?e.clone():new Array(e.length)}(i);for(let r=0;r<n.length&&r<i.length;++r){const i="number"==typeof e?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}(e,(e=>Math.max(t,Math.min(n,e))))}function us(e,t,n){return ls(e)?e.map(((e,i)=>us(e,t[i],n))):n*t+(1-n)*e}function hs(e,t,n){const i=ss.EPSILON;n&&(ss.EPSILON=n);try{if(e===t)return!0;if(ls(e)&&ls(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!hs(e[n],t[n]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=ss.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{ss.EPSILON=i}}class ds extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}toArray(e=[],t=0){for(let n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ls(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ss)}formatString(e){let t="";for(let n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+as(this[n],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!hs(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],o="number"==typeof t?t:t[i];this[i]=r+n*(o-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(ss.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}get elements(){return this}}function ps(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function fs(e,t,n=""){if(ss.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return e}function ms(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class gs extends ds{get x(){return this[0]}set x(e){this[0]=ps(e)}get y(){return this[1]}set y(e){this[1]=ps(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let n=0;n<this.ELEMENTS;++n){const i=this[n]-e[n];t+=i*i}return ps(t)}dot(e){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return ps(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ms(e>=0&&e<this.ELEMENTS,"index is out of range"),ps(this[e])}setComponent(e,t){return ms(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const _s=1e-6;let ys="undefined"!=typeof Float32Array?Float32Array:Array;function vs(e,t,n){const i=t[0],r=t[1],o=t[2];let s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}Math.random,Math.PI;const bs=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},xs=function(e,t){const n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)},ws=function(e){const t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i};function Es(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o||1;return e[0]=(n[0]*i+n[4]*r+n[8]*o)/s,e[1]=(n[1]*i+n[5]*r+n[9]*o)/s,e[2]=(n[2]*i+n[6]*r+n[10]*o)/s,e}!function(){const e=new ys(3);ys!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0)}();const Ss=[0,0,0];let Ts;class As extends gs{static get ZERO(){return Ts||(Ts=new As(0,0,0),Object.freeze(Ts)),Ts}constructor(e=0,t=0,n=0){super(-0,-0,-0),1===arguments.length&&ls(e)?this.copy(e):(ss.debug&&(ps(e),ps(t),ps(n)),this[0]=e,this[1]=t,this[2]=n)}set(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ss.debug&&(ps(e.x),ps(e.y),ps(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ps(e)}angle(e){return function(e,t){const n=e[0],i=e[1],r=e[2],o=t[0],s=t[1],a=t[2],l=Math.sqrt((n*n+i*i+r*r)*(o*o+s*s+a*a)),c=l&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}cross(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],l=n[2];e[0]=r*l-o*a,e[1]=o*s-i*l,e[2]=i*a-r*s}(this,this,e),this.check()}rotateX({radians:e,origin:t=Ss}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Ss}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Ss}){return function(e,t,n,i){const r=[],o=[];r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return vs(this,this,e),this.check()}transformAsVector(e){return Es(this,this,e),this.check()}transformByMatrix3(e){return function(e,t,n){const i=t[0],r=t[1],o=t[2];e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8]}(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,n){const i=t[0],r=t[1];e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,n){const i=n[0],r=n[1],o=n[2],s=n[3],a=t[0],l=t[1],c=t[2];let u=r*c-o*l,h=o*a-i*c,d=i*l-r*a,p=r*d-o*h,f=o*u-i*d,m=i*h-r*u;const g=2*s;u*=g,h*=g,d*=g,p*=2,f*=2,m*=2,e[0]=a+u+p,e[1]=l+h+f,e[2]=c+d+m}(this,this,e),this.check()}}const Cs=new As;function Ps(e,t,n,i){Cs.set(e,t,n);const r=Cs.len();return{distance:i/r,normal:new As(-e/r,-t/r,-n/r)}}function Is(e){return e-Math.fround(e)}let Ms;function Rs(e,t){const{size:n=1,startIndex:i=0}=t,r=void 0!==t.endIndex?t.endIndex:e.length,o=(r-i)/n;Ms=os.allocate(Ms,o,{type:Float32Array,size:2*n});let s=i,a=0;for(;s<r;){for(let t=0;t<n;t++){const i=e[s++];Ms[a+t]=i,Ms[a+t+n]=Is(i)}a+=2*n}return Ms.subarray(0,o*n*2)}function Os(e){let t=null,n=!1;for(const i of e)i&&(t?(n||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],n=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}class ks extends ds{toString(){let e="[";if(ss.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let n=0;n<this.RANK;++n)e+=` ${this[n*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,n){return this[t*this.RANK+e]=ps(n),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[n+e];return t}setColumn(e,t){const n=e*this.RANK;for(let e=0;e<this.RANK;++e)this[n+e]=t[e];return this}}function Ls(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=n*a-i*s,v=n*l-r*s,b=n*c-o*s,x=i*l-r*a,w=i*c-o*a,E=r*c-o*l,S=u*m-h*f,T=u*g-d*f,A=u*_-p*f,C=h*g-d*m,P=h*_-p*m,I=d*_-p*g;let M=y*I-v*P+b*C+x*A-w*T+E*S;return M?(M=1/M,e[0]=(a*I-l*P+c*C)*M,e[1]=(r*P-i*I-o*C)*M,e[2]=(m*E-g*w+_*x)*M,e[3]=(d*w-h*E-p*x)*M,e[4]=(l*A-s*I-c*T)*M,e[5]=(n*I-r*A+o*T)*M,e[6]=(g*b-f*E-_*v)*M,e[7]=(u*E-d*b+p*v)*M,e[8]=(s*P-a*A+c*S)*M,e[9]=(i*A-n*P-o*S)*M,e[10]=(f*w-m*b+_*y)*M,e[11]=(h*b-u*w-p*y)*M,e[12]=(a*T-s*C-l*S)*M,e[13]=(n*C-i*T+r*S)*M,e[14]=(m*v-f*x-g*y)*M,e[15]=(u*x-h*v+d*y)*M,e):null}function Ds(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15];let v=n[0],b=n[1],x=n[2],w=n[3];return e[0]=v*i+b*a+x*h+w*m,e[1]=v*r+b*l+x*d+w*g,e[2]=v*o+b*c+x*p+w*_,e[3]=v*s+b*u+x*f+w*y,v=n[4],b=n[5],x=n[6],w=n[7],e[4]=v*i+b*a+x*h+w*m,e[5]=v*r+b*l+x*d+w*g,e[6]=v*o+b*c+x*p+w*_,e[7]=v*s+b*u+x*f+w*y,v=n[8],b=n[9],x=n[10],w=n[11],e[8]=v*i+b*a+x*h+w*m,e[9]=v*r+b*l+x*d+w*g,e[10]=v*o+b*c+x*p+w*_,e[11]=v*s+b*u+x*f+w*y,v=n[12],b=n[13],x=n[14],w=n[15],e[12]=v*i+b*a+x*h+w*m,e[13]=v*r+b*l+x*d+w*g,e[14]=v*o+b*c+x*p+w*_,e[15]=v*s+b*u+x*f+w*y,e}function Fs(e,t,n){const i=n[0],r=n[1],o=n[2];let s,a,l,c,u,h,d,p,f,m,g,_;return t===e?(e[12]=t[0]*i+t[4]*r+t[8]*o+t[12],e[13]=t[1]*i+t[5]*r+t[9]*o+t[13],e[14]=t[2]*i+t[6]*r+t[10]*o+t[14],e[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],c=t[3],u=t[4],h=t[5],d=t[6],p=t[7],f=t[8],m=t[9],g=t[10],_=t[11],e[0]=s,e[1]=a,e[2]=l,e[3]=c,e[4]=u,e[5]=h,e[6]=d,e[7]=p,e[8]=f,e[9]=m,e[10]=g,e[11]=_,e[12]=s*i+u*r+f*o+t[12],e[13]=a*i+h*r+m*o+t[13],e[14]=l*i+d*r+g*o+t[14],e[15]=c*i+p*r+_*o+t[15]),e}function Ns(e,t,n){const i=n[0],r=n[1],o=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Bs(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*r+c*i,e[5]=s*r+u*i,e[6]=a*r+h*i,e[7]=l*r+d*i,e[8]=c*r-o*i,e[9]=u*r-s*i,e[10]=h*r-a*i,e[11]=d*r-l*i,e}function zs(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r+c*i,e[1]=s*r+u*i,e[2]=a*r+h*i,e[3]=l*r+d*i,e[4]=c*r-o*i,e[5]=u*r-s*i,e[6]=h*r-a*i,e[7]=d*r-l*i,e}function js(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Us(e,t,n,i){const r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}function Vs(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function Gs(e,t,n){const i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e}var $s;!function(){const e=new ys(2);ys!=Float32Array&&(e[0]=0,e[1]=0)}(),function(){const e=new ys(4);ys!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}($s||($s={}));const Ws=45*Math.PI/180,Hs=1,qs=.1,Xs=500,Zs=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ys extends ks{static get IDENTITY(){return Js||(Js=new Ys,Object.freeze(Js)),Js}static get ZERO(){return Ks||(Ks=new Ys([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ks)),Ks}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return $s}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=r,this[5]=o,this[6]=s,this[7]=a,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=p,this[14]=f,this[15]=m,this.check()}setRowMajor(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){return this[0]=e,this[1]=r,this[2]=l,this[3]=d,this[4]=t,this[5]=o,this[6]=c,this[7]=p,this[8]=n,this[9]=s,this[10]=u,this[11]=f,this[12]=i,this[13]=a,this[14]=h,this[15]=m,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(Zs)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,l=r+r,c=n*s,u=i*s,h=i*a,d=r*s,p=r*a,f=r*l,m=o*s,g=o*a,_=o*l;e[0]=1-h-f,e[1]=u+_,e[2]=d-g,e[3]=0,e[4]=u-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}frustum(e){const{left:t,right:n,bottom:i,top:r,near:o=qs,far:s=Xs}=e;return s===1/0?function(e,t,n,i,r,o){const s=2*o/(n-t),a=2*o/(r-i),l=(n+t)/(n-t),c=(r+i)/(r-i),u=-2*o;e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=l,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=u,e[15]=0}(this,t,n,i,r,o):function(e,t,n,i,r,o,s){const a=1/(n-t),l=1/(r-i),c=1/(o-s);e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*l,e[10]=(s+o)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*c,e[15]=0}(this,t,n,i,r,o,s),this.check()}lookAt(e){const{eye:t,center:n=[0,0,0],up:i=[0,1,0]}=e;return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,p;const f=t[0],m=t[1],g=t[2],_=i[0],y=i[1],v=i[2],b=n[0],x=n[1],w=n[2];Math.abs(f-b)<_s&&Math.abs(m-x)<_s&&Math.abs(g-w)<_s?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(h=f-b,d=m-x,p=g-w,r=1/Math.sqrt(h*h+d*d+p*p),h*=r,d*=r,p*=r,o=y*p-v*d,s=v*h-_*p,a=_*d-y*h,r=Math.sqrt(o*o+s*s+a*a),r?(r=1/r,o*=r,s*=r,a*=r):(o=0,s=0,a=0),l=d*a-p*s,c=p*o-h*a,u=h*s-d*o,r=Math.sqrt(l*l+c*c+u*u),r?(r=1/r,l*=r,c*=r,u*=r):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=a,e[9]=u,e[10]=p,e[11]=0,e[12]=-(o*f+s*m+a*g),e[13]=-(l*f+c*m+u*g),e[14]=-(h*f+d*m+p*g),e[15]=1)}(this,t,n,i),this.check()}ortho(e){const{left:t,right:n,bottom:i,top:r,near:o=qs,far:s=Xs}=e;return function(e,t,n,i,r,o,s){const a=1/(t-n),l=1/(i-r),c=1/(o-s);e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*l,e[14]=(s+o)*c,e[15]=1}(this,t,n,i,r,o,s),this.check()}orthographic(e){const{fovy:t=Ws,aspect:n=Hs,focalDistance:i=1,near:r=qs,far:o=Xs}=e;Qs(t);const s=t/2,a=i*Math.tan(s),l=a*n;return this.ortho({left:-l,right:l,bottom:-a,top:a,near:r,far:o})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:n=1,near:i=.1,far:r=500}=e;return Qs(t),function(e,t,n,i,r){const o=1/Math.tan(t/2);if(e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=r&&r!==1/0){const t=1/(i-r);e[10]=(r+i)*t,e[14]=2*r*i*t}else e[10]=-1,e[14]=-2*i}(this,t,n,i,r),this.check()}determinant(){return function(e){const t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=t*s-n*o,_=t*a-i*o,y=n*a-i*s,v=c*f-u*p,b=c*m-h*p,x=u*m-h*f;return l*(t*x-n*b+i*v)-r*(o*x-s*b+a*v)+e[15]*(c*y-u*_+h*g)-d*(p*y-f*_+m*g)}(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*r,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*r,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const n=this.getScale(t),i=1/n[0],r=1/n[1],o=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*r,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*r,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*r,e[8]=this[10]*o,e}transpose(){return function(e,t){if(e===t){const n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}invert(){return Ls(this,this),this.check()}multiplyLeft(e){return Ds(this,e,this),this.check()}multiplyRight(e){return Ds(this,this,e),this.check()}rotateX(e){return Bs(this,this,e),this.check()}rotateY(e){return function(e,t,n){const i=Math.sin(n),r=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*r-c*i,e[1]=s*r-u*i,e[2]=a*r-h*i,e[3]=l*r-d*i,e[8]=o*i+c*r,e[9]=s*i+u*r,e[10]=a*i+h*r,e[11]=l*i+d*r}(this,this,e),this.check()}rotateZ(e){return zs(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return function(e,t,n,i){let r,o,s,a,l,c,u,h,d,p,f,m,g,_,y,v,b,x,w,E,S,T,A,C,P=i[0],I=i[1],M=i[2],R=Math.sqrt(P*P+I*I+M*M);R<_s||(R=1/R,P*=R,I*=R,M*=R,o=Math.sin(n),r=Math.cos(n),s=1-r,a=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],m=t[8],g=t[9],_=t[10],y=t[11],v=P*P*s+r,b=I*P*s+M*o,x=M*P*s-I*o,w=P*I*s-M*o,E=I*I*s+r,S=M*I*s+P*o,T=P*M*s+I*o,A=I*M*s-P*o,C=M*M*s+r,e[0]=a*v+h*b+m*x,e[1]=l*v+d*b+g*x,e[2]=c*v+p*b+_*x,e[3]=u*v+f*b+y*x,e[4]=a*w+h*E+m*S,e[5]=l*w+d*E+g*S,e[6]=c*w+p*E+_*S,e[7]=u*w+f*E+y*S,e[8]=a*T+h*A+m*C,e[9]=l*T+d*A+g*C,e[10]=c*T+p*A+_*C,e[11]=u*T+f*A+y*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}scale(e){return Ns(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Fs(this,this,e),this.check()}transform(e,t){return 4===e.length?(fs(t=Gs(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:n}=e;let i;switch(n){case 2:i=function(e,t,n){const i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e}(t||[-0,-0],e,this);break;case 3:i=vs(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fs(i,e.length),i}transformAsVector(e,t){let n;switch(e.length){case 2:n=function(e,t,n){const i=t[0],r=t[1],o=n[3]*i+n[7]*r||1;return e[0]=(n[0]*i+n[4]*r)/o,e[1]=(n[1]*i+n[5]*r)/o,e}(t||[-0,-0],e,this);break;case 3:n=Es(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return fs(n,e.length),n}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,n){return this.identity().translate([e,t,n])}}let Ks,Js;function Qs(e){if(e>2*Math.PI)throw Error("expected radians")}function ea(e,t){const n=Gs([],t,e);return Vs(n,n,1/n[3]),n}function ta(e,t){const n=e%t;return n<0?t+n:n}function na(e,t,n){return e<t?t:e>n?n:e}const ia=Math.log2||function(e){return Math.log(e)*Math.LOG2E};function ra(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const oa=Math.PI,sa=oa/4,aa=oa/180,la=180/oa,ca=512,ua=4003e4,ha=85.051129,da=1.5;function pa(e){return Math.pow(2,e)}function fa(e){return ia(e)}function ma(e){const[t,n]=e;ra(Number.isFinite(t)),ra(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=n*aa;return[ca*(t*aa+oa)/(2*oa),ca*(oa+Math.log(Math.tan(sa+.5*i)))/(2*oa)]}function ga(e){const[t,n]=e,i=t/ca*(2*oa)-oa,r=2*(Math.atan(Math.exp(n/ca*(2*oa)-oa))-sa);return[i*la,r*la]}function _a(e){const t=Math.cos(e*aa);return ca/ua/t}function ya(e){const{latitude:t,longitude:n,highPrecision:i=!1}=e;ra(Number.isFinite(t)&&Number.isFinite(n));const r=ca,o=Math.cos(t*aa),s=r/360,a=s/o,l=r/ua/o,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,a,l],degreesPerUnit:[1/s,1/a,1/l]};if(i){const e=aa*Math.tan(t*aa)/o,n=s*e/2,i=r/ua*e,u=i/a*l;c.unitsPerDegree2=[0,n,i],c.unitsPerMeter2=[u,0,u]}return c}function va(e,t){const[n,i,r]=e,[o,s,a]=t,{unitsPerMeter:l,unitsPerMeter2:c}=ya({longitude:n,latitude:i,highPrecision:!0}),u=ma(e);u[0]+=o*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);const h=ga(u),d=(r||0)+(a||0);return Number.isFinite(r)||Number.isFinite(a)?[h[0],h[1],d]:h}function ba(e){return 2*Math.atan(.5/e)*la}function xa(e){return.5/Math.tan(.5*e*aa)}function wa(e,t){const[n,i,r=0]=e;return ra(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(r)),ea(t,[n,i,r,1])}function Ea(e,t,n=0){const[i,r,o]=e;if(ra(Number.isFinite(i)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(o))return ea(t,[i,r,o,1]);const s=ea(t,[i,r,0,1]),a=ea(t,[i,r,1,1]),l=s[2],c=a[2];return Us([],s,a,l===c?0:((n||0)-l)/(c-l))}const Sa=Math.PI/180;function Ta(e,t,n){const{pixelUnprojectionMatrix:i}=e,r=ea(i,[t,0,1,1]),o=ea(i,[t,e.height,1,1]),s=ga(Us([],r,o,(n*e.distanceScales.unitsPerMeter[2]-r[2])/(o[2]-r[2])));return s.push(n),s}const Aa=["longitude","latitude","zoom"],Ca={curve:1.414,speed:1.2};function Pa(e,t,n){const i=(n=Object.assign({},Ca,n)).curve,r=e.zoom,o=[e.longitude,e.latitude],s=pa(r),a=t.zoom,l=[t.longitude,t.latitude],c=pa(a-r),u=ma(o),h=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}([],ma(l),u),d=Math.max(e.width,e.height),p=d/c,f=function(e){const t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}(h)*s,m=Math.max(f,.01),g=i*i,_=(p*p-d*d+g*g*m*m)/(2*d*g*m),y=(p*p-d*d-g*g*m*m)/(2*p*g*m),v=Math.log(Math.sqrt(_*_+1)-_),b=Math.log(Math.sqrt(y*y+1)-y);return{startZoom:r,startCenterXY:u,uDelta:h,w0:d,u1:f,S:(b-v)/i,rho:i,rho2:g,r0:v,r1:b}}const Ia={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ia,"IDENTITY",{get:()=>(rs.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Ma={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ra={common:0,meters:1,pixels:2},Oa={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},ka=Math.PI/180,La=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Da=[0,0,0],Fa={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class Na{static{this.displayName="Viewport"}constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Fa,this.focalDistance=e.focalDistance||1,this.position=e.position||Da,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:n}=e;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Ma.WEB_MERCATOR:Ma.WEB_MERCATOR_AUTO_OFFSET:Ma.IDENTITY}equals(e){return e instanceof Na&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&hs(e.projectionMatrix,this.projectionMatrix)&&hs(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){const n=wa(this.projectPosition(e),this.pixelProjectionMatrix),[i,r]=n,o=t?r:this.height-r;return 2===e.length?[i,o]:[i,o,n[2]]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,a=n&&n*this.distanceScales.unitsPerMeter[2],l=Ea([i,s,o],this.pixelUnprojectionMatrix,a),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){const t=ma(e);return t[1]=cs(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?ga(e):e}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,0],t),i=this.unproject([this.width,0],t),r=this.unproject([0,this.height],t),o=this.unproject([this.width,this.height],t);return[Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1]),Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])]}getDistanceScales(e){return e?ya({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:n=1,height:i=1}){return e<this.x+this.width&&this.x<e+n&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,{left:Ps((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Ps(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Ps(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Ps(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Ps(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Ps(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes;var e}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,n=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){const{latitude:t}=e;ra(Number.isFinite(t));const n=Math.cos(t*aa);return fa(ua*n)-9}({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||ya({latitude:n,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:r,modelMatrix:o}=e;let s=Da;if(r&&(s=o?new Ys(o).transformAsVector(r,[]):r),this.isGeospatial){const e=this.projectPosition([t,n,0]);this.center=new As(s).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(s)}_initMatrices(e){const{viewMatrix:t=La,projectionMatrix:n=null,orthographic:i=!1,fovyRadians:r,fovy:o=75,near:s=.1,far:a=1e3,padding:l=null,focalDistance:c=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=(new Ys).multiplyRight(t).translate(new As(this.center).negate()),this.projectionMatrix=n||function({width:e,height:t,orthographic:n,fovyRadians:i,focalDistance:r,padding:o,near:s,far:a}){const l=e/t,c=n?(new Ys).orthographic({fovy:i,aspect:l,focalDistance:r,near:s,far:a}):(new Ys).perspective({fovy:i,aspect:l,near:s,far:a});if(o){const{left:n=0,right:i=0,top:r=0,bottom:s=0}=o,a=cs((n+e-i)/2,0,e)-e/2,l=cs((r+t-s)/2,0,t)-t/2;c[8]-=2*a/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:i,fovyRadians:r||o*ka,focalDistance:c,padding:l,near:s,far:a});const u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var h;Ds(u,u,this.projectionMatrix),Ds(u,u,this.viewMatrix),this.viewProjectionMatrix=u,this.viewMatrixInverse=Ls([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(h=this.viewMatrixInverse)[12],h[13],h[14]];const d=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Ns(d,d,[this.width/2,-this.height/2,1]),Fs(d,d,[1,-1,0]),Ds(p,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=Ls([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||rs.warn("Pixel project matrix not invertible")()}}class Ba extends Na{static{this.displayName="WebMercatorViewport"}constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,pitch:r=0,bearing:o=0,nearZMultiplier:s=.1,farZMultiplier:a=1.01,nearZ:l,farZ:c,orthographic:u=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:f,padding:m,legacyMeterSizes:g=!1}=e;let{width:_,height:y,altitude:v=1.5}=e;const b=Math.pow(2,i);let x;_=_||1,y=y||1;let w=null;if(h)v=h[5]/2,x=ba(v);else{let n;if(e.fovy?(x=e.fovy,v=xa(x)):x=ba(v),m){const{top:e=0,bottom:t=0}=m;n=[0,cs((e+y-t)/2,0,y)-y/2]}w=function(e){const{width:t,height:n,altitude:i,pitch:r=0,offset:o,center:s,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=e;let{fovy:u=ba(da)}=e;void 0!==i&&(u=ba(i));const h=u*aa,d=r*aa,p=xa(u);let f=p;s&&(f+=s[2]*a/Math.cos(d)/n);const m=h*(.5+(o?o[1]:0)/n),g=Math.sin(m)*f/Math.sin(na(Math.PI/2-d-m,.01,Math.PI-.01)),_=Math.sin(d)*g+f,y=10*f;return{fov:h,aspect:t/n,focalDistance:p,near:l,far:Math.min(_*c,y)}}({width:_,height:y,scale:b,center:f&&[0,0,f[2]*_a(t)],offset:n,pitch:r,fovy:x,nearZMultiplier:s,farZMultiplier:a}),Number.isFinite(l)&&(w.near=l),Number.isFinite(c)&&(w.far=c)}let E=function(e){const{height:t,pitch:n,bearing:i,altitude:r,scale:o,center:s}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Fs(a,a,[0,0,-r]),Bs(a,a,-n*aa),zs(a,a,i*aa);const l=o/t;return Ns(a,a,[l,l,l]),s&&Fs(a,a,((c=[])[0]=-(u=s)[0],c[1]=-u[1],c[2]=-u[2],c)),a;var c,u}({height:y,pitch:r,bearing:o,scale:b,altitude:v});p&&(E=(new Ys).translate([512*p,0,0]).multiplyLeft(E)),super({...e,width:_,height:y,viewMatrix:E,longitude:n,latitude:t,zoom:i,...w,fovy:x,focalDistance:v}),this.latitude=t,this.longitude=n,this.zoom=i,this.pitch=r,this.bearing=o,this.altitude=v,this.fovy=x,this.orthographic=u,this._subViewports=d?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),n=Math.ceil((e[2]-180)/360);for(let e=t;e<=n;e++){const t=e?new Ba({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,n]=this.projectFlat(e);return[t,n,(e[2]||0)*_a(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,n]=this.unprojectFlat(e);return[t,n,(e[2]||0)/_a(n)]}addMetersToLngLat(e,t){return va(e,t)}panByPosition(e,t){const n=Ea(t,this.pixelUnprojectionMatrix),i=js([],this.projectFlat(e),((a=[])[0]=-(l=n)[0],a[1]=-l[1],a)),r=js([],this.center,i),[o,s]=this.unprojectFlat(r);var a,l;return{longitude:o,latitude:s}}getBounds(e={}){const t=function(e,t=0){const{width:n,height:i,unproject:r}=e,o={targetZ:t},s=r([0,i],o),a=r([n,i],o);let l,c;return(e.fovy?.5*e.fovy*Sa:Math.atan(.5/e.altitude))>(90-e.pitch)*Sa-.01?(l=Ta(e,0,t),c=Ta(e,n,t)):(l=r([0,0],o),c=r([n,0],o)),[s,a,c,l]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:n,height:i}=this,{longitude:r,latitude:o,zoom:s}=function(e){const{width:t,height:n,bounds:i,minExtent:r=0,maxZoom:o=24,offset:s=[0,0]}=e,[[a,l],[c,u]]=i,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(ra(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=ma([a,na(u,-85.051129,ha)]),p=ma([c,na(l,-85.051129,ha)]),f=[Math.max(Math.abs(p[0]-d[0]),r),Math.max(Math.abs(p[1]-d[1]),r)],m=[t-h.left-h.right-2*Math.abs(s[0]),n-h.top-h.bottom-2*Math.abs(s[1])];ra(m[0]>0&&m[1]>0);const g=m[0]/f[0],_=m[1]/f[1],y=(h.right-h.left)/2/g,v=(h.top-h.bottom)/2/_,b=ga([(p[0]+d[0])/2+y,(p[1]+d[1])/2+v]),x=Math.min(o,ia(Math.abs(Math.min(g,_))));return ra(Number.isFinite(x)),{longitude:b[0],latitude:b[1],zoom:x}}({width:n,height:i,bounds:e,...t});return new Ba({width:n,height:i,longitude:r,latitude:o,zoom:s})}}const za=Math.PI/180,ja=180/Math.PI,Ua=6370972,Va=256;function Ga(){const e=4018225162502676e-20,t=Math.PI/180*Va;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,24886.609375]}}class $a extends Na{constructor(e={}){const{latitude:t=0,longitude:n=0,zoom:i=0,nearZMultiplier:r=.1,farZMultiplier:o=2,resolution:s=10}=e;let{height:a,altitude:l=1.5}=e;a=a||1,l=Math.max(.75,l);const c=(new Ys).lookAt({eye:[0,-l,0],up:[0,0,1]}),u=Math.pow(2,i);c.rotateX(t*za),c.rotateZ(-n*za),c.scale(u/a);const h=Math.atan(.5/l),d=512*u/a;super({...e,height:a,viewMatrix:c,longitude:n,latitude:t,zoom:i,distanceScales:Ga(),fovyRadians:2*h,focalDistance:l,near:r,far:Math.min(2,1/d+1)*l*o}),this.latitude=t,this.longitude=n,this.resolution=s}get projectionMode(){return Ma.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},n=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),r=this.unproject([this.width,this.height/2],t),o=this.unproject([this.width/2,this.height],t);return r[0]<this.longitude&&(r[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],r[0],i[0],o[0]),Math.min(n[1],r[1],i[1],o[1]),Math.max(n[0],r[0],i[0],o[0]),Math.max(n[1],r[1],i[1],o[1])]}unproject(e,{topLeft:t=!0,targetZ:n}={}){const[i,r,o]=e,s=t?r:this.height-r,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=Wa(a,[i,s,o,1]);else{const e=Wa(a,[i,s,-1,1]),t=Wa(a,[i,s,1,1]),r=((n||0)/Ua+1)*Va,o=ws(bs([],e,t)),c=ws(e),u=ws(t),h=(4*c*u-(o-c-u)**2)/16*4/o;l=function(e,t,n,i){const r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e}([],e,t,(Math.sqrt(c-h)-Math.sqrt(Math.max(0,r*r-h)))/Math.sqrt(o))}const[c,u,h]=this.unprojectPosition(l);return Number.isFinite(o)?[c,u,h]:Number.isFinite(n)?[c,u,n]:[c,u]}projectPosition(e){const[t,n,i=0]=e,r=t*za,o=n*za,s=Math.cos(o),a=(i/Ua+1)*Va;return[Math.sin(r)*s*a,-Math.cos(r)*s*a,Math.sin(o)*a]}unprojectPosition(e){const[t,n,i]=e,r=function(e){const t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}(e),o=Math.asin(i/r);return[Math.atan2(t,-n)*ja,o*ja,(r/Va-1)*Ua]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const n=this.unproject(t);return{longitude:e[0]-n[0]+this.longitude,latitude:e[1]-n[1]+this.latitude}}}function Wa(e,t){const n=Gs([],t,e);return Vs(n,n,1/n[3]),n}function Ha(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}class qa{constructor(e){const{compare:t,extract:n,required:i}=e;this._propsToCompare=t,this._propsToExtract=n||t,this._requiredProps=i}arePropsEqual(e,t){for(const n of this._propsToCompare)if(!(n in e)||!(n in t)||!hs(e[n],t[n]))return!1;return!0}initializeProps(e,t){const n={},i={};for(const r of this._propsToExtract)(r in e||r in t)&&(n[r]=e[r],i[r]=t[r]);return this._checkRequiredProps(n),this._checkRequiredProps(i),{start:n,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach((t=>{const n=e[t];Ha(Number.isFinite(n)||Array.isArray(n),`${t} is required for transition`)}))}}const Xa={bearing:0,pitch:0,position:[0,0,0]},Za={speed:1.2,curve:1.414};class Ya extends qa{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...Za,...e}}interpolateProps(e,t,n){const i=function(e,t,n,i){const{startZoom:r,startCenterXY:o,uDelta:s,w0:a,u1:l,S:c,rho:u,rho2:h,r0:d}=Pa(e,t,i);if(l<.01){const i={};for(const r of Aa){const o=e[r],s=t[r];i[r]=(p=n)*s+(1-p)*o}return i}var p;const f=n*c,m=Math.cosh(d)/Math.cosh(d+u*f),g=a*((Math.cosh(d)*Math.tanh(d+u*f)-Math.sinh(d))/h)/l,_=r+fa(1/m),y=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}([],s,g);js(y,y,o);const v=ga(y);return{longitude:v[0],latitude:v[1],zoom:_}}(e,t,n,this.opts);for(const r in Xa)i[r]=us(e[r]||Xa[r],t[r]||Xa[r],n);return i}getDuration(e,t){let{transitionDuration:n}=t;return"auto"===n&&(n=function(e,t,n){const i={...Ca,...n},{screenSpeed:r,speed:o,maxDuration:s}=i,{S:a,rho:l}=Pa(e,t,i),c=1e3*a;let u;return u=Number.isFinite(r)?c/(r/l):c/o,Number.isFinite(s)&&u>s?0:u}(e,t,this.opts)),n}}class Ka{constructor(e){this.id="compass",this.placement="top-left",this.viewId=null,this.id=e.id||"compass",this.viewId=e.viewId||null,this.placement=e.placement||"top-left",e.transitionDuration=e.transitionDuration||200,e.label=e.label||"Compass",e.style=e.style||{},this.props=e}setProps(e){Object.assign(this.props,e)}onViewportChange(e){this.viewport=e,this.update()}onAdd({deck:e}){const{style:t,className:n}=this.props,i=document.createElement("div");return i.classList.add("deck-widget","deck-widget-compass"),n&&i.classList.add(n),t&&Object.entries(t).map((([e,t])=>i.style.setProperty(e,t))),this.deck=e,this.element=i,this.update(),i}getRotation(){return this.viewport instanceof Ba?[-this.viewport.bearing,this.viewport.pitch]:this.viewport instanceof $a?[0,Math.max(-80,Math.min(80,this.viewport.latitude))]:[0,0]}update(){const[e,t]=this.getRotation(),n=this.element;n&&Oo(Lo("div",{className:"deck-widget-button",style:{perspective:100},children:Lo("button",{type:"button",onClick:()=>this.handleCompassReset(),label:this.props.label,style:{transform:`rotateX(${t}deg)`},children:Lo("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:Lo("g",{transform:`rotate(${e},13,13)`,children:[Lo("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),Lo("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})}),n)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(){const e=this.viewId||"default-view";if(this.viewport instanceof Ba){const t={...this.viewport,bearing:0,...0===this.getRotation()[0]?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new Ya};this.deck._onViewStateChange({viewId:e,viewState:t,interactionState:{}})}}}var Ja=d(5292),Qa=d.n(Ja),el=d(9893),tl=d.n(el),nl=d(9383),il=d.n(nl),rl=d(6884),ol=d.n(rl),sl=d(9088),al=d.n(sl),ll=d(7997),cl=d.n(ll),ul=d(2190),hl={};hl.styleTagTransform=cl(),hl.setAttributes=ol(),hl.insert=il().bind(null,"head"),hl.domAPI=tl(),hl.insertStyleElement=al(),Qa()(ul.A,hl),ul.A&&ul.A.locals&&ul.A.locals;var dl=d(5114);function pl(e,t={}){t.concavity=t.concavity||1/0;const n=[];if(G(e,(e=>{n.push([e[0],e[1]])})),!n.length)return null;const i=dl(n,t.concavity);return i.length>3?y([i]):null}(0,Object.defineProperty)(pl,"name",{value:"convex",configurable:!0});var fl=pl,ml=d(2007);if(!r.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!function(e,t,n){return xr((function(){var i=nr(e,n)[lt];null!=t||(t=function(e){return Xe(e,rt)||je(e,rt,Je({},e[rt])),e[rt]}(e)),He(t).forEach((function(e){return i.make_(e,t[e])}))})),e})throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");var gl=d(8398);function _l(e){e()}function yl(e){return ci(yr(e,t));var t}var vl=!1;function bl(){return vl}var xl,wl,El=function(){function e(e){var t=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(e){void 0===e&&(e=1e4),clearTimeout(t.sweepTimeout),t.sweepTimeout=void 0;var n=Date.now();t.registrations.forEach((function(i,r){n-i.registeredAt>=e&&(t.finalize(i.value),t.registrations.delete(r))})),t.registrations.size>0&&t.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){t.sweep(0)}})}return Object.defineProperty(e.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){this.registrations.set(n,{value:t,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(e.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(e.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){void 0===this.sweepTimeout&&(this.sweepTimeout=setTimeout(this.sweep,1e4))}}),e}(),Sl=new("undefined"!=typeof FinalizationRegistry?FinalizationRegistry:El)((function(e){var t;null===(t=e.reaction)||void 0===t||t.dispose(),e.reaction=null})),Tl=d(3676);function Al(e){e.reaction=new zn("observer".concat(e.name),(function(){var t;e.stateVersion=Symbol(),null===(t=e.onStoreChange)||void 0===t||t.call(e)}))}var Cl="function"==typeof Symbol&&Symbol.for,Pl=null!==(wl=null===(xl=Object.getOwnPropertyDescriptor((function(){}),"name"))||void 0===xl?void 0:xl.configurable)&&void 0!==wl&&wl,Il=Cl?Symbol.for("react.forward_ref"):"function"==typeof r.forwardRef&&(0,r.forwardRef)((function(e){return null})).$$typeof,Ml=Cl?Symbol.for("react.memo"):"function"==typeof r.memo&&(0,r.memo)((function(e){return null})).$$typeof;function Rl(e,t){var n;if(Ml&&e.$$typeof===Ml)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");if(bl())return e;var i=null!==(n=null==t?void 0:t.forwardRef)&&void 0!==n&&n,s=e,a=e.displayName||e.name;if(Il&&e.$$typeof===Il&&(i=!0,"function"!=typeof(s=e.render)))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var l=function(e,t){return function(e,t){if(void 0===t&&(t="observed"),bl())return e();var n=o().useRef(null);if(!n.current){var i={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:t,subscribe:function(e){return Sl.unregister(i),i.onStoreChange=e,i.reaction||(Al(i),i.stateVersion=Symbol()),function(){var e;i.onStoreChange=null,null===(e=i.reaction)||void 0===e||e.dispose(),i.reaction=null}},getSnapshot:function(){return i.stateVersion}};n.current=i}var r,s,a=n.current;if(a.reaction||(Al(a),Sl.register(n,a,a)),o().useDebugValue(a.reaction,yl),(0,Tl.useSyncExternalStore)(a.subscribe,a.getSnapshot,a.getSnapshot),a.reaction.track((function(){try{r=e()}catch(e){s=e}})),s)throw s;return r}((function(){return s(e,t)}),a)};return l.displayName=e.displayName,Pl&&Object.defineProperty(l,"name",{value:e.name,writable:!0,configurable:!0}),e.contextTypes&&(l.contextTypes=e.contextTypes),i&&(l=(0,r.forwardRef)(l)),function(e,t){Object.keys(e).forEach((function(n){Ol[n]||Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}(e,l=(0,r.memo)(l)),l}var Ol={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};!function(e){e||(e=_l),ai({reactionScheduler:e})}(gl.unstable_batchedUpdates),Sl.finalizeAllImmediately;let kl=1,Ll=1;class Dl{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,o=kl++,s={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(s,this.time),this.channels.set(o,s),o}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const e of t)this._setChannelTime(e,this.time);const n=this.animations.values();for(const e of n){const{animation:t,channel:n}=e;t.setTime(this.getTime(n))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=Ll++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}function Fl(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const Nl={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Bl(e){let t=zl(e);if("object"!==t)return{value:e,...Nl[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Nl[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=zl(e.value),{...e,...Nl[t],type:t}):{type:"object",value:null};throw new Error("props")}function zl(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const jl={vertex:"#ifdef MODULE_LOGDEPTH\nlogdepth_adjustPosition(gl_Position);\n#endif\n",fragment:"#ifdef MODULE_MATERIAL\ngl_FragColor = material_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_LIGHTING\ngl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_FOG\ngl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n#ifdef MODULE_PICKING\ngl_FragColor = picking_filterHighlightColor(gl_FragColor);\ngl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n#ifdef MODULE_LOGDEPTH\nlogdepth_setFragDepth();\n#endif\n"},Ul=/void\s+main\s*\([^)]*\)\s*\{\n?/,Vl=/}\n?[^{}]*$/,Gl=[],$l="__LUMA_INJECT_DECLARATIONS__";function Wl(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Hl(e,t,n,i=!1){const r="vertex"===t;for(const t in n){const i=n[t];i.sort(((e,t)=>e.order-t.order)),Gl.length=i.length;for(let e=0,t=i.length;e<t;++e)Gl[e]=i[e].injection;const o=`${Gl.join("\n")}\n`;switch(t){case"vs:#decl":r&&(e=e.replace($l,o));break;case"vs:#main-start":r&&(e=e.replace(Ul,(e=>e+o)));break;case"vs:#main-end":r&&(e=e.replace(Vl,(e=>o+e)));break;case"fs:#decl":r||(e=e.replace($l,o));break;case"fs:#main-start":r||(e=e.replace(Ul,(e=>e+o)));break;case"fs:#main-end":r||(e=e.replace(Vl,(e=>o+e)));break;default:e=e.replace(t,(e=>e+o))}}return e=e.replace($l,""),i&&(e=e.replace(/\}\s*$/,(e=>e+jl[t]))),e}let ql=1;class Xl{name;vs;fs;getModuleUniforms;dependencies;deprecations;defines;injections;uniforms={};uniformTypes={};static instantiateModules(e){return e.map((e=>{if(e instanceof Xl)return e;Fl("string"!=typeof e,`Shader module use by name is deprecated. Import shader module '${JSON.stringify(e)}' and use it directly.`),e.name||(console.warn("shader module has no name"),e.name="shader-module-"+ql++);const t=new Xl(e);return t.dependencies=Xl.instantiateModules(e.dependencies||[]),t}))}constructor(e){const{name:t,vs:n,fs:i,dependencies:r=[],uniformTypes:o={},uniformPropTypes:s={},getUniforms:a,deprecations:l=[],defines:c={},inject:u={}}=e;Fl("string"==typeof t),this.name=t,this.vs=n,this.fs=i,this.getModuleUniforms=a,this.dependencies=Xl.instantiateModules(r),this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=function(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[Wl(n)][n]=i}return t}(u),this.uniformTypes=o,s&&(this.uniforms=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=Bl(i);return t}(s))}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:Fl(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------\n\n#define MODULE_${n}\n${t}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):function(e,t,n){const i={};for(const[r,o]of Object.entries(t))e&&r in e&&!o.private?(o.validate&&Fl(o.validate(e[r],o),`${n}: invalid ${r}`),i[r]=e[r]):i[r]=o.value;return i}(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{n.regex?.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{"function"===e.type?e.regex=new RegExp(`\\b${e.old}\\(`):e.regex=new RegExp(`${e.type} ${e.old};`)})),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const i in n){const r=n[i];i in e&&!r.private?(r.validate&&Fl(r.validate(e[i],r),`${this.name}: invalid ${i}`),t[i]=e[i]):t[i]=r.value}return t}}function Zl(e){if(e.source&&"webgpu"===e.platformInfo.type)return{...e,vs:void 0,fs:void 0};if(!e.vs)throw new Error("no vertex shader");const t=Yl(e.platformInfo,e.vs);let n;return e.fs&&(n=Yl(e.platformInfo,e.fs)),{...e,vs:t,fs:n}}function Yl(e,t){if("string"==typeof t)return t;if("webgpu"===e.type){if(t?.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders")}if(t?.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}function Kl(e){return function(e){const t={},n={};return Jl({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}(Xl.instantiateModules(e))}function Jl(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const e of t)i[e.name]=e,(void 0===r[e.name]||r[e.name]<n)&&(r[e.name]=n);for(const e of t)e.dependencies&&Jl({modules:e.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}const Ql=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],ec=[...Ql,[ic("attribute"),"in $1"],[ic("varying"),"out $1"]],tc=[...Ql,[ic("varying"),"in $1"]];function nc(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function ic(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function rc(e,t){let n="";for(const i in e){const r=e[i];if(n+=`void ${r.signature} {\n`,r.header&&(n+=`  ${r.header}`),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+=`  ${t.injection}\n`}r.footer&&(n+=`  ${r.footer}`),n+="}\n"}return n}function oc(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,o]=i.split(":"),s=i.replace(/\(.+/,""),a=Object.assign(e,{signature:o});switch(r){case"vs":t.vertex[s]=a;break;case"fs":t.fragment[s]=a;break;default:throw new Error(r)}}return t}function sc(e,t="unnamed"){const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function ac(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error(`Invalid GLSL version ${t}`);return t}const lc=`\n\n${$l}\n`;function cc(e,t){const{source:n,stage:i,modules:r,hookFunctions:o=[],inject:s={},log:a}=t;Fl("string"==typeof n,"shader source must be a string");const l=n;let c="";const u=oc(o),h={},d={},p={};for(const e in s){const t="string"==typeof s[e]?{injection:s[e],order:0}:s[e],n=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(n){const i=n[2],r=n[3];i?"decl"===r?d[e]=[t]:p[e]=[t]:h[e]=[t]}else p[e]=[t]}const f="webgpu"!==e.type?r:[];for(const e of f){a&&e.checkDeprecations(l,a),c+=e.getModuleSource(i,"wgsl");const t=e.injections[i];for(const e in t){const n=/^(v|f)s:#([\w-]+)$/.exec(e);if(n){const i="decl"===n[2]?d:p;i[e]=i[e]||[],i[e].push(t[e])}else h[e]=h[e]||[],h[e].push(t[e])}}return c+=lc,c=Hl(c,i,d),c+=rc(u[i],h),c+=l,c=Hl(c,i,p),c}function uc(e,t){const{id:n,source:i,stage:r,language:o="glsl",modules:s,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;Fl("string"==typeof i,"shader source must be a string");const d="glsl"===o?function(e,t){return{name:sc(e,void 0),language:"glsl",version:ac(e)}}(i).version:-1,p=e.shaderLanguageVersion,f=100===d?"#version 100":"#version 300 es",m=i.split("\n").slice(1).join("\n"),g={};s.forEach((e=>{Object.assign(g,e.getDefines())})),Object.assign(g,a);let _="";switch(o){case"wgsl":break;case"glsl":_=u?`${f}\n\n// ----- PROLOGUE -------------------------\n${function(e){const{id:t,source:n,stage:i}=e;return t&&-1===n.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${t}_${i}\n\n`:""}({id:n,source:i,stage:r})}\n#define SHADER_TYPE_${r.toUpperCase()}\n${function(e){switch(e?.gpu.toLowerCase()){case"apple":return"#define APPLE_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"nvidia":return"#define NVIDIA_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}(e)}\n${"fragment"===r?"precision highp float;\n":""}\n\n// ----- APPLICATION DEFINES -------------------------\n\n${function(e={}){let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+=`#define ${n.toUpperCase()} ${e[n]}\n`)}return t}(g)}\n\n`:`${f}\n`}const y=oc(l),v={},b={},x={};for(const e in c){const t="string"==typeof c[e]?{injection:c[e],order:0}:c[e],n=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(n){const i=n[2],r=n[3];i?"decl"===r?b[e]=[t]:x[e]=[t]:v[e]=[t]}else x[e]=[t]}for(const e of s){h&&e.checkDeprecations(m,h),_+=e.getModuleSource(r);const t=e.injections[r];for(const e in t){const n=/^(v|f)s:#([\w-]+)$/.exec(e);if(n){const i="decl"===n[2]?b:x;i[e]=i[e]||[],i[e].push(t[e])}else v[e]=v[e]||[],v[e].push(t[e])}}return _+="// ----- MAIN SHADER SOURCE -------------------------",_+=lc,_=Hl(_,r,b),_+=rc(y[r],v),_+=m,_=Hl(_,r,x),"glsl"===o&&d!==p&&(_=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return nc(e,ec);case"fragment":return nc(e,tc);default:throw new Error(t)}}(_,r)),_.trim()}function hc(e){return function(t){const n={};for(const i of e){const e=i.getUniforms(t,n);Object.assign(n,e)}return n}}class dc{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return dc.defaultShaderAssembler=dc.defaultShaderAssembler||new dc,dc.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=Zl(e),r=function(e){const t=Kl(e.modules||[]);return{source:cc(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:hc(t)}}({platformInfo:e.platformInfo,...i,modules:t,hookFunctions:n});return{...r,modules:t}}assembleShaderPair(e){const t=Zl(e),n=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:r}=e,o="wgsl"===e.platformInfo.shaderLanguage?function(e){const t=Kl(e.modules||[]);return{vs:cc(e.platformInfo,{...e,source:e.vs,stage:"vertex",modules:t}),fs:cc(e.platformInfo,{...e,source:e.fs,stage:"fragment",modules:t}),getUniforms:hc(t)}}({platformInfo:r,...t,modules:n,hookFunctions:i}):function(e){const{vs:t,fs:n}=e,i=Kl(e.modules||[]);return{vs:uc(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:uc(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:hc(i)}}({platformInfo:r,...t,modules:n,hookFunctions:i});return{...o,modules:n}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let e=0,r=this._defaultModules.length;e<r;++e){const r=this._defaultModules[e],o=r.name;t[i++]=r,n[o]=!0}for(let r=0,o=e.length;r<o;++r){const o=e[r],s=o.name;n[s]||(t[i++]=o,n[s]=!0)}return t.length=i,Xl.instantiateModules(t)}}const pc="#define SMOOTH_EDGE_RADIUS 0.5",fc={name:"geometry",vs:`\n${pc}\n\nstruct VertexGeometry {\n  vec4 position;\n  vec3 worldPosition;\n  vec3 worldPositionAlt;\n  vec3 normal;\n  vec2 uv;\n  vec3 pickingColor;\n} geometry = VertexGeometry(\n  vec4(0.0, 0.0, 1.0, 0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec3(0.0),\n  vec2(0.0),\n  vec3(0.0)\n);\n`,fs:`\n${pc}\n\nstruct FragmentGeometry {\n  vec2 uv;\n} geometry;\n\nfloat smoothedge(float edge, float x) {\n  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);\n}\n`},mc=`${Object.keys(Ia).map((e=>`const int COORDINATE_SYSTEM_${e} = ${Ia[e]};`)).join("")}\n${Object.keys(Ma).map((e=>`const int PROJECTION_MODE_${e} = ${Ma[e]};`)).join("")}\n${Object.keys(Ra).map((e=>`const int UNIT_${e.toUpperCase()} = ${Ra[e]};`)).join("")}\nuniform int project_uCoordinateSystem;\nuniform int project_uProjectionMode;\nuniform float project_uScale;\nuniform bool project_uWrapLongitude;\nuniform vec3 project_uCommonUnitsPerMeter;\nuniform vec3 project_uCommonUnitsPerWorldUnit;\nuniform vec3 project_uCommonUnitsPerWorldUnit2;\nuniform vec4 project_uCenter;\nuniform mat4 project_uModelMatrix;\nuniform mat4 project_uViewProjectionMatrix;\nuniform vec2 project_uViewportSize;\nuniform float project_uDevicePixelRatio;\nuniform float project_uFocalDistance;\nuniform vec3 project_uCameraPosition;\nuniform vec3 project_uCoordinateOrigin;\nuniform vec3 project_uCommonOrigin;\nuniform bool project_uPseudoMeters;\nconst float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);\nconst vec3 ZERO_64_LOW = vec3(0.0);\nconst float EARTH_RADIUS = 6370972.0;\nconst float GLOBE_RADIUS = 256.0;\nfloat project_size_at_latitude(float lat) {\nfloat y = clamp(lat, -89.9, 89.9);\nreturn 1.0 / cos(radians(y));\n}\nfloat project_size() {\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&\nproject_uPseudoMeters == false) {\nif (geometry.position.w == 0.0) {\nreturn project_size_at_latitude(geometry.worldPosition.y);\n}\nfloat y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;\nfloat y2 = y * y;\nfloat y4 = y2 * y2;\nfloat y6 = y4 * y2;\nreturn 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;\n}\nreturn 1.0;\n}\nfloat project_size_at_latitude(float meters, float lat) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);\n}\nfloat project_size(float meters) {\nreturn meters * project_uCommonUnitsPerMeter.z * project_size();\n}\nvec2 project_size(vec2 meters) {\nreturn meters * project_uCommonUnitsPerMeter.xy * project_size();\n}\nvec3 project_size(vec3 meters) {\nreturn meters * project_uCommonUnitsPerMeter * project_size();\n}\nvec4 project_size(vec4 meters) {\nreturn vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);\n}\nmat3 project_get_orientation_matrix(vec3 up) {\nvec3 uz = normalize(up);\nvec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));\nvec3 uy = cross(uz, ux);\nreturn mat3(ux, uy, uz);\n}\nbool project_needs_rotation(vec3 commonPosition, out mat3 transform) {\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\ntransform = project_get_orientation_matrix(commonPosition);\nreturn true;\n}\nreturn false;\n}\nvec3 project_normal(vec3 vector) {\nvec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);\nvec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);\nmat3 rotation;\nif (project_needs_rotation(geometry.position.xyz, rotation)) {\nn = rotation * n;\n}\nreturn n;\n}\nvec4 project_offset_(vec4 offset) {\nfloat dy = offset.y;\nvec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;\nreturn vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);\n}\nvec2 project_mercator_(vec2 lnglat) {\nfloat x = lnglat.x;\nif (project_uWrapLongitude) {\nx = mod(x + 180., 360.0) - 180.;\n}\nfloat y = clamp(lnglat.y, -89.9, 89.9);\nreturn vec2(\nradians(x) + PI,\nPI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))\n) * WORLD_SCALE;\n}\nvec3 project_globe_(vec3 lnglatz) {\nfloat lambda = radians(lnglatz.x);\nfloat phi = radians(lnglatz.y);\nfloat cosPhi = cos(phi);\nfloat D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;\nreturn vec3(\nsin(lambda) * cosPhi,\n-cos(lambda) * cosPhi,\nsin(phi)\n) * D;\n}\nvec4 project_position(vec4 position, vec3 position64Low) {\nvec4 position_world = project_uModelMatrix * position;\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_mercator_(position_world.xy),\nproject_size_at_latitude(position_world.z, position_world.y),\nposition_world.w\n);\n}\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {\nposition_world.xyz += project_uCoordinateOrigin;\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_GLOBE) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nreturn vec4(\nproject_globe_(position_world.xyz),\nposition_world.w\n);\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\nif (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {\nreturn vec4(\nproject_mercator_(position_world.xy) - project_uCommonOrigin.xy,\nproject_size(position_world.z),\nposition_world.w\n);\n}\n}\n}\nif (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||\n(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&\n(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {\nposition_world.xyz -= project_uCoordinateOrigin;\n}\nreturn project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));\n}\nvec4 project_position(vec4 position) {\nreturn project_position(position, ZERO_64_LOW);\n}\nvec3 project_position(vec3 position, vec3 position64Low) {\nvec4 projected_position = project_position(vec4(position, 1.0), position64Low);\nreturn projected_position.xyz;\n}\nvec3 project_position(vec3 position) {\nvec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);\nreturn projected_position.xyz;\n}\nvec2 project_position(vec2 position) {\nvec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);\nreturn projected_position.xy;\n}\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\nreturn viewProjectionMatrix * position + center;\n}\nvec4 project_common_position_to_clipspace(vec4 position) {\nreturn project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\nvec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;\nreturn offset * project_uFocalDistance;\n}\nfloat project_size_to_pixel(float meters) {\nreturn project_size(meters) * project_uScale;\n}\nfloat project_size_to_pixel(float size, int unit) {\nif (unit == UNIT_METERS) return project_size_to_pixel(size);\nif (unit == UNIT_COMMON) return size * project_uScale;\nreturn size;\n}\nfloat project_pixel_size(float pixels) {\nreturn pixels / project_uScale;\n}\nvec2 project_pixel_size(vec2 pixels) {\nreturn pixels / project_uScale;\n}\n`;function gc(e,t){if(e===t)return!0;if(Array.isArray(e)){const n=e.length;if(!t||t.length!==n)return!1;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}function _c(e){let t,n={};return i=>{for(const r in i)if(!gc(i[r],n[r])){t=e(i),n=i;break}return t}}const yc=[0,0,0,0],vc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bc=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],xc=[0,0,0],wc=[0,0,0],Ec=_c((function({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:r,viewProjectionMatrix:o,originCommon:s,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,n){const{viewMatrixUncentered:i,projectionMatrix:r}=e;let{viewMatrix:o,viewProjectionMatrix:s}=e,a=yc,l=yc,c=e.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=Sc(e,t,n);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Gs([],l,s),o=i||o,s=Ds([],r,o),s=Ds([],s,vc)),{viewMatrix:o,viewProjectionMatrix:s,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,n,i),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=Gs([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,p={project_uCoordinateSystem:n,project_uProjectionMode:e.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:s.slice(0,3),project_uCenter:r,project_uPseudoMeters:Boolean(e._pseudoMeters),project_uViewportSize:h,project_uDevicePixelRatio:t,project_uFocalDistance:d,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:xc,project_uScale:e.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:o,project_uModelMatrix:bc,project_uCameraPosition:a};if(c){const t=e.getDistanceScales(c);switch(n){case Ia.METER_OFFSETS:p.project_uCommonUnitsPerWorldUnit=t.unitsPerMeter,p.project_uCommonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case Ia.LNGLAT:case Ia.LNGLAT_OFFSETS:e._pseudoMeters||(p.project_uCommonUnitsPerMeter=t.unitsPerMeter),p.project_uCommonUnitsPerWorldUnit=t.unitsPerDegree,p.project_uCommonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case Ia.CARTESIAN:p.project_uCommonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],p.project_uCommonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return p}));function Sc(e,t,n=wc){n.length<3&&(n=[n[0],n[1],0]);let i,r=n,o=!0;switch(i=t===Ia.LNGLAT_OFFSETS||t===Ia.METER_OFFSETS?n:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Ma.WEB_MERCATOR:t!==Ia.LNGLAT&&t!==Ia.CARTESIAN||(i=[0,0,0],o=!1);break;case Ma.WEB_MERCATOR_AUTO_OFFSET:t===Ia.LNGLAT?r=i:t===Ia.CARTESIAN&&(r=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Ma.IDENTITY:r=e.position.map(Math.fround),r[2]=r[2]||0;break;case Ma.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:o}}const Tc={},Ac={name:"project",dependencies:[{name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;\nfloat sin_taylor_fp32(float a) {\nfloat r, s, t, x;\nif (a == 0.0) {\nreturn 0.0;\n}\nx = -a * a;\ns = a;\nr = a;\nr = r * x;\nt = r * INVERSE_FACTORIAL_3;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_5;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_7;\ns = s + t;\nr = r * x;\nt = r * INVERSE_FACTORIAL_9;\ns = s + t;\nreturn s;\n}\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\nif (a == 0.0) {\nsin_t = 0.0;\ncos_t = 1.0;\n}\nsin_t = sin_taylor_fp32(a);\ncos_t = sqrt(1.0 - sin_t * sin_t);\n}\nfloat tan_taylor_fp32(float a) {\nfloat sin_a;\nfloat cos_a;\nif (a == 0.0) {\nreturn 0.0;\n}\nfloat z = floor(a / TWO_PI);\nfloat r = a - TWO_PI * z;\nfloat t;\nfloat q = floor(r / PI_2 + 0.5);\nint j = int(q);\nif (j < -2 || j > 2) {\nreturn 1.0 / 0.0;\n}\nt = r - PI_2 * q;\nq = floor(t / PI_16 + 0.5);\nint k = int(q);\nint abs_k = int(abs(float(k)));\nif (abs_k > 4) {\nreturn 1.0 / 0.0;\n} else {\nt = t - PI_16 * q;\n}\nfloat u = 0.0;\nfloat v = 0.0;\nfloat sin_t, cos_t;\nfloat s, c;\nsincos_taylor_fp32(t, sin_t, cos_t);\nif (k == 0) {\ns = sin_t;\nc = cos_t;\n} else {\nif (abs(float(abs_k) - 1.0) < 0.5) {\nu = COS_TABLE_0;\nv = SIN_TABLE_0;\n} else if (abs(float(abs_k) - 2.0) < 0.5) {\nu = COS_TABLE_1;\nv = SIN_TABLE_1;\n} else if (abs(float(abs_k) - 3.0) < 0.5) {\nu = COS_TABLE_2;\nv = SIN_TABLE_2;\n} else if (abs(float(abs_k) - 4.0) < 0.5) {\nu = COS_TABLE_3;\nv = SIN_TABLE_3;\n}\nif (k > 0) {\ns = u * sin_t + v * cos_t;\nc = u * cos_t - v * sin_t;\n} else {\ns = u * sin_t - v * cos_t;\nc = u * cos_t + v * sin_t;\n}\n}\nif (j == 0) {\nsin_a = s;\ncos_a = c;\n} else if (j == 1) {\nsin_a = c;\ncos_a = -s;\n} else if (j == -1) {\nsin_a = -c;\ncos_a = s;\n} else {\nsin_a = -s;\ncos_a = -c;\n}\nreturn sin_a / cos_a;\n}\n#endif\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\nreturn tan_taylor_fp32(a);\n#else\nreturn tan(a);\n#endif\n}\n"},fc],vs:mc,getUniforms:function(e=Tc){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:n=null,coordinateSystem:i=Ia.DEFAULT,coordinateOrigin:r=wc,autoWrapLongitude:o=!1}){i===Ia.DEFAULT&&(i=e.isGeospatial?Ia.LNGLAT:Ia.CARTESIAN);const s=Ec({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r});return s.project_uWrapLongitude=o,s.project_uModelMatrix=n||bc,s}(e):{}}},Cc=[Ac],Pc=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Ic(){const e=dc.getDefaultShaderAssembler();for(const t of Cc)e.addDefaultModule(t);for(const t of Pc)e.addShaderHook(t);return e}const Mc=Symbol.for("component"),Rc=Symbol.for("propTypes"),Oc=Symbol.for("deprecatedProps"),kc=Symbol.for("asyncPropDefaults"),Lc=Symbol.for("asyncPropOriginal"),Dc=Symbol.for("asyncPropResolved");let Fc={};function Nc(e){Fc=e}function Bc(e,t,n,i){rs.level>0&&Fc[e]&&Fc[e].call(null,t,n,i)}function zc(e,t=(()=>!0)){return Array.isArray(e)?jc(e,t,[]):t(e)?[e]:[]}function jc(e,t,n){let i=-1;for(;++i<e.length;){const r=e[i];Array.isArray(r)?jc(r,t,n):t(r)&&n.push(r)}return n}function Uc({target:e,source:t,start:n=0,count:i=1}){const r=t.length,o=i*r;let s=0;for(let i=n;s<r;s++)e[i++]=t[s];for(;s<o;)s<o-s?(e.copyWithin(n+s,n,n+s),s*=2):(e.copyWithin(n+s,n,n+o-s),s=o);return e}function Vc(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if("undefined"!=typeof process&&process.hrtime){const t=process.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class Gc{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Vc(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Vc()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class $c{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach((t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}})),e}_initializeStats(e=[]){e.forEach((e=>this._getOrCreate(e)))}_getOrCreate(e){const{name:t,type:n}=e;let i=this.stats[t];return i||(i=e instanceof Gc?e:new Gc(t,n),this.stats[t]=i),i}}const Wc=e=>"function"==typeof e,Hc=e=>null!==e&&"object"==typeof e,qc=e=>Hc(e)&&e.constructor==={}.constructor,Xc=e=>Boolean(e)&&"function"==typeof e[Symbol.iterator],Zc=e=>e&&"function"==typeof e[Symbol.asyncIterator],Yc=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Kc=e=>"undefined"!=typeof Blob&&e instanceof Blob,Jc=e=>e&&"object"==typeof e&&e.isBuffer,Qc=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Hc(e)&&Wc(e.tee)&&Wc(e.cancel)&&Wc(e.getReader))(e)||(e=>Hc(e)&&Wc(e.read)&&Wc(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);function eu(e,t){if(!e)throw new Error(t||"loader assertion failed.")}function tu(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function nu(e){let t;return eu(e,"null loader"),eu(tu(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let iu="";const ru={};class ou extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const su=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,au=/^([-\w.]+\/[-\w.+]+)/;function lu(e,t){return e.toLowerCase()===t.toLowerCase()}function cu(e){const t=su.exec(e);return t?t[1]:""}const uu=/\?.*/;function hu(e){return e.replace(uu,"")}function du(e){return Yc(e)?e.url:Kc(e)?e.name||"":"string"==typeof e?e:""}function pu(e){if(Yc(e)){const t=e,n=t.headers.get("content-type")||"",i=hu(t.url);return function(e){const t=au.exec(e);return t?t[1]:e}(n)||cu(i)}return Kc(e)?e.type||"":"string"==typeof e?cu(e):""}async function fu(e){if(Yc(e))return e;const t={},n=function(e){return Yc(e)?e.headers["content-length"]||-1:Kc(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);n>=0&&(t["content-length"]=String(n));const i=du(e),r=pu(e);r&&(t["content-type"]=r);const o=await async function(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const n=new FileReader;n.onload=t=>e(t?.target?.result),n.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const t=function(e){let t="";const n=new Uint8Array(e);for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const s=new Response(e,{headers:t});return Object.defineProperty(s,"url",{value:i}),s}async function mu(e,t){if("string"==typeof e){const n=function(e){for(const t in ru)if(e.startsWith(t)){const n=ru[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${iu}${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(n)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(n,t):await fetch(n,t)}return await fu(e)}const gu=new es({id:"loaders.gl"});class _u{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const yu=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),vu="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),bu=(vu&&parseFloat(vu[1]),{fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:yu,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]}),xu={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function wu(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Eu(){const e=wu();return e.globalOptions=e.globalOptions||{...bu},e.globalOptions}function Su(e,t,n,i){return n=n||[],function(e,t){Tu(e,null,bu,xu,t);for(const n of t){const i=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},o=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Tu(i,n.id,r,o,t)}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){const i={...e.options||{}};return function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}(i,n),null===i.log&&(i.log=new _u),Cu(i,Eu()),Cu(i,t),i}(t,e,i)}function Tu(e,t,n,i,r){const o=t||"Top level",s=t?`${t}.`:"";for(const a in e){const l=!t&&Hc(e[a]);if(!(a in n)&&("baseUri"!==a||t)&&("workerUrl"!==a||!t))if(a in i)gu.warn(`${o} loader option '${s}${a}' no longer supported, use '${i[a]}'`)();else if(!l){const e=Au(a,r);gu.warn(`${o} loader option '${s}${a}' not recognized. ${e}`)()}}}function Au(e,t){const n=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const o=t.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function Cu(e,t){for(const n in t)if(n in t){const i=t[n];qc(i)&&qc(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Pu(e,t){const n=Eu(),i=e||n;return"function"==typeof i.fetch?i.fetch:Hc(i.fetch)?e=>mu(e,i.fetch):t?.fetch?t?.fetch:mu}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const Iu="object"!=typeof process||"[object process]"!==String(process)||process.browser,Mu="undefined"!=typeof window&&void 0!==window.orientation,Ru="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Ru&&parseFloat(Ru[1]);class Ou{terminate(){}}function ku(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Lu=new Map;function Du(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Fu(e,t=!0,n){const i=n||new Set;if(e)if(Nu(e))i.add(e);else if(Nu(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const n in e)Fu(e[n],t,i);return void 0===n?Array.from(i):[]}function Nu(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}const Bu=()=>{};class zu{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&Iu||void 0!==Ou&&!Iu}constructor(e){const{name:t,source:n,url:i}=e;ku(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Bu,this.onError=e=>console.log(e),this.worker=Iu?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Bu,this.onError=Bu,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Fu(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=function(e){ku(e.source&&!e.url||!e.source&&e.url);let t=Lu.get(e.source||e.url);return t||(e.url&&(t=(n=e.url).startsWith("http")?Du(`try {\n  importScripts('${n}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):n,Lu.set(e.url,t)),e.source&&(t=Du(e.source),Lu.set(e.source,t))),ku(t),t;var n}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Ou(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Ou(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class ju{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ku(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ku(this.isRunning),this.isRunning=!1,this._reject(e)}}class Uu{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return zu.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,n)=>e.done(n)),n=((e,t)=>e.error(t))){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const n=new ju(t.name,e);e.onMessage=e=>t.onMessage(n,e.type,e.payload),e.onError=e=>t.onError(n,e),t.onStart(n);try{await n.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Iu||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new zu({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Mu?this.maxMobileConcurrency:this.maxConcurrency}}const Vu={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Gu{props;workerPools=new Map;static _workerFarm;static isSupported(){return zu.isSupported()}static getWorkerFarm(e={}){return Gu._workerFarm=Gu._workerFarm||new Gu({}),Gu._workerFarm.setProps(e),Gu._workerFarm}constructor(e){this.props={...Vu},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:n,url:i}=e;let r=this.workerPools.get(t);return r||(r=new Uu({name:t,source:n,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}const $u="latest",Wu=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.0"),globalThis._loadersgl_.version);async function Hu(e,t,n,i,r){const o=e.id,s=function(e,t={}){const n=t[e.id]||{},i=Iu?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=Iu?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t=$u);const n=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${n}/dist/${i}`}return ku(r),r}(e,n),a=Gu.getWorkerFarm(n).getWorkerPool({name:o,url:s});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",qu.bind(null,r));l.postMessage("process",{input:t,options:n,context:i});const c=await l.result;return await c.result}async function qu(e,t,n,i){switch(n){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:o,options:s}=i;try{const n=await e(o,s);t.postMessage("done",{id:r,result:n})}catch(e){const n=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:n})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function Xu(e,t){return Zu(e||{},t)}function Zu(e,t,n=0){if(n>3)return t;const i={...e};for(const[e,r]of Object.entries(t))r&&"object"==typeof r&&!Array.isArray(r)?i[e]=Zu(i[e]||{},t[e],n+1):i[e]=t[e];return i}const Yu=262144,Ku=262144,Ju=1048576;function Qu(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function eh(e,t){return yu?async function*(e,t){const n=e.getReader();let i;try{for(;;){const e=i||n.read();t?._streamReadAhead&&(i=n.read());const{done:r,value:o}=await e;if(r)return;yield Qu(o)}}catch(e){n.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield Qu(t)}(e)}const th="Cannot convert supplied data type";async function nh(e,t,n){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t,n){if(t.text&&"string"==typeof e)return e;if(Jc(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+i)),n}throw new Error(th)}(e,t);if(Kc(e)&&(e=await fu(e)),Yc(e)){const n=e;return await async function(e){if(!e.ok){const t=await async function(e){const t=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let n=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;n=n.length>100?`${n.slice(0,100)}...`:n;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=t?.includes("application/json")?await e.json():e.text()}catch(e){}return new ou(n,i)}(e);throw t}}(n),t.binary?await n.arrayBuffer():await n.text()}if(Qc(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){const n=t?.chunkSize||Yu;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,n),o=e.slice(i,i+t);i+=t,yield r.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:n=Ku}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,n),r=new ArrayBuffer(t),o=new Uint8Array(e,i,t);new Uint8Array(r).set(o),i+=t,yield r}}(e,t);if(Kc(e))return async function*(e,t){const n=t?.chunkSize||Ju;let i=0;for(;i<e.size;){const t=i+n,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(Qc(e))return eh(e,t);if(Yc(e))return eh(e.body,t);throw new Error("makeIterator")}(e,n)),Xc(e)||Zc(e))return async function(e){const t=[];for await(const n of e)t.push(n);return function(...e){return function(e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),n=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(n);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(e)}(...t)}(e);throw new Error(th)}function ih(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const rh=new es({id:"loaders.gl"}),oh=()=>{const e=wu();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},sh=/\.([^.]+)$/;function ah(e,t=[],n,i){if(!lh(e))return null;if(t&&!Array.isArray(t))return nu(t);let r=[];t&&(r=r.concat(t)),n?.ignoreRegisteredLoaders||r.push(...oh()),function(e){for(const t of e)nu(t)}(r);const o=function(e,t,n,i){const r=du(e),o=pu(e),s=hu(r)||i?.url;let a=null,l="";return n?.mimeType&&(a=uh(t,n?.mimeType),l=`match forced by supplied MIME type ${n?.mimeType}`),a=a||function(e,t){const n=t&&sh.exec(t),i=n&&n[1];return i?function(e,t){t=t.toLowerCase();for(const n of e)for(const e of n.extensions)if(e.toLowerCase()===t)return n;return null}(e,i):null}(t,s),l=l||(a?`matched url ${s}`:""),a=a||uh(t,o),l=l||(a?`matched MIME type ${o}`:""),a=a||function(e,t){if(!t)return null;for(const n of e)if("string"==typeof t){if(hh(t,n))return n}else if(ArrayBuffer.isView(t)){if(dh(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&dh(t,0,n))return n;return null}(t,e),l=l||(a?`matched initial data ${ph(e)}`:""),n?.fallbackMimeType&&(a=a||uh(t,n?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${o}`:"")),l&&rh.log(1,`selectLoader selected ${a?.name}: ${l}.`),a}(e,r,n,i);if(!o&&!n?.nothrow)throw new Error(ch(e));return o}function lh(e){return!(e instanceof Response&&204===e.status)}function ch(e){const t=du(e),n=pu(e);let i="No valid loader found (";i+=t?`${ih(t)}, `:"no url provided, ",i+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?ph(e):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function uh(e,t){for(const n of e){if(n.mimeTypes?.some((e=>lu(t,e))))return n;if(lu(t,`application/x.${n.id}`))return n}return null}function hh(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function dh(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((n=>function(e,t,n,i){if(i instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===fh(e,t,i.length);default:return!1}}(e,t,0,n)))}function ph(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?fh(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?fh(e,0,t):""}function fh(e,t,n){if(e.byteLength<t+n)return"";const i=new DataView(e);let r="";for(let e=0;e<n;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}async function mh(e,t,n,i){!t||Array.isArray(t)||tu(t)||(i=void 0,n=t,t=void 0),n=n||{};const r=du(e=await e),o=function(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...e]:e}return n&&n.length?n:void 0}(t,i),s=await async function(e,t=[],n,i){if(!lh(e))return null;let r=ah(e,t,{...n,nothrow:!0},i);if(r)return r;if(Kc(e)&&(r=ah(e=await e.slice(0,10).arrayBuffer(),t,n,i)),!r&&!n?.nothrow)throw new Error(ch(e));return r}(e,o,n);return s?(i=function(e,t,n){if(n)return n;const i={fetch:Pu(t,e),...e};if(i.url){const e=hu(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(uu);return t&&t[0]}(i.url),i.filename=ih(e),i.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,_parse:mh,loaders:o},n=Su(n,s,o,r),i||null),await async function(e,t,n,i){if(function(e,t=Wu){ku(e,"no worker provided");e.version}(e),n=Xu(e.options,n),Yc(t)){const e=t,{ok:n,redirected:r,status:o,statusText:s,type:a,url:l}=e,c=Object.fromEntries(e.headers.entries());i.response={headers:c,ok:n,redirected:r,status:o,statusText:s,type:a,url:l}}t=await nh(t,e,n);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,n,i);if(function(e,t){return!!Gu.isSupported()&&!(!Iu&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,n))return await Hu(e,t,n,i,mh);if(r.parseText&&"string"==typeof t)return await r.parseText(t,n,i);if(r.parse)return await r.parse(t,n,i);throw ku(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(s,e,n,i)):null}async function gh(e,t,n,i){let r,o;Array.isArray(t)||tu(t)?(r=t,o=n):(r=[],o=t);const s=Pu(o);let a=e;return"string"==typeof e&&(a=await s(e)),Kc(e)&&(a=await s(e)),Array.isArray(r),await mh(a,r,o)}class _h{constructor(e,t,n){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=n,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then((()=>this.getData()))}setData(e,t){if(e===this._data&&!t)return;this._data=e;const n=++this._loadCount;let i=e;"string"==typeof e&&(i=gh(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=e)})).catch((e=>{this._loadCount===n&&(this.isLoaded=!0,this._error=e||!0)}))):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const e of this._subscribers)e.onChange(this.getData())}}class yh{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:n=!1,persistent:i=!0}){let r=this._resources[e];r?r.setData(t,n):(r=new _h(e,t,this._context),this._resources[e]=r),r.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const e in t){const n=t[e],i=this._resources[n.resourceId];i&&i.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:n,requestId:i="default"}){const{_resources:r,protocol:o}=this;e.startsWith(o)&&(r[e=e.replace(o,"")]||this.add({resourceId:e,data:null,persistent:!1}));const s=r[e];if(this._track(n,i,s,t),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout((()=>this._prune()),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,n,i){const r=this._consumers,o=r[e]=r[e]||{};let s=o[t];const a=s&&s.resourceId&&this._resources[s.resourceId];a&&(a.unsubscribe(s),this.prune()),n&&(s?(s.onChange=i,s.resourceId=n.id):s={onChange:i,resourceId:n.id},o[t]=s,n.subscribe(s))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}class vh{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{Bc("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:n,stats:i,viewport:r,timeline:o}=t||{};this.layers=[],this.resourceManager=new yh({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:n,shaderAssembler:Ic(),defaultShaderModules:[],renderPass:void 0,stats:i||new $c({id:"deck.gl"}),viewport:r||new Na({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Dl,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const i=n.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter((t=>e.find((e=>0===t.id.indexOf(e))))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bc("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;const n=zc(e,Boolean);for(const e of n)e.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find((t=>t.name===e.name))||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,n=t.findIndex((t=>t.name===e.name));n>=0&&(t.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,n){n.raiseError(t,`${e} of ${n}`)}_updateLayers(e,t){const n={};for(const t of e)n[t.id]?rs.warn(`Multiple old layers with same id ${t.id}`)():n[t.id]=t;if(this._defaultShaderModulesChanged){for(const t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,n,i),this._finalizeOldLayers(n);let r=!1;for(const e of i)if(e.hasUniformTransition()){r=`Uniform transition in ${e}`;break}this._needsUpdate=r,this.layers=i}_updateSublayersRecursively(e,t,n){for(const i of e){i.context=this.context;const e=t[i.id];null===e&&rs.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let r=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),n.push(i),r=i.isComposite?i.getSubLayers():null}catch(e){this._handleError("matching",e,i)}r&&this._updateSublayersRecursively(r,t,n)}}_finalizeOldLayers(e){for(const t in e){const n=e[t];n&&this._finalizeLayer(n)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}class bh{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter((t=>t.containsPixel(e))):this._viewports}getViews(){const e={};return this.views.forEach((t=>{e[t.id]=t})),e}getView(e){return this.views.find((t=>t.id===e))}getViewState(e){const t="string"==typeof e?this.getView(e):e,n=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(n):n}getViewport(e){return this._viewportMap[e]}unproject(e,t){const n=this.getViewports(),i={x:e[0],y:e[1]};for(let r=n.length-1;r>=0;--r){const o=n[r];if(o.containsPixel(i)){const n=e.slice();return n[0]-=o.x,n[1]-=o.y,o.unproject(n,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){e===this.width&&t===this.height||(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=zc(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Do(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):rs.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new(0,t.type)({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,n,i){const r=e.controller;if(r&&n){const o={...t,...r,id:e.id,x:n.x,y:n.y,width:n.width,height:n.height};return i&&i.constructor===r.type||(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let i=e.length;i--;){const r=e[i],o=this.getViewState(r),s=r.makeViewport({viewState:o,width:this.width,height:this.height});let a=t[r.id];const l=Boolean(r.controller);l&&!a&&(n=!0),!n&&l||!a||(a.finalize(),a=null),this.controllers[r.id]=this._updateController(r,o,s,a),s&&this._viewports.unshift(s)}for(const e in t){const n=t[e];n&&!this.controllers[e]&&n.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach((e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)}))}_diffViews(e,t){return e.length!==t.length||e.some(((n,i)=>!e[i].equals(t[i])))}}const xh=/([0-9]+\.?[0-9]*)(%|px)/;function wh(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=xh.exec(e);if(t&&t.length>=3){const e="%"===t[2],n=parseFloat(t[1]);return{position:e?n/100:n,relative:e}}default:throw new Error(`Could not parse position string ${e}`)}}function Eh(e,t){return e.relative?Math.round(e.position*t):e.position}class Sh{constructor(e){const{id:t,x:n=0,y:i=0,width:r="100%",height:o="100%",padding:s=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=wh(n),this._y=wh(i),this._width=wh(r),this._height=wh(o),this._padding=s&&{left:wh(s.left||0),right:wh(s.right||0),top:wh(s.top||0),bottom:wh(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.ViewportType===e.ViewportType&&Do(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:n}){n=this.filterViewState(n);const i=this.getDimensions({width:e,height:t});return i.height&&i.width?new this.ViewportType({...n,...this.props,...i}):null}getViewStateId(){const{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){const n={x:Eh(this._x,e),y:Eh(this._y,t),width:Eh(this._width,e),height:Eh(this._height,t)};return this._padding&&(n.padding={left:Eh(this._padding.left,e),top:Eh(this._padding.top,t),right:Eh(this._padding.right,e),bottom:Eh(this._padding.bottom,t)}),n}get controller(){const e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}class Th{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Ah=()=>{},Ch=e=>e;class Ph{constructor(e){this._onTransitionUpdate=e=>{const{time:t,settings:{interpolator:n,startProps:i,endProps:r,duration:o,easing:s}}=e,a=s(t/o),l=n.interpolateProps(i,r,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Th(e.timeline),this.onViewStateChange=e.onViewStateChange||Ah,this.onStateChange=e.onStateChange||Ah}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const n=this.props;if(this.props=e,!n||this._shouldIgnoreViewportChange(n,e))return!1;if(this._isTransitionEnabled(e)){let i=n;if(this.transition.inProgress){const{interruption:e,endProps:t}=this.transition.settings;i={...n,...2===e?t:this.propsInTransition||n}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:n}=e;return(t>0||"auto"===t)&&Boolean(n)}_isUpdateDueToCurrentTransition(e){return!(!this.transition.inProgress||!this.propsInTransition)&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){const n=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(n),r=t.transitionInterpolator,o=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(0===o)return;const s=r.initializeProps(e,i);this.propsInTransition={};const a={duration:o,easing:t.transitionEasing||Ch,interpolator:r,interruption:t.transitionInterruption||1,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}const Ih=["longitude","latitude","zoom","bearing","pitch"],Mh=["longitude","latitude","zoom"];class Rh extends qa{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,n=Array.isArray(e)?{}:e;n.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Ih,required:Mh},super(n.transitionProps),this.opts=n}initializeProps(e,t){const n=super.initializeProps(e,t),{makeViewport:i,around:r}=this.opts;if(i&&r){const o=i(e),s=i(t),a=o.unproject(r);n.start.around=r,Object.assign(n.end,{around:s.project(a),aroundPosition:a,width:t.width,height:t.height})}return n}interpolateProps(e,t,n){const i={};for(const r of this._propsToExtract)i[r]=us(e[r]||0,t[r]||0,n);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...i});Object.assign(i,r.panByPosition(t.aroundPosition,us(e.around,t.around,n)))}return i}}const Oh={transitionDuration:0},kh=e=>1-(1-e)*(1-e),Lh=["wheel"],Dh=["panstart","panmove","panend"],Fh=["pinchstart","pinchmove","pinchend"],Nh=["tripanstart","tripanmove","tripanend"],Bh=["doubletap"],zh=["keydown"],jh={};class Uh{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Ph({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return!t&&this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:n}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-n]}isPointInBounds(e,t){const{width:n,height:i}=this.props;if(t&&t.handled)return!1;const r=e[0]>=0&&e[0]<=n&&e[1]>=0&&e[1]<=i;return r&&t&&t.stopPropagation(),r}isFunctionKeyPressed(e){const{srcEvent:t}=e;return Boolean(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout((()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)}),e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:!0===t?300:0;const{scrollZoom:n=!0,dragPan:i=!0,dragRotate:r=!0,doubleClickZoom:o=!0,touchZoom:s=!0,touchRotate:a=!1,keyboard:l=!0}=e,c=Boolean(this.onViewStateChange);this.toggleEvents(Lh,c&&n),this.toggleEvents(Dh,c),this.toggleEvents(Fh,c&&(s||a)),this.toggleEvents(Nh,c&&a),this.toggleEvents(Bh,c&&o),this.toggleEvents(zh,c&&l),this.scrollZoom=n,this.dragPan=i,this.dragRotate=r,this.doubleClickZoom=o,this.touchZoom=s,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach((e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))}))}updateViewport(e,t=null,n={}){const i={...e.getViewportProps(),...t},r=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(n),r){const e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let n=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(n=!n);const i=this.controllerState[n?"panStart":"rotateStart"]({pos:t});return this._panMove=n,this.updateViewport(i,Oh,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),n=this.controllerState.pan({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isPanning:!0})}else{const e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const n=this.getCenter(e),i=[n[0]+e.velocityX*t/2,n[1]+e.velocityY*t/2],r=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isRotating:!0})}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:n=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:r}=e;let o=2/(1+Math.exp(-Math.abs(r*n)));r<0&&0!==o&&(o=1/o);const s=this.controllerState.zoom({pos:t,scale:o});return this.updateViewport(s,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.rotateStart({pos:t});return this.updateViewport(n,Oh,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate)return!1;if(!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const n=this.controllerState.rotate({pos:t});return this.updateViewport(n,Oh,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const n=this.getCenter(e),i=[n[0],n[1]+=e.velocityY*t/2],r=this.controllerState.rotate({pos:i});this.updateViewport(r,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return jh._startPinchRotation=e.rotation,jh._lastPinchEvent=e,this.updateViewport(n,Oh,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate)return!1;if(!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:n}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:n})}if(this.touchRotate){const{rotation:n}=e;t=t.rotate({deltaAngleX:jh._startPinchRotation-n})}return this.updateViewport(t,Oh,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),jh._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:n}=jh;if(this.touchZoom&&t&&n&&e.scale!==n.scale){const i=this.getCenter(e);let r=this.controllerState.rotateEnd();const o=Math.log2(e.scale),s=(o-Math.log2(n.scale))/(e.deltaTime-n.deltaTime),a=Math.pow(2,o+s*t/2);r=r.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(r,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:kh},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return jh._startPinchRotation=null,jh._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const n=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:n?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:n,moveSpeed:i,rotateSpeedX:r,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:s}=this;let a;const l={};switch(e.srcEvent.code){case"Minus":a=t?s.zoomOut(n).zoomOut(n):s.zoomOut(n),l.isZooming=!0;break;case"Equal":a=t?s.zoomIn(n).zoomIn(n):s.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":t?(a=s.rotateLeft(r),l.isRotating=!0):(a=s.moveLeft(i),l.isPanning=!0);break;case"ArrowRight":t?(a=s.rotateRight(r),l.isRotating=!0):(a=s.moveRight(i),l.isPanning=!0);break;case"ArrowUp":t?(a=s.rotateUp(o),l.isRotating=!0):(a=s.moveUp(i),l.isPanning=!0);break;case"ArrowDown":t?(a=s.rotateDown(o),l.isRotating=!0):(a=s.moveDown(i),l.isPanning=!0);break;default:return!1}return this.updateViewport(a,this._getTransitionProps(),l),!0}_getTransitionProps(e){const{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new Rh({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:Oh}}class Vh{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class Gh extends Vh{constructor(e){const{width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s=0,pitch:a=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:f,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v,normalize:b=!0}=e;Ha(Number.isFinite(r)),Ha(Number.isFinite(i)),Ha(Number.isFinite(o)),super({width:t,height:n,latitude:i,longitude:r,zoom:o,bearing:s,pitch:a,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:p,normalize:b,position:c},{startPanLngLat:f,startZoomLngLat:m,startRotatePos:g,startBearing:_,startPitch:y,startZoom:v}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const n=this.getState().startPanLngLat||this._unproject(t);if(!n)return this;const i=this.makeViewport(this.getViewportProps()).panByPosition(n,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:n=0}){const{startRotatePos:i,startBearing:r,startPitch:o}=this.getState();if(!i||void 0===r||void 0===o)return this;let s;return s=e?this._getNewRotation(e,i,o,r):{bearing:r+t,pitch:o+n},this._getUpdatedState(s)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:n}){let{startZoom:i,startZoomLngLat:r}=this.getState();if(r||(i=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:o,minZoom:s}=this.getViewportProps();let a=i+Math.log2(n);a=cs(a,s,o);const l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),n={...this.getViewportProps()},{bearing:i,longitude:r}=n;return Math.abs(i-t.bearing)>180&&(n.bearing=i<0?i+360:i-360),Math.abs(r-t.longitude)>180&&(n.longitude=r<0?r+360:r-360),n}applyConstraints(e){const{maxZoom:t,minZoom:n,zoom:i}=e;e.zoom=cs(i,n,t);const{maxPitch:r,minPitch:o,pitch:s}=e;e.pitch=cs(s,o,r);const{normalize:a=!0}=e;return a&&Object.assign(e,function(e){const{width:t,height:n,pitch:i=0}=e;let{longitude:r,latitude:o,zoom:s,bearing:a=0}=e;(r<-180||r>180)&&(r=ta(r+180,360)-180),(a<-180||a>180)&&(a=ta(a+180,360)-180);const l=ia(n/512);if(s<=l)s=l,o=0;else{const e=n/2/Math.pow(2,s),t=ga([0,e])[1];if(o<t)o=t;else{const t=ga([0,512-e])[1];o>t&&(o=t)}}return{width:t,height:n,longitude:r,latitude:o,zoom:s,pitch:i,bearing:a}}(e)),e}_zoomFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.zoom({pos:[t/2,n/2],scale:e})}_panFromCenter(e){const{width:t,height:n}=this.getViewportProps();return this.pan({startPos:[t/2,n/2],pos:[t/2+e[0],n/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,n,i){const r=e[0]-t[0],o=e[1]-t[1],s=e[1],a=t[1],{width:l,height:c}=this.getViewportProps(),u=r/l;let h=0;o>0?Math.abs(c-a)>5&&(h=o/(a-c)*1.2):o<0&&a>5&&(h=1-s/a),h=cs(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps();let f=n;return h>0?f=n+h*(p-n):h<0&&(f=n-h*(d-n)),{pitch:f,bearing:i+180*u}}}class $h extends Uh{constructor(){super(...arguments),this.ControllerState=Gh,this.transition={transitionDuration:300,transitionInterpolator:new Rh({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Wh extends Sh{static{this.displayName="MapView"}constructor(e={}){super(e)}get ViewportType(){return Ba}get ControllerType(){return $h}}const Hh=[255,255,255],qh=1;let Xh=0;class Zh{constructor(e={}){this.type="ambient";const{color:t=Hh}=e,{intensity:n=qh}=e;this.id=e.id||"ambient-"+Xh++,this.color=t,this.intensity=n}}const Yh=[255,255,255],Kh=1,Jh=[0,0,-1];let Qh=0;class ed{constructor(e={}){this.type="directional";const{color:t=Yh}=e,{intensity:n=Kh}=e,{direction:i=Jh}=e,{_shadow:r=!1}=e;this.id=e.id||"directional-"+Qh++,this.color=t,this.intensity=n,this.type="directional",this.direction=new As(i).normalize().toArray(),this.shadow=r}getProjectedLight(e){return this}}class td{constructor(e,t={id:"pass"}){const{id:n}=t;this.id=n,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class nd extends td{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,n]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,r=e.clearColor??(!!i&&[0,0,0,0]),o=!!i&&1,s=!!i&&0,a=e.colorMask??15,l={viewport:[0,0,t,n]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:r,clearDepth:o,clearStencil:s});try{return this._drawLayers(c,e)}finally{c.end()}}_drawLayers(e,t){const{target:n,moduleParameters:i,viewports:r,views:o,onViewportActive:s,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);const l=[];for(const a of r){const r=o&&o[a.id];s?.(a);const c=this._getDrawLayerParams(a,t),u=a.subViewports||[a];for(const o of u){const s=this._drawLayersInViewport(e,{target:n,moduleParameters:i,viewport:o,view:r,pass:t.pass,layers:t.layers},c);l.push(s)}}return l}_getDrawLayerParams(e,{layers:t,pass:n,isPicking:i=!1,layerFilter:r,cullRect:o,effects:s,moduleParameters:a},l=!1){const c=[],u=id(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:i,renderPass:n,cullRect:o},d={};for(let i=0;i<t.length;i++){const o=t[i],p=this._shouldDrawLayer(o,h,r,d),f={shouldDrawLayer:p};p&&!l&&(f.layerRenderIndex=u(o,p),f.moduleParameters=this._getModuleParameters(o,s,n,a),f.layerParameters={...o.context.deck?.props.parameters,...this.getLayerParameters(o,i,e)}),c[i]=f}return c}_drawLayersInViewport(e,{layers:t,moduleParameters:n,pass:i,target:r,viewport:o,view:s},a){const l=function(e,{moduleParameters:t,target:n,viewport:i}){const r=t&&t.devicePixelRatio||e.canvasContext.cssToDeviceRatio(),[,o]=e.canvasContext.getDrawingBufferSize(),s=n?n.height:o,a=i;return[a.x*r,s-(a.y+a.height)*r,a.width*r,a.height*r]}(this.device,{moduleParameters:n,target:r,viewport:o});if(s&&s.props.clear){const e=!0===s.props.clear?{color:!0,depth:!0}:s.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:l},(()=>this.device.clearWebGL(e)))}const c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let n=0;n<t.length;n++){const r=t[n],{shouldDrawLayer:s,layerRenderIndex:l,moduleParameters:u,layerParameters:h}=a[n];if(s&&r.props.pickable&&c.pickableCount++,r.isComposite)c.compositeCount++;else if(s){c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,l),u.viewport=o,r.context.renderPass=e;try{r._drawLayer({renderPass:e,moduleParameters:u,uniforms:{layerIndex:l},parameters:h})}catch(e){r.raiseError(e,`drawing ${r} to ${i}`)}}}return c}shouldDrawLayer(e){return!0}getModuleParameters(e,t){return null}getLayerParameters(e,t,n){return e.props.parameters}_shouldDrawLayer(e,t,n,i){if(!e.props.visible||!this.shouldDrawLayer(e))return!1;t.layer=e;let r=e.parent;for(;r;){if(!r.props.visible||!r.filterSubLayer(t))return!1;t.layer=r,r=r.parent}if(n){const e=t.layer.id;if(e in i||(i[e]=n(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getModuleParameters(e,t,n,i){const r=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(e.internalState?.propsInTransition||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:r});if(t)for(const n of t)Object.assign(o,n.getModuleParameters?.(e));return Object.assign(o,this.getModuleParameters(e,t),i)}}function id(e=0,t={}){const n={},i=(r,o)=>{const s=r.props._offset,a=r.id,l=r.parent&&r.parent.id;let c;if(l&&!(l in t)&&i(r.parent,!1),l in n){const e=n[l]=n[l]||id(t[l],t);c=e(r,o),n[a]=e}else Number.isFinite(s)?(c=s+(t[l]||0),n[a]=null):c=e;return o&&c>=e&&(e=c+1),t[a]=c,c};return i}class rd extends nd{constructor(e,t){super(e,t),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const t=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],r=i.width*n,o=i.height*n;r===t.width&&o===t.height||t.resize({width:r,height:o}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const od=_c((function({viewport:e,center:t}){return new Ys(e.viewProjectionMatrix).invert().transform(t)})),sd=_c((function({viewport:e,shadowMatrices:t}){const n=[],i=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,o=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map((e=>function(e,t){const[n,i,r]=e,o=Ea([n,i,r],t);return Number.isFinite(r)?o:[o[0],o[1],0]}(e,i)));for(const i of t){const t=i.clone().translate(new As(e.center).negate()),r=o.map((e=>t.transform(e))),s=(new Ys).ortho({left:Math.min(...r.map((e=>e[0]))),right:Math.max(...r.map((e=>e[0]))),bottom:Math.min(...r.map((e=>e[1]))),top:Math.max(...r.map((e=>e[1]))),near:Math.min(...r.map((e=>-e[2]))),far:Math.max(...r.map((e=>-e[2])))});n.push(s.multiplyRight(i))}return n})),ad=[0,0,0,1],ld=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],cd={name:"shadow",dependencies:[Ac],vs:"\nconst int max_lights = 2;\nuniform mat4 shadow_uViewProjectionMatrices[max_lights];\nuniform vec4 shadow_uProjectCenters[max_lights];\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform int shadow_uLightId;\nuniform float shadow_uLightCount;\n\nout vec3 shadow_vPosition[max_lights];\n\nvec4 shadow_setVertexPosition(vec4 position_commonspace) {\n  if (shadow_uDrawShadowMap) {\n    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);\n  }\n  if (shadow_uUseShadowMap) {\n    for (int i = 0; i < max_lights; i++) {\n      if(i < int(shadow_uLightCount)) {\n        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);\n        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;\n      }\n    }\n  }\n  return gl_Position;\n}\n",fs:"\nconst int max_lights = 2;\nuniform bool shadow_uDrawShadowMap;\nuniform bool shadow_uUseShadowMap;\nuniform sampler2D shadow_uShadowMap0;\nuniform sampler2D shadow_uShadowMap1;\nuniform vec4 shadow_uColor;\nuniform float shadow_uLightCount;\n\nin vec3 shadow_vPosition[max_lights];\n\nconst vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);\nconst vec4 bitUnpackShift = 1.0 / bitPackShift;\nconst vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);\n\nfloat shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {\n  vec4 rgbaDepth = texture(shadowMap, position.xy);\n\n  float z = dot(rgbaDepth, bitUnpackShift);\n  return smoothstep(0.001, 0.01, position.z - z);\n}\n\nvec4 shadow_filterShadowColor(vec4 color) {\n  if (shadow_uDrawShadowMap) {\n    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);\n    rgbaDepth -= rgbaDepth.gbaa * bitMask;\n    return rgbaDepth;\n  }\n  if (shadow_uUseShadowMap) {\n    float shadowAlpha = 0.0;\n    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);\n    if(shadow_uLightCount > 1.0) {\n      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);\n    }\n    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;\n    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);\n\n    return vec4(\n      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),\n      blendedAlpha\n    );\n  }\n  return color;\n}\n",inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    position = shadow_setVertexPosition(geometry.position);\n    ","fs:DECKGL_FILTER_COLOR":"\n    color = shadow_filterShadowColor(color);\n    "},getUniforms:(e={},t={})=>"viewport"in e&&(e.drawToShadowMap||e.shadowMaps&&e.shadowMaps.length>0)?function(e,t){const{shadowEnabled:n=!0}=e;if(!n||!e.shadowMatrices||!e.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const i={shadow_uDrawShadowMap:Boolean(e.drawToShadowMap),shadow_uUseShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,shadow_uColor:e.shadowColor||ad,shadow_uLightId:e.shadowLightId||0,shadow_uLightCount:e.shadowMatrices.length},r=od({viewport:e.viewport,center:t.project_uCenter}),o=[],s=sd({shadowMatrices:e.shadowMatrices,viewport:e.viewport}).slice();for(let n=0;n<e.shadowMatrices.length;n++){const i=s[n],a=i.clone().translate(new As(e.viewport.center).negate());t.project_uCoordinateSystem===Ia.LNGLAT&&t.project_uProjectionMode===Ma.WEB_MERCATOR?(s[n]=a,o[n]=r):(s[n]=i.clone().multiplyRight(ld),o[n]=a.transform(r))}for(let e=0;e<s.length;e++)i[`shadow_uViewProjectionMatrices[${e}]`]=s[e],i[`shadow_uProjectCenters[${e}]`]=o[e];for(let t=0;t<2;t++)i[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return i}(e,t):{}},ud={color:[255,255,255],intensity:1},hd=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],dd=[0,0,0,200/255];class pd{constructor(e={}){this.id="lighting-effect",this.shadowColor=dd,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:n}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),n._addDefaultShaderModule(cd),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const t in e){const n=e[t];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some((e=>e.shadow)),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:t,viewports:n,onViewportActive:i,views:r,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const t=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return t.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map((t=>t.getProjectedLight({layer:e}))),pointLights:this.pointLights.map((t=>t.getProjectedLight({layer:e})))},t}cleanup(e){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(cd))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const n=(new Ys).lookAt({eye:new As(t.direction).negate()});e.push(n)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const n=new rd(e);this.shadowPasses[t]=n,this.shadowMaps[t]=n.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:n}=this;e||0!==t.length||0!==n.length||(this.ambientLight=new Zh(ud),this.directionalLights.push(new ed(hd[0]),new ed(hd[1])))}}const fd=new pd;class md{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find((t=>t.id===e.id))){const n=t.findIndex((t=>{return n=e,(t.order??1/0)-(n.order??1/0)>0;var n}));n<0?t.push(e):t.splice(n,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Do(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const e of this.effects)t[e.id]=e;const n=[];for(const i of e){const e=t[i.id];let r=i;e&&e!==i?e.setProps?(e.setProps(i.props),r=e):e.cleanup(this._context):e||i.setup(this._context),n.push(r),delete t[i.id]}for(const e in t)t[e].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),e.some((e=>e instanceof pd))||this._resolvedEffects.push(fd),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class gd extends nd{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const _d={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class yd extends nd{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,pickingFBO:o,deviceRect:{x:s,y:a,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:p,moduleParameters:f}){this.pickZ=p;const m=this._resetColorEncoder(p),g=[s,a,l,c],_=super.render({target:o,layers:e,layerFilter:t,views:n,viewports:i,onViewportActive:r,cullRect:u,effects:h?.filter((e=>e.useInPicking)),pass:d,isPicking:!0,moduleParameters:f,clearColor:[0,0,0,0],colorMask:15,scissorRect:g});return this._colorEncoderState=null,{decodePickingColor:m&&vd.bind(null,m),stats:_}}shouldDrawLayer(e){const{pickable:t,operation:n}=e.props;return t&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,t,n){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:r,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:r&&o.includes("draw")&&(Object.assign(i,_d),i.blend=!0,i.blendColor=function(e,t,n){const{byLayer:i,byAlpha:r}=e;let o,s=i.get(t);return s?(s.viewports.push(n),o=s.a):(o=i.size+1,o<=255?(s={a:o,layer:t,viewports:[n]},i.set(t,s),r[o]=s):(rs.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}(this._colorEncoderState,e,n)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function vd(e,t){const n=e.byAlpha[t[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(t)}}class bd{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new gd(e),this.pickLayersPass=new yd(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};n.effects&&this._preRender(n.effects,n);const i=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const r=t.render({...n,target:i});n.effects&&this._postRender(n.effects,n),this.renderCount++,Bc("deckRenderer.renderLayers",this,r,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const n of e)t.preRenderStats[n.id]=n.preRender(t),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();0===e.length&&[0,1].map((t=>{const n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))}));for(const n of e)n.resize(t)}_postRender(e,t){const{renderBuffers:n}=this,i={...t,inputBuffer:n[0],swapBuffer:n[1]};for(const r of e)if(r.postRender){i.target=r.id===this.lastPostProcessEffect?t.target:void 0;const e=r.postRender(i);i.inputBuffer=e,i.swapBuffer=e===n[0]?n[1]:n[0]}}}const xd={pickedColor:null,pickedObjectIndex:-1};function wd({pickedColors:e,decodePickingColor:t,deviceX:n,deviceY:i,deviceRadius:r,deviceRect:o}){const{x:s,y:a,width:l,height:c}=o;let u=r*r,h=-1,d=0;for(let t=0;t<c;t++){const r=t+a-i,o=r*r;if(o>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){const e=t+s-n,i=e*e+o;i<=u&&(u=i,h=d)}d+=4}}if(h>=0){const n=e.slice(h,h+4),i=t(n);if(i){const e=Math.floor(h/4/l),t=h/4-e*l;return{...i,pickedColor:n,pickedX:s+t,pickedY:a+e}}rs.error("Picked non-existent layer. Is picking buffer corrupt?")()}return xd}function Ed({pickInfo:e,viewports:t,pixelRatio:n,x:i,y:r,z:o}){let s,a=t[0];if(t.length>1&&(a=function(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.containsPixel(t))return i}return e[0]}(e?.pickedViewports||t,{x:i,y:r})),a){const e=[i-a.x,r-a.y];void 0!==o&&(e[2]=o),s=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:r,pixel:[i,r],coordinate:s,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:n}}function Sd(e){const{pickInfo:t,lastPickedInfo:n,mode:i,layers:r}=e,{pickedColor:o,pickedLayer:s,pickedObjectIndex:a}=t,l=s?[s]:[];if("hover"===i){const e=n.index,t=n.layerId,i=s?s.props.id:null;if(i!==t||a!==e){if(i!==t){const e=r.find((e=>e.props.id===t));e&&l.unshift(e)}n.layerId=i,n.index=a,n.info=null}}const c=Ed(e),u=new Map;return u.set(null,c),l.forEach((e=>{let t={...c};e===s&&(t.color=o,t.index=a,t.picked=!0),t=Td({layer:e,info:t,mode:i});const r=t.layer;e===s&&"hover"===i&&(n.info=t),u.set(r.id,t),"hover"===i&&r.updateAutoHighlight(t)})),u}function Td({layer:e,info:t,mode:n}){for(;e&&t;){const i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:n,sourceLayer:i}),e=e.parent}return t}class Ad{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new yd(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:n,viewports:i},r=this.lastPickedInfo.info){const o=r&&r.layer&&r.layer.id,s=r&&r.viewport&&r.viewport.id,a=o?n.find((e=>e.id===o)):null,l=s&&i.find((e=>e.id===s))||i[0],c=l&&l.unproject([e-l.x,t-l.y]),u={x:e,y:t,viewport:l,coordinate:c,layer:a};return{...r,...u}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}const e=this.device.gl;this.pickingFBO?.resize({width:e.canvas.width,height:e.canvas.height}),this.depthFBO?.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(!1===this._pickable)return null;const t=e.filter((e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite));return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:n,x:i,y:r,radius:o=0,depth:s=1,mode:a="query",unproject3D:l,onViewportActive:c,effects:u}){const h=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||0===n.length)return{result:[],emptyInfo:Ed({viewports:n,x:i,y:r,pixelRatio:h})};this._resizeBuffer();const p=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(o*h),{width:g,height:_}=this.pickingFBO,y=this._getPickingRect({deviceX:f[0],deviceY:f[1],deviceRadius:m,deviceWidth:g,deviceHeight:_}),v={x:i-o,y:r-o,width:2*o+1,height:2*o+1};let b;const x=[],w=new Set;for(let e=0;e<s;e++){let o,p;if(o=y?wd({...this._drawAndSample({layers:d,views:t,viewports:n,onViewportActive:c,deviceRect:y,cullRect:v,effects:u,pass:`picking:${a}`}),deviceX:f[0],deviceY:f[1],deviceRadius:m,deviceRect:y}):{pickedColor:null,pickedObjectIndex:-1},o.pickedLayer&&l&&this.depthFBO){const{pickedColors:e}=this._drawAndSample({layers:[o.pickedLayer],views:t,viewports:n,onViewportActive:c,deviceRect:{x:o.pickedX,y:o.pickedY,width:1,height:1},cullRect:v,effects:u,pass:`picking:${a}:z`},!0);e[3]&&(p=e[0])}o.pickedLayer&&e+1<s&&(w.add(o.pickedLayer),o.pickedLayer.disablePickingIndex(o.pickedObjectIndex)),b=Sd({pickInfo:o,lastPickedInfo:this.lastPickedInfo,mode:a,layers:d,viewports:n,x:i,y:r,z:p,pixelRatio:h});for(const e of b.values())e.layer&&x.push(e);if(!o.pickedColor)break}for(const e of w)e.restorePickingColors();return{result:x,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:n,x:i,y:r,width:o=1,height:s=1,mode:a="query",maxObjects:l=null,onViewportActive:c,effects:u}){const h=this._getPickable(e);if(!h||0===n.length)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,r],!0),f=p.x,m=p.y+p.height,g=this.device.canvasContext.cssToDevicePixels([i+o,r+s],!0),_=g.x+g.width,y=g.y,v={x:f,y,width:_-f,height:m-y},b=function({pickedColors:e,decodePickingColor:t}){const n=new Map;if(e)for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){const r=e.slice(i,i+4),o=r.join(",");if(!n.has(o)){const e=t(r);e?n.set(o,{...e,color:r}):rs.error("Picked non-existent layer. Is picking buffer corrupt?")()}}return Array.from(n.values())}(this._drawAndSample({layers:h,views:t,viewports:n,onViewportActive:c,deviceRect:v,cullRect:{x:i,y:r,width:o,height:s},effects:u,pass:`picking:${a}`})),x=new Map,w=[],E=Number.isFinite(l);for(let e=0;e<b.length&&!(E&&w.length>=l);e++){const t=b[e];let n={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:r,pixelRatio:d};n=Td({layer:t.pickedLayer,info:n,mode:a});const o=n.layer.id;x.has(o)||x.set(o,new Set);const s=x.get(o),l=n.object??n.index;s.has(l)||(s.add(l),w.push(n))}return w}_drawAndSample({layers:e,views:t,viewports:n,onViewportActive:i,deviceRect:r,cullRect:o,effects:s,pass:a},l=!1){const c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:n,onViewportActive:i,pickingFBO:c,deviceRect:r,cullRect:o,effects:s,pass:a,pickZ:l,preRenderStats:{}};for(const e of s)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));const{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:p,width:f,height:m}=r,g=new(l?Float32Array:Uint8Array)(f*m*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:p,sourceWidth:f,sourceHeight:m,target:g}),{pickedColors:g,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:n,deviceWidth:i,deviceHeight:r}){const o=Math.max(0,e-n),s=Math.max(0,t-n),a=Math.min(i,e+n+1)-o,l=Math.min(r,t+n+1)-s;return a<=0||l<=0?null:{x:o,y:s,width:a,height:l}}}const Cd={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Pd="top-left",Id="__root";class Md{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Do(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find((t=>t.id===e.id))||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const e of this.resolvedWidgets)t[e.id]=e;this.resolvedWidgets.length=0;for(const e of this.defaultWidgets)t[e.id]=null,this.resolvedWidgets.push(e);for(let n of e){const e=t[n.id];e?e.viewId!==n.viewId||e.placement!==n.placement?(this._remove(e),this._add(n)):n!==e&&(e.setProps(n.props),n=e):this._add(n),t[n.id]=null,this.resolvedWidgets.push(n)}for(const e in t){const n=t[e];n&&this._remove(n)}this.widgets=e}_add(e){const{viewId:t=null,placement:n=Pd}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,n).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const n=e||Id;let i=this.containers[n];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[n]=i);let r=i.querySelector(`.${t}`);return r||(r=document.createElement("div"),r.className=t,r.style.position="absolute",r.style.zIndex="2",Object.assign(r.style,Cd[t]),i.append(r)),r}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const n in this.containers){const i=this.lastViewports[n]||null,r=n===Id||i,o=this.containers[n];r?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:t}px`):o.style.display="none"}}onRedraw({viewports:e,layers:t}){const n=e.reduce(((e,t)=>(e[t.id]=t,e)),{}),{lastViewports:i}=this;for(const r of this.getWidgets()){const{viewId:o}=r;if(o){const e=n[o];e&&(r.onViewportChange&&!e.equals(i[o])&&r.onViewportChange(e),r.onRedraw?.({viewports:[e],layers:t}))}else{if(r.onViewportChange)for(const t of e)t.equals(i[t.id])||r.onViewportChange(t);r.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=n,this._updateContainers()}onHover(e,t){for(const n of this.getWidgets()){const{viewId:i}=n;i&&i!==e.viewport?.id||n.onHover?.(e,t)}}onEvent(e,t){const n=Oa[t.type];if(n)for(const i of this.getWidgets()){const{viewId:r}=i;r&&r!==e.viewport?.id||i[n.handler]?.(e,t)}}}const Rd={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Od{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Rd),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,n=t&&t.props.getTooltip;if(!n)return;const i=n(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,n){const i=this.element;if(i){if("string"==typeof e)i.innerText=e;else{if(!e)return this.isVisible=!1,void(i.style.display="none");e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className)}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${n}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}function kd(e,t){if(!e)throw new Error(t||"loader assertion failed.")}"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,"undefined"!=typeof global&&global,"undefined"!=typeof document&&document;const Ld=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Dd="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version),Fd=(Dd&&parseFloat(Dd[1]),globalThis.loaders?.parseImageNode),Nd="undefined"!=typeof Image,Bd="undefined"!=typeof ImageBitmap,zd=Boolean(Fd),jd=!!Ld||zd;function Ud(e){const t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw new Error("Not an image");return t}const Vd=/^data:image\/svg\+xml/,Gd=/\.svg((\?|#).*)?$/;function $d(e){return e&&(Vd.test(e)||Gd.test(e))}function Wd(e,t){if($d(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Hd(e,t,n){const i=function(e,t){if($d(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return Wd(e,t)}(e,n),r=self.URL||self.webkitURL,o="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise(((e,t)=>{try{n.onload=()=>e(n),n.onerror=e=>{const n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(e){t(e)}}))}(o||i,t)}finally{o&&r.revokeObjectURL(o)}}const qd={};let Xd=!0;const Zd=!1,Yd=!0;function Kd(e){const t=Jd(e);return function(e){const t=Jd(e);return t.byteLength>=24&&2303741511===t.getUint32(0,Zd)?{mimeType:"image/png",width:t.getUint32(16,Zd),height:t.getUint32(20,Zd)}:null}(t)||function(e){const t=Jd(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,Zd)&&255===t.getUint8(2)))return null;const{tableMarkers:n,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,Zd);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,Zd),width:t.getUint16(r+7,Zd)};if(!n.has(e))return null;r+=2,r+=t.getUint16(r,Zd)}return null}(t)||function(e){const t=Jd(e);return t.byteLength>=10&&1195984440===t.getUint32(0,Zd)?{mimeType:"image/gif",width:t.getUint16(6,Yd),height:t.getUint16(8,Yd)}:null}(t)||function(e){const t=Jd(e);return t.byteLength>=14&&16973===t.getUint16(0,Zd)&&t.getUint32(2,Yd)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Yd),height:t.getUint32(22,Yd)}:null}(t)||function(e){const t=function(e){return function(e,t,n=0){const i=(r="ftyp",[...r].map((e=>e.charCodeAt(0))));var r;for(let t=0;t<i.length;++t)if(i[t]!==e[t+n])return!1;return!0}(e,0,4)&&96&e[8]?function(e){switch((t=e,String.fromCharCode(...t.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t}(e):null}(new Uint8Array(e instanceof DataView?e.buffer:e));return t?{mimeType:t.mimeType,width:0,height:0}:null}(t)}function Jd(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Qd={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.2.1",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,n){const i=((t=t||{}).image||{}).type||"auto",{url:r}=n||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(Bd)return"imagebitmap";if(Nd)return"image";if(jd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Bd||Nd||jd;case"imagebitmap":return Bd;case"image":return Nd;case"data":return jd;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":o=await async function(e,t,n){let i;i=$d(n)?await Hd(e,t,n):Wd(e,n);const r=t&&t.imagebitmap;return await async function(e,t=null){if(!function(e){for(const t in e||qd)return!1;return!0}(t)&&Xd||(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Xd=!1}return await createImageBitmap(e)}(i,r)}(e,t,r);break;case"image":o=await Hd(e,t,r);break;case"data":o=await async function(e,t){const{mimeType:n}=Kd(e)||{},i=globalThis.loaders?.parseImageNode;return kd(i),await i(e,n)}(e);break;default:kd(!1)}return"data"===i&&(o=function(e){switch(Ud(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(Kd(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},ep={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){const t=e[0],n=e[e.length-1];return"{"===t&&"}"===n||"["===t&&"]"===n},parseTextSync:JSON.parse},tp=function(){const e="9.0.17",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(rs.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:rs,_registerLoggers:Nc},function(e){const t=oh();e=Array.isArray(e)?e:[e];for(const n of e){const e=nu(n);t.find((t=>e===t))||t.unshift(e)}}([ep,[Qd,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}(),np=new es({id:"luma.gl"}),ip=new class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new $c({id:e})),this.stats.get(e)}},rp=function(){const e="9.0.14";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(zo()&&np.log(1,`${e} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:np,stats:ip}),e}(),op={};function sp(e="id"){return op[e]=op[e]||1,`${e}-${op[e]++}`}function ap(e){let t=!0;for(const n in e){t=!1;break}return t}class lp{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,n){if(!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const t in e)void 0!==e[t]&&(n[t]=e[t]);return n}(t,n);const i="undefined"!==this.props.id?this.props.id:sp(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}class cp extends lp{static defaultProps={...lp.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const n={...t};(t.usage||0)&cp.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),super(e,n,cp.defaultProps),this.usage=t.usage||0,this.indexType=n.indexType,this.updateTimestamp=e.incrementTimestamp()}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,r=Math.min(e?e.byteLength:n,cp.DEBUG_DATA_MAX_LENGTH);null===e?this.debugData=new ArrayBuffer(r):0===t&&n===e.byteLength?this.debugData=i.slice(0,r):this.debugData=i.slice(t,t+r)}}function up(e){const t=function(e){return dp[e]}(hp[e]),n=e.includes("norm"),i=!n&&!e.startsWith("float"),r=e.startsWith("s");return{dataType:hp[e],byteLength:t,integer:i,signed:r,normalized:n}}const hp={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},dp={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},pp=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],fp=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function mp(e){const t=fp.exec(e);if(t){const[,e,n,i,r,o]=t;if(e){const t=up(`${i}${n}`);return{format:e,components:e.length,srgb:"-srgb"===r,unsized:"-unsized"===o,webgl:"-webgl"===o,...t}}}return function(e){const t=gp[e];if(!t)throw new Error(`Unknown format ${e}`);return{format:t.format||"",components:t.components||t.format?.length||1,byteLength:t.bpp||1,srgb:!1,unsized:!1}}(e)}const gp={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};class _p{}class yp{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}class vp{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:Boolean(np.get("debug")),spector:Boolean(np.get("spector")||np.get("spectorjs")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>np.error(e.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=rp;constructor(e){this.props={...vp.defaultProps,...e},this.id=this.props.id||sp(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=ip;_lumaData={};isTextureFormatCompressed(e){return t=e,pp.some((e=>t.startsWith(e)));var t}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||"string"==typeof e)&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&cp.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":np.warn("indices buffer content must be of integer type")()),t}}function bp(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}const xp=new Map;class wp{static defaultProps={...vp.defaultProps,type:"best-available",devices:void 0};static stats=ip;static log=np;static registerDevices(e){for(const t of e)bp(t.type&&t.isSupported&&t.create),xp.set(t.type,t)}static getAvailableDevices(){return Array.from(xp).map((e=>e.type))}static getSupportedDevices(){return Array.from(xp).filter((e=>e.isSupported())).map((e=>e.type))}static setDefaultDeviceProps(e){Object.assign(vp.defaultProps,e)}static async attachDevice(e){const t=Ep(e.devices)||xp;if(e.handle instanceof WebGL2RenderingContext){const n=t.get("webgl");if(n)return await n.attach(e.handle)}if(null===e.handle){const e=t.get("unknown");if(e)return await e.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){(e={...wp.defaultProps,...e}).gl&&(e.type="webgl");const t=Ep(e.devices)||xp;switch(e.type){case"webgpu":let n=t.get("webgpu");if(n)return await n.create(e);break;case"webgl":let i=t.get("webgl");if(i)return await i.create(e);break;case"unknown":const r=t.get("unknown");if(r)return await r.create(e);break;case"best-available":if(n=t.get("webgpu"),n?.isSupported?.())return await n.create(e);if(i=t.get("webgl"),i?.isSupported?.())return await i.create(e)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static enforceWebGL2(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext)return t.getContext=t.originalGetContext,void(t.originalGetContext=void 0);t.originalGetContext=t.getContext,t.getContext=function(e,t){return"webgl"===e||"experimental-webgl"===e?this.originalGetContext("webgl2",t):this.originalGetContext(e,t)}}}function Ep(e){if(!e||0===e?.length)return null;const t=new Map;for(const n of e)t.set(n.type,n);return t}const Sp=zo()&&"undefined"!=typeof document,Tp=()=>Sp&&"complete"===document.readyState,Ap={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class Cp{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return Tp()}static pageLoaded=function(){return Tp()||"undefined"==typeof window?Promise.resolve():new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();constructor(e){if(this.props={...Ap,...e},e=this.props,!zo())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!t&&!Tp())throw new Error(`Accessing '${e}' before page was loaded`);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{const t=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(n)?`${n}px`:"100%",i}(e),n=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t&&!Tp())throw new Error(`Accessing '${e}' before page was loaded`);if(!t)throw new Error(`${e} is not an HTML element`);return t}return e||document.body}(e?.container||null);n.insertBefore(t,n.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return"undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas||!(e=void 0===e?this.props.useDevicePixels:e)||e<=0?1:!0===e?"undefined"!=typeof window&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const o=e,s=Pp(o[0],t,n);let a=Ip(o[1],t,i,r),l=Pp(o[0]+1,t,n);const c=l===n-1?l:l-1;let u;return l=Ip(o[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1,{x:s,y:a,width:Math.max(c-s+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;n&&i||(np.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==i||r.devicePixelRatio!==e){let t=e;const r=Math.floor(n*t),o=Math.floor(i*t);this.htmlCanvas.width=r,this.htmlCanvas.height=o;const[s,a]=this.getDrawingBufferSize();s===r&&a===o||(t=Math.min(s/n,a/i),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(i*t),np.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){"lumagl-auto-created-canvas"===this.htmlCanvas?.id&&(this.htmlCanvas.id=e)}}function Pp(e,t,n){return Math.min(Math.round(e*t),n-1)}function Ip(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}const Mp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Rp=(e,t,n)=>t?e.enable(n):e.disable(n),Op=(e,t,n)=>e.hint(n,t),kp=(e,t,n)=>e.pixelStorei(n,t),Lp=(e,t,n)=>{const i=36006===n?36009:36008;return e.bindFramebuffer(i,t)},Dp=(e,t,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];e.bindBuffer(i,t)};function Fp(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const Np={3042:Rp,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Rp,2885:(e,t)=>e.cullFace(t),2929:Rp,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Rp,35723:Op,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:Lp,36010:Lp,34964:Dp,36662:Dp,36663:Dp,35053:Dp,35055:Dp,2886:(e,t)=>e.frontFace(t),33170:Op,2849:(e,t)=>e.lineWidth(t),32823:Rp,32824:"polygonOffset",10752:"polygonOffset",35977:Rp,32926:Rp,32928:Rp,32938:"sampleCoverage",32939:"sampleCoverage",3089:Rp,3088:(e,t)=>e.scissor(...t),2960:Rp,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:Rp,10754:Rp,12288:Rp,12289:Rp,12290:Rp,12291:Rp,12292:Rp,12293:Rp,12294:Rp,12295:Rp,3333:kp,3317:kp,37440:kp,37441:kp,37443:kp,3330:kp,3332:kp,3331:kp,3314:kp,32878:kp,3316:kp,3315:kp,32877:kp,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,n)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===t?.length?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Fp(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(1028,n),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{t=Fp(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilFuncSeparate(1028,n,i,r),e.stencilFuncSeparate(1029,o,s,a)},stencilOp:(e,t)=>{t=Fp(t)&&3===t.length?[...t,...t]:t;const[n,i,r,o,s,a]=t;e.stencilOpSeparate(1028,n,i,r),e.stencilOpSeparate(1029,o,s,a)},viewport:(e,t)=>e.viewport(...t)};function Bp(e,t,n){return void 0!==t[e]?t[e]:n[e]}const zp={blendEquation:(e,t,n)=>e.blendEquationSeparate(Bp(32777,t,n),Bp(34877,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(Bp(32969,t,n),Bp(32968,t,n),Bp(32971,t,n),Bp(32970,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(Bp(32824,t,n),Bp(10752,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(Bp(32938,t,n),Bp(32939,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(1028,Bp(2962,t,n),Bp(2967,t,n),Bp(2963,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(1029,Bp(34816,t,n),Bp(36003,t,n),Bp(36004,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(1028,Bp(2964,t,n),Bp(2965,t,n),Bp(2966,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(1029,Bp(34817,t,n),Bp(34818,t,n),Bp(34819,t,n))},jp={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,n)=>e({36007:n}),bindTransformFeedback:(e,t,n)=>e({36389:n}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,n)=>{switch(t){case 36160:return e({36006:n,36010:n});case 36009:return e({36006:n});case 36008:return e({36010:n});default:return null}},bindBuffer:(e,t,n)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({32773:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,n)=>e({32777:t,34877:n}),blendFunc:(e,t,n)=>e({32969:t,32968:n,32971:t,32970:n}),blendFuncSeparate:(e,t,n,i,r)=>e({32969:t,32968:n,32971:i,32970:r}),clearColor:(e,t,n,i,r)=>e({3106:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,n,i,r)=>e({3107:[t,n,i,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,n)=>e({2928:new Float32Array([t,n])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,n)=>e({32824:t,10752:n}),sampleCoverage:(e,t,n)=>e({32938:t,32939:n}),scissor:(e,t,n,i,r)=>e({3088:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,n)=>e({[1028===t?2968:36005]:n}),stencilFunc:(e,t,n,i)=>e({2962:t,2967:n,2963:i,34816:t,36003:n,36004:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[1028===t?2962:34816]:n,[1028===t?2967:36003]:i,[1028===t?2963:36004]:r}),stencilOp:(e,t,n,i)=>e({2964:t,2965:n,2966:i,34817:t,34818:n,34819:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[1028===t?2964:34817]:n,[1028===t?2965:34818]:i,[1028===t?2966:34819]:r}),viewport:(e,t,n,i,r)=>e({2978:[t,n,i,r]})},Up=(e,t)=>e.isEnabled(t),Vp={3042:Up,2884:Up,2929:Up,3024:Up,32823:Up,32926:Up,32928:Up,3089:Up,2960:Up,35977:Up},Gp=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function $p(e,t){if(function(e){for(const t in e)return!1;return!0}(t))return;const n={};for(const i in t){const r=Number(i),o=Np[i];o&&("string"==typeof o?n[o]=!0:o(e,t[i],r))}const i=e.state&&e.state.cache;if(i)for(const r in n)(0,zp[r])(e,t,i)}function Wp(e,t=Mp){if("number"==typeof t){const n=t,i=Vp[n];return i?i(e,n):e.getParameter(n)}const n=Array.isArray(t)?t:Object.keys(t),i={};for(const t of n){const n=Vp[t];i[t]=n?n(e,Number(t)):e.getParameter(Number(t))}return i}function Hp(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class qp{gl;program=null;stateStack=[];enable=!0;cache;log;constructor(e,{copyState:t=!1,log:n=(()=>{})}={}){this.gl=e,this.cache=t?Wp(e):Object.assign({},Mp),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){bp(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];$p(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){bp(void 0!==r);const o=e[r],s=this.cache[r];Hp(o,s)||(n=!0,t=s,i&&!(r in i)&&(i[r]=s),this.cache[r]=o)}return{valueChanged:n,oldValue:t}}}function Xp(e){return e.state}function Zp(e,t){const{enable:n=!0,copyState:i}=t;if(bp(void 0!==i),!e.state){e.state=new qp(e,{copyState:i}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=Xp(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const t in jp)Qp(e,t,jp[t]);Jp(e,"getParameter"),Jp(e,"isEnabled")}return Xp(e).enable=n,e}function Yp(e){let t=Xp(e);t||(Zp(e,{copyState:!1}),t=Xp(e)),t.push()}function Kp(e){const t=Xp(e);bp(t),t.pop()}function Jp(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||Gp.has(t))return n(t);const i=Xp(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Qp(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(...t){const r=Xp(e),{valueChanged:o,oldValue:s}=n(r._updateCache,...t);return o&&i(...t),s},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}const ef={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function tf(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function nf(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function rf(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const of="texture-compression-bc",sf="texture-compression-astc",af="texture-compression-etc2",lf="texture-compression-pvrtc-webgl",cf="texture-compression-atc-webgl",uf="float32-renderable-webgl",hf="float16-renderable-webgl",df="snorm8-renderable-webgl",pf="norm16-renderable-webgl",ff="snorm16-renderable-webgl",mf="float32-filterable",gf="float16-filterable-webgl",_f="WEBGL_compressed_texture_s3tc",yf="WEBGL_compressed_texture_s3tc_srgb",vf="EXT_texture_compression_rgtc",bf="EXT_texture_compression_bptc",xf="EXT_texture_norm16",wf="EXT_render_snorm",Ef={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[wf],"norm16-renderable-webgl":[xf],"snorm16-renderable-webgl":[xf,wf],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[_f,yf,vf,bf],"texture-compression-bc5-webgl":[vf],"texture-compression-bc7-webgl":[bf],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};const Sf={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:df},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:df},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:hf,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:pf,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:ff},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:df},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:hf,filter:gf,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:pf},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:ff},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:uf,filter:mf},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:"rgb9e5ufloat_renderable-webgl"},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:uf,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:pf},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:pf},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:uf,filter:mf,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:hf,filter:gf},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:pf,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:ff},"rgb32float-webgl":{gl:34837,render:uf,filter:mf,gl2ext:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:uf,filter:mf,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:_f,f:of},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:yf,f:of},"bc1-rgba-unorm":{gl:33777,x:_f,f:of},"bc1-rgba-unorm-srgb":{gl:35916,x:yf,f:of},"bc2-rgba-unorm":{gl:33778,x:_f,f:of},"bc2-rgba-unorm-srgb":{gl:35918,x:yf,f:of},"bc3-rgba-unorm":{gl:33779,x:_f,f:of},"bc3-rgba-unorm-srgb":{gl:35919,x:yf,f:of},"bc4-r-unorm":{gl:36283,x:vf,f:of},"bc4-r-snorm":{gl:36284,x:vf,f:of},"bc5-rg-unorm":{gl:36285,x:vf,f:of},"bc5-rg-snorm":{gl:36286,x:vf,f:of},"bc6h-rgb-ufloat":{gl:36495,x:bf,f:of},"bc6h-rgb-float":{gl:36494,x:bf,f:of},"bc7-rgba-unorm":{gl:36492,x:bf,f:of},"bc7-rgba-unorm-srgb":{gl:36493,x:bf,f:of},"etc2-rgb8unorm":{gl:37492,f:af},"etc2-rgb8unorm-srgb":{gl:37494,f:af},"etc2-rgb8a1unorm":{gl:37496,f:af},"etc2-rgb8a1unorm-srgb":{gl:37497,f:af},"etc2-rgba8unorm":{gl:37493,f:af},"etc2-rgba8unorm-srgb":{gl:37495,f:af},"eac-r11unorm":{gl:37488,f:af},"eac-r11snorm":{gl:37489,f:af},"eac-rg11unorm":{gl:37490,f:af},"eac-rg11snorm":{gl:37491,f:af},"astc-4x4-unorm":{gl:37808,f:sf},"astc-4x4-unorm-srgb":{gl:37840,f:sf},"astc-5x4-unorm":{gl:37809,f:sf},"astc-5x4-unorm-srgb":{gl:37841,f:sf},"astc-5x5-unorm":{gl:37810,f:sf},"astc-5x5-unorm-srgb":{gl:37842,f:sf},"astc-6x5-unorm":{gl:37811,f:sf},"astc-6x5-unorm-srgb":{gl:37843,f:sf},"astc-6x6-unorm":{gl:37812,f:sf},"astc-6x6-unorm-srgb":{gl:37844,f:sf},"astc-8x5-unorm":{gl:37813,f:sf},"astc-8x5-unorm-srgb":{gl:37845,f:sf},"astc-8x6-unorm":{gl:37814,f:sf},"astc-8x6-unorm-srgb":{gl:37846,f:sf},"astc-8x8-unorm":{gl:37815,f:sf},"astc-8x8-unorm-srgb":{gl:37847,f:sf},"astc-10x5-unorm":{gl:37819,f:sf},"astc-10x5-unorm-srgb":{gl:37851,f:sf},"astc-10x6-unorm":{gl:37817,f:sf},"astc-10x6-unorm-srgb":{gl:37849,f:sf},"astc-10x8-unorm":{gl:37818,f:sf},"astc-10x8-unorm-srgb":{gl:37850,f:sf},"astc-10x10-unorm":{gl:37819,f:sf},"astc-10x10-unorm-srgb":{gl:37851,f:sf},"astc-12x10-unorm":{gl:37820,f:sf},"astc-12x10-unorm-srgb":{gl:37852,f:sf},"astc-12x12-unorm":{gl:37821,f:sf},"astc-12x12-unorm-srgb":{gl:37853,f:sf},"pvrtc-rgb4unorm-webgl":{gl:35840,f:lf},"pvrtc-rgba4unorm-webgl":{gl:35842,f:lf},"pvrtc-rbg2unorm-webgl":{gl:35841,f:lf},"pvrtc-rgba2unorm-webgl":{gl:35843,f:lf},"etc1-rbg-unorm-webgl":{gl:36196,f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{gl:35986,f:cf},"atc-rgba-unorm-webgl":{gl:35986,f:cf},"atc-rgbai-unorm-webgl":{gl:34798,f:cf}},Tf={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},Af={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Cf(e,t,n){const i=Sf[t];if(!i)return!1;if(void 0===i.gl)return!1;const r=i.x||i.gl2ext;return!r||Boolean(tf(e,r,n))}function Pf(e){const t=Sf[e],n=t?.gl;if(void 0===n)throw new Error(`Unsupported texture format ${e}`);return n}function If(e){const t=Sf[e],n=Pf(e),i=mp(e);return{format:n,dataFormat:t?.dataFormat||Rf(i.format,i.integer,i.normalized,n),type:i.dataType?rf(i.dataType):t?.types?.[0]||5121,compressed:i.compressed}}function Mf(e){const t=If(e);return(Tf[t.dataFormat]||4)*(Af[t.type]||1)}function Rf(e,t,n,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!n?36244:6403;case"rg":return t&&!n?33320:33319;case"rgb":return t&&!n?36248:6407;case"rgba":return t&&!n?36249:6408;default:return 6408}}const Of={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class kf extends yp{gl;extensions;testedFeatures=new Set;constructor(e,t,n){super([],n),this.gl=e,this.extensions=t,tf(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return!this.disabledFeatures[e]&&(this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in Ef}(e)&&function(e,t,n){return(Ef[t]||[]).every((t=>tf(e,t,n)))}(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter((e=>"polygon-mode-webgl"!==e));for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(Of),...Object.keys(Ef)]}getWebGLFeature(e){const t=Of[e];return"string"==typeof t?Boolean(tf(this.gl,t,this.extensions)):Boolean(t)}}class Lf extends _p{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}class Df extends lp{static defaultProps={...lp.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(e,t,n=Df.defaultProps){super(e,t,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=e.incrementTimestamp()}}class Ff extends lp{static defaultProps={...lp.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(e,t={}){super(e,t,Ff.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(np.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e=>{if("string"==typeof e){const t=this.createColorTexture(e);return this.attachResource(t),t.view}return e instanceof Df?e.view:e}));const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Df?e.view:e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Df.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Df.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.device._createTexture({...this.colorAttachments[n].props,width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}}async function Nf(e,t){return await new Promise(((n,i)=>{try{const r=new Image;r.onload=()=>n(r),r.onerror=()=>i(new Error(`Could not load image ${e}.`)),r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:""+e}catch(e){i(e)}}))}async function Bf(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise(((t,r)=>{i.onload=t,i.onerror=t=>r(new Error(`Unable to load script '${e}': ${t}`)),n.appendChild(i)}))}function zf(e,t,n){if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t;let r;if(Yp(e),$p(e,t),i)r=n(e),Kp(e);else try{r=n(e)}finally{Kp(e)}return r}function jf(e,t){return $f(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Uf(e,t){return $f(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Vf(e,t){return $f(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Gf(e,t){return $f(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function $f(e,t,n){if(!(t in n))throw new Error(function(e,t){return`Illegal parameter ${t} for ${e}`}(e,t));return n[t]}function Wf(e){const t={};return e.addressModeU&&(t[10242]=Hf(e.addressModeU)),e.addressModeV&&(t[10243]=Hf(e.addressModeV)),e.addressModeW&&(t[32882]=Hf(e.addressModeW)),e.magFilter&&(t[10240]=qf(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t){if(!t)return qf(e);switch(e){case"nearest":return"nearest"===t?9984:9986;case"linear":return"nearest"===t?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=jf("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Hf(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function qf(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class Xf extends cp{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;var i;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=(i=this.props.usage)&cp.INDEX?34963:i&cp.VERTEX?34962:i&cp.UNIFORM?35345:34962,this.glUsage=function(e){return e&cp.INDEX||e&cp.VERTEX?35044:e&cp.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,n=e.byteLength+t){const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){bp(e>=0);let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){const n=36663;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const n=new Uint8Array(t);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,n,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(n,e,t),n}}class Zf extends lp{static defaultProps={...lp.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t,Zf.defaultProps)}}class Yf extends Zf{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=Wf(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}class Kf extends lp{static defaultProps={...lp.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Kf.defaultProps)}}class Jf extends Kf{device;gl;handle;texture;constructor(e,t){super(e,{...Df.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const Qf={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class em extends Df{static FACES=[34069,34070,34071,34072,34073,34074];MAX_ATTRIBUTES;device;gl;handle;sampler=void 0;view=void 0;glFormat=void 0;type=void 0;dataFormat=void 0;mipmaps=void 0;target;textureUnit=void 0;loaded=!1;_video;constructor(e,t){super(e,{...Qf,format:"rgba8unorm",...t}),this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=function(e){switch(e.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;default:throw new Error(e.dimension)}}(this.props),this.loaded=!1,"string"==typeof this.props?.data&&Object.assign(this.props,{data:Nf(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(e){return new Jf(this.device,{...e,texture:this})}initialize(e={}){if("cube"===this.props.dimension)return this.initializeCube(e);let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{parameters:i={}}=e,{pixels:r=null,pixelStore:o={},textureUnit:s,mipmaps:a=!0}=e;t||(t=r);let{width:l,height:c,dataFormat:u,type:h,compressed:d=!1}=e;const{depth:p=0}=e,f=Pf(e.format);return({width:l,height:c,compressed:d,dataFormat:u,type:h}=this._deduceParameters({format:e.format,type:h,dataFormat:u,compressed:d,data:t,width:l,height:c})),this.width=l,this.height=c,this.glFormat=f,this.type=h,this.dataFormat=u,this.textureUnit=s,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=a,this.setImageData({data:t,width:l,height:c,depth:p,format:f,type:h,dataFormat:u,parameters:o,compressed:d}),this.setSampler(e.sampler),this._setSamplerParameters(i),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),a&&this.device.isTextureFormatFilterable(e.format)&&this.generateMipmap(),n&&(this._video={video:t,parameters:i,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}initializeCube(e){const{mipmaps:t=!0,parameters:n={}}=e;return this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(n)})),this}setSampler(e={}){let t;e instanceof Yf?(this.sampler=e,t=e.props):(this.sampler=new Yf(this.device,e),t=e);const n=Wf(t);return this._setSamplerParameters(n),this}resize(e){const{height:t,width:n,mipmaps:i=!1}=e;return n!==this.width||t!==this.height?this.initialize({width:n,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),zf(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this}setImageData(e){if("3d"===this.props.dimension||"2d-array"===this.props.dimension)return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,glFormat:r=this.glFormat,offset:o=0,parameters:s={}}=e;let{data:a=null,type:l=this.type,width:c=this.width,height:u=this.height,dataFormat:h=this.dataFormat,compressed:d=!1}=e;a||(a=n),({type:l,dataFormat:h,compressed:d,width:c,height:u}=this._deduceParameters({format:this.props.format,type:l,dataFormat:h,compressed:d,data:a,width:c,height:u}));const{gl:p}=this;p.bindTexture(this.target,this.handle);let f=null;if(({data:a,dataType:f}=this._getDataType({data:a,compressed:d})),zf(this.gl,s,(()=>{switch(f){case"null":case"browser-object":p.texImage2D(t,i,r,c,u,0,h,l,a);break;case"typed-array":p.texImage2D(t,i,r,c,u,0,h,l,a,o);break;case"buffer":this.device.gl.bindBuffer(35052,a.handle||a),this.device.gl.texImage2D(t,i,r,c,u,0,h,l,o),this.device.gl.bindBuffer(35052,null);break;case"compressed":for(const[e,n]of a.entries())p.compressedTexImage2D(t,e,n.format,n.width,n.height,0,n.data);break;default:bp(!1,"Unknown image data type")}})),a&&a.byteLength)this.trackAllocatedMemory(a.byteLength,"Texture");else{const e=Mf(this.props.format);this.trackAllocatedMemory(this.width*this.height*e,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:n=null,x:i=0,y:r=0,width:o=this.width,height:s=this.height,level:a=0,glFormat:l=this.glFormat,type:c=this.type,dataFormat:u=this.dataFormat,compressed:h=!1,offset:d=0,parameters:p={}}){if(({type:c,dataFormat:u,compressed:h,width:o,height:s}=this._deduceParameters({format:this.props.format,type:c,dataFormat:u,compressed:h,data:n,width:o,height:s})),bp(1===this.depth,"texSubImage not supported for 3D textures"),n||(n=t),n&&n.data){const e=n;n=e.data,o=e.shape[0],s=e.shape[1]}n instanceof Xf&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),zf(this.gl,p,(()=>{h?this.gl.compressedTexSubImage2D(e,a,i,r,o,s,l,n):null===n?this.gl.texSubImage2D(e,a,i,r,o,s,u,c,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(e,a,i,r,o,s,u,c,n,d):"undefined"!=typeof WebGLBuffer&&n instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,n),this.device.gl.texSubImage2D(e,a,i,r,o,s,u,c,d),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(e,a,i,r,o,s,u,c,n)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return np.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof Xf?{data:e.handle,dataType:"buffer"}:"undefined"!=typeof WebGLBuffer&&e instanceof WebGLBuffer?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:i,height:r,dataFormat:o,type:s,compressed:a}=e;const l=If(t);return o=o||l.dataFormat,s=s||l.type,a=a||l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:o,type:s,compressed:a,width:i,height:r,format:t,data:n}}_deduceImageSize(e,t,n){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},bp(i,"Could not deduced texture size"),bp(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),bp(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(e){const{gl:t}=this,{width:n,height:i,pixels:r,data:o,format:s=6408,type:a=5121}=e,l=r||o,c=await Promise.all(em.FACES.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),em.FACES.forEach(((e,r)=>{c[r].length>1&&!1!==this.props.mipmaps&&np.warn(`${this.id} has mipmap and multiple LODs.`)(),c[r].forEach(((r,o)=>{n&&i?t.texImage2D(e,o,s,n,i,0,s,a,r):t.texImage2D(e,o,s,s,a,r)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:o,format:s=6408,type:a=5121}=e,{gl:l}=this,c=r||o;return this.bind(),c instanceof Promise?c.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?l.texImage2D(t,0,s,n,i,0,s,a,c):l.texImage2D(t,0,s,s,a,c),this}setImageData3D(e){const{level:t=0,dataFormat:n,format:i,type:r,width:o,height:s,depth:a=1,offset:l=0,data:c,parameters:u={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const h=If(i);if(zf(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,t,h.format,o,s,a,0,h.dataFormat,h.type,c),c instanceof Xf&&(this.gl.bindBuffer(35052,c.handle),this.gl.texImage3D(this.target,t,n,o,s,a,0,i,r,l))})),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const e=Mf(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*e,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!ap(e)){!function(e){np.log(1,"texture sampler parameters",e)()}(e),this.gl.bindTexture(this.target,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case 33082:case 33083:this.gl.texParameterf(this.target,e,i);break;default:this.gl.texParameteri(this.target,e,i)}}this.gl.bindTexture(this.target,null)}}}class tm extends Ff{device;gl;handle;get texture(){return this.colorAttachments[0]}constructor(e,t){super(e,t);const n=null===t.handle;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const n=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const t=this.colorAttachments[e],n=36064+e;t&&this._attachOne(n,t)}if(this.depthStencilAttachment&&this._attachOne(function(e){const t=Sf[e];if(!t?.attachment)throw new Error(`${e} is not a depth stencil format`);return t.attachment}(this.depthStencilAttachment.props.format),this.depthStencilAttachment),!1!==t.check){const e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw new Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,n)}}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new em(this.device,{id:`${this.id}-depth-stencil`,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){if(null===this.handle)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:e,height:t});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:t}),this}_attachOne(e,t){if(Array.isArray(t)){const[n,i=0,r=0]=t;return this._attachTexture(e,n,i,r),n}if(t instanceof em)return this._attachTexture(e,t,0,0),t;if(t instanceof Jf){const n=t;return this._attachTexture(e,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),t.texture}throw new Error("attach")}_attachTexture(e,t,n,i){const{gl:r}=this.device;switch(r.bindTexture(t.target,t.handle),t.target){case 35866:case 32879:r.framebufferTextureLayer(36160,e,t.target,i,n);break;case 34067:const o=function(e){return e<34069?e+34069:e}(n);r.framebufferTexture2D(36160,e,o,t.handle,i);break;case 3553:r.framebufferTexture2D(36160,e,3553,t.handle,i);break;default:bp(!1,"Illegal texture type")}r.bindTexture(t.target,null)}}class nm extends Cp{device;presentationSize;_framebuffer=null;constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new tm(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e)}}commit(){}}const im={spector:np.get("spector")||np.get("spectorjs")};let rm=null,om=!1;var sm;function am(e){return e.luma=e.luma||{},e.luma}function lm(e,t={}){return e?t.debug?function(e,t){if(!globalThis.WebGLDebugUtils)return np.warn("webgl-debug not loaded")(),e;const n=am(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...sm,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,um.bind(null,t),hm.bind(null,t));for(const e in sm)e in i||"number"!=typeof sm[e]||(i[e]=sm[e]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const o=Object.create(r);return n.realContext=e,n.debugContext=o,o.debug=!0,o}(e,t):function(e){const t=am(e);return t.realContext?t.realContext:e}(e):null}function cm(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${e}(${n})`}function um(e,t,n,i){i=Array.from(i).map((e=>void 0===e?"undefined":e));const r=`${globalThis.WebGLDebugUtils.glEnumToString(t)} in gl.${n}(${globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)})`;if(np.error(r)(),e.throwOnError)throw new Error(r)}function hm(e,t,n){let i="";np.level>=1&&(i=cm(t,n),np.log(1,i)()),e.break&&e.break.length>0&&(i=i||cm(t,n),e.break.every((e=>-1!==i.indexOf(e))));for(const r of n)if(void 0===r){if(i=i||cm(t,n),e.throwOnError)throw new Error(`Undefined argument: ${i}`);np.error(`Undefined argument: ${i}`)()}}function dm(e,t,n,i){if(i?.inlineSource){const i=function(e,t,n){let i="";for(let n=t-2;n<=t;n++){const r=e[n-1];void 0!==r&&(i+=pm(r,t,undefined))}return i}(t,n);return`\n${i}${e.linePos>0?`${" ".repeat(e.linePos+5)}^^^\n`:""}${e.type.toUpperCase()}: ${e.message}\n\n`}return i?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function pm(e,t,n){const i=n?.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e,t){let n="";for(let t=e.length;t<4;++t)n+=" ";return n+e}(String(t))}: ${i}${n?.html?"<br/>":"\n"}`}function fm(e,t){return{name:mm(e,t),language:"glsl",version:gm(e)}}function mm(e,t="unnamed"){const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function gm(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(sm||(sm={}));class _m extends lp{static defaultProps={...lp.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){super(e,{id:ym(t),...t},_m.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e=this.props.debug){switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===this.props.debug&&0===t?.length||this._displayShaderLog(t)}_displayShaderLog(e){if("undefined"==typeof document||!document?.createElement)return;const t=fm(this.source).name,n=`${this.stage} ${t}`;let i=function(e,t,n){let i="";const r=t.split(/\r?\n/),o=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch(n?.showSourceCode||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=pm(r[e-1],e,n);o.length>t&&o[t].lineNum===e;){const e=o[t++];i+=dm(e,r,e.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const t of e)i+=dm(t,r,t.lineNum,{inlineSource:"no"!==n?.showSourceCode});return i}}(e,this.source,{showSourceCode:"all",html:!0});const r=this.getTranslatedSource();r&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${r}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`\n<h1>Shader Compilation Error in ${n}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${i}\n</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const s=document.getElementsByClassName("luma-compiler-log-error");s[0]?.scrollIntoView&&s[0].scrollIntoView(),o.onclick=()=>{const e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}}function ym(e){return fm(e.source).name||e.id||sp(`unnamed ${e.stage}-shader`)}function vm(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class bm extends _m{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){return function(e){const t=e.split(/\r?\n/),n=[];for(const e of t){if(e.length<=1)continue;const t=e.split(":");if(2===t.length){const[e,i]=t;n.push({message:i.trim(),type:vm(e),lineNum:0,linePos:0});continue}const[i,r,o,...s]=t;let a=parseInt(o,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:s.join(":").trim(),type:vm(i),lineNum:a,linePos:l})}return n}(this.device.gl.getShaderInfoLog(this.handle))}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return e?.getTranslatedShaderSource(this.handle)}async _compile(e){e=(e=>e.startsWith("#version ")?e:`#version 100\n${e}`)(e);const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),0!==np.level){if(this.device.features.has("compilation-status-async-webgl"))np.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),np.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader();else if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`)}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}class xm extends lp{static defaultProps={...lp.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t,xm.defaultProps)}}const wm=6144,Em=[1,2,4,8];class Sm extends xm{device;glParameters;constructor(e,t){super(e,t),this.device=e,Yp(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){Kp(this.device.gl)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};this.props.framebuffer&&(t.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=Em.map((t=>Boolean(t&e.colorMask)))),this.glParameters=t,$p(this.device.gl,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;t?.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;e?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;!1!==this.props.clearColor&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&zf(this.device.gl,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e=0,t=[0,0,0,0]){zf(this.device.gl,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int32Array:this.device.gl.clearBufferiv(wm,e,t);break;case Uint32Array:this.device.gl.clearBufferuiv(wm,e,t);break;case Float32Array:default:this.device.gl.clearBufferfv(wm,e,t)}}))}}class Tm extends lp{static defaultProps={...lp.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,Tm.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}function Am(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]?e:null:function(e){return!ArrayBuffer.isView(e)||e instanceof DataView?null:e}(e)}function Cm(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const i=e[n];var r;null===Am(r=i)&&"number"!=typeof r&&"boolean"!=typeof r?t.bindings[n]=i:t.uniforms[n]=i})),t}const Pm={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Im={f32:4,f16:2,i32:4,u32:4};function Mm(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),r=n,o=i?parseInt(i):1,s=up(r),a={type:r,components:o,byteLength:s.byteLength*o,integer:s.integer,signed:s.signed,normalized:s.normalized};return t&&(a.webglOnly=!0),a}function Rm(e,t){const n={};for(const i of e.attributes)n[i.name]=Om(e,t,i.name);return n}function Om(e,t,n){const i=function(e,t){const n=e.attributes.find((e=>e.name===t));return n||np.warn(`shader layout attribute "${t}" not present in shader`),n||null}(e,n),r=function(e,t){km(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);return n||(n=function(e,t){for(const n of e){let e=n.byteStride;if("number"!=typeof n.byteStride)for(const t of n.attributes||[])e+=Mm(t.format).byteLength;const i=n.attributes?.find((e=>e.attribute===t));if(i)return{attributeName:i.attribute,bufferName:n.name,stepMode:n.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:e}}return null}(e,t),n||(np.warn(`layout for attribute "${t}" not present in buffer layout`),null))}(t,n);if(!i)return null;const o=function(e){const[t,n]=Pm[e],i="i32"===t||"u32"===t,r="u32"!==t,o=Im[t]*n,s=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:`${n}x${t}`}(t,n);return{dataType:t,components:n,defaultVertexFormat:s,byteLength:o,integer:i,signed:r}}(i.type),s=r?.vertexFormat||o.defaultVertexFormat,a=Mm(s);return{attributeName:r?.attributeName||i.name,bufferName:r?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:s,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:o.integer,stepMode:r?.stepMode||i.stepMode,byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function km(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&np.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Lm(e,t){const{clamped:n=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const Dm={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},Fm={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Nm{offset;stride;type;size;divisor;normalized;integer;buffer;index;static getBytesPerElement(e){return Lm(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return bp(e.size),Lm(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Nm(...[Dm,...e])}constructor(...e){e.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Nm.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Nm.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=function(e,t,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:o={}}=n;for(const n in i)if(n in t){const t=i[n]?`${e}.${i[n]}`:"N/A";np.removed(`${e}.${n}`,t)()}for(const n in r)if(n in t){const t=r[n];np.deprecated(`${e}.${n}`,`${e}.${t}`)()}let s=null;for(const[n,i]of Object.entries(o))n in t&&(np.deprecated(`${e}.${n}`,`${e}.${i}`)(),s=s||Object.assign({},t),s[i]=t[n],delete s[n]);return s||t}("Accessor",e,Fm)).type&&(this.type=e.type,5124!==e.type&&5125!==e.type||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalize&&(this.normalized=e.normalize),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),void 0===this.offset&&delete this.offset,void 0===this.stride&&delete this.stride,void 0===this.type&&delete this.type,void 0===this.size&&delete this.size,void 0===this.divisor&&delete this.divisor,void 0===this.normalized&&delete this.normalized,void 0===this.integer&&delete this.integer,void 0===this.buffer&&delete this.buffer,void 0===this.index&&delete this.index,this}}const Bm=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],zm={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function jm(e){const t=zm[e];if(!t)throw new Error("uniform");const[n,i,,r]=t;return{format:r,components:i,glType:n}}function Um(e){const t=zm[e];if(!t)throw new Error("attribute");const[,n,,i,r]=t;return{attributeType:i,vertexFormat:r,components:n}}const Vm={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Gm(e){const t=Vm[e];if(!t)throw new Error("sampler");const[n,i]=t;return{viewDimension:n,sampleType:i}}function $m(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function Wm(e,t,n,i){const r=e;let o=i;!0===o&&(o=1),!1===o&&(o=0);const s="number"==typeof o?[o]:o;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,s);case 35664:return e.uniform2fv(t,s);case 35665:return e.uniform3fv(t,s);case 35666:return e.uniform4fv(t,s);case 5124:case 35670:return e.uniform1iv(t,s);case 35667:case 35671:return e.uniform2iv(t,s);case 35668:case 35672:return e.uniform3iv(t,s);case 35669:case 35673:return e.uniform4iv(t,s);case 5125:return r.uniform1uiv(t,s,1);case 36294:return r.uniform2uiv(t,s,2);case 36295:return r.uniform3uiv(t,s,3);case 36296:return r.uniform4uiv(t,s,4);case 35674:return e.uniformMatrix2fv(t,!1,s);case 35675:return e.uniformMatrix3fv(t,!1,s);case 35676:return e.uniformMatrix4fv(t,!1,s);case 35685:return r.uniformMatrix2x3fv(t,!1,s);case 35686:return r.uniformMatrix2x4fv(t,!1,s);case 35687:return r.uniformMatrix3x2fv(t,!1,s);case 35688:return r.uniformMatrix3x4fv(t,!1,s);case 35689:return r.uniformMatrix4x2fv(t,!1,s);case 35690:return r.uniformMatrix4x3fv(t,!1,s)}throw new Error("Illegal uniform")}class Hm extends Tm{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=35981}=t;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),np.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=function(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s}=i,a=e.getAttribLocation(t,o);if(a>=0){const{attributeType:e}=Um(s),t=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:a,stepMode:t,type:e})}}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,35382);for(let o=0;o<r;o++){const r={name:e.getActiveUniformBlockName(t,o)||"",location:n(o,35391),byteLength:n(o,35392),vertex:n(o,35396),fragment:n(o,35398),uniformCount:n(o,35394),uniforms:[]},s=n(o,35395)||[],a=e.getActiveUniforms(t,s,35383),l=e.getActiveUniforms(t,s,35384),c=e.getActiveUniforms(t,s,35387),u=e.getActiveUniforms(t,s,35388);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,s[n]);if(!i)throw new Error("activeInfo");r.uniforms.push({name:i.name,format:jm(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);for(const e of i){const t=e.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));n.bindings.push({type:"uniform",name:e.name,location:e.location,visibility:(e.vertex?1:0)&(e.fragment?2:0),minBindingSize:e.byteLength,uniforms:t})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,35718);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:o,size:s,type:a}=i,{name:l,isArray:c}=$m(o);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:s,type:a,isArray:c};if(n.push(h),h.size>1)for(let i=0;i<h.size;i++){const r=`${l}[${i}]`;u=e.getUniformLocation(t,r);const o={...h,name:r,location:u};n.push(o)}}return n}(e,t);let o=0;for(const e of r)if(s=e.type,Bm.includes(s)){const{viewDimension:t,sampleType:i}=Gm(e.type);n.bindings.push({type:"texture",name:e.name,location:o,viewDimension:t,sampleType:i}),e.textureUnit=o,o+=1}var s;r.length&&(n.uniforms=r);const a=function(e,t){const n=[],i=e.getProgramParameter(t,35971);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:o,type:s,size:a}=i,{glType:l,components:c}=jm(s),u={location:r,name:o,accessor:new Nm({type:l,size:a*c})};n.push(u)}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);return a?.length&&(n.varyings=a),n}(this.device.gl,this.handle),np.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=function(e,t){const n={...e,attributes:e.attributes.map((e=>({...e})))};for(const e of t?.attributes||[]){const t=n.attributes.find((t=>t.name===e.name));t?(t.type=e.type||t.type,t.stepMode=e.stepMode||t.stepMode):np.warn(`shader layout attribute ${e.name} not present in shader`)}return n}(this.introspectedLayout,t.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":np.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`)}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[n,i]of Object.entries(e)){const e=this.shaderLayout.bindings.find((e=>e.name===n))||this.shaderLayout.bindings.find((e=>e.name===`${n}Uniforms`));if(e){switch(i||np.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(i instanceof Xf||i.buffer instanceof Xf))throw new Error("buffer value");break;case"texture":if(!(i instanceof Jf||i instanceof em||i instanceof tm))throw new Error("texture value");break;case"sampler":np.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(e.type)}this.bindings[n]=i}else{const e=this.shaderLayout.bindings.map((e=>`"${e.name}"`)).join(", ");t?.disableWarnings||np.warn(`Unknown binding "${n}" in render pipeline "${this.id}", expected one of ${e}`)()}}}draw(e){const{renderPass:t,parameters:n=this.props.parameters,topology:i=this.props.topology,vertexArray:r,vertexCount:o,instanceCount:s,isInstanced:a=!1,firstVertex:l=0,transformFeedback:c}=e,u=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(e)}}(i),h=Boolean(r.indexBuffer),d=r.indexBuffer?.glIndexType;if("success"!==this.linkStatus)return np.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||0===o)return np.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(0===o)return np.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),r.bindBeforeRender(t),c&&c.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const p=t;return function(e,t,n,i){if(ap(t))return i();const r=e;Yp(r.gl);try{return function(e,t){const n=e,{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}if(t.frontFace&&i.frontFace($f("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383),void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=$f("provokingVertex",t.provokingVertex,{first:36429,last:36430});e?.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=$f("polygonMode",t.polygonMode,{fill:6914,line:6913});e?.polygonModeWEBGL(1028,i),e?.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(jf("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&np.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=jf("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,n,0,e),i.stencilFuncSeparate(1029,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=Uf("stencilPassOperation",t.stencilPassOperation),n=Uf("stencilFailOperation",t.stencilFailOperation),r=Uf("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,n,r,e),i.stencilOpSeparate(1029,n,r,e)}if(t.blendColorOperation||t.blendAlphaOperation){i.enable(3042);const e=Vf("blendColorOperation",t.blendColorOperation||"add"),n=Vf("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=Gf("blendColorSrcFactor",t.blendColorSrcFactor||"one"),o=Gf("blendColorDstFactor",t.blendColorDstFactor||"zero"),s=Gf("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=Gf("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,o,s,a)}}(e,t),$p(r.gl,n),i()}finally{Kp(r.gl)}}(this.device,n,p.glParameters,(()=>{h&&a?this.device.gl.drawElementsInstanced(u,o||0,d,l,s||0):h?this.device.gl.drawElements(u,o||0,d,l):a?this.device.gl.drawArraysInstanced(u,l,o||0,s||0):this.device.gl.drawArrays(u,l,o||0),c&&c.end()})),r.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=Cm(e);Object.keys(t).forEach((e=>{np.warn(`Unsupported value "${JSON.stringify(t[e])}" used in setUniforms() for key ${e}. Use setBindings() instead?`)()})),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),np.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),np.timeEnd(4,`linkProgram for ${this.id}`)(),np.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}np.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),np.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}_reportLinkStatus(e){if("success"!==e){if("error"===this.vs.compilationStatus)throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);if("error"===this.fs?.compilationStatus)throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);throw new Error(`Error during ${e}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,t]of Object.entries(this.bindings))t instanceof em&&(t.update(),e=e&&t.loaded);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":const{name:o}=i,s=e.getUniformBlockIndex(this.handle,o);if(4294967295===s)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,n,s),r instanceof Xf?e.bindBufferBase(35345,n,r.handle):e.bindBufferRange(35345,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof Jf||r instanceof em||r instanceof tm))throw new Error("texture");let a;if(r instanceof Jf)a=r.texture;else if(r instanceof em)a=r;else{if(!(r instanceof tm&&r.colorAttachments[0]instanceof Jf))throw new Error("No texture");np.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0].texture}e.activeTexture(33984+t),e.bindTexture(a.target,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:n,type:i,textureUnit:r}=e,o=this.uniforms[t]??r;void 0!==o&&Wm(this.device.gl,n,i,o)}}}class qm extends lp{static defaultProps={...lp.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,qm.defaultProps)}}class Xm extends lp{static defaultProps={...lp.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Xm.defaultProps)}}class Zm extends Xm{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Ym(this.device,t.options);break;case"copy-buffer-to-texture":Km(this.device,t.options);break;case"copy-texture-to-buffer":Jm(this.device,t.options);break;case"copy-texture-to-texture":Qm(this.device,t.options)}}}function Ym(e,t){const n=t.source,i=t.destination;e.gl.bindBuffer(36662,n.handle),e.gl.bindBuffer(36663,i.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function Km(e,t){throw new Error("Not implemented")}function Jm(e,t){const{source:n,mipLevel:i=0,aspect:r="all",width:o=t.source.width,height:s=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:d}=t;if("all"!==r)throw new Error("not supported");if(0!==i||0!==a||h||d)throw new Error("not implemented");const{framebuffer:p,destroyFramebuffer:f}=eg(n);let m;try{const t=c,n=o||p.width,i=s||p.height,r=If(p.texture.props.format),a=r.dataFormat,h=r.type;e.gl.bindBuffer(35051,t.handle),m=e.gl.bindFramebuffer(36160,p.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(35051,null),void 0!==m&&e.gl.bindFramebuffer(36160,m),f&&p.destroy()}}function Qm(e,t){const{source:n,destinationMipLevel:i=0,origin:r=[0,0],destinationOrigin:o=[0,0],destination:s}=t;let{width:a=t.destination.width,height:l=t.destination.height}=t;const{framebuffer:c,destroyFramebuffer:u}=eg(n),[h,d]=r,[p,f,m]=o,g=e.gl.bindFramebuffer(36160,c.handle);let _,y=null;if(!(s instanceof em))throw new Error("invalid destination");switch(y=s,a=Number.isFinite(a)?a:y.width,l=Number.isFinite(l)?l:y.height,y.bind(0),_=y.target,_){case 3553:case 34067:e.gl.copyTexSubImage2D(_,i,p,f,h,d,a,l);break;case 35866:case 32879:e.gl.copyTexSubImage3D(_,i,p,f,m,h,d,a,l)}y&&y.unbind(),e.gl.bindFramebuffer(36160,g),u&&c.destroy()}function eg(e){if(e instanceof Df){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class tg extends qm{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Zm(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}class ng extends lp{static defaultProps={...lp.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,ng.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(e,t,n=16){const i=Rm(e,t),r=new Array(n).fill(null);for(const e of Object.values(i))r[e.location]=e;return r}(t.renderPipeline.shaderLayout,t.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){throw new Error("constant attributes not supported")}}let ig;function rg(e){return(!ig||ig.byteLength<e)&&(ig=new ArrayBuffer(e)),ig}class og extends ng{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return"Chrome"==(zo()?Bo(t)?"Electron":(qo.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node");var t}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&34963!==t.glTarget)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const n=t;if(34963===n.glTarget)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:o,offset:s,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,o,s):this.device.gl.vertexAttribPointer(e,i,r,a,o,s),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const n=rf(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t=!0){const n=og.isConstantAttributeZeroSupported(this.device);(t||n||0!==e)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=(o=t,Array.isArray(o)?new Float32Array(o):o),i=n.byteLength*e,r=n.length*e;var o;if(this.buffer&&i!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${i} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),s){const e=function(e,t){return new e(rg(e.BYTES_PER_ELEMENT*t),0,t)}(t.constructor,r);!function(e){const{target:t,source:n,start:i=0,count:r=1}=e,o=n.length,s=r*o;let a=0;for(let e=i;a<o;a++)t[e++]=n[a];for(;a<s;)a<s-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+s-a),a=s)}({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class sg extends lp{static defaultProps={...lp.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,sg.defaultProps)}}class ag extends sg{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":case"line-loop-webgl":return 1;case"triangle-list":case"triangle-strip":case"triangle-fan-webgl":return 4;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:o}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void np.warn(`${this.id} unusedBuffers varying buffer ${e}`)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:o},this.bindOnUse||this._bindBuffer(n,i,o,r)}getBuffer(e){if(lg(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if("function"!=typeof e)return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Xf)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(lg(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,n=0,i){const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(35982,e,r,n,i):this.gl.bindBufferBase(35982,e,r)}}function lg(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class cg extends lp{static defaultProps={...lp.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,cg.defaultProps)}}class ug extends cg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}}function hg(e){switch(e){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return bp(!1),0}}function dg(e){return e instanceof Ff?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:pg(e),deleteFramebuffer:!0}}function pg(e,t){const{device:n,width:i,height:r,id:o}=e;return n.createFramebuffer({...t,id:`framebuffer-for-${o}`,width:i,height:r,colorAttachments:[e]})}class fg extends vp{static type="webgl";type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;static isSupported(){return"undefined"!=typeof WebGL2RenderingContext}static attach(e){if(e instanceof fg)return e;if(e?.device instanceof vp)return e.device;if(!function(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new fg({gl:e})}static async create(e={}){np.groupCollapsed(1,"WebGLDevice created")();const t=[];e.debug&&t.push(async function(){zo()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Bf("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.spector&&t.push(async function(e){if(!globalThis.SPECTOR)try{await Bf("https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js")}catch(e){np.warn(String(e))}}()),"string"==typeof e.canvas&&t.push(Cp.pageLoaded);const n=await Promise.allSettled(t);for(const e of n)"rejected"===e.status&&np.error(`Failed to initialize debug libraries ${e.reason}`)();if(np.probe(2,"DOM is loaded")(),e.gl?.device)return np.warn("reattaching existing device")(),fg.attach(e.gl);const i=new fg(e),r=`Created ${i.type}${i.debug?" debug":""} context: ${i.info.vendor}, ${i.info.renderer} for canvas: ${i.canvasContext.id}`;return np.probe(1,r)(),np.table(1,i.info)(),np.groupEnd(1)(),i}constructor(e){super({...e,id:e.id||sp("webgl-device")});const t=e.gl?.device;if(t)throw new Error(`WebGL context already attached to device ${t.id}`);const n=e.gl?.canvas||e.canvas;this.canvasContext=new nm(this,{...e,canvas:n}),this.lost=new Promise((e=>{this._resolveContextLost=e}));let i=e.gl||null;if(i||=function(e,t){t={...ef,...t};let n=null;const i=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",i,!1);let r=null;if(r||=e.getContext("webgl2",t),e.removeEventListener("webglcontextcreationerror",i,!1),!r)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(t.onContextLost){const{onContextLost:n}=t;e.addEventListener("webglcontextlost",(e=>n(e)),!1)}if(t.onContextRestored){const{onContextRestored:n}=t;e.addEventListener("webglcontextrestored",(e=>n(e)),!1)}return r}(this.canvasContext.canvas,{...e,onContextLost:e=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}),!i)throw new Error("WebGL context creation failed");this.handle=i,this.gl=i,this.gl.device=this,this.gl._version=2,e.spector&&(this.spectorJS=function(e){if(e={...im,...e},!e?.spector)return null;if(!rm&&globalThis.SPECTOR&&(np.probe(1,"SPECTOR found and initialized")(),rm=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=rm)),!rm)return null;if(om||(om=!0,rm.spyCanvases(),rm?.onCaptureStarted.add((e=>np.info("Spector capture started:",e)())),rm?.onCapture.add((e=>{np.info("Spector capture complete:",e)(),rm?.getResultUI(),rm?.resultView.display(),rm?.resultView.addCapture(e)}))),e?.canvas){if("string"==typeof e.spector&&e.spector!==e.canvas.id)return rm;rm?.startCapture(e?.canvas,500),new Promise((e=>setTimeout(e,2e3))).then((e=>{np.info("Spector capture stopped after 2 seconds")(),rm?.stopCapture()}))}return rm}({...this.props,canvas:this.handle.canvas})),this.info=function(e,t){const n=e.getParameter(7936),i=e.getParameter(7937);tf(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,o=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936)||n,s=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937)||i,a=e.getParameter(7938),l=nf(o,s),c=function(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}(o,s),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(nf(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(o,s);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:o,renderer:s,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}(this.gl,this._extensions),this.limits=new Lf(this.gl),this.features=new kf(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:r=!0,copyState:o=!1}=e;Zp(this.gl,{enable:r,copyState:o,log:(...e)=>np.log(1,...e)()}),e.debug&&(this.gl=lm(this.gl,{...e,throwOnError:!0}),this.debug=!0,np.level=Math.max(np.level,1),np.warn("WebGL debug mode activated. Performance reduced.")())}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return Cf(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return function(e,t,n){if(!Cf(e,t,n))return!1;if(t.startsWith("depth")||t.startsWith("stencil"))return!1;try{if(mp(t).signed)return!1}catch{return!1}return t.endsWith("32float")?Boolean(tf(e,"OES_texture_float_linear, extensions",n)):!t.endsWith("16float")||Boolean(tf(e,"OES_texture_half_float_linear, extensions",n))}(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return function(e,t,n){return!!Cf(e,t,n)&&"number"!=typeof t}(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._getBufferProps(e);return new Xf(this,t)}_createTexture(e){return new em(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new Yf(this,e)}createShader(e){return new bm(this,e)}createFramebuffer(e){return new tm(this,e)}createVertexArray(e){return new og(this,e)}createTransformFeedback(e){return new ag(this,e)}createQuerySet(e){return new ug(this,e)}createRenderPipeline(e){return new Hm(this,e)}beginRenderPass(e){return new Sm(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e){return new tg(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return function(e,t){const{sourceX:n=0,sourceY:i=0,sourceFormat:r=6408,sourceAttachment:o=36064}=t||{};let{target:s=null,sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=dg(e);bp(u);const{gl:d,handle:p}=u;a=a||u.width,l=l||u.height;const f=o-36064;c=c||u.colorAttachments[f]?.texture?.type||5121,m=s,g=c,_=r,y=a,v=l,s=m||new(Lm(g=g||5121,{clamped:!1}))(y*v*hg(_)),c=c||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error("Failed to deduce GL constant from typed array")}}(s);var m,g,_,y,v;const b=d.bindFramebuffer(36160,p);return d.readPixels(n,i,a,l,r,c,s),d.bindFramebuffer(36160,b||null),h&&u.destroy(),s}(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:o=6408,targetByteOffset:s=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=dg(e);bp(u),a=a||u.width,l=l||u.height;const d=u;c=c||5121;let p=n;if(!p){const e=s+a*l*hg(o)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return bp(!1),0}}(c);p=d.device.createBuffer({byteLength:e})}const f=e.device.createCommandEncoder();return f.copyTextureToBuffer({source:e,width:a,height:l,origin:[i,r],destination:p,byteOffset:s}),f.destroy(),h&&u.destroy(),p}(e,t)}setParametersWebGL(e){$p(this.gl,e)}getParametersWebGL(e){return Wp(this.gl,e)}withParametersWebGL(e,t){return zf(this.gl,e,t)}clearWebGL(e){!function(e,t){const{framebuffer:n=null,color:i=null,depth:r=null,stencil:o=null}=t||{},s={};n&&(s.framebuffer=n);let a=0;i&&(a|=16384,!0!==i&&(s.clearColor=i)),r&&(a|=256,!0!==r&&(s.clearDepth=r)),o&&(a|=1024,!0!==r&&(s.clearStencil=r)),bp(0!==a,"clear: bad arguments");const l=e.gl;zf(l,s,(()=>{l.clear(a)}))}(this,e)}resetWebGL(){np.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),$p(this.gl,Mp)}gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;loseDevice(){let e=!1;const t=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return t&&(e=!0,t.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Yp(this.gl)}popState(){Kp(this.gl)}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){t=t||this.gl2||this.gl;const n=Number(e);for(const e in t)if(t[e]===n)return`GL.${e}`;return String(e)}_constants;setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&np.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n);break;default:bp(!1)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:bp(!1)}}getExtension(e){return tf(this.gl,e,this._extensions),this._extensions}}let mg=0;const gg={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:wp.stats.get("animation-loop-"+mg++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class _g{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;constructor(e){if(this.props={...gg,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new $c({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:this.device?.canvasContext?.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?n=i.clientWidth/i.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}var yg=d(2332);const vg={mousedown:1,mousemove:2,mouseup:4};!function(e){const t=e.prototype.handler;e.prototype.handler=function(e){const n=this.store;e.button>0&&"pointerdown"===e.type&&(function(t,n){for(let n=0;n<t.length;n++)if(t[n].pointerId===e.pointerId)return!0;return!1}(n)||n.push(e)),t.call(this,e)}}(yg.PointerEventInput),yg.MouseInput.prototype.handler=function(e){let t=vg[e.type];1&t&&e.button>=0&&(this.pressed=!0),2&t&&0===e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))};const bg=yg.Manager,xg=yg;class wg{constructor(e,t,n){this.element=e,this.callback=t,this.options={enable:!0,...n}}}const Eg=xg?[[xg.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[xg.Rotate,{enable:!1}],[xg.Pinch,{enable:!1}],[xg.Swipe,{enable:!1}],[xg.Pan,{threshold:0,enable:!1}],[xg.Press,{enable:!1}],[xg.Tap,{event:"doubletap",taps:2,enable:!1}],[xg.Tap,{event:"anytap",enable:!1}],[xg.Tap,{enable:!1}]]:null,Sg={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Tg={doubletap:["tap"]},Ag={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Cg={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Pg={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Ig={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Mg="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Rg="undefined"!=typeof window?window:d.g;void 0!==d.g?d.g:window,"undefined"!=typeof document&&document;let Og=!1;try{const e={get passive(){return Og=!0,!0}};Rg.addEventListener("test",null,e),Rg.removeEventListener("test",null)}catch(e){Og=!1}const kg=-1!==Mg.indexOf("firefox"),{WHEEL_EVENTS:Lg}=Cg,Dg="wheel",Fg=4.000244140625;class Ng extends wg{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;Rg.WheelEvent&&(kg&&e.deltaMode===Rg.WheelEvent.DOM_DELTA_PIXEL&&(t/=Rg.devicePixelRatio),e.deltaMode===Rg.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%Fg==0&&(t=Math.floor(t/Fg)),e.shiftKey&&t&&(t*=.25),this.callback({type:Dg,center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},this.events=(this.options.events||[]).concat(Lg),this.events.forEach((t=>e.addEventListener(t,this.handleEvent,!!Og&&{passive:!1})))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===Dg&&(this.options.enable=t)}}const{MOUSE_EVENTS:Bg}=Cg,zg="pointermove",jg="pointerover",Ug="pointerout",Vg="pointerenter",Gg="pointerleave";class $g extends wg{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(Bg),this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===zg&&(this.enableMoveEvent=t),e===jg&&(this.enableOverEvent=t),e===Ug&&(this.enableOutEvent=t),e===Vg&&(this.enableEnterEvent=t),e===Gg&&(this.enableLeaveEvent=t)}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit(jg,e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit(Ug,e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit(Vg,e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit(Gg,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.which&&(this.pressed=!1),this.pressed||this._emit(zg,e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const{KEY_EVENTS:Wg}=Cg,Hg="keydown",qg="keyup";class Xg extends wg{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{const t=e.target||e.srcElement;"INPUT"===t.tagName&&"text"===t.type||"TEXTAREA"===t.tagName||(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:Hg,srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:qg,srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(Wg),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach((t=>e.addEventListener(t,this.handleEvent)))}destroy(){this.events.forEach((e=>this.element.removeEventListener(e,this.handleEvent)))}enableEventType(e,t){e===Hg&&(this.enableDownEvent=t),e===qg&&(this.enableUpEvent=t)}}const Zg="contextmenu";class Yg extends wg{constructor(e,t,n){super(e,t,n),this.handleEvent=e=>{this.options.enable&&this.callback({type:Zg,center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e===Zg&&(this.options.enable=t)}}const Kg={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4};function Jg(e){const t=Kg[e.srcEvent.type];if(!t)return null;const{buttons:n,button:i,which:r}=e.srcEvent;let o=!1,s=!1,a=!1;return 4===t||2===t&&!Number.isFinite(n)?(o=1===r,s=2===r,a=3===r):2===t?(o=Boolean(1&n),s=Boolean(4&n),a=Boolean(2&n)):1===t&&(o=0===i,s=1===i,a=2===i),{leftButton:o,middleButton:s,rightButton:a}}function Qg(e,t){const n=e.center;if(!n)return null;const i=t.getBoundingClientRect(),r=i.width/t.offsetWidth||1,o=i.height/t.offsetHeight||1;return{center:n,offsetCenter:{x:(n.x-i.left-t.clientLeft)/r,y:(n.y-i.top-t.clientTop)/o}}}const e_={srcElement:"root",priority:0};class t_{constructor(e){this.handleEvent=e=>{if(this.isEmpty())return;const t=this._normalizeEvent(e);let n=e.srcEvent.target;for(;n&&n!==t.rootElement;){if(this._emit(t,n),t.handled)return;n=n.parentNode}this._emit(t,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,n,i=!1,r=!1){const{handlers:o,handlersByElement:s}=this;let a=e_;"string"==typeof n||n&&n.addEventListener?a={...e_,srcElement:n}:n&&(a={...e_,...n});let l=s.get(a.srcElement);l||(l=[],s.set(a.srcElement,l));const c={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(c.once=!0),r&&(c.passive=!0),o.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){const{handlers:n,handlersByElement:i}=this;for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.type===e&&o.handler===t){n.splice(r,1);const e=i.get(o.srcElement);e.splice(e.indexOf(o),1),0===e.length&&i.delete(o.srcElement)}}this._active=n.some((e=>!e.passive))}_emit(e,t){const n=this.handlersByElement.get(t);if(n){let t=!1;const i=()=>{e.handled=!0},r=()=>{e.handled=!0,t=!0},o=[];for(let s=0;s<n.length;s++){const{type:a,handler:l,once:c}=n[s];if(l({...e,type:a,stopPropagation:i,stopImmediatePropagation:r}),c&&o.push(n[s]),t)break}for(let e=0;e<o.length;e++){const{type:t,handler:n}=o[e];this.remove(t,n)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...Jg(e),...Qg(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}const n_={events:null,recognizers:null,recognizerOptions:{},Manager:bg,touchAction:"none",tabIndex:0};class i_{constructor(e=null,t){this._onBasicInput=e=>{const{srcEvent:t}=e,n=Ag[t.type];n&&this.manager.emit(n,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={...n_,...t},this.events=new Map,this.setElement(e);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:t}=this,n=t.Manager;this.manager=new n(e,{touchAction:t.touchAction,recognizers:t.recognizers||Eg}).on("hammer.input",this._onBasicInput),t.recognizers||Object.keys(Sg).forEach((e=>{const t=this.manager.get(e);t&&Sg[e].forEach((e=>{t.recognizeWith(e)}))}));for(const e in t.recognizerOptions){const n=this.manager.get(e);if(n){const i=t.recognizerOptions[e];delete i.enable,n.set(i)}}this.wheelInput=new Ng(e,this._onOtherEvent,{enable:!1}),this.moveInput=new $g(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Xg(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new Yg(e,this._onOtherEvent,{enable:!1});for(const[e,t]of this.events)t.isEmpty()||(this._toggleRecognizer(t.recognizerName,!0),this.manager.on(e,t.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,t,n){this._addEventHandler(e,t,n,!1)}once(e,t,n){this._addEventHandler(e,t,n,!0)}watch(e,t,n){this._addEventHandler(e,t,n,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:n}=this;if(!n)return;const i=n.get(e);if(i&&i.options.enable!==t){i.set({enable:t});const r=Tg[e];r&&!this.options.recognizers&&r.forEach((r=>{const o=n.get(r);t?(o.requireFailure(e),i.dropRequireFailure(r)):o.dropRequireFailure(e)}))}this.wheelInput.enableEventType(e,t),this.moveInput.enableEventType(e,t),this.keyInput.enableEventType(e,t),this.contextmenuInput.enableEventType(e,t)}_addEventHandler(e,t,n,i,r){if("string"!=typeof e){n=t;for(const t in e)this._addEventHandler(t,e[t],n,i,r);return}const{manager:o,events:s}=this,a=Ig[e]||e;let l=s.get(a);l||(l=new t_(this),s.set(a,l),l.recognizerName=Pg[a]||a,o&&o.on(a,l.handleEvent)),l.add(e,t,n,i,r),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(const t in e)this._removeEventHandler(t,e[t]);return}const{events:n}=this,i=Ig[e]||e,r=n.get(i);if(r&&(r.remove(e,t),r.isEmpty())){const{recognizerName:e}=r;let t=!1;for(const i of n.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}}function r_(){}const o_={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:r_,onWebGLInitialized:r_,onResize:r_,onViewStateChange:r_,onInteractionStateChange:r_,onBeforeRender:r_,onAfterRender:r_,onLoad:r_,onError:e=>rs.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class s_{static{this.defaultProps=o_}static{this.VERSION=tp}constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new $c({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{const{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;{const n=e.offsetCenter;if(!n)return;t.x=n.x,t.y=n.y,t.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{const t=Oa[e.type],n=e.offsetCenter;if(!t||!n||!this.layerManager)return;const i=this.layerManager.getLayers(),r=this.deckPicker.getLastPickedObject({x:n.x,y:n.y,layers:i,viewports:this.getViewports(n)},this._lastPointerDownInfo),{layer:o}=r,s=o&&(o[t.handler]||o.props[t.handler]),a=this.props[t.handler];let l=!1;s&&(l=s.call(o,r,e)),l||(a?.(r,e),this.widgetManager.onEvent(r,e))},this._onPointerDown=e=>{const t=e.offsetCenter,n=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=n.result[0]||n.emptyInfo},this.props={...o_,...e},(e=this.props).viewState&&e.initialViewState&&rs.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&rs.error("WebGL1 context not supported.")(),this.device=fg.attach(e.gl));let t=this.device;t||(wp.registerDevices([fg]),t=wp.createDevice({...e.deviceProps,canvas:this._createCanvas(e)})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&os.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&rs.removed("onLayerHover","onHover")(),"onLayerClick"in e&&rs.removed("onLayerClick","onClick")(),e.initialViewState&&!Do(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),r=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return t=t||n||i||r||o,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return Ha(this.viewManager),this.viewManager.views}getViewports(e){return Ha(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const n in e)this.layerManager.resourceManager.add({resourceId:n,data:e[n],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,n){Ha(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const r=this.deckPicker[e]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return i.get(t).timeEnd(),r}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),Ha(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:n}=e;if(t||0===t){const e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(n||0===n){const t=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,n=e.clientHeight??e.height;t===this.width&&n===this.height||(this.width=t,this.height=n,this.viewManager?.setProps({width:t,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:n}))}_createAnimationLoop(e,t){const{gl:n,onError:i,useDevicePixels:r}=t;return new _g({device:e,useDevicePixels:r,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Wh({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:n}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=n,r=!1;for(const n of t)i=n,r=n.layer?.onHover(n,e.event)||r;r||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof fg&&this.props.onWebGLInitialized(this.device.gl);const t=new Dl;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new i_(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const e in Oa)this.eventManager.on(e,this._onEvent);this.viewManager=new bh({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new vh(this.device,{deck:this,stats:this.stats,viewport:n,timeline:t}),this.effectManager=new md({deck:this,device:this.device}),this.deckRenderer=new bd(this.device),this.deckPicker=new Ad(this.device),this.widgetManager=new Md({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Od),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:n,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:i});const r={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(r),"screen"===r.pass&&this.widgetManager.onRedraw({viewports:r.viewports,layers:r.layers}),this.props.onAfterRender({device:n,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),rs.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const n=wp.stats.get("Memory Usage");e.bufferMemory=n.get("Buffer Memory").count,e.textureMemory=n.get("Texture Memory").count,e.renderbufferMemory=n.get("Renderbuffer Memory").count,e.gpuMemory=n.get("GPU Memory").count}}const a_="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function l_(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}function c_(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function u_(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function h_(e,t,n){if(!t||t>4)throw new Error(`size ${t}`);const i=t;let r=c_(e);if("uint8"===r||"sint8"===r){if(1===i||3===i)throw new Error(`size: ${t}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}if("uint16"===r||"sint16"===r){if(1===i||3===i)throw new Error(`size: ${t}`);return n&&(r=r.replace("int","norm")),`${r}x${i}`}return 1===i?r:`${r}x${i}`}const d_=c_;function p_(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function f_(e){return e.stride||e.size*e.bytesPerElement}function m_(e,t){t.offset&&rs.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=f_(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*n+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:n}}class g_{constructor(e,t,n){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,r="float64"===i;let o,{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0),o=r?"float32":!i&&t.isIndexed?"uint32":i||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return u_(e)}}(i||o);this.doublePrecision=r,r&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:s,logicalType:i,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*f_(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),os.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const n={};if(this.state.constant){const i=this.value;if(t){const r=m_(this.getAccessor(),t),o=r.offset/i.BYTES_PER_ELEMENT,s=r.size||this.size;n[e]=i.subarray(o,o+s)}else n[e]=i}else n[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${e}64Low`]=n[e]:n[`${e}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(e=this.id,t=null){const n=this.getAccessor(),i=[],r={name:this.id,byteStride:f_(n),attributes:i};if(this.doublePrecision){const r=function(e,t){const n=m_(e,t);return{high:n,low:{...n,offset:n.offset+4*e.size}}}(n,t||{});i.push(p_(e,{...n,...r.high}),p_(`${e}64Low`,{...n,...r.low}))}else if(t){const r=m_(n,t);i.push(p_(e,{...n,...r}))}else i.push(p_(e,n));return r}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:n,size:i}=this,r=n*i;if(t&&r&&t.length>=r){const n=new Array(i).fill(1/0),o=new Array(i).fill(-1/0);for(let e=0;e<r;)for(let r=0;r<i;r++){const i=t[e++];i<n[r]&&(n[r]=i),i>o[r]&&(o[r]=i)}e=[n,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let n;n=ArrayBuffer.isView(e)?{value:e}:e instanceof cp?{buffer:e}:e;const i={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)i.type="float32";else{const e=d_(n.value);i.type=i.normalized?e.replace("int","norm"):e}i.bytesPerElement=n.value.BYTES_PER_ELEMENT,i.stride=f_(i)}if(t.bounds=null,n.constant){let e=n.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),t.constant&&this._areValuesEqual(e,this.value))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(n.buffer){const e=n.buffer;t.externalBuffer=e,t.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let e=n.value;t.externalBuffer=null,t.constant=!1,this.value=e;let{buffer:r}=this;const o=f_(i),s=(i.vertexOffset||0)*o;if(this.doublePrecision&&e instanceof Float64Array&&(e=Rs(e,i)),this.settings.isIndexed){const t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}const a=e.byteLength+s+2*o;(!r||r.byteLength<a)&&(r=this._createBuffer(a)),r.write(e,s)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:n=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Rs(t,{size:this.size,startIndex:n,endIndex:i}):t.subarray(n,i),n*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:n}=this,i=n.allocatedValue,r=os.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=r;const{byteOffset:o}=this;let{buffer:s}=this;return(!s||s.byteLength<r.byteLength+o)&&(s=this._createBuffer(r.byteLength+o),t&&i&&s.write(i instanceof Float64Array?Rs(i,this):i,o)),n.allocatedValue=r,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof n||!this.settings.normalized||"normalized"in e||rs.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map((e=>(e+128)/255*2-1));case"snorm16":return new Float32Array(e).map((e=>(e+32768)/65535*2-1));case"unorm8":return new Float32Array(e).map((e=>e/255));case"unorm16":return new Float32Array(e).map((e=>e/65535));default:return e}}_normalizeValue(e,t,n){const{defaultValue:i,size:r}=this.settings;if(Number.isFinite(e))return t[n]=e,t;if(!e){let e=r;for(;--e>=0;)t[n+e]=i[e];return t}switch(r){case 4:t[n+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[n+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[n+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[n+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=r;for(;--o>=0;)t[n+o]=Number.isFinite(e[o])?e[o]:i[o]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:n}=this;for(let i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:t?cp.INDEX:cp.VERTEX,indexType:t?n:void 0,byteLength:e}),this._buffer}}const __=[],y_=[];function v_(e,t=0,n=1/0){let i=__;const r={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(y_.length=e.length,i=y_):i=__,(t>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,n),r.index=t-1),{iterable:i,objectInfo:r}}function b_(e){return e&&e[Symbol.asyncIterator]}function x_(e,t){const{size:n,stride:i,offset:r,startIndices:o,nested:s}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:n,c=r?r/a:0,u=Math.floor((e.length-c)/l);return(t,{index:i,target:r})=>{if(!o){const t=i*l+c;for(let i=0;i<n;i++)r[i]=e[t+i];return r}const a=o[i],h=o[i+1]||u;let d;if(s){d=new Array(h-a);for(let t=a;t<h;t++){const i=t*l+c;r=new Array(n);for(let t=0;t<n;t++)r[t]=e[i+t];d[t-a]=r}}else if(l===n)d=e.subarray(a*n+c,h*n+c);else{d=new e.constructor((h-a)*n);let t=0;for(let i=a;i<h;i++){const r=i*l+c;for(let i=0;i<n;i++)d[t++]=e[r+i]}}return d}}const w_=[],E_=[[0,1/0]],S_={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function T_(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const n=e.type||"interpolation";return{...S_[n],...t,...e,type:n}}class A_ extends g_{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:E_}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,n;this.state.layoutChanged||=(t=e,n=this.getAccessor(),!(t.type===n.type&&t.size===n.size&&f_(t)===f_(n)&&(t.offset||0)===(n.offset||0))),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,n=this.settings.transition;return T_(Array.isArray(t)?e[t.find((t=>e[t]))]:e[t],n)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:e=0,endRow:n=1/0}=t;this.state.updateRanges=function(e,t){if(e===E_)return e;if(t[0]<0&&(t[0]=0),t[0]>=t[1])return e;const n=[],i=e.length;let r=0;for(let o=0;o<i;o++){const i=e[o];i[1]<t[0]?(n.push(i),r=o+1):i[0]>t[1]?n.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return n.splice(r,0,t),n}(this.state.updateRanges,[e,n])}else this.state.updateRanges=E_}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=w_}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:n}=this;return!n.noAlloc&&!!n.update&&(super.allocate(e,t.updateRanges!==E_),!0)}updateBuffer({numInstances:e,data:t,props:n,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:r},settings:{update:o,noAlloc:s}}=this;let a=!0;if(o){for(const[s,a]of r)o.call(i,this,{data:t,startRow:s,endRow:a,props:n,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[t,n]of r){const i=Number.isFinite(t)?this.getVertexOffset(t):0,r=Number.isFinite(n)?this.getVertexOffset(n):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:r})}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:n,settings:i}=this;if(!e)return n.binaryValue=null,n.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(n.binaryValue===e)return this.clearNeedsUpdate(),!0;if(n.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const r=e;Ha(ArrayBuffer.isView(r.value),`invalid ${i.accessor}`);const o=Boolean(r.size)&&r.size!==this.size;return n.binaryAccessor=x_(r.value,{size:r.size||this.size,stride:r.stride,offset:r.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const n in e)Object.assign(t,super.getValue(n,e[n]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:i}=this.settings;if(n.stepMode="dynamic"===i?e?e.isInstanced?"instance":"vertex":"instance":i??"vertex",!t)return n;for(const e in t){const i=super._getBufferLayout(e,t[e]);n.attributes.push(...i.attributes)}return n}_autoUpdater(e,{data:t,startRow:n,endRow:i,props:r,numInstances:o}){if(e.constant)return;const{settings:s,state:a,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=s,p=a.binaryAccessor||("function"==typeof h?h:r[h]);Ha("function"==typeof p,`accessor "${h}" is not a function`);let f=e.getVertexOffset(n);const{iterable:m,objectInfo:g}=v_(t,n,i);for(const t of m){g.index++;let n=p(t,g);if(d&&(n=d.call(this,n)),u){const t=(g.index<u.length-1?u[g.index+1]:o)-u[g.index];if(n&&Array.isArray(n[0])){let t=f;for(const i of n)e._normalizeValue(i,l,t),t+=c}else n&&n.length>c?l.set(n,f):(e._normalizeValue(n,g.target,0),Uc({target:l,source:g.target,start:f,count:t}));f+=t*c}else e._normalizeValue(n,l,f),f+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!e.noAlloc&&"function"!=typeof e.update)throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let n=!0;switch(t){case 4:n=n&&Number.isFinite(e[3]);case 3:n=n&&Number.isFinite(e[2]);case 2:n=n&&Number.isFinite(e[1]);case 1:n=n&&Number.isFinite(e[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function C_(e){const{input:t,inputChannels:n,output:i}=e||{};if(!t)return"#version 300 es\nout vec4 transform_output;\nvoid main() {\ntransform_output = vec4(0);\n}";if(!n)throw new Error("inputChannels");return`#version 300 es\nin ${function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}(n)} ${t};\nout vec4 ${i};\nvoid main() {\n  ${i} = ${function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}(t,n)};\n}`}class P_{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name,e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find((t=>"uniform"===t.type&&t.name===e?.name));if(!t)throw new Error(e?.name);const n=t;for(const e of n.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${n}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t,n=16){if(e!==t)return!1;const i=Am(e);if(!i)return!1;const r=Am(t);if(r&&i.length===r.length)for(let e=0;e<i.length;++e)if(r[e]!==i[e])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){const t=Am(e);return t?t.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}const I_={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function M_(e){const t=I_[e];return bp(e),t}function R_(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}class O_{layout={};byteLength;constructor(e){let t=0;for(const[n,i]of Object.entries(e)){const e=M_(i),{type:r,components:o}=e;t=R_(t,o);const s=t;t+=o,this.layout[n]={type:r,size:o,offset:s}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=rg(Math.max(this.byteLength,1024)),n={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[t,i]of Object.entries(e)){const e=this.layout[t];if(!e){np.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}const{type:r,size:o,offset:s}=e,a=n[r];if(1===o){if("number"!=typeof i&&"boolean"!=typeof i){np.warn(`Supplied value for single component uniform ${t} is not a number: ${i}`)();continue}a[s]=Number(i)}else{const e=Am(i);if(!e){np.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${i}`)();continue}a.set(e,s)}}return new Uint8Array(t)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class k_{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,n]of Object.entries(e)){const e=t,i=new O_(n.uniformTypes||{});this.uniformBufferLayouts.set(e,i);const r=new P_({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:cp.UNIFORM|cp.COPY_DST,byteLength:i}),o=this.getUniformBufferData(t);return r.write(o),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:cp.UNIFORM|cp.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||=n}return e&&np.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=!1;if(this.uniformBuffers.get(e)&&t.needsRedraw){n||=t.needsRedraw;const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const r=this.uniformBlocks.get(e).getAllUniforms();np.log(4,`Writing to uniform buffer ${String(e)}`,i,r)()}return n}}function L_(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!L_(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i){if(!t.hasOwnProperty(r))return!1;if(!L_(e[r],t[r],n-1))return!1}return!0}return!1}class D_{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class F_{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class N_ extends F_{constructor(){super()}}class B_ extends N_{constructor(e,t,n,i){super(),this.name=e,this.args=t,this.returnType=n,this.body=i}get astNodeType(){return"function"}}class z_ extends N_{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class j_ extends N_{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}}class U_ extends N_{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class V_ extends N_{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}}class G_ extends N_{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}}class $_ extends N_{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}}class W_ extends N_{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}}class H_ extends N_{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var q_,X_,Z_,Y_,K_;!function(e){e.increment="++",e.decrement="--"}(q_||(q_={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}}(q_||(q_={}));class J_ extends N_{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}}!function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="}(X_||(X_={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for AssignOperator");return e[n]}}(X_||(X_={}));class Q_ extends N_{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}}class ey extends N_{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}}class ty extends N_{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class ny extends N_{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class iy extends N_{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}}class ry extends N_{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class oy extends N_{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class sy extends N_{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ay extends N_{constructor(){super()}get astNodeType(){return"discard"}}class ly extends N_{constructor(){super()}get astNodeType(){return"break"}}class cy extends N_{constructor(){super()}get astNodeType(){return"continue"}}class uy extends N_{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class hy extends uy{constructor(e,t){super(e),this.members=t}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class dy extends uy{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class py extends uy{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class fy extends uy{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class my extends uy{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class gy extends F_{constructor(){super()}}class _y extends gy{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class yy extends gy{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}}class vy extends gy{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return 180*this.args[0].evaluate(e)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class by extends gy{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class xy extends gy{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof yy){const i=null===(t=this.postfix)||void 0===t?void 0:t.evaluateString(e),r=null===(n=this.initializer.type)||void 0===n?void 0:n.name,o=e.structs.get(r),s=null==o?void 0:o.getMemberIndex(i);if(-1!=s)return this.initializer.args[s].evaluate(e);console.log(s)}return this.initializer.evaluate(e)}}class wy extends gy{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Ey extends gy{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}}class Sy extends gy{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class Ty extends gy{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Ay extends gy{constructor(){super()}}class Cy extends Ay{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Py extends Ay{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class Iy extends F_{constructor(){super()}}class My extends Iy{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}}class Ry extends Iy{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class Oy extends F_{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class ky extends F_{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}}class Ly extends F_{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Dy extends F_{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}!function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"}(Y_||(Y_={}));class Fy{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Ny{}Z_=Ny,Ny.none=new Fy("",Y_.reserved,""),Ny.eof=new Fy("EOF",Y_.token,""),Ny.reserved={asm:new Fy("asm",Y_.reserved,"asm"),bf16:new Fy("bf16",Y_.reserved,"bf16"),do:new Fy("do",Y_.reserved,"do"),enum:new Fy("enum",Y_.reserved,"enum"),f16:new Fy("f16",Y_.reserved,"f16"),f64:new Fy("f64",Y_.reserved,"f64"),handle:new Fy("handle",Y_.reserved,"handle"),i8:new Fy("i8",Y_.reserved,"i8"),i16:new Fy("i16",Y_.reserved,"i16"),i64:new Fy("i64",Y_.reserved,"i64"),mat:new Fy("mat",Y_.reserved,"mat"),premerge:new Fy("premerge",Y_.reserved,"premerge"),regardless:new Fy("regardless",Y_.reserved,"regardless"),typedef:new Fy("typedef",Y_.reserved,"typedef"),u8:new Fy("u8",Y_.reserved,"u8"),u16:new Fy("u16",Y_.reserved,"u16"),u64:new Fy("u64",Y_.reserved,"u64"),unless:new Fy("unless",Y_.reserved,"unless"),using:new Fy("using",Y_.reserved,"using"),vec:new Fy("vec",Y_.reserved,"vec"),void:new Fy("void",Y_.reserved,"void")},Ny.keywords={array:new Fy("array",Y_.keyword,"array"),atomic:new Fy("atomic",Y_.keyword,"atomic"),bool:new Fy("bool",Y_.keyword,"bool"),f32:new Fy("f32",Y_.keyword,"f32"),i32:new Fy("i32",Y_.keyword,"i32"),mat2x2:new Fy("mat2x2",Y_.keyword,"mat2x2"),mat2x3:new Fy("mat2x3",Y_.keyword,"mat2x3"),mat2x4:new Fy("mat2x4",Y_.keyword,"mat2x4"),mat3x2:new Fy("mat3x2",Y_.keyword,"mat3x2"),mat3x3:new Fy("mat3x3",Y_.keyword,"mat3x3"),mat3x4:new Fy("mat3x4",Y_.keyword,"mat3x4"),mat4x2:new Fy("mat4x2",Y_.keyword,"mat4x2"),mat4x3:new Fy("mat4x3",Y_.keyword,"mat4x3"),mat4x4:new Fy("mat4x4",Y_.keyword,"mat4x4"),ptr:new Fy("ptr",Y_.keyword,"ptr"),sampler:new Fy("sampler",Y_.keyword,"sampler"),sampler_comparison:new Fy("sampler_comparison",Y_.keyword,"sampler_comparison"),struct:new Fy("struct",Y_.keyword,"struct"),texture_1d:new Fy("texture_1d",Y_.keyword,"texture_1d"),texture_2d:new Fy("texture_2d",Y_.keyword,"texture_2d"),texture_2d_array:new Fy("texture_2d_array",Y_.keyword,"texture_2d_array"),texture_3d:new Fy("texture_3d",Y_.keyword,"texture_3d"),texture_cube:new Fy("texture_cube",Y_.keyword,"texture_cube"),texture_cube_array:new Fy("texture_cube_array",Y_.keyword,"texture_cube_array"),texture_multisampled_2d:new Fy("texture_multisampled_2d",Y_.keyword,"texture_multisampled_2d"),texture_storage_1d:new Fy("texture_storage_1d",Y_.keyword,"texture_storage_1d"),texture_storage_2d:new Fy("texture_storage_2d",Y_.keyword,"texture_storage_2d"),texture_storage_2d_array:new Fy("texture_storage_2d_array",Y_.keyword,"texture_storage_2d_array"),texture_storage_3d:new Fy("texture_storage_3d",Y_.keyword,"texture_storage_3d"),texture_depth_2d:new Fy("texture_depth_2d",Y_.keyword,"texture_depth_2d"),texture_depth_2d_array:new Fy("texture_depth_2d_array",Y_.keyword,"texture_depth_2d_array"),texture_depth_cube:new Fy("texture_depth_cube",Y_.keyword,"texture_depth_cube"),texture_depth_cube_array:new Fy("texture_depth_cube_array",Y_.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Fy("texture_depth_multisampled_2d",Y_.keyword,"texture_depth_multisampled_2d"),texture_external:new Fy("texture_external",Y_.keyword,"texture_external"),u32:new Fy("u32",Y_.keyword,"u32"),vec2:new Fy("vec2",Y_.keyword,"vec2"),vec3:new Fy("vec3",Y_.keyword,"vec3"),vec4:new Fy("vec4",Y_.keyword,"vec4"),bitcast:new Fy("bitcast",Y_.keyword,"bitcast"),block:new Fy("block",Y_.keyword,"block"),break:new Fy("break",Y_.keyword,"break"),case:new Fy("case",Y_.keyword,"case"),continue:new Fy("continue",Y_.keyword,"continue"),continuing:new Fy("continuing",Y_.keyword,"continuing"),default:new Fy("default",Y_.keyword,"default"),discard:new Fy("discard",Y_.keyword,"discard"),else:new Fy("else",Y_.keyword,"else"),enable:new Fy("enable",Y_.keyword,"enable"),fallthrough:new Fy("fallthrough",Y_.keyword,"fallthrough"),false:new Fy("false",Y_.keyword,"false"),fn:new Fy("fn",Y_.keyword,"fn"),for:new Fy("for",Y_.keyword,"for"),function:new Fy("function",Y_.keyword,"function"),if:new Fy("if",Y_.keyword,"if"),let:new Fy("let",Y_.keyword,"let"),const:new Fy("const",Y_.keyword,"const"),loop:new Fy("loop",Y_.keyword,"loop"),while:new Fy("while",Y_.keyword,"while"),private:new Fy("private",Y_.keyword,"private"),read:new Fy("read",Y_.keyword,"read"),read_write:new Fy("read_write",Y_.keyword,"read_write"),return:new Fy("return",Y_.keyword,"return"),storage:new Fy("storage",Y_.keyword,"storage"),switch:new Fy("switch",Y_.keyword,"switch"),true:new Fy("true",Y_.keyword,"true"),alias:new Fy("alias",Y_.keyword,"alias"),type:new Fy("type",Y_.keyword,"type"),uniform:new Fy("uniform",Y_.keyword,"uniform"),var:new Fy("var",Y_.keyword,"var"),override:new Fy("override",Y_.keyword,"override"),workgroup:new Fy("workgroup",Y_.keyword,"workgroup"),write:new Fy("write",Y_.keyword,"write"),r8unorm:new Fy("r8unorm",Y_.keyword,"r8unorm"),r8snorm:new Fy("r8snorm",Y_.keyword,"r8snorm"),r8uint:new Fy("r8uint",Y_.keyword,"r8uint"),r8sint:new Fy("r8sint",Y_.keyword,"r8sint"),r16uint:new Fy("r16uint",Y_.keyword,"r16uint"),r16sint:new Fy("r16sint",Y_.keyword,"r16sint"),r16float:new Fy("r16float",Y_.keyword,"r16float"),rg8unorm:new Fy("rg8unorm",Y_.keyword,"rg8unorm"),rg8snorm:new Fy("rg8snorm",Y_.keyword,"rg8snorm"),rg8uint:new Fy("rg8uint",Y_.keyword,"rg8uint"),rg8sint:new Fy("rg8sint",Y_.keyword,"rg8sint"),r32uint:new Fy("r32uint",Y_.keyword,"r32uint"),r32sint:new Fy("r32sint",Y_.keyword,"r32sint"),r32float:new Fy("r32float",Y_.keyword,"r32float"),rg16uint:new Fy("rg16uint",Y_.keyword,"rg16uint"),rg16sint:new Fy("rg16sint",Y_.keyword,"rg16sint"),rg16float:new Fy("rg16float",Y_.keyword,"rg16float"),rgba8unorm:new Fy("rgba8unorm",Y_.keyword,"rgba8unorm"),rgba8unorm_srgb:new Fy("rgba8unorm_srgb",Y_.keyword,"rgba8unorm_srgb"),rgba8snorm:new Fy("rgba8snorm",Y_.keyword,"rgba8snorm"),rgba8uint:new Fy("rgba8uint",Y_.keyword,"rgba8uint"),rgba8sint:new Fy("rgba8sint",Y_.keyword,"rgba8sint"),bgra8unorm:new Fy("bgra8unorm",Y_.keyword,"bgra8unorm"),bgra8unorm_srgb:new Fy("bgra8unorm_srgb",Y_.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Fy("rgb10a2unorm",Y_.keyword,"rgb10a2unorm"),rg11b10float:new Fy("rg11b10float",Y_.keyword,"rg11b10float"),rg32uint:new Fy("rg32uint",Y_.keyword,"rg32uint"),rg32sint:new Fy("rg32sint",Y_.keyword,"rg32sint"),rg32float:new Fy("rg32float",Y_.keyword,"rg32float"),rgba16uint:new Fy("rgba16uint",Y_.keyword,"rgba16uint"),rgba16sint:new Fy("rgba16sint",Y_.keyword,"rgba16sint"),rgba16float:new Fy("rgba16float",Y_.keyword,"rgba16float"),rgba32uint:new Fy("rgba32uint",Y_.keyword,"rgba32uint"),rgba32sint:new Fy("rgba32sint",Y_.keyword,"rgba32sint"),rgba32float:new Fy("rgba32float",Y_.keyword,"rgba32float"),static_assert:new Fy("static_assert",Y_.keyword,"static_assert")},Ny.tokens={decimal_float_literal:new Fy("decimal_float_literal",Y_.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Fy("hex_float_literal",Y_.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Fy("int_literal",Y_.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Fy("uint_literal",Y_.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Fy("ident",Y_.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new Fy("and",Y_.token,"&"),and_and:new Fy("and_and",Y_.token,"&&"),arrow:new Fy("arrow ",Y_.token,"->"),attr:new Fy("attr",Y_.token,"@"),attr_left:new Fy("attr_left",Y_.token,"[["),attr_right:new Fy("attr_right",Y_.token,"]]"),forward_slash:new Fy("forward_slash",Y_.token,"/"),bang:new Fy("bang",Y_.token,"!"),bracket_left:new Fy("bracket_left",Y_.token,"["),bracket_right:new Fy("bracket_right",Y_.token,"]"),brace_left:new Fy("brace_left",Y_.token,"{"),brace_right:new Fy("brace_right",Y_.token,"}"),colon:new Fy("colon",Y_.token,":"),comma:new Fy("comma",Y_.token,","),equal:new Fy("equal",Y_.token,"="),equal_equal:new Fy("equal_equal",Y_.token,"=="),not_equal:new Fy("not_equal",Y_.token,"!="),greater_than:new Fy("greater_than",Y_.token,">"),greater_than_equal:new Fy("greater_than_equal",Y_.token,">="),shift_right:new Fy("shift_right",Y_.token,">>"),less_than:new Fy("less_than",Y_.token,"<"),less_than_equal:new Fy("less_than_equal",Y_.token,"<="),shift_left:new Fy("shift_left",Y_.token,"<<"),modulo:new Fy("modulo",Y_.token,"%"),minus:new Fy("minus",Y_.token,"-"),minus_minus:new Fy("minus_minus",Y_.token,"--"),period:new Fy("period",Y_.token,"."),plus:new Fy("plus",Y_.token,"+"),plus_plus:new Fy("plus_plus",Y_.token,"++"),or:new Fy("or",Y_.token,"|"),or_or:new Fy("or_or",Y_.token,"||"),paren_left:new Fy("paren_left",Y_.token,"("),paren_right:new Fy("paren_right",Y_.token,")"),semicolon:new Fy("semicolon",Y_.token,";"),star:new Fy("star",Y_.token,"*"),tilde:new Fy("tilde",Y_.token,"~"),underscore:new Fy("underscore",Y_.token,"_"),xor:new Fy("xor",Y_.token,"^"),plus_equal:new Fy("plus_equal",Y_.token,"+="),minus_equal:new Fy("minus_equal",Y_.token,"-="),times_equal:new Fy("times_equal",Y_.token,"*="),division_equal:new Fy("division_equal",Y_.token,"/="),modulo_equal:new Fy("modulo_equal",Y_.token,"%="),and_equal:new Fy("and_equal",Y_.token,"&="),or_equal:new Fy("or_equal",Y_.token,"|="),xor_equal:new Fy("xor_equal",Y_.token,"^="),shift_right_equal:new Fy("shift_right_equal",Y_.token,">>="),shift_left_equal:new Fy("shift_left_equal",Y_.token,"<<=")},Ny.storage_class=[Z_.keywords.function,Z_.keywords.private,Z_.keywords.workgroup,Z_.keywords.uniform,Z_.keywords.storage],Ny.access_mode=[Z_.keywords.read,Z_.keywords.write,Z_.keywords.read_write],Ny.sampler_type=[Z_.keywords.sampler,Z_.keywords.sampler_comparison],Ny.sampled_texture_type=[Z_.keywords.texture_1d,Z_.keywords.texture_2d,Z_.keywords.texture_2d_array,Z_.keywords.texture_3d,Z_.keywords.texture_cube,Z_.keywords.texture_cube_array],Ny.multisampled_texture_type=[Z_.keywords.texture_multisampled_2d],Ny.storage_texture_type=[Z_.keywords.texture_storage_1d,Z_.keywords.texture_storage_2d,Z_.keywords.texture_storage_2d_array,Z_.keywords.texture_storage_3d],Ny.depth_texture_type=[Z_.keywords.texture_depth_2d,Z_.keywords.texture_depth_2d_array,Z_.keywords.texture_depth_cube,Z_.keywords.texture_depth_cube_array,Z_.keywords.texture_depth_multisampled_2d],Ny.texture_external_type=[Z_.keywords.texture_external],Ny.any_texture_type=[...Z_.sampled_texture_type,...Z_.multisampled_texture_type,...Z_.storage_texture_type,...Z_.depth_texture_type,...Z_.texture_external_type],Ny.texel_format=[Z_.keywords.r8unorm,Z_.keywords.r8snorm,Z_.keywords.r8uint,Z_.keywords.r8sint,Z_.keywords.r16uint,Z_.keywords.r16sint,Z_.keywords.r16float,Z_.keywords.rg8unorm,Z_.keywords.rg8snorm,Z_.keywords.rg8uint,Z_.keywords.rg8sint,Z_.keywords.r32uint,Z_.keywords.r32sint,Z_.keywords.r32float,Z_.keywords.rg16uint,Z_.keywords.rg16sint,Z_.keywords.rg16float,Z_.keywords.rgba8unorm,Z_.keywords.rgba8unorm_srgb,Z_.keywords.rgba8snorm,Z_.keywords.rgba8uint,Z_.keywords.rgba8sint,Z_.keywords.bgra8unorm,Z_.keywords.bgra8unorm_srgb,Z_.keywords.rgb10a2unorm,Z_.keywords.rg11b10float,Z_.keywords.rg32uint,Z_.keywords.rg32sint,Z_.keywords.rg32float,Z_.keywords.rgba16uint,Z_.keywords.rgba16sint,Z_.keywords.rgba16float,Z_.keywords.rgba32uint,Z_.keywords.rgba32sint,Z_.keywords.rgba32float],Ny.const_literal=[Z_.tokens.int_literal,Z_.tokens.uint_literal,Z_.tokens.decimal_float_literal,Z_.tokens.hex_float_literal,Z_.keywords.true,Z_.keywords.false],Ny.literal_or_ident=[Z_.tokens.ident,Z_.tokens.int_literal,Z_.tokens.uint_literal,Z_.tokens.decimal_float_literal,Z_.tokens.hex_float_literal],Ny.element_count_expression=[Z_.tokens.int_literal,Z_.tokens.uint_literal,Z_.tokens.ident],Ny.template_types=[Z_.keywords.vec2,Z_.keywords.vec3,Z_.keywords.vec4,Z_.keywords.mat2x2,Z_.keywords.mat2x3,Z_.keywords.mat2x4,Z_.keywords.mat3x2,Z_.keywords.mat3x3,Z_.keywords.mat3x4,Z_.keywords.mat4x2,Z_.keywords.mat4x3,Z_.keywords.mat4x4,Z_.keywords.atomic,Z_.keywords.bitcast,...Z_.any_texture_type],Ny.attribute_name=[Z_.tokens.ident,Z_.keywords.block],Ny.assignment_operators=[Z_.tokens.equal,Z_.tokens.plus_equal,Z_.tokens.minus_equal,Z_.tokens.times_equal,Z_.tokens.division_equal,Z_.tokens.modulo_equal,Z_.tokens.and_equal,Z_.tokens.or_equal,Z_.tokens.xor_equal,Z_.tokens.shift_right_equal,Z_.tokens.shift_left_equal],Ny.increment_operators=[Z_.tokens.plus_plus,Z_.tokens.minus_minus];class By{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return-1!=Ny.template_types.indexOf(this.type)}isArrayType(){return this.type==Ny.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class zy{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new By(Ny.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}let t=Ny.none;for(;;){let n=this._findType(e);const i=this._peekAhead();if(">"==e&&(">"==i||"="==i)){let e=!1,t=this._tokens.length-1;for(let n=0;n<5&&t>=0;++n,--t)if(this._tokens[t].type===Ny.tokens.less_than){t>0&&this._tokens[t-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(n),!0}if(n===Ny.none){let i=e,r=0;const o=2;for(let e=0;e<o;++e)if(i+=this._peekAhead(e),n=this._findType(i),n!==Ny.none){r=e;break}if(n===Ny.none)return t!==Ny.none&&(this._current--,this._addToken(t),!0);e=i,this._current+=r+1}if(t=n,this._isAtEnd())break;e+=this._advance()}return t!==Ny.none&&(this._addToken(t),!0)}_findType(e){for(const t in Ny.keywords){const n=Ny.keywords[t];if(this._match(e,n.rule))return n}for(const t in Ny.tokens){const n=Ny.tokens[t];if(this._match(e,n.rule))return n}return Ny.none}_match(e,t){if("string"==typeof t){if(t==e)return!0}else{const n=t.exec(e);if(n&&0==n.index&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new By(e,t,this._line))}}class jy{constructor(){this._tokens=[],this._current=0,this._context=new D_}parse(e){this._initialize(e);let t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}return t}_initialize(e){if(e)if("string"==typeof e){const t=new zy(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return console.error(e,t),{token:e,message:t,toString:function(){return`${t}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ny.eof}_match(e){if(e instanceof Fy)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){let n=t.type;return-1!=e.indexOf(n)}return t.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ny.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ny.keywords.alias)){const e=this._type_alias();return this._consume(Ny.tokens.semicolon,"Expected ';'"),e}if(this._match(Ny.keywords.enable)){const e=this._enable_directive();return this._consume(Ny.tokens.semicolon,"Expected ';'"),e}const e=this._attribute();if(this._check(Ny.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ny.tokens.semicolon,"Expected ';'."),t}if(this._check(Ny.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ny.tokens.semicolon,"Expected ';'."),t}if(this._check(Ny.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Ny.tokens.semicolon,"Expected ';'."),t}if(this._check(Ny.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Ny.tokens.semicolon,"Expected ';'."),t}if(this._check(Ny.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),t}if(this._check(Ny.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(Ny.keywords.fn))return null;const e=this._consume(Ny.tokens.ident,"Expected function name.").toString();this._consume(Ny.tokens.paren_left,"Expected '(' for function arguments.");const t=[];if(!this._check(Ny.tokens.paren_right))do{if(this._check(Ny.tokens.paren_right))break;const e=this._attribute(),n=this._consume(Ny.tokens.ident,"Expected argument name.").toString();this._consume(Ny.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,t.push(new Oy(n,r,e)))}while(this._match(Ny.tokens.comma));this._consume(Ny.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Ny.tokens.arrow)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}const i=this._compound_statement();return new B_(e,t,n,i)}_compound_statement(){const e=[];for(this._consume(Ny.tokens.brace_left,"Expected '{' for block.");!this._check(Ny.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Ny.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ny.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ny.keywords.if))return this._if_statement();if(this._check(Ny.keywords.switch))return this._switch_statement();if(this._check(Ny.keywords.loop))return this._loop_statement();if(this._check(Ny.keywords.for))return this._for_statement();if(this._check(Ny.keywords.while))return this._while_statement();if(this._check(Ny.keywords.continuing))return this._continuing_statement();if(this._check(Ny.keywords.static_assert))return this._static_assert_statement();if(this._check(Ny.tokens.brace_left))return this._compound_statement();let e=null;return e=this._check(Ny.keywords.return)?this._return_statement():this._check([Ny.keywords.var,Ny.keywords.let,Ny.keywords.const])?this._variable_statement():this._match(Ny.keywords.discard)?new ay:this._match(Ny.keywords.break)?new ly:this._match(Ny.keywords.continue)?new cy:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=e&&this._consume(Ny.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ny.keywords.static_assert))return null;let e=this._optional_paren_expression();return new z_(e)}_while_statement(){if(!this._match(Ny.keywords.while))return null;let e=this._optional_paren_expression();const t=this._compound_statement();return new j_(e,t)}_continuing_statement(){if(!this._match(Ny.keywords.continuing))return null;const e=this._compound_statement();return new U_(e)}_for_statement(){if(!this._match(Ny.keywords.for))return null;this._consume(Ny.tokens.paren_left,"Expected '('.");const e=this._check(Ny.tokens.semicolon)?null:this._for_init();this._consume(Ny.tokens.semicolon,"Expected ';'.");const t=this._check(Ny.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(Ny.tokens.semicolon,"Expected ';'.");const n=this._check(Ny.tokens.paren_right)?null:this._for_increment();this._consume(Ny.tokens.paren_right,"Expected ')'.");const i=this._compound_statement();return new V_(e,t,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ny.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ny.tokens.equal)&&(t=this._short_circuit_or_expression()),new G_(e.name,e.type,e.storage,e.access,t)}if(this._match(Ny.keywords.let)){const e=this._consume(Ny.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(Ny.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new W_(e,t,null,null,n)}if(this._match(Ny.keywords.const)){const e=this._consume(Ny.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(Ny.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new H_(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Ny.increment_operators))return this._current=e,null;const n=this._consume(Ny.increment_operators,"Expected increment operator");return new J_(n.type===Ny.tokens.plus_plus?q_.increment:q_.decrement,t)}_assignment_statement(){let e=null;if(this._check(Ny.tokens.brace_right))return null;let t=this._match(Ny.tokens.underscore);if(t||(e=this._unary_expression()),!t&&null==e)return null;const n=this._consume(Ny.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new Q_(X_.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(Ny.tokens.ident))return null;const e=this._current,t=this._consume(Ny.tokens.ident,"Expected function name."),n=this._argument_expression_list();return null===n?(this._current=e,null):new ey(t.lexeme,n)}_loop_statement(){if(!this._match(Ny.keywords.loop))return null;this._consume(Ny.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.push(n);else e.push(t);t=this._statement()}let n=null;return this._match(Ny.keywords.continuing)&&(n=this._compound_statement()),this._consume(Ny.tokens.brace_right,"Expected '}' for loop."),new ty(e,n)}_switch_statement(){if(!this._match(Ny.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(Ny.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(null==t||0==t.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ny.tokens.brace_right,"Expected '}' for switch."),new ny(e,t)}_switch_body(){const e=[];if(this._match(Ny.keywords.case)){const t=this._case_selectors();this._match(Ny.tokens.colon),this._consume(Ny.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(Ny.tokens.brace_right,"Exected '}' for switch case."),e.push(new My(t,n))}if(this._match(Ny.keywords.default)){this._match(Ny.tokens.colon),this._consume(Ny.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(Ny.tokens.brace_right,"Exected '}' for switch default."),e.push(new Ry(t))}if(this._check([Ny.keywords.default,Ny.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){var e,t,n,i;const r=[null!==(t=null===(e=this._shift_expression())||void 0===e?void 0:e.evaluate(this._context).toString())&&void 0!==t?t:""];for(;this._match(Ny.tokens.comma);)r.push(null!==(i=null===(n=this._shift_expression())||void 0===n?void 0:n.evaluate(this._context).toString())&&void 0!==i?i:"");return r}_case_body(){if(this._match(Ny.keywords.fallthrough))return this._consume(Ny.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Ny.keywords.if))return null;const e=this._optional_paren_expression(),t=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let i=null;return this._match(Ny.keywords.else)&&(i=this._compound_statement()),new iy(e,t,n,i)}_match_elseif(){return this._tokens[this._current].type===Ny.keywords.else&&this._tokens[this._current+1].type===Ny.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new ky(t,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(Ny.keywords.return))return null;const e=this._short_circuit_or_expression();return new ry(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ny.tokens.or_or);)e=new Py(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ny.tokens.and_and);)e=new Py(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ny.tokens.or);)e=new Py(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ny.tokens.xor);)e=new Py(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ny.tokens.and);)e=new Py(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([Ny.tokens.equal_equal,Ny.tokens.not_equal])?new Py(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ny.tokens.less_than,Ny.tokens.greater_than,Ny.tokens.less_than_equal,Ny.tokens.greater_than_equal]);)e=new Py(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ny.tokens.shift_left,Ny.tokens.shift_right]);)e=new Py(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ny.tokens.plus,Ny.tokens.minus]);)e=new Py(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ny.tokens.star,Ny.tokens.forward_slash,Ny.tokens.modulo]);)e=new Py(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([Ny.tokens.minus,Ny.tokens.bang,Ny.tokens.tilde,Ny.tokens.star,Ny.tokens.and])?new Cy(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ny.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Ny.tokens.bracket_right,"Expected ']'.");const t=this._postfix_expression();return t&&(e.postfix=t),e}if(this._match(Ny.tokens.period)){const e=this._consume(Ny.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new _y(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(Ny.tokens.ident)){const e=this._previous().toString();if(this._check(Ny.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getStruct(e);return null!=n?new yy(n,t):new vy(e,t)}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return new xy(e,t.value)}return new by(e)}if(this._match(Ny.const_literal))return new wy(parseFloat(this._previous().toString()));if(this._check(Ny.tokens.paren_left))return this._paren_expression();if(this._match(Ny.keywords.bitcast)){this._consume(Ny.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Ny.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return new Ey(e,t)}const e=this._type_decl(),t=this._argument_expression_list();return new Sy(e,t)}_argument_expression_list(){if(!this._match(Ny.tokens.paren_left))return null;const e=[];do{if(this._check(Ny.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ny.tokens.comma));return this._consume(Ny.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ny.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Ny.tokens.paren_right),new Ty([e])}_paren_expression(){this._consume(Ny.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Ny.tokens.paren_right,"Expected ')'."),new Ty([e])}_struct_decl(){if(!this._match(Ny.keywords.struct))return null;const e=this._consume(Ny.tokens.ident,"Expected name for struct.").toString();this._consume(Ny.tokens.brace_left,"Expected '{' for struct body.");const t=[];for(;!this._check(Ny.tokens.brace_right);){const e=this._attribute(),n=this._consume(Ny.tokens.ident,"Expected variable name.").toString();this._consume(Ny.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(Ny.tokens.brace_right)?this._match(Ny.tokens.comma):this._consume(Ny.tokens.comma,"Expected ',' for struct member."),t.push(new Ly(n,r,e))}this._consume(Ny.tokens.brace_right,"Expected '}' after struct body.");const n=new hy(e,t);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(Ny.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Ny.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(Ny.keywords.const))return null;const e=this._consume(Ny.tokens.ident,"Expected variable name");let t=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;if(this._match(Ny.tokens.equal)){const e=this._short_circuit_or_expression();if(e instanceof yy)n=e;else if(e instanceof xy&&e.initializer instanceof yy)n=e.initializer;else try{const t=e.evaluate(this._context);n=new wy(t)}catch(t){n=e}}const i=new H_(e.toString(),t,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(Ny.keywords.let))return null;const e=this._consume(Ny.tokens.ident,"Expected variable name");let t=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;return this._match(Ny.tokens.equal)&&(n=this._const_expression()),new W_(e.toString(),t,"","",n)}_const_expression(){if(this._match(Ny.const_literal))return new _y(this._previous().toString());const e=this._type_decl();this._consume(Ny.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(Ny.tokens.paren_right)&&(t.push(this._const_expression()),this._check(Ny.tokens.comma));)this._advance();return this._consume(Ny.tokens.paren_right,"Expected ')'."),new yy(e,t)}_variable_decl(){if(!this._match(Ny.keywords.var))return null;let e="",t="";this._match(Ny.tokens.less_than)&&(e=this._consume(Ny.storage_class,"Expected storage_class.").toString(),this._match(Ny.tokens.comma)&&(t=this._consume(Ny.access_mode,"Expected access_mode.").toString()),this._consume(Ny.tokens.greater_than,"Expected '>'."));const n=this._consume(Ny.tokens.ident,"Expected variable name");let i=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}return new G_(n.toString(),i,e,t,null)}_override_decl(){if(!this._match(Ny.keywords.override))return null;const e=this._consume(Ny.tokens.ident,"Expected variable name");let t=null;if(this._match(Ny.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return new $_(e.toString(),t,null)}_enable_directive(){const e=this._consume(Ny.tokens.ident,"identity expected.");return new oy(e.toString())}_type_alias(){const e=this._consume(Ny.tokens.ident,"identity expected.");this._consume(Ny.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new sy(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ny.tokens.ident,...Ny.texel_format,Ny.keywords.bool,Ny.keywords.f32,Ny.keywords.i32,Ny.keywords.u32])){const e=this._advance(),t=e.toString();return this._context.structs.has(t)?this._context.structs.get(t):this._context.aliases.has(t)?this._context.aliases.get(t).type:new uy(e.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ny.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Ny.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Ny.tokens.comma)&&(n=this._consume(Ny.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ny.tokens.greater_than,"Expected '>' for type.")),new dy(e,t,n)}if(this._match(Ny.keywords.ptr)){let e=this._previous().toString();this._consume(Ny.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Ny.storage_class,"Expected storage_class for pointer");this._consume(Ny.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(Ny.tokens.comma)&&(i=this._consume(Ny.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ny.tokens.greater_than,"Expected '>' for pointer."),new py(e,t.toString(),n,i)}const t=this._attribute();if(this._match(Ny.keywords.array)){let e=null,n=-1;const i=this._previous();if(this._match(Ny.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";this._match(Ny.tokens.comma)&&(t=this._shift_expression().evaluate(this._context).toString()),this._consume(Ny.tokens.greater_than,"Expected '>' for array."),n=t?parseInt(t):0}return new fy(i.toString(),t,e,n)}return null}_texture_sampler_types(){if(this._match(Ny.sampler_type))return new my(this._previous().toString(),null,null);if(this._match(Ny.depth_texture_type))return new my(this._previous().toString(),null,null);if(this._match(Ny.sampled_texture_type)||this._match(Ny.multisampled_texture_type)){const e=this._previous();this._consume(Ny.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Ny.tokens.greater_than,"Expected '>' for sampler type."),new my(e.toString(),t,null)}if(this._match(Ny.storage_texture_type)){const e=this._previous();this._consume(Ny.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Ny.texel_format,"Invalid texel format.").toString();this._consume(Ny.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Ny.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ny.tokens.greater_than,"Expected '>' for sampler type."),new my(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(Ny.tokens.attr);){const t=this._consume(Ny.attribute_name,"Expected attribute name"),n=new Dy(t.toString(),null);if(this._match(Ny.tokens.paren_left)){if(n.value=this._consume(Ny.literal_or_ident,"Expected attribute value").toString(),this._check(Ny.tokens.comma)){this._advance();do{const e=this._consume(Ny.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Ny.tokens.comma))}this._consume(Ny.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(Ny.tokens.attr_left);){if(!this._check(Ny.tokens.attr_right))do{const t=this._consume(Ny.attribute_name,"Expected attribute name"),n=new Dy(t.toString(),null);if(this._match(Ny.tokens.paren_left)){if(n.value=[this._consume(Ny.literal_or_ident,"Expected attribute value").toString()],this._check(Ny.tokens.comma)){this._advance();do{const e=this._consume(Ny.literal_or_ident,"Expected attribute value").toString();n.value.push(e)}while(this._match(Ny.tokens.comma))}this._consume(Ny.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(Ny.tokens.comma));this._consume(Ny.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==e.length?null:e}}class Uy{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Vy{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Gy extends Uy{constructor(e,t){super(e,t),this.members=[],this.align=0}get isStruct(){return!0}}class $y extends Uy{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class Wy extends Uy{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}!function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"}(K_||(K_={}));class Hy{constructor(e,t,n,i,r,o,s){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=o,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qy{constructor(e,t){this.name=e,this.type=t}}class Xy{constructor(e,t){this.align=e,this.size=t}}class Zy{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class Yy{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class Ky{constructor(e,t=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=t}}class Jy{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Qy{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class ev{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Jy,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}update(e){const t=(new jy).parse(e);for(const e of t)if(e instanceof hy){const t=this._getTypeInfo(e,null);t instanceof Gy&&this.structs.push(t)}else if(e instanceof sy)this.aliases.push(this._getAliasInfo(e));else if(e instanceof $_){const t=e,n=this._getAttributeNum(t.attributes,"id",0),i=null!=t.type?this._getTypeInfo(t.type,t.attributes):null;this.overrides.push(new Qy(t.name,i,t.attributes,n))}else if(this._isUniformVar(e)){const t=e,n=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this._getTypeInfo(t.type,t.attributes),o=new Hy(t.name,r,n,i,t.attributes,K_.Uniform,t.access);this.uniforms.push(o)}else if(this._isStorageVar(e)){const t=e,n=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this._getTypeInfo(t.type,t.attributes),o=this._isStorageTexture(r),s=new Hy(t.name,r,n,i,t.attributes,o?K_.StorageTexture:K_.Storage,t.access);this.storage.push(s)}else if(this._isTextureVar(e)){const t=e,n=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this._getTypeInfo(t.type,t.attributes),o=this._isStorageTexture(r),s=new Hy(t.name,r,n,i,t.attributes,o?K_.StorageTexture:K_.Texture,t.access);o?this.storage.push(s):this.textures.push(s)}else if(this._isSamplerVar(e)){const t=e,n=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this._getTypeInfo(t.type,t.attributes),o=new Hy(t.name,r,n,i,t.attributes,K_.Sampler,t.access);this.samplers.push(o)}else if(e instanceof B_){const t=this._getAttribute(e,"vertex"),n=this._getAttribute(e,"fragment"),i=this._getAttribute(e,"compute"),r=t||n||i;if(r){const t=new Ky(e.name,r.name);t.inputs=this._getInputs(e.args),t.outputs=this._getOutputs(e.returnType),this.entry[r.name].push(t)}}}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(void 0===t&&(t=[]),e instanceof hy)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof hy)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this._getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),o=new Yy(n.name,i,e.name,r);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Yy("",n,t.name,i)}return null}_getInputs(e,t=void 0){void 0===t&&(t=[]);for(const n of e)if(n.type instanceof hy)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof hy)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),o=new Zy(e.name,i,t.name,r);return null!==n&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new qy(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof fy){const n=e,i=this._getTypeInfo(n.format,n.attributes),r=new $y(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof hy){const n=e,i=new Gy(n.name,t);for(const e of n.members){const t=this._getTypeInfo(e.type,e.attributes);i.members.push(new Vy(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof my){const n=e,i=n.format instanceof uy,r=n.format?i?this._getTypeInfo(n.format,null):new Uy(n.format,null):null,o=new Wy(n.name,r,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof dy){const n=e,i=n.format?this._getTypeInfo(n.format,null):null,r=new Wy(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new Uy(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const i=this._getTypeSize(e);if(e.size=null!==(t=null==i?void 0:i.size)&&void 0!==t?t:0,e instanceof $y){const t=this._getTypeSize(e.format);e.stride=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,this._updateTypeInfo(e.format)}e instanceof Gy&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,o=0;for(let s=0,a=e.members.length;s<a;++s){const a=e.members[s],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,o=Math.max(o,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(o,r+i),e.align=o}_getTypeSize(e){var t;if(null==e)return null;const n=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Vy&&(e=e.type),e instanceof Uy){const t=this._getAlias(e.name);null!==t&&(e=t)}{const t=ev._typeInfo[e.name];if(void 0!==t){const r="f16"===e.format?2:1;return new Xy(Math.max(i,t.align/r),Math.max(n,t.size/r))}}{const t=ev._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const r="h"===e.name[e.name.length-1]?2:1;return new Xy(Math.max(i,t.align/r),Math.max(n,t.size/r))}}if(e instanceof $y){let r=e,o=8,s=8;const a=this._getTypeSize(r.format);return null!==a&&(s=a.size,o=a.align),s=r.count*this._getAttributeNum(null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:null,"stride",this._roundUp(o,s)),n&&(s=n),new Xy(Math.max(i,o),Math.max(n,s))}if(e instanceof Gy){let t=0,r=0,o=0,s=0,a=0;for(const n of e.members){const e=this._getTypeSize(n.type);null!==e&&(t=Math.max(e.align,t),o=this._roundUp(e.align,o+s),s=e.size,a=o)}return r=this._roundUp(t,a+s),new Xy(Math.max(i,t),Math.max(n,r))}return null}_isUniformVar(e){return e instanceof G_&&"uniform"==e.storage}_isStorageVar(e){return e instanceof G_&&"storage"==e.storage}_isTextureVar(e){return e instanceof G_&&null!==e.type&&-1!=ev._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof G_&&null!==e.type&&-1!=ev._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let e of i)if(e.name==t)return e;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}function tv(e){return e.format?`${e.name}<${e.format.name}>`:e.name}ev._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ev._textureTypes=Ny.any_texture_type.map((e=>e.name)),ev._samplerTypes=Ny.sampler_type.map((e=>e.name));class nv{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){this.id=e.id||sp("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&bp(this.indices.usage===cp.INDEX)}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}class iv{modules;moduleUniforms;moduleBindings;moduleUniformsChanged;constructor(e){const t=Kl(Object.values(e).filter((e=>e.dependencies)));for(const n of t)e[n.name]=n;np.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[t,n]of Object.entries(e)){const e=t;this.moduleUniforms[e]=n.defaultUniforms||{},this.moduleBindings[e]={}}}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,i=e[n],r=this.modules[n];if(!r){np.warn(`Module ${t} not found`)();continue}const o=this.moduleUniforms[n],s=r.getUniforms?.(i,this.moduleUniforms[n])||i;this.moduleUniforms[n]={...o,...s}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,n]of Object.entries(this.moduleUniforms))for(const[i,r]of Object.entries(n))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(r)};return e}}class rv extends lp{static defaultProps={...lp.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(e,t){super(e,t,rv.defaultProps)}}class ov{static defaultProps={...Tm.defaultProps};device;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new ov(e),e._lumaData.defaultPipelineFactory}constructor(e){this.device=e}createRenderPipeline(e){const t={...Tm.defaultProps,...e},n=this._hashRenderPipeline(t);if(!this._renderPipelineCache[n]){const e=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._renderPipelineCache[n]={pipeline:e,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(e){const t={...rv.defaultProps,...e},n=this._hashComputePipeline(t);if(!this._computePipelineCache[n]){const e=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=n,this._computePipelineCache[n]={pipeline:e,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(e){const t=e.hash,n=e instanceof rv?this._computePipelineCache:this._renderPipelineCache;n[t].useCount--,0===n[t].useCount&&(n[t].pipeline.destroy(),delete n[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return`${t}/${n}V-BL${i}`;{const r=this._getHash(JSON.stringify(e.parameters));return`${t}/${n}V-T${e.topology}P${r}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class sv{static defaultProps={..._m.defaultProps};device;_cache={};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new sv(e),e._lumaData.defaultShaderFactory}constructor(e){this.device=e}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n&&(n.useCount--,0===n.useCount&&(delete this._cache[t],n.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}let av=null,lv=null;class cv{static defaultProps={...Tm.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:dc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;constructor(e,t){this.props={...cv.defaultProps,...t},t=this.props,this.id=t.id||sp("model"),this.device=e,Object.assign(this.userData,t.userData);const n=Object.fromEntries(this.props.modules?.map((e=>[e.name,e]))||[]);this.setShaderInputs(t.shaderInputs||new iv(n));const i=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),r=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){this.props.shaderLayout||=function(e){const t={attributes:[],bindings:[]};let n;try{n=function(e){try{return new ev(e)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw"object"==typeof e&&e?.message&&(t+=`: ${e.message} `),"object"==typeof e&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}(e)}catch(e){return np.error(e.message)(),t}for(const e of n.uniforms){const n=[];for(const t of e.type.members)n.push({name:t.name,type:tv(t.type)});t.bindings.push({type:"uniform",name:e.name,location:e.binding,group:e.group,members:n})}const i=n.entry.vertex[0],r=i?.inputs.length||0;for(let e=0;e<r;e++){const n=i.inputs[e];if("location"===n.locationType){const e=tv(n.type);t.attributes.push({name:n.name,location:n.location,type:e})}}return t}(this.props.source);const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:r});this.source=e,this._getModuleUniforms=t}else{const{vs:e,fs:t,getUniforms:n}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:r});this.vs=e,this.fs=t,this._getModuleUniforms=n}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||ov.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||sv.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&this.updateModuleSettings(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t;this.predraw();try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),ap(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:n}=this.vertexArray,i=n?n.byteLength/("uint32"===n.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&function(e,t){if(t instanceof nv)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:cp.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[r,o]of Object.entries(t.attributes)){let t=r;switch(r){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}i[t]=e.createBuffer({data:o.value,id:`${r}-buffer`});const{value:s,size:a,normalized:l}=o;n.push({name:t,format:h_(s,a,l)})}return{attributes:i,bufferLayout:n,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new nv({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}(this.device,e);t&&(this.setTopology(t.topology||"triangle-list"),this.bufferLayout=uv(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)),this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?uv(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){L_(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new k_(this.shaderInputs.modules);for(const e of Object.keys(this.shaderInputs.modules)){const t=this._uniformStore.getManagedUniformBuffer(this.device,e);this.bindings[`${e}Uniforms`]=t}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){e.indices&&np.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[n,i]of Object.entries(e)){const e=this.bufferLayout.find((e=>hv(e).includes(n)));if(!e){np.warn(`Model(${this.id}): Missing layout for buffer "${n}".`)();continue}const r=hv(e);let o=!1;for(const e of r){const t=this._attributeInfos[e];t&&(this.vertexArray.setBuffer(t.location,i),o=!0)}o||(t?.disableWarnings??this.props.disableWarnings)||np.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${n}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[n,i]of Object.entries(e)){const e=this._attributeInfos[n];e?this.vertexArray.setConstantWebGL(e.location,i):(t?.disableWarnings??this.props.disableWarnings)||np.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){ap(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:t,uniforms:n}=Cm(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Kf?e=Math.max(e,t.texture.updateTimestamp):t instanceof cp||t instanceof Df?e=Math.max(e,t.updateTimestamp):t instanceof Zf||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((t=>t.name===e))||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(np.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=n:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:i}),this._attributeInfos=Rm(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=np.level>3?0:1e4;np.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,np.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:np.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e,t){const n={},i="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const t of e.attributes)t&&(n[`in ${t.location} ${t.name}: ${t.type}`]={[i]:t.stepMode||"vertex"});for(const t of e.varyings||[])n[`out ${t.location} ${t.name}`]={[i]:JSON.stringify(t.accessor)};return n}(this.pipeline.shaderLayout,this.id);np.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[e,n]of Object.entries(this.uniforms))t[e]={value:n};np.table(2,t)();const n=this._getAttributeDebugTable();np.table(2,this._attributeInfos)(),np.table(2,n)(),np.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=np.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&function(e,{id:t,minimap:n,opaque:i,top:r="0",left:o="0",rgbaScale:s=1}){av||(av=document.createElement("canvas"),av.id=t,av.title=t,av.style.zIndex="100",av.style.position="absolute",av.style.top=r,av.style.left=o,av.style.border="blue 1px solid",av.style.transform="scaleY(-1)",document.body.appendChild(av),lv=av.getContext("2d")),av.width===e.width&&av.height===e.height||(av.width=e.width/2,av.height=e.height/2,av.style.width="400px",av.style.height="400px");const a=e.device.readPixelsToArrayWebGL(e),l=lv.createImageData(e.width,e.height);for(let e=0;e<a.length;e+=4)l.data[0+e+0]=a[e+0]*s,l.data[0+e+1]=a[e+1]*s,l.data[0+e+2]=a[e+2]*s,l.data[0+e+3]=i?255:a[e+3]*s;lv.putImageData(l,0,0)}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=u_(t);return(e instanceof cp?new n(e.debugData):e).toString()}}function uv(e,t){const n=[...e];for(const e of t){const t=n.findIndex((t=>t.name===e.name));t<0?n.push(e):n[t]=e}return n}function hv(e){return e.attributes?e.attributes?.map((e=>e.attribute)):[e.name]}class dv{device;model;transformFeedback;static isSupported(e){return"webgl"===e?.info?.type}constructor(e,t=cv.defaultProps){bp(dv.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new cv(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||C_(),topology:t.topology||"point-list",...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(t instanceof cp)return t.readAsync();const{buffer:n,byteOffset:i=0,byteLength:r=n.byteLength}=t;return n.readAsync(i,r)}}function pv(e,t=[],n=0){const i=Math.fround(e),r=e-i;return t[n]=i,t[n+1]=r,t}const fv={ONE:1},mv={name:"fp64-arithmetic",vs:"uniform float ONE;\nvec2 split(float a) {\nconst float SPLIT = 4097.0;\nfloat t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat a_hi = t * ONE - (t - a);\nfloat a_lo = a * ONE - a_hi;\n#else\nfloat a_hi = t - (t - a);\nfloat a_lo = a - a_hi;\n#endif\nreturn vec2(a_hi, a_lo);\n}\nvec2 split2(vec2 a) {\nvec2 b = split(a.x);\nb.y += a.y;\nreturn b;\n}\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat sum = (a + b) * ONE;\nfloat err = b - (sum - a) * ONE;\n#else\nfloat sum = a + b;\nfloat err = b - (sum - a);\n#endif\nreturn vec2(sum, err);\n}\nvec2 twoSum(float a, float b) {\nfloat s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat v = (s * ONE - a) * ONE;\nfloat err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\nfloat v = s - a;\nfloat err = (a - (s - v)) + (b - v);\n#endif\nreturn vec2(s, err);\n}\nvec2 twoSub(float a, float b) {\nfloat s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat v = (s * ONE - a) * ONE;\nfloat err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\nfloat v = s - a;\nfloat err = (a - (s - v)) - (b + v);\n#endif\nreturn vec2(s, err);\n}\nvec2 twoSqr(float a) {\nfloat prod = a * a;\nvec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nfloat err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\na_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\nfloat err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\nreturn vec2(prod, err);\n}\nvec2 twoProd(float a, float b) {\nfloat prod = a * b;\nvec2 a_fp64 = split(a);\nvec2 b_fp64 = split(b);\nfloat err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\na_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\nreturn vec2(prod, err);\n}\nvec2 sum_fp64(vec2 a, vec2 b) {\nvec2 s, t;\ns = twoSum(a.x, b.x);\nt = twoSum(a.y, b.y);\ns.y += t.x;\ns = quickTwoSum(s.x, s.y);\ns.y += t.y;\ns = quickTwoSum(s.x, s.y);\nreturn s;\n}\nvec2 sub_fp64(vec2 a, vec2 b) {\nvec2 s, t;\ns = twoSub(a.x, b.x);\nt = twoSub(a.y, b.y);\ns.y += t.x;\ns = quickTwoSum(s.x, s.y);\ns.y += t.y;\ns = quickTwoSum(s.x, s.y);\nreturn s;\n}\nvec2 mul_fp64(vec2 a, vec2 b) {\nvec2 prod = twoProd(a.x, b.x);\nprod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nprod = split2(prod);\n#endif\nprod = quickTwoSum(prod.x, prod.y);\nprod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nprod = split2(prod);\n#endif\nprod = quickTwoSum(prod.x, prod.y);\nreturn prod;\n}\nvec2 div_fp64(vec2 a, vec2 b) {\nfloat xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nvec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\nvec2 yn = a * xn;\n#endif\nfloat diff = (sub_fp64(a, mul_fp64(b, yn))).x;\nvec2 prod = twoProd(xn, diff);\nreturn sum_fp64(yn, prod);\n}\nvec2 sqrt_fp64(vec2 a) {\nif (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\nif (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\nfloat x = 1.0 / sqrt(a.x);\nfloat yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\nvec2 yn_sqr = twoSqr(yn) * ONE;\n#else\nvec2 yn_sqr = twoSqr(yn);\n#endif\nfloat diff = sub_fp64(a, yn_sqr).x;\nvec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\nreturn sum_fp64(split(yn), prod);\n#else\nreturn sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n",getUniforms:function(){return fv},fp64ify:pv,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let i=0;i<4;++i){const r=4*n+i;pv(e[4*i+n],t,2*r)}return t}};function gv(e){const{source:t,target:n,start:i=0,size:r,getData:o}=e,s=e.end||n.length,a=t.length,l=s-i;if(a>l)return void n.set(t.subarray(0,l),i);if(n.set(t,i),!o)return;let c=a;for(;c<l;){const e=o(c,t);for(let t=0;t<r;t++)n[i+c]=e[t]||0,c++}}function _v(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function yv(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function vv(e){e.push(e.shift())}function bv({device:e,source:t,target:n}){return(!n||n.byteLength<t.byteLength)&&(n?.destroy(),n=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),n}function xv({device:e,buffer:t,attribute:n,fromLength:i,toLength:r,fromStartIndices:o,getData:s=(e=>e)}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,d=o&&h,p=n.isConstant;if(!d&&t&&i>=r)return t;const f=n.value instanceof Float64Array?Float32Array:n.value.constructor,m=p?n.value:new f(n.getBuffer().readSyncWebGL(c,r*f.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!p){const e=s;s=(t,i)=>n.normalizeConstant(e(t,i))}const g=p?(e,t)=>s(m,t):(e,t)=>s(m.subarray(e+c,e+c+l),t),_=t?new Float32Array(t.readSyncWebGL(u,4*i).buffer):new Float32Array(0),y=new Float32Array(r);return function({source:e,target:t,size:n,getData:i,sourceStartIndices:r,targetStartIndices:o}){if(!r||!o)return gv({source:e,target:t,size:n,getData:i}),t;let s=0,a=0;const l=i&&((e,t)=>i(e+a,t)),c=Math.min(r.length,o.length);for(let i=1;i<c;i++){const c=r[i]*n,u=o[i]*n;gv({source:e.subarray(s,c),target:t,start:a,end:u,size:n,getData:l}),s=c,a=u}a<t.length&&gv({source:[],target:t,start:a,size:n,getData:l})}({source:_,target:y,sourceStartIndices:o,targetStartIndices:h,size:l,getData:g}),(!t||t.byteLength<y.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+u,usage:35050})),t.write(y,u),t}class wv{constructor({device:e,attribute:t,timeline:n}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Th(n),this.attribute=t,this.attributeInTransition=function(e){const{device:t,settings:n,value:i}=e,r=new A_(t,n);return r.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),r}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,n=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){const{doublePrecision:n,settings:i,value:r,size:o}=e,s=n&&r instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=e.settings;if(l)for(const e of Object.values(l))a=Math.max(a,e.vertexOffset??0);return(i.noAlloc?r.length:(t+a)*o)*s}(this.attribute,t),this.transition.start({...e,duration:n})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}function Ev(e){return e.doublePrecision&&e.value instanceof Float64Array}const Sv={interpolation:class extends wv{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="interpolation",this.transform=function(e,t){const n=t.size,i=_v(n),r=yv(n),o=t.getBufferLayout();return Ev(t)?new dv(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aFrom64Low;\nin ATTRIBUTE_TYPE aTo;\nin ATTRIBUTE_TYPE aTo64Low;\nout ATTRIBUTE_TYPE vCurrent;\nout ATTRIBUTE_TYPE vCurrent64Low;\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\nvoid main(void) {\n  for (int i=0; i<ATTRIBUTE_SIZE; i++) {\n    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), time);\n    vCurrent[i] = value.x;\n    vCurrent64Low[i] = value.y;\n  }\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*n}]}],modules:[mv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new dv(e,{vs:"#version 300 es\n#define SHADER_NAME interpolation-transition-vertex-shader\n\nuniform float time;\nin ATTRIBUTE_TYPE aFrom;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vCurrent;\n\nvoid main(void) {\n  vCurrent = mix(aFrom, aTo, time);\n  gl_Position = vec4(0.0);\n}\n",bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:o.attributes[0].format}],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();const{buffers:r,attribute:o}=this;vv(r),r[0]=xv({device:this.device,buffer:r[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),r[1]=bv({device:this.device,source:r[0],target:r[1]}),this.setBuffer(r[1]);const{transform:s}=this,a=s.model;let l=Math.floor(this.currentLength/o.size);Ev(o)&&(l/=2),a.setVertexCount(l),o.isConstant?(a.setAttributes({aFrom:r[0]}),a.setConstantAttributes({aTo:o.value})):a.setAttributes({aFrom:r[0],aTo:o.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:r[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:n}=this.transition;let i=n/e;t&&(i=t(i));const{model:r}=this.transform;r.setUniforms({time:i}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends wv{constructor({device:e,attribute:t,timeline:n}){super({device:e,attribute:t,timeline:n}),this.type="spring",this.texture=function(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}(e),this.framebuffer=function(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}(e,this.texture),this.transform=function(e,t){const n=_v(t.size),i=yv(t.size);return new dv(e,{vs:"#version 300 es\n#define SHADER_NAME spring-transition-vertex-shader\n\n#define EPSILON 0.00001\n\nuniform float stiffness;\nuniform float damping;\nin ATTRIBUTE_TYPE aPrev;\nin ATTRIBUTE_TYPE aCur;\nin ATTRIBUTE_TYPE aTo;\nout ATTRIBUTE_TYPE vNext;\nout float vIsTransitioningFlag;\n\nATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {\n  ATTRIBUTE_TYPE velocity = cur - prev;\n  ATTRIBUTE_TYPE delta = dest - cur;\n  ATTRIBUTE_TYPE spring = delta * stiffness;\n  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;\n  return spring + damper + velocity + cur;\n}\n\nvoid main(void) {\n  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;\n  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;\n\n  vNext = getNextValue(aCur, aPrev, aTo);\n  gl_Position = vec4(0, 0, 0, 1);\n  gl_PointSize = 100.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME spring-transition-is-transitioning-fragment-shader\n\nin float vIsTransitioningFlag;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vIsTransitioningFlag == 0.0) {\n    discard;\n  }\n  fragColor = vec4(1.0);\n}",bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){const n=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:r,attribute:o}=this;for(let t=0;t<2;t++)r[t]=xv({device:this.device,buffer:r[t],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});r[2]=bv({device:this.device,source:r[0],target:r[2]}),this.setBuffer(r[1]);const{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?s.setConstantAttributes({aTo:o.value}):s.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:n,transition:i}=this,r=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]}),t.model.setUniforms({stiffness:r.stiffness,damping:r.damping}),t.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),vv(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class Tv{constructor(e,{id:t,timeline:n}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:n}){this.numInstances=n||1;for(const n in e){const i=e[n],r=i.getTransitionSetting(t);r&&this._updateAttribute(n,i,r)}for(const n in this.transitions){const i=e[n];i&&i.getTransitionSetting(t)||this._removeTransition(n)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const n=this.transitions[t];n.inProgress&&(e[t]=n.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(const e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,n){const i=this.transitions[e];let r=!i||i.type!==n.type;if(r){i&&this._removeTransition(e);const o=Sv[n.type];o?this.transitions[e]=new o({attribute:t,timeline:this.timeline,device:this.device}):(rs.error(`unsupported transition type '${n.type}'`)(),r=!1)}(r||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(n,this.numInstances))}}const Av="attributeManager.invalidate";class Cv{constructor(e,{id:t="attribute-manager",stats:n,timeline:i}={}){this.mergeBoundsMemoized=_c(Os),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new Tv(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const n=this._invalidateTrigger(e,t);Bc(Av,this,e,n)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bc(Av,this,"all")}update({data:e,numInstances:t,startIndices:n=null,transitions:i,props:r={},buffers:o={},context:s={}}){let a=!1;Bc("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const i in this.attributes){const l=this.attributes[i],c=l.settings.accessor;l.startIndices=n,l.numInstances=t,r[i]&&rs.removed(`props.${i}`,`data.attributes.${i}`)(),l.setExternalBuffer(o[i])||l.setBinaryValue("string"==typeof c?o[c]:void 0,e.startIndices)||"string"==typeof c&&!o[c]&&l.setConstantValue(r[c])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:r,context:s})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}a&&Bc("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map((e=>this.attributes[e]?.getBounds()));return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:n}=this,i={...n.getAttributes()};for(const r in t){const o=t[r];o.needsRedraw(e)&&!n.hasAttribute(r)&&(i[r]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map((t=>t.getBufferLayout(e)))}_add(e,t){for(const n in e){const i=e[n],r={...i,id:n,size:(i.isIndexed?1:i.size)||1,...t};this.attributes[n]=new A_(this.device,r)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}));this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:n,updateTriggers:i}=this,r=i[e];return r&&r.forEach((e=>{const i=n[e];i&&i.setNeedsUpdate(i.id,t)})),r}_updateAttribute(e){const{attribute:t,numInstances:n}=e;Bc("attribute.updateStart",t),t.constant?t.setConstantValue(t.value):(t.allocate(n)&&Bc("attribute.allocate",t,n),t.updateBuffer(e)&&(this.needsRedraw=!0,Bc("attribute.updateEnd",t,n)))}}const Pv=1e-5;function Iv(e,t,n,i,r){const o=t-e;return(n-t)*r+-o*i+o+t}function Mv(e,t){if(Array.isArray(e)){let n=0;for(let i=0;i<e.length;i++){const r=e[i]-t[i];n+=r*r}return Math.sqrt(n)}return Math.abs(e-t)}const Rv={interpolation:class extends Th{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:n,duration:i,easing:r}}=this,o=r(e/i);this._value=us(t,n,o)}},spring:class extends Th{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:n,stiffness:i}=this.settings,{_prevValue:r=e,_currValue:o=e}=this;let s=function(e,t,n,i,r){if(Array.isArray(n)){const o=[];for(let s=0;s<n.length;s++)o[s]=Iv(e[s],t[s],n[s],i,r);return o}return Iv(e,t,n,i,r)}(r,o,t,n,i);const a=Mv(s,t),l=Mv(s,o);a<Pv&&l<Pv&&(s=t,this.end()),this._prevValue=o,this._currValue=s}}};class Ov{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,n,i){const{transitions:r}=this;if(r.has(e)){const n=r.get(e),{value:i=n.settings.fromValue}=n;t=i,this.remove(e)}if(!(i=T_(i)))return;const o=Rv[i.type];if(!o)return void rs.error(`unsupported transition type '${i.type}'`)();const s=new o(this.timeline);s.start({...i,fromValue:t,toValue:n}),r.set(e,s)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,n]of this.transitions)n.update(),e[t]=n.value,n.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function kv(e,t){if(!e.transitions)return!1;const n={},i=e[Rc];let r=!1;for(const o in e.transitions){const s=i[o],a=s&&s.type;("number"===a||"color"===a||"array"===a)&&Dv(e[o],t[o],s)&&(n[o]=!0,r=!0)}return!!r&&n}function Lv({newProps:e,oldProps:t,ignoreProps:n={},propTypes:i={},triggerName:r="props"}){if(t===e)return!1;if("object"!=typeof e||null===e)return`${r} changed shallowly`;if("object"!=typeof t||null===t)return`${r} changed shallowly`;for(const o of Object.keys(e))if(!(o in n)){if(!(o in t))return`${r}.${o} added`;const n=Dv(e[o],t[o],i[o]);if(n)return`${r}.${o} ${n}`}for(const o of Object.keys(t))if(!(o in n)){if(!(o in e))return`${r}.${o} dropped`;if(!Object.hasOwnProperty.call(e,o)){const n=Dv(e[o],t[o],i[o]);if(n)return`${r}.${o} ${n}`}}return!1}function Dv(e,t,n){let i=n&&n.equal;return i&&!i(e,t,n)?"changed deeply":i||(i=e&&t&&e.equals,!i||i.call(e,t))?i||t===e?null:"changed shallowly":"changed deeply"}function Fv(e,t){if(null===t)return!0;const n=t.extensions,{extensions:i}=e;if(i===n)return!1;if(!n||!i)return!0;if(i.length!==n.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(n[e]))return!0;return!1}function Nv(e,t,n){let i=e.updateTriggers[n];i=null==i?{}:i;let r=t.updateTriggers[n];return r=null==r?{}:r,Lv({oldProps:r,newProps:i,triggerName:n})}function Bv(e,t){if(!t)return e;const n={...e,...t};if("defines"in t&&(n.defines={...e.defines,...t.defines}),"modules"in t&&(n.modules=(e.modules||[]).concat(t.modules),t.modules.some((e=>"project64"===e.name)))){const e=n.modules.findIndex((e=>"project32"===e.name));e>=0&&n.modules.splice(e,1)}if("inject"in t)if(e.inject){const i={...e.inject};for(const e in t.inject)i[e]=(i[e]||"")+t.inject[e];n.inject=i}else n.inject=t.inject;return n}const zv=[0,0,0];function jv(e,t,n=!1){const i=t.projectPosition(e);if(n&&t instanceof Ba){const[n,r,o=0]=e,s=t.getDistanceScales([n,r]);i[2]=o*s.unitsPerMeter[2]}return i}function Uv(e,{viewport:t,modelMatrix:n,coordinateSystem:i,coordinateOrigin:r,offsetMode:o}){let[s,a,l=0]=e;switch(n&&([s,a,l]=Gs([],[s,a,l,1],n)),i){case Ia.LNGLAT:return jv([s,a,l],t,o);case Ia.LNGLAT_OFFSETS:return jv([s+r[0],a+r[1],l+(r[2]||0)],t,o);case Ia.METER_OFFSETS:return jv(va(r,[s,a,l]),t,o);case Ia.CARTESIAN:default:return t.isGeospatial?[s+r[0],a+r[1],l+r[2]]:t.projectPosition([s,a,l])}}const Vv={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Gv={},$v={boolean:{validate:(e,t)=>!0,equal:(e,t,n)=>Boolean(e)===Boolean(t)},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||qv(e)&&(3===e.length||4===e.length),equal:(e,t,n)=>Do(e,t,1)},accessor:{validate(e,t){const n=Xv(e);return"function"===n||n===Xv(t.value)},equal:(e,t,n)=>"function"==typeof t||Do(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||qv(e),equal(e,t,n){const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Do(e,t,r):e===t}},object:{equal(e,t,n){if(n.ignore)return!0;const{compare:i}=n,r=Number.isInteger(i)?i:i?1:0;return i?Do(e,t,r):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,n)=>!n.compare&&!1!==n.ignore||e===t},data:{transform:(e,t,n)=>{if(!e)return e;const{dataTransform:i}=n.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,n)=>{const i=n.context;return i&&i.device?function(e,t,n,i){if(n instanceof Df)return n;n.constructor&&"Object"!==n.constructor.name&&(n={data:n});let r=null;n.compressed&&(r={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const o=t.createTexture({...n,sampler:{...Vv,...r,...i}});return Gv[o.id]=e,o}(n.id,i.device,e,{...t.parameters,...n.props.textureParameters}):null},release:(e,t,n)=>{var i,r;i=n.id,(r=e)&&r instanceof Df&&Gv[r.id]===i&&(r.delete(),delete Gv[r.id])}}};function Wv(e,t){switch(Xv(t)){case"object":return Hv(e,t);case"array":return Hv(e,{type:"array",value:t,compare:!1});case"boolean":return Hv(e,{type:"boolean",value:t});case"number":return Hv(e,{type:"number",value:t});case"function":return Hv(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Hv(e,t){return"type"in t?{name:e,...$v[t.type],...t}:"value"in t?{name:e,type:Xv(t.value),...t}:{name:e,type:"object",value:t}}function qv(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Xv(e){return qv(e)?"array":null===e?"null":typeof e}function Zv(e,t){let n="_mergedDefaultProps";if(t)for(const e of t){const t=e.constructor;t&&(n+=`:${t.extensionName||t.name}`)}return Jv(e,n)||(e[n]=function(e,t){if(!e.prototype)return null;const n=Zv(Object.getPrototypeOf(e)),i=function(e){const t={},n={},i={};for(const[r,o]of Object.entries(e)){const e=o?.deprecatedFor;if(e)i[r]=Array.isArray(e)?e:[e];else{const e=Wv(r,o);t[r]=e,n[r]=e.value}}return{propTypes:t,defaultProps:n,deprecatedProps:i}}(Jv(e,"defaultProps")||{}),r=Object.assign(Object.create(null),n,i.defaultProps),o=Object.assign(Object.create(null),n?.[Rc],i.propTypes),s=Object.assign(Object.create(null),n?.[Oc],i.deprecatedProps);for(const e of t){const t=Zv(e.constructor);t&&(Object.assign(r,t),Object.assign(o,t[Rc]),Object.assign(s,t[Oc]))}return function(e,t){const n=function(e){const t=e.componentName;return t||rs.warn(`${e.name}.componentName not specified`)(),t||e.name}(t);Object.defineProperties(e,{id:{writable:!0,value:n}})}(r,e),function(e,t){const n={},i={};for(const e in t){const r=t[e],{name:o,value:s}=r;r.async&&(n[o]=s,i[o]=Yv(o))}e[kc]=n,e[Lc]={},Object.defineProperties(e,i)}(r,o),function(e,t){for(const n in t)Object.defineProperty(e,n,{enumerable:!1,set(e){const i=`${this.id}: ${n}`;for(const i of t[n])Kv(this,i)||(this[i]=e);rs.deprecated(i,t[n].join("/"))()}})}(r,s),r[Rc]=o,r[Oc]=s,0!==t.length||Kv(e,"_propTypes")||(e._propTypes=o),r}(e,t||[]))}function Yv(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||b_(t)?this[Lc][e]=t:this[Dc][e]=t},get(){if(this[Dc]){if(e in this[Dc])return this[Dc][e]||this[kc][e];if(e in this[Lc]){const t=this[Mc]&&this[Mc].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[kc][e]}}return this[kc][e]}}}function Kv(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Jv(e,t){return Kv(e,t)&&e[t]}let Qv=0;class eb{static{this.componentName="Component"}static{this.defaultProps={}}constructor(...e){this.props=function(e,t){let n;for(let e=t.length-1;e>=0;e--){const i=t[e];"extensions"in i&&(n=i.extensions)}const i=Zv(e.constructor,n),r=Object.create(i);r[Mc]=e,r[Lc]={},r[Dc]={};for(let e=0;e<t.length;++e){const n=t[e];for(const e in n)r[e]=n[e]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=Qv++}clone(e){const{props:t}=this,n={};for(const e in t[kc])e in t[Dc]?n[e]=t[Dc][e]:e in t[Lc]&&(n[e]=t[Lc][e]);return new this.constructor({...t,...n,...e})}}const tb=Object.freeze({});class nb{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||tb}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return Boolean(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Mc]||this.component;const t=e[Dc]||{},n=e[Lc]||e,i=e[kc]||{};for(const e in t){const n=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,n),t[e]=this.getAsyncProp(e)}for(const e in n){const t=n[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){this._didAsyncInputValueChange(e,t)&&("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise?this._watchPromise(e,t):b_(t)?this._resolveAsyncIterable(e,t):this._setPropValue(e,t))}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const n=this.asyncProps[e];return t!==n.resolvedValue&&t!==n.lastValue&&(n.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const n=this.asyncProps[e];n&&(t=this._postProcessValue(n,t),n.resolvedValue=t,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(e,t,n){const i=this.asyncProps[e];i&&n>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=n,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const n=this.asyncProps[e];if(n){n.pendingLoadCount++;const i=n.pendingLoadCount;t.then((t=>{this.component&&(t=this._postProcessValue(n,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))})).catch((t=>{this._onError(e,t)}))}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);const n=this.asyncProps[e];if(!n)return;n.pendingLoadCount++;const i=n.pendingLoadCount;let r=[],o=0;for await(const n of t){if(!this.component)return;const{dataTransform:t}=this.component.props;r=t?t(n,r):r.concat(n),Object.defineProperty(r,"__diff",{enumerable:!1,value:[{startRow:o,endRow:r.length}]}),o=r.length,this._setAsyncPropValue(e,r,i)}this._onResolve(e,r)}_postProcessValue(e,t){const n=e.type;return n&&this.component&&(n.release&&n.release(e.resolvedValue,n,this.component),n.transform)?n.transform(t,n,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Rc];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class ib extends nb{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const n=this.layer,i=n?.props.fetch;return i?i(t,{propName:e,layer:n}):super._fetch(e,t)}_onResolve(e,t){const n=this.layer;if(n){const i=n.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:n})}}_onError(e,t){const n=this.layer;n&&n.raiseError(t,`loading ${e} of ${this.layer}`)}}const rb=2**24-1,ob=Object.freeze([]),sb=_c((({oldViewport:e,viewport:t})=>e.equals(t)));let ab=new Uint8ClampedArray(0);const lb={data:{type:"data",value:ob,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:n,loaders:i,loadOptions:r,signal:o})=>{const{resourceManager:s}=n.context;r=r||n.getLoadOptions(),i=i||n.props.loaders,o&&(r={...r,fetch:{...r?.fetch,signal:o}});let a=s.contains(e);return a||r||(s.add({resourceId:e,data:gh(e,i),persistent:!1}),a=!0),a?s.subscribe({resourceId:e,onChange:e=>n.internalState?.reloadAsyncProp(t,e),consumerId:n.id,requestId:t}):gh(e,i,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ia.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,100*-e]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class cb extends eb{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static{this.defaultProps=lb}static{this.layerName="Layer"}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ha(this.internalState);const t=this.internalState.viewport||this.context.viewport,n=Uv(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,r,o]=wa(n,t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,o]}unproject(e){return Ha(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return Ha(this.internalState),function(e,t){const{viewport:n,coordinateSystem:i,coordinateOrigin:r,modelMatrix:o,fromCoordinateSystem:s,fromCoordinateOrigin:a}=function(e){const{viewport:t,modelMatrix:n,coordinateOrigin:i}=e;let{coordinateSystem:r,fromCoordinateSystem:o,fromCoordinateOrigin:s}=e;return r===Ia.DEFAULT&&(r=t.isGeospatial?Ia.LNGLAT:Ia.CARTESIAN),void 0===o&&(o=r),void 0===s&&(s=i),{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:s}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=zv,shaderCoordinateOrigin:u=zv,offsetMode:h=!1}=l?Sc(n,i,r):{},d=Uv(e,{viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:a,offsetMode:h});if(h){const e=n.projectPosition(c||u);bs(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const t of this.getModels())t.updateModuleSettings(e)}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ia.DEFAULT||e===Ia.LNGLAT||e===Ia.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ha(e instanceof Uint8Array);const[t,n,i]=e;return t+256*n+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(e){if(null===(t=e)||"object"!=typeof t)throw new Error("count(): argument not an object");var t;if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(function(e){return null!==e&&"object"==typeof e&&e.constructor===Object}(e))return Object.keys(e).length;throw new Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=Bv(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Bv(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:n}=e.changeFlags;if(n&&t)if(Array.isArray(n))for(const e of n)t.invalidateAll(e);else t.invalidateAll();if(t){const{props:n}=e,i=this.internalState.hasPickingBuffer,r=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some((e=>e.getNeedsPickingBuffer.call(this,e)));if(i!==r){this.internalState.hasPickingBuffer=r;const{pickingColors:e,instancePickingColors:n}=t.attributes,i=e||n;i&&(r&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||r||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(const e of this.getModels())e.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e)}getPickingInfo({info:e,mode:t,sourceLayer:n}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,t&&sb({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const n in e)e[n].layoutChanged()&&(t=!0);for(const n of this.getModels())this._setModelAttributes(n,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,n=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:n,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const r=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(r)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),n=Object.create(this.props);for(const e in t)Object.defineProperty(n,e,{value:t[e]});return n}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const n=Math.floor(ab.length/4);if(this.internalState.usesPickingColorCache=!0,n<t){t>rb&&rs.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),ab=os.allocate(ab,t,{size:4,copy:!0,maxCount:Math.max(t,rb)});const e=Math.floor(ab.length/4),i=[];for(let t=n;t<e;t++)this.encodePickingColor(t,i),ab[4*t+0]=i[0],ab[4*t+1]=i[1],ab[4*t+2]=i[2]}e.value=ab.subarray(0,4*t)}_setModelAttributes(e,t,n=!1){if(!Object.keys(t).length)return;if(n){const n=this.getAttributeManager();e.setBufferLayout(n.getBufferLayouts(e)),t=n.getAttributes()}const i=e.userData?.excludeAttributes||{},r={},o={};for(const n in t){if(i[n])continue;const s=t[n].getValue();for(const i in s){const a=s[i];a instanceof cp?t[n].settings.isIndexed?e.setIndexBuffer(a):r[i]=a:a&&(o[i]=a)}}e.setAttributes(r),e.setConstantAttributes(o)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,r=n||i,o=r&&t.attributes&&t.attributes[r.id];if(o&&o.value){const n=o.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){const t=r.getVertexOffset(e);n[t]===i[0]&&n[t+1]===i[1]&&n[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:n}=this.getAttributeManager().attributes,i=t||n;if(!i)return;const r=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-r),r)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,n=e||t;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==ab.buffer&&(n.value=ab.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){Ha(!this.internalState),Ha(Number.isFinite(this.props.coordinateSystem)),Bc("layer.initialize",this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ib({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(rs.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Ov(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const e of this.props.extensions)e.initializeState.call(this,this.context,e);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bc("layer.matched",this,this===e);const{state:t,internalState:n}=e;this!==e&&(this.internalState=n,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bc("layer.update",this,e),!e)return;const t=this.props,n=this.context,i=this.internalState,r=n.viewport,o=this._updateUniformTransition();i.propsInTransition=o,n.viewport=i.viewport||r,this.props=o;try{const e=this._getUpdateParams(),t=this.getModels();if(n.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(const t of this.props.extensions)t.updateState.call(this,e,t);const i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{n.viewport=r,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Bc("layer.finalize",this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:t=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const r=this.props,o=this.context;this.props=this.internalState.propsInTransition||r;const s=this.props.opacity;n.opacity=Math.pow(s,1/2.2);try{if(t){const{isActive:e,isAttribute:n}=t.picking;this.setModuleParameters(t),this.setShaderModuleProps({picking:{isActive:e,isAttribute:n}})}const{getPolygonOffset:r}=this.props,s=r&&r(n)||[0,0];o.device.setParametersWebGL({polygonOffset:s});for(const e of this.getModels())e.setParameters(i);o.device.withParametersWebGL(i,(()=>{const r={renderPass:e,moduleParameters:t,uniforms:n,parameters:i,context:o};for(const e of this.props.extensions)e.draw.call(this,r,e);this.draw(r)}))}finally{this.props=r}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let i=!1;if("dataChanged"===n){const r=e[n],o=t[n];r&&Array.isArray(o)&&(t.dataChanged=Array.isArray(r)?o.concat(r):r,i=!0)}t[n]||(t[n]=e[n],i=!0),i&&Bc("layer.changeFlag",this,n,e)}const n=Boolean(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=n,t.somethingChanged=n||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const n=function(e,t){const n=Lv({newProps:e,oldProps:t,propTypes:e[Rc],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:r}=e;return i?i(e.data,t.data)||(n="Data comparator detected a change"):e.data!==t.data&&(n="A new data container was supplied"),n&&r&&(n=r(e.data,t.data)||n),n}(e,t);let r=!1;return i||(r=function(e,t){if(null===t)return{all:!0};if("all"in e.updateTriggers&&Nv(e,t,"all"))return{all:!0};const n={};let i=!1;for(const r in e.updateTriggers)"all"!==r&&Nv(e,t,r)&&(n[r]=!0,i=!0);return!!i&&n}(e,t)),{dataChanged:i,propsChanged:n,updateTriggersChanged:r,extensionsChanged:Fv(e,t),transitionsChanged:kv(e,t)}}(e,t);if(n.updateTriggersChanged)for(const e in n.updateTriggersChanged)n.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(n.transitionsChanged)for(const i in n.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(n)}validateProps(){!function(e){const t=e[Rc];for(const n in t){const i=t[n],{validate:r}=i;if(r&&!r(e[n],i))throw new Error(`Invalid prop ${n}: ${e[n]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:n}=this.props;e.picked&&"function"==typeof n&&(t.highlightColor=n(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Cv(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:n,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const r=this.state.model;r?.isInstanced&&r.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:s,highlightColor:a}=n;if(t||i.autoHighlight!==o||i.highlightedObjectIndex!==s||i.highlightColor!==a){const e={};o||(e.highlightedObjectColor=null),Array.isArray(a)&&(e.highlightColor=a),(t||s!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),i=!!n&&n.getNeedsRedraw(e);if(t=t||i,t)for(const e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}const ub={position:"absolute",zIndex:-1};function hb(e,t){if("function"==typeof e)return e(t);if(Array.isArray(e))return e.map((e=>hb(e,t)));if(db(e)){if(n=e,n.props?.mapStyle)return t.style=ub,(0,r.cloneElement)(e,t);if(function(e){const t=e.type;return t&&t.deckGLViewProps}(e))return(0,r.cloneElement)(e,t)}var n;return e}function db(e){return e&&"object"==typeof e&&"type"in e||!1}function pb(e){if("function"==typeof e)return(0,r.createElement)(Sh,{},e);if(Array.isArray(e))return e.map(pb);if(db(e)){if(e.type===r.Fragment)return pb(e.props.children);if(l_(e.type,Sh))return e}return e}const fb={mixBlendMode:null};function mb(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}const gb=r.forwardRef((function(e,t){const[n,i]=(0,r.useState)(0),o=(0,r.useRef)({control:null,version:n,forceUpdate:()=>i((e=>e+1))}),s=o.current,a=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useMemo)((()=>function({children:e,layers:t=[],views:n=null}){const i=[],o=[],s={};return r.Children.forEach(pb(e),(e=>{if(db(e)){const t=e.type;if(l_(t,cb)){const n=function(e,t){const n={},i=e.defaultProps||{};for(const e in t)i[e]!==t[e]&&(n[e]=t[e]);return new e(n)}(t,e.props);o.push(n)}else i.push(e);if(l_(t,Sh)&&t!==Sh&&e.props.id){const n=new t(e.props);s[n.id]=n}}else e&&i.push(e)})),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach((e=>{s[e.id]=e})):n&&(s[n.id]=n),n=Object.values(s)),{layers:t=o.length>0?[...o,...t]:t,children:i,views:n}}(e)),[e.layers,e.views,e.children]);let u=!0;const h=t=>u&&e.viewState?(s.viewStateUpdateRequested=t,null):(s.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),d=t=>{u?s.interactionStateUpdateRequested=t:(s.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},p=(0,r.useMemo)((()=>{const t={...e,style:null,width:"100%",height:"100%",parent:a.current,canvas:l.current,layers:c.layers,views:c.views,onViewStateChange:h,onInteractionStateChange:d};return delete t._customRender,s.deck&&s.deck.setProps(t),t}),[e]);(0,r.useEffect)((()=>{const t=e.Deck||s_;return s.deck=function(e,t,n){const i=new t({...n,_customRender:t=>{e.redrawReason=t;const n=i.getViewports();e.lastRenderedViewports!==n?e.forceUpdate():mb(e)}});return i}(s,t,{...p,parent:a.current,canvas:l.current}),()=>s.deck?.finalize()}),[]),a_((()=>{mb(s);const{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=s;e&&h(e),t&&d(t)})),(0,r.useImperativeHandle)(t,(()=>function(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}(s)),[]);const f=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:m,width:g="100%",height:_="100%",id:y,style:v}=e,{containerStyle:b,canvasStyle:x}=(0,r.useMemo)((()=>function({width:e,height:t,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(n)for(const e in n)e in fb?r[e]=n[e]:i[e]=n[e];return{containerStyle:i,canvasStyle:r}}({width:g,height:_,style:v})),[g,_,v]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===f||s.version!==n){s.lastRenderedViewports=f,s.version=n;const e=function({children:e,deck:t,ContextProvider:n}){const{viewManager:i}=t||{};if(!i||!i.views.length)return[];const o={},s=i.views[0].id;for(const t of e){let e=s,n=t;db(t)&&l_(t.type,Sh)&&(e=t.props.id||s,n=t.props.children);const r=i.getViewport(e),a=i.getViewState(e);if(r){a.padding=r.padding;const{x:t,y:i,width:s,height:l}=r;n=hb(n,{x:t,y:i,width:s,height:l,viewport:r,viewState:a}),o[e]||(o[e]={viewport:r,children:[]}),o[e].children.push(n)}}return Object.keys(o).map((e=>{const{viewport:i,children:s}=o[e],{x:a,y:l,width:c,height:u}=i,h={position:"absolute",left:a,top:l,width:c,height:u},d=`view-${e}`,p=(0,r.createElement)("div",{key:d,id:d,style:h},...s);if(n){const o={viewport:i,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:n=>{n.viewId=e,t._onViewStateChange(n)}};return(0,r.createElement)(n,{key:d,value:o},p)}return p}))}({children:c.children,deck:s.deck,ContextProvider:m}),t=(0,r.createElement)("canvas",{key:"canvas",id:y||"deckgl-overlay",ref:l,style:x});s.control=(0,r.createElement)("div",{id:`${y||"deckgl"}-wrapper`,ref:a,style:b},[t,e])}return u=!1,s.control})),_b=gb,yb=r.createContext(null);function vb(e,t){if(e===t)return!0;if(!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!vb(e[n],t[n]))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(const i of n){if(!t.hasOwnProperty(i))return!1;if(!vb(e[i],t[i]))return!1}return!0}return!1}function bb(e,t){if(!e.getProjection)return;const n=e.getProjection();vb(n,t.getProjection())||t.setProjection(n)}function xb(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function wb(e,t){const n=t.viewState||t;let i=!1;if("longitude"in n&&"latitude"in n){const t=e.center;e.center=new t.constructor(n.longitude,n.latitude),i=i||t!==e.center}if("zoom"in n){const t=e.zoom;e.zoom=n.zoom,i=i||t!==e.zoom}if("bearing"in n){const t=e.bearing;e.bearing=n.bearing,i=i||t!==e.bearing}if("pitch"in n){const t=e.pitch;e.pitch=n.pitch,i=i||t!==e.pitch}return n.padding&&!e.isPaddingEqual(n.padding)&&(i=!0,e.padding=n.padding),i}const Eb=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Sb(e){if(!e)return null;if("string"==typeof e)return e;if("toJS"in e&&(e=e.toJS()),!e.layers)return e;const t={};for(const n of e.layers)t[n.id]=n;const n=e.layers.map((e=>{let n=null;"interactive"in e&&(n=Object.assign({},e),delete n.interactive);const i=t[e.ref];if(i){n=n||Object.assign({},e),delete n.ref;for(const e of Eb)e in i&&(n[e]=i[e])}return n||e}));return{...e,layers:n}}const Tb={version:8,sources:{},layers:[]},Ab={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Cb={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Pb={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Ib=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Mb=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Rb{constructor(e,t,n){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=e=>{const t=this.props[Pb[e.type]];t?t(e):"error"===e.type&&console.error(e.error)},this._onPointerEvent=e=>{"mousemove"!==e.type&&"mouseout"!==e.type||this._updateHover(e);const t=this.props[Ab[e.type]];t&&(this.props.interactiveLayerIds&&"mouseover"!==e.type&&"mouseout"!==e.type&&(e.features=this._hoveredFeatures||this._queryRenderedFeatures(e.point)),t(e),delete e.features)},this._onCameraEvent=e=>{if(!this._internalUpdate){const t=this.props[Cb[e.type]];t&&t(e)}e.type in this._deferredEvents&&(this._deferredEvents[e.type]=!1)},this._MapClass=e,this.props=t,this._initialize(n)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const t=this.props;this.props=e;const n=this._updateSettings(e,t);n&&this._createShadowTransform(this._map);const i=this._updateSize(e),r=this._updateViewState(e,!0);this._updateStyle(e,t),this._updateStyleComponents(e,t),this._updateHandlers(e,t),(n||i||r&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const n=Rb.savedMaps.pop();if(!n)return null;const i=n.map,r=i.getContainer();for(t.className=r.className;r.childNodes.length>0;)t.appendChild(r.childNodes[0]);i._container=t;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(t)),n.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:s}=e;return s&&(s.bounds?i.fitBounds(s.bounds,{...s.fitBoundsOptions,duration:0}):n._updateViewState(s,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",(()=>i.fire("load"))),i._update(),n}_initialize(e){const{props:t}=this,{mapStyle:n=Tb}=t,i={...t,...t.initialViewState,accessToken:t.mapboxAccessToken||Ob()||null,container:e,style:Sb(n)},r=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[r.longitude||0,r.latitude||0],zoom:r.zoom||0,pitch:r.pitch||0,bearing:r.bearing||0}),t.gl){const e=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=e,t.gl)}const o=new this._MapClass(i);r.padding&&o.setPadding(r.padding),t.cursor&&(o.getCanvas().style.cursor=t.cursor),this._createShadowTransform(o);const s=o._render;o._render=e=>{this._inRender=!0,s.call(o,e),this._inRender=!1};const a=o._renderTaskQueue.run;o._renderTaskQueue.run=e=>{a.call(o._renderTaskQueue,e),this._onBeforeRepaint()},o.on("render",(()=>this._onAfterRepaint()));const l=o.fire;o.fire=this._fireEvent.bind(this,l),o.on("resize",(()=>{this._renderTransform.resize(o.transform.width,o.transform.height)})),o.on("styledata",(()=>{this._updateStyleComponents(this.props,{}),bb(o.transform,this._renderTransform)})),o.on("sourcedata",(()=>this._updateStyleComponents(this.props,{})));for(const e in Ab)o.on(e,this._onPointerEvent);for(const e in Cb)o.on(e,this._onCameraEvent);for(const e in Pb)o.on(e,this._onEvent);this._map=o}recycle(){const e=this.map.getContainer().querySelector("[mapboxgl-children]");null==e||e.remove(),Rb.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const t=function(e){const t=e.clone();return t.pixelsToGLUnits=e.pixelsToGLUnits,t}(e.transform);e.painter.transform=t,this._renderTransform=t}_updateSize(e){const{viewState:t}=e;if(t){const e=this._map;if(t.width!==e.transform.width||t.height!==e.transform.height)return e.resize(),!0}return!1}_updateViewState(e,t){if(this._internalUpdate)return!1;const n=this._map,i=this._renderTransform,{zoom:r,pitch:o,bearing:s}=i,a=n.isMoving();a&&(i.cameraElevationReference="sea");const l=wb(i,{...xb(n.transform),...e});if(a&&(i.cameraElevationReference="ground"),l&&t){const e=this._deferredEvents;e.move=!0,e.zoom||(e.zoom=r!==i.zoom),e.rotate||(e.rotate=s!==i.bearing),e.pitch||(e.pitch=o!==i.pitch)}return a||wb(n.transform,e),l}_updateSettings(e,t){const n=this._map;let i=!1;for(const r of Ib)if(r in e&&!vb(e[r],t[r])){i=!0;const t=n[`set${r[0].toUpperCase()}${r.slice(1)}`];null==t||t.call(n,e[r])}return i}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:t=Tb,styleDiffing:n=!0}=e,i={diff:n};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Sb(t),i),!0}return!1}_updateStyleComponents(e,t){const n=this._map;let i=!1;return n.isStyleLoaded()&&("light"in e&&n.setLight&&!vb(e.light,t.light)&&(i=!0,n.setLight(e.light)),"fog"in e&&n.setFog&&!vb(e.fog,t.fog)&&(i=!0,n.setFog(e.fog)),"terrain"in e&&n.setTerrain&&!vb(e.terrain,t.terrain)&&(e.terrain&&!n.getSource(e.terrain.source)||(i=!0,n.setTerrain(e.terrain)))),i}_updateHandlers(e,t){var n,i;const r=this._map;let o=!1;for(const s of Mb){const a=null===(n=e[s])||void 0===n||n;vb(a,null===(i=t[s])||void 0===i||i)||(o=!0,a?r[s].enable(a):r[s].disable())}return o}_queryRenderedFeatures(e){const t=this._map,n=t.transform,{interactiveLayerIds:i=[]}=this.props;try{return t.transform=this._renderTransform,t.queryRenderedFeatures(e,{layers:i.filter(t.getLayer.bind(t))})}catch(e){return[]}finally{t.transform=n}}_updateHover(e){var t;const{props:n}=this;if(n.interactiveLayerIds&&(n.onMouseMove||n.onMouseEnter||n.onMouseLeave)){const n=e.type,i=(null===(t=this._hoveredFeatures)||void 0===t?void 0:t.length)>0,r=this._queryRenderedFeatures(e.point),o=r.length>0;!o&&i&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=r,o&&!i&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=n}else this._hoveredFeatures=null}_fireEvent(e,t,n){const i=this._map,r=i.transform,o="string"==typeof t?t:t.type;return"move"===o&&this._updateViewState(this.props,!1),o in Cb&&("object"==typeof t&&(t.viewState=xb(r)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,t,n),i.transform=r,i):(e.call(i,t,n),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const t in this._deferredEvents)this._deferredEvents[t]&&e.fire(t);this._internalUpdate=!1;const t=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{bb(this._renderTransform,t),e.transform=t}}}function Ob(){let e=null;if("undefined"!=typeof location){const t=/access_token=([^&\/]*)/.exec(location.search);e=t&&t[1]}try{e=e||process.env.MapboxAccessToken}catch(e){}try{e=e||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch(e){}return e}Rb.savedMaps=[];const kb=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];const Lb="undefined"!=typeof document?r.useLayoutEffect:r.useEffect,Db=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"],Fb=r.createContext(null);function Nb(e,t,n){const i=(0,r.useContext)(yb),[o,s]=(0,r.useState)(null),a=(0,r.useRef)(),{current:l}=(0,r.useRef)({mapLib:null,map:null});(0,r.useEffect)((()=>{const t=e.mapLib;let r,o=!0;return Promise.resolve(t||n).then((t=>{if(!o)return;if(!t)throw new Error("Invalid mapLib");const n="Map"in t?t:t.default;if(!n.Map)throw new Error("Invalid mapLib");if(function(e,t){for(const n of Db)n in t&&(e[n]=t[n]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=t;n&&e.getRTLTextPluginStatus&&"unavailable"===e.getRTLTextPluginStatus()&&e.setRTLTextPlugin(n,(e=>{e&&console.error(e)}),!0)}(n,e),n.supported&&!n.supported(e))throw new Error("Map is not supported by this browser");e.reuseMaps&&(r=Rb.reuse(e,a.current)),r||(r=new Rb(n.Map,e,a.current)),l.map=function(e){if(!e)return null;const t=e.map,n={getMap:()=>t,getCenter:()=>e.transform.center,getZoom:()=>e.transform.zoom,getBearing:()=>e.transform.bearing,getPitch:()=>e.transform.pitch,getPadding:()=>e.transform.padding,getBounds:()=>e.transform.getBounds(),project:n=>{const i=t.transform;t.transform=e.transform;const r=t.project(n);return t.transform=i,r},unproject:n=>{const i=t.transform;t.transform=e.transform;const r=t.unproject(n);return t.transform=i,r},queryTerrainElevation:(n,i)=>{const r=t.transform;t.transform=e.transform;const o=t.queryTerrainElevation(n,i);return t.transform=r,o},queryRenderedFeatures:(n,i)=>{const r=t.transform;t.transform=e.transform;const o=t.queryRenderedFeatures(n,i);return t.transform=r,o}};for(const e of function(e){const t=new Set;let n=e;for(;n;){for(const i of Object.getOwnPropertyNames(n))"_"!==i[0]&&"function"==typeof e[i]&&"fire"!==i&&"setEventedParent"!==i&&t.add(i);n=Object.getPrototypeOf(n)}return Array.from(t)}(t))e in n||kb.includes(e)||(n[e]=t[e].bind(t));return n}(r),l.mapLib=n,s(r),null==i||i.onMapMount(l.map,e.id)})).catch((t=>{const{onError:n}=e;n?n({type:"error",target:null,originalEvent:null,error:t}):console.error(t)})),()=>{o=!1,r&&(null==i||i.onMapUnmount(e.id),e.reuseMaps?r.recycle():r.destroy())}}),[]),Lb((()=>{o&&o.setProps(e)})),(0,r.useImperativeHandle)(t,(()=>l.map),[o]);const c=(0,r.useMemo)((()=>({position:"relative",width:"100%",height:"100%",...e.style})),[e.style]);return r.createElement("div",{id:e.id,ref:a,style:c},o&&r.createElement(Fb.Provider,{value:l},r.createElement("div",{"mapboxgl-children":"",style:{height:"100%"}},e.children)))}const Bb=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function zb(e,t){if(!e||!t)return;const n=e.style;for(const e in t){const i=t[e];Number.isFinite(i)&&!Bb.test(e)?n[e]=`${i}px`:n[e]=i}}function jb(e){return new Set(e?e.trim().split(/\s+/):[])}(0,r.memo)((0,r.forwardRef)((function(e,t){const{map:n,mapLib:i}=(0,r.useContext)(Fb),o=(0,r.useRef)({props:e});o.current.props=e;const s=(0,r.useMemo)((()=>{let t=!1;r.Children.forEach(e.children,(e=>{e&&(t=!0)}));const n={...e,element:t?document.createElement("div"):null},a=new i.Marker(n);return a.setLngLat([e.longitude,e.latitude]),a.getElement().addEventListener("click",(e=>{var t,n;null===(n=(t=o.current.props).onClick)||void 0===n||n.call(t,{type:"click",target:a,originalEvent:e})})),a.on("dragstart",(e=>{var t,n;const i=e;i.lngLat=s.getLngLat(),null===(n=(t=o.current.props).onDragStart)||void 0===n||n.call(t,i)})),a.on("drag",(e=>{var t,n;const i=e;i.lngLat=s.getLngLat(),null===(n=(t=o.current.props).onDrag)||void 0===n||n.call(t,i)})),a.on("dragend",(e=>{var t,n;const i=e;i.lngLat=s.getLngLat(),null===(n=(t=o.current.props).onDragEnd)||void 0===n||n.call(t,i)})),a}),[]);(0,r.useEffect)((()=>(s.addTo(n.getMap()),()=>{s.remove()})),[]);const{longitude:a,latitude:l,offset:c,style:u,draggable:h=!1,popup:d=null,rotation:p=0,rotationAlignment:f="auto",pitchAlignment:m="auto"}=e;return(0,r.useEffect)((()=>{zb(s.getElement(),u)}),[u]),(0,r.useImperativeHandle)(t,(()=>s),[]),s.getLngLat().lng===a&&s.getLngLat().lat===l||s.setLngLat([a,l]),c&&!function(e,t){const n=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0,r=Array.isArray(t)?t[0]:t?t.x:0,o=Array.isArray(t)?t[1]:t?t.y:0;return n===r&&i===o}(s.getOffset(),c)&&s.setOffset(c),s.isDraggable()!==h&&s.setDraggable(h),s.getRotation()!==p&&s.setRotation(p),s.getRotationAlignment()!==f&&s.setRotationAlignment(f),s.getPitchAlignment()!==m&&s.setPitchAlignment(m),s.getPopup()!==d&&s.setPopup(d),(0,gl.createPortal)(e.children,s.getElement())}))),(0,r.memo)((0,r.forwardRef)((function(e,t){const{map:n,mapLib:i}=(0,r.useContext)(Fb),o=(0,r.useMemo)((()=>document.createElement("div")),[]),s=(0,r.useRef)({props:e});s.current.props=e;const a=(0,r.useMemo)((()=>{const t={...e},n=new i.Popup(t);return n.setLngLat([e.longitude,e.latitude]),n.once("open",(e=>{var t,n;null===(n=(t=s.current.props).onOpen)||void 0===n||n.call(t,e)})),n}),[]);if((0,r.useEffect)((()=>{const e=e=>{var t,n;null===(n=(t=s.current.props).onClose)||void 0===n||n.call(t,e)};return a.on("close",e),a.setDOMContent(o).addTo(n.getMap()),()=>{a.off("close",e),a.isOpen()&&a.remove()}}),[]),(0,r.useEffect)((()=>{zb(a.getElement(),e.style)}),[e.style]),(0,r.useImperativeHandle)(t,(()=>a),[]),a.isOpen()&&(a.getLngLat().lng===e.longitude&&a.getLngLat().lat===e.latitude||a.setLngLat([e.longitude,e.latitude]),e.offset&&!vb(a.options.offset,e.offset)&&a.setOffset(e.offset),a.options.anchor===e.anchor&&a.options.maxWidth===e.maxWidth||(a.options.anchor=e.anchor,a.setMaxWidth(e.maxWidth)),a.options.className!==e.className)){const t=jb(a.options.className),n=jb(e.className);for(const e of t)n.has(e)||a.removeClassName(e);for(const e of n)t.has(e)||a.addClassName(e);a.options.className=e.className}return(0,gl.createPortal)(e.children,o)})));const Ub=function(e,t,n,i){const o=(0,r.useContext)(Fb),s=(0,r.useMemo)((()=>e(o)),[]);return(0,r.useEffect)((()=>{const e=i||n||t,r="function"==typeof t&&"function"==typeof n?t:null,a="function"==typeof n?n:"function"==typeof t?t:null,{map:l}=o;return l.hasControl(s)||(l.addControl(s,null==e?void 0:e.position),r&&r(o)),()=>{a&&a(o),l.hasControl(s)&&l.removeControl(s)}}),[]),s},Vb=(0,r.memo)((function(e){const t=Ub((({mapLib:t})=>new t.AttributionControl(e)),{position:e.position});return(0,r.useEffect)((()=>{zb(t._container,e.style)}),[e.style]),null}));(0,r.memo)((function(e){const t=Ub((({mapLib:t})=>new t.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)})),{position:e.position});return(0,r.useEffect)((()=>{zb(t._controlContainer,e.style)}),[e.style]),null})),(0,r.memo)((0,r.forwardRef)((function(e,t){const n=(0,r.useRef)({props:e}),i=Ub((({mapLib:t})=>{const i=new t.GeolocateControl(e),r=i._setupUI;return i._setupUI=e=>{i._container.hasChildNodes()||r(e)},i.on("geolocate",(e=>{var t,i;null===(i=(t=n.current.props).onGeolocate)||void 0===i||i.call(t,e)})),i.on("error",(e=>{var t,i;null===(i=(t=n.current.props).onError)||void 0===i||i.call(t,e)})),i.on("outofmaxbounds",(e=>{var t,i;null===(i=(t=n.current.props).onOutOfMaxBounds)||void 0===i||i.call(t,e)})),i.on("trackuserlocationstart",(e=>{var t,i;null===(i=(t=n.current.props).onTrackUserLocationStart)||void 0===i||i.call(t,e)})),i.on("trackuserlocationend",(e=>{var t,i;null===(i=(t=n.current.props).onTrackUserLocationEnd)||void 0===i||i.call(t,e)})),i}),{position:e.position});return n.current.props=e,(0,r.useImperativeHandle)(t,(()=>i),[]),(0,r.useEffect)((()=>{zb(i._container,e.style)}),[e.style]),null}))),(0,r.memo)((function(e){const t=Ub((({mapLib:t})=>new t.NavigationControl(e)),{position:e.position});return(0,r.useEffect)((()=>{zb(t._container,e.style)}),[e.style]),null})),(0,r.memo)((function(e){const t=Ub((({mapLib:t})=>new t.ScaleControl(e)),{position:e.position}),n=(0,r.useRef)(e),i=n.current;n.current=e;const{style:o}=e;return void 0!==e.maxWidth&&e.maxWidth!==i.maxWidth&&(t.options.maxWidth=e.maxWidth),void 0!==e.unit&&e.unit!==i.unit&&t.setUnit(e.unit),(0,r.useEffect)((()=>{zb(t._container,o)}),[o]),null}));const Gb=Promise.resolve().then(d.t.bind(d,6505,23)),$b=r.forwardRef((function(e,t){return Nb(e,t,Gb)})),Wb=Vb,Hb=$b;class qb extends cb{static{this.layerName="CompositeLayer"}get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:n}=this.props;return n&&n[e]&&n[e].type||t}getSubLayerRow(e,t,n){return e.__source={parent:this,object:t,index:n},e}getSubLayerAccessor(e){if("function"==typeof e){const t={index:-1,data:this.props.data,target:[]};return(n,i)=>n&&n.__source?(t.index=n.__source.index,e(n.__source.object,t)):e(n,i)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:f,fetch:m,operation:g,_subLayerProps:_}=this.props,y={id:"",updateTriggers:{},opacity:t,pickable:n,visible:i,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:u,wrapLongitude:h,positionFormat:d,modelMatrix:p,extensions:f,fetch:m,operation:g},v=_&&e.id&&_[e.id],b=v&&v.updateTriggers,x=e.id||"sublayer";if(v){const t=this.props[Rc],n=e.type?e.type._propTypes:{};for(const e in v){const i=n[e]||t[e];i&&"accessor"===i.type&&(v[e]=this.getSubLayerAccessor(v[e]))}}Object.assign(y,e,v),y.id=`${this.props.id}-${x}`,y.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...b};for(const e of f){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(y,t,{updateTriggers:Object.assign(y.updateTriggers,t.updateTriggers)})}return y}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let n=this.internalState.subLayers;const i=!n||this.needsUpdate();i&&(n=zc(this.renderLayers(),Boolean),this.internalState.subLayers=n),Bc("compositeLayer.renderLayers",this,i,n);for(const e of n)e.parent=this}}function Xb({data:e,getIndex:t,dataRange:n,replace:i}){const{startRow:r=0,endRow:o=1/0}=n,s=e.length;let a=s,l=s;for(let n=0;n<s;n++){const i=t(e[n]);if(a>n&&i>=r&&(a=n),i>=o){l=n;break}}let c=a;const u=l-a!==i.length?e.slice(l):void 0;for(let t=0;t<i.length;t++)e[c++]=i[t];if(u){for(let t=0;t<u.length;t++)e[c++]=u[t];e.length=c}return{startRow:a,endRow:a+i.length}}const Zb={name:"project32",dependencies:[Ac],vs:"\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition\n) {\n  vec3 projectedPosition = project_position(position, position64Low);\n  mat3 rotation;\n  if (project_needs_rotation(projectedPosition, rotation)) {\n    // offset is specified as ENU\n    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe\n    offset = rotation * offset;\n  }\n  commonPosition = vec4(projectedPosition + offset, 1.0);\n  return project_common_position_to_clipspace(commonPosition);\n}\n\nvec4 project_position_to_clipspace(\n  vec3 position, vec3 position64Low, vec3 offset\n) {\n  vec4 commonPosition;\n  return project_position_to_clipspace(position, position64Low, offset, commonPosition);\n}\n"},Yb=new Float32Array([0,1,1,1]),Kb={name:"picking",vs:"uniform pickingUniforms {\nfloat isActive;\nfloat isAttribute;\nfloat isHighlightActive;\nfloat useFloatColors;\nvec3 highlightedObjectColor;\nvec4 highlightColor;\n} picking;\nout vec4 picking_vRGBcolor_Avalid;\nvec3 picking_normalizeColor(vec3 color) {\nreturn picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\nvec4 picking_normalizeColor(vec4 color) {\nreturn picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\nbool picking_isColorZero(vec3 color) {\nreturn dot(color, vec3(1.0)) < 0.00001;\n}\nbool picking_isColorValid(vec3 color) {\nreturn dot(color, vec3(1.0)) > 0.00001;\n}\nbool isVertexHighlighted(vec3 vertexColor) {\nvec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\nreturn\nbool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\nvoid picking_setPickingColor(vec3 pickingColor) {\npickingColor = picking_normalizeColor(pickingColor);\nif (bool(picking.isActive)) {\npicking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\nif (!bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rgb = pickingColor;\n}\n} else {\npicking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n}\n}\nvoid picking_setPickingAttribute(float value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.r = value;\n}\n}\nvoid picking_setPickingAttribute(vec2 value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rg = value;\n}\n}\nvoid picking_setPickingAttribute(vec3 value) {\nif (bool(picking.isAttribute)) {\npicking_vRGBcolor_Avalid.rgb = value;\n}\n}\n",fs:"uniform pickingUniforms {\nfloat isActive;\nfloat isAttribute;\nfloat isHighlightActive;\nfloat useFloatColors;\nvec3 highlightedObjectColor;\nvec4 highlightColor;\n} picking;\nin vec4 picking_vRGBcolor_Avalid;\nvec4 picking_filterHighlightColor(vec4 color) {\nif (picking.isActive > 0.5) {\nreturn color;\n}\nbool selected = bool(picking_vRGBcolor_Avalid.a);\nif (selected) {\nfloat highLightAlpha = picking.highlightColor.a;\nfloat blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\nfloat highLightRatio = highLightAlpha / blendedAlpha;\nvec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\nreturn vec4(blendedRGB, blendedAlpha);\n} else {\nreturn color;\n}\n}\nvec4 picking_filterPickingColor(vec4 color) {\nif (bool(picking.isActive)) {\nif (picking_vRGBcolor_Avalid.a == 0.0) {\ndiscard;\n}\nreturn picking_vRGBcolor_Avalid;\n}\nreturn color;\n}\nvec4 picking_filterColor(vec4 color) {\nvec4 highlightColor = picking_filterHighlightColor(color);\nreturn picking_filterPickingColor(highlightColor);\n}\n",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:Yb},getUniforms:function(e={},t){const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}return void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute)),void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors)),n}},Jb={...Kb,defaultUniforms:{...Kb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":"\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  ","vs:DECKGL_FILTER_COLOR":"\n  picking_setPickingColor(geometry.pickingColor);\n  ","fs:DECKGL_FILTER_COLOR":{order:99,injection:"\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    "}}};class Qb{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||sp("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[e,n]of Object.entries(t)){const t=ArrayBuffer.isView(n)?{value:n}:n;bp(ArrayBuffer.isView(t.value),`${this._print(e)}: must be typed array or object with value as typed array`),"POSITION"!==e&&"positions"!==e||t.size||(t.size=3),"indices"===e?(bp(!this.indices),this.indices=t):this.attributes[e]=t}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const t of Object.values(e)){const{value:e,size:i,constant:r}=t;!r&&e&&i>=1&&(n=Math.min(n,e.length/i))}return bp(Number.isFinite(n)),n}}const ex=()=>{},tx={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},nx={x:0,y:0,width:0,height:0};function ix(e,t,n,i){const r=Math.min(n/t.width,i/t.height),o=Math.floor(t.width*r),s=Math.floor(t.height*r);return 1===r?{data:t,width:o,height:s}:(e.canvas.height=s,e.canvas.width=o,e.clearRect(0,0,o,s),e.drawImage(t,0,0,t.width,t.height,0,0,o,s),{data:e.canvas,width:o,height:s})}function rx(e){return e&&(e.id||e.url)}function ox(e,t,n){for(let i=0;i<t.length;i++){const{icon:r,xOffset:o}=t[i];e[rx(r)]={...r,x:o,y:n}}}class sx{constructor(e,{onUpdate:t=ex,onError:n=ex}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=t,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const t=this._autoPacking?rx(e):e;return this._mapping[t]||nx}setProps({loadOptions:e,autoPacking:t,iconAtlas:n,iconMapping:i,textureParameters:r}){e&&(this._loadOptions=e),void 0!==t&&(this._autoPacking=t),i&&(this._mapping=i),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),r&&(this._textureParameters=r)}get isLoaded(){return 0===this._pendingCount}packIcons(e,t){if(!this._autoPacking||"undefined"==typeof document)return;const n=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};const i={},{iterable:r,objectInfo:o}=v_(e);for(const e of r){o.index++;const r=t(e,o),s=rx(r);if(!r)throw new Error("Icon is missing.");if(!r.url)throw new Error("Icon url is missing.");i[s]||n[s]&&r.url===n[s].url||(i[s]={...r,source:e,sourceIndex:o.index})}return i}(e,t,this._mapping)||{});if(n.length>0){const{mapping:e,xOffset:t,yOffset:i,rowHeight:r,canvasHeight:o}=function({icons:e,buffer:t,mapping:n={},xOffset:i=0,yOffset:r=0,rowHeight:o=0,canvasWidth:s}){let a=[];for(let l=0;l<e.length;l++){const c=e[l];if(!n[rx(c)]){const{height:e,width:l}=c;i+l+t>s&&(ox(n,a,r),i=0,r=o+r+t,o=0,a=[]),a.push({icon:c,xOffset:i}),i=i+l+t,o=Math.max(o,e)}}return a.length>0&&ox(n,a,r),{mapping:n,rowHeight:o,xOffset:i,yOffset:r,canvasWidth:s,canvasHeight:(l=o+r+t,Math.pow(2,Math.ceil(Math.log2(l))))};var l}({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=r,this._mapping=e,this._xOffset=t,this._yOffset=i,this._canvasHeight=o,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||tx})),this._texture.height!==this._canvasHeight&&(this._texture=function(e,t,n,i){const{width:r,height:o,device:s}=e,a=s.createTexture({format:"rgba8unorm",width:t,height:n,sampler:i}),l=s.createCommandEncoder();return l.copyTextureToTexture({source:e,destination:a,width:r,height:o}),l.finish(),e.destroy(),a}(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||tx)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(e){const t=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of e)this._pendingCount++,gh(n.url,this._loadOptions).then((e=>{const i=rx(n),r=this._mapping[i],{x:o,y:s,width:a,height:l}=r,{data:c,width:u,height:h}=ix(t,e,a,l);this._texture.setSubImageData({data:c,x:o+(a-u)/2,y:s+(l-h)/2,width:u,height:h}),r.width=u,r.height=h,this._texture.generateMipmap(),this.onUpdate()})).catch((e=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:e})})).finally((()=>{this._pendingCount--}))}}const ax=[0,0,0,255],lx={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:ax},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class cx extends cb{static{this.defaultProps=lx}static{this.layerName="IconLayer"}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME icon-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceSizes;\nin float instanceAngles;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin vec4 instanceIconFrames;\nin float instanceColorModes;\nin vec2 instanceOffsets;\nin vec2 instancePixelOffset;\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\nuniform int sizeUnits;\nout float vColorMode;\nout vec4 vColor;\nout vec2 vTextureCoords;\nout vec2 uv;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = angle * PI / 180.0;\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvec2 iconSize = instanceIconFrames.zw;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\nfloat instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\nvec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\npixelOffset += instancePixelOffset;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvTextureCoords = mix(\ninstanceIconFrames.xy,\ninstanceIconFrames.xy + iconSize,\n(positions.xy + 1.0) / 2.0\n) / iconsTextureDim;\nvColor = instanceColors;\nDECKGL_FILTER_COLOR(vColor, geometry);\nvColorMode = instanceColorModes;\n}\n",fs:"#version 300 es\n#define SHADER_NAME icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\nin float vColorMode;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec4 texColor = texture(iconsTexture, vTextureCoords);\nvec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\nfloat a = texColor.a * opacity * vColor.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color, a);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Zb,Jb]})}initializeState(){this.state={iconManager:new sx(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:ax},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager(),{iconAtlas:o,iconMapping:s,data:a,getIcon:l,textureParameters:c}=t,{iconManager:u}=this.state;if("string"==typeof o)return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");u.setProps({loadOptions:t.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?s:null,textureParameters:c}),h?n.iconMapping!==t.iconMapping&&r.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&u.packIcons(a,l),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,sizeUnits:r,billboard:o,alphaCutoff:s}=this.props,{iconManager:a}=this.state,l=a.getTexture();if(l){const a=this.state.model;a.setBindings({iconsTexture:l}),a.setUniforms(e),a.setUniforms({iconsTextureDim:[l.width,l.height],sizeUnits:Ra[r],sizeScale:t,sizeMinPixels:n,sizeMaxPixels:i,billboard:o,alphaCutoff:s}),a.draw(this.context.renderPass)}}_getModel(){return new cv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qb({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([-1,-1,1,-1,-1,1,1,1])}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){const t=this.getCurrentLayer()?.props.onIconError;t?t(e):rs.error(e.error.message)()}getInstanceOffset(e){const{width:t,height:n,anchorX:i=t/2,anchorY:r=n/2}=this.state.iconManager.getIconMapping(e);return[t/2-i,n/2-r]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:t,y:n,width:i,height:r}=this.state.iconManager.getIconMapping(e);return[t,n,i,r]}}const ux=[0,0,0,255],hx={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:ux},getLineColor:{type:"accessor",value:ux},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class dx extends cb{static{this.defaultProps=hx}static{this.layerName="ScatterplotLayer"}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-vertex-shader\nin vec3 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin float instanceRadius;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool antialiasing;\nuniform bool billboard;\nuniform int radiusUnits;\nuniform int lineWidthUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout vec2 unitPosition;\nout float innerUnitRadius;\nout float outerRadiusPixels;\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\nouterRadiusPixels = clamp(\nproject_size_to_pixel(radiusScale * instanceRadius, radiusUnits),\nradiusMinPixels, radiusMaxPixels\n);\nfloat lineWidthPixels = clamp(\nproject_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),\nlineWidthMinPixels, lineWidthMaxPixels\n);\nouterRadiusPixels += stroked * lineWidthPixels / 2.0;\nfloat edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;\nunitPosition = edgePadding * positions.xy;\ngeometry.uv = unitPosition;\ngeometry.pickingColor = instancePickingColors;\ninnerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\nif (billboard) {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = edgePadding * positions * outerRadiusPixels;\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME scatterplot-layer-fragment-shader\nprecision highp float;\nuniform bool filled;\nuniform float stroked;\nuniform bool antialiasing;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin vec2 unitPosition;\nin float innerUnitRadius;\nin float outerRadiusPixels;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = unitPosition;\nfloat distToCenter = length(unitPosition) * outerRadiusPixels;\nfloat inCircle = antialiasing ?\nsmoothedge(distToCenter, outerRadiusPixels) :\nstep(distToCenter, outerRadiusPixels);\nif (inCircle == 0.0) {\ndiscard;\n}\nif (stroked > 0.5) {\nfloat isLine = antialiasing ?\nsmoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :\nstep(innerUnitRadius * outerRadiusPixels, distToCenter);\nif (filled) {\nfragColor = mix(vFillColor, vLineColor, isLine);\n} else {\nif (isLine == 0.0) {\ndiscard;\n}\nfragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n}\n} else if (!filled) {\ndiscard;\n} else {\nfragColor = vFillColor;\n}\nfragColor.a *= inCircle;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Zb,Jb]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,stroked:o,filled:s,billboard:a,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,p=this.state.model;p.setUniforms(e),p.setUniforms({stroked:o?1:0,filled:s,billboard:a,antialiasing:l,radiusUnits:Ra[t],radiusScale:n,radiusMinPixels:i,radiusMaxPixels:r,lineWidthUnits:Ra[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}),p.draw(this.context.renderPass)}_getModel(){return new cv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qb({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0})}}const px=.75,fx=[],mx={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class gx extends cx{static{this.defaultProps=mx}static{this.layerName="MultiIconLayer"}getShaders(){return{...super.getShaders(),fs:"#version 300 es\n#define SHADER_NAME multi-icon-layer-fragment-shader\nprecision highp float;\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float gamma;\nuniform bool sdf;\nuniform float alphaCutoff;\nuniform float sdfBuffer;\nuniform float outlineBuffer;\nuniform vec4 outlineColor;\nin vec4 vColor;\nin vec2 vTextureCoords;\nin vec2 uv;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nif (!bool(picking.isActive)) {\nfloat alpha = texture(iconsTexture, vTextureCoords).a;\nvec4 color = vColor;\nif (sdf) {\nfloat distance = alpha;\nalpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);\nif (outlineBuffer > 0.0) {\nfloat inFill = alpha;\nfloat inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);\ncolor = mix(outlineColor, vColor, inFill);\nalpha = inBorder;\n}\n}\nfloat a = alpha * color.a;\nif (a < alphaCutoff) {\ndiscard;\n}\nfragColor = vec4(color.rgb, a * opacity);\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(e,{index:t,target:n})=>this.encodePickingColor(t,n)}})}updateState(e){super.updateState(e);const{props:t,oldProps:n}=e;let{outlineColor:i}=t;i!==n.outlineColor&&(i=i.map((e=>e/255)),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!t.sdf&&t.outlineWidth&&rs.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:t,smoothing:n,outlineWidth:i}=this.props,{outlineColor:r}=this.state,o=i?Math.max(n,px*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:px,outlineBuffer:o,gamma:n,sdf:Boolean(t),outlineColor:r},super.draw(e),t&&i){const{iconManager:e}=this.state,t=e.getTexture(),n=this.state.model;t&&(n.setUniforms({outlineBuffer:px}),n.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap((e=>super.getInstanceOffset(e))):fx}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap((e=>super.getInstanceIconFrame(e))):fx}}const _x=1e20;class yx{constructor({fontSize:e=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;const a=this.size=e+4*t,l=this._createCanvas(a),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font=`${s} ${o} ${e}px ${r}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(e),s=Math.ceil(n),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),l=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=a+2*this.buffer,u=l+2*this.buffer,h=Math.max(c*u,0),d=new Uint8ClampedArray(h),p={data:d,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:s,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,l),f.fillText(e,m,m+s);const y=f.getImageData(m,m,a,l);_.fill(_x,0,h),g.fill(0,0,h);for(let e=0;e<l;e++)for(let t=0;t<a;t++){const n=y.data[4*(e*a+t)+3]/255;if(0===n)continue;const i=(e+m)*c+t+m;if(1===n)_[i]=0,g[i]=_x;else{const e=.5-n;_[i]=e>0?e*e:0,g[i]=e<0?e*e:0}}vx(_,0,0,c,u,c,this.f,this.v,this.z),vx(g,m,m,a,l,c,this.f,this.v,this.z);for(let e=0;e<h;e++){const t=Math.sqrt(_[e])-Math.sqrt(g[e]);d[e]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}}function vx(e,t,n,i,r,o,s,a,l){for(let c=t;c<t+i;c++)bx(e,n*o+c,o,r,s,a,l);for(let c=n;c<n+r;c++)bx(e,c*o+t,1,i,s,a,l)}function bx(e,t,n,i,r,o,s){o[0]=0,s[0]=-_x,s[1]=_x,r[0]=e[t];for(let a=1,l=0,c=0;a<i;a++){r[a]=e[t+a*n];const i=a*a;do{const e=o[l];c=(r[a]-r[e]+i-e*e)/(a-e)/2}while(c<=s[l]&&--l>-1);l++,o[l]=a,s[l]=c,s[l+1]=_x}for(let a=0,l=0;a<i;a++){for(;s[l+1]<a;)l++;const i=o[l],c=a-i;e[t+a*n]=r[i]+c*c}}const xx=[];function wx(e,t,n,i){let r=0;for(let o=t;o<n;o++){const t=e[o];r+=i[t]?.layoutWidth||0}return r}function Ex(e,t,n,i,r,o){let s=t,a=0;for(let l=t;l<n;l++){const t=wx(e,l,l+1,r);a+t>i&&(s<l&&o.push(l),s=l,a=0),a+=t}return a}function Sx(e,t,n,i,r=0,o){void 0===o&&(o=e.length);const s=[];return"break-all"===t?Ex(e,r,o,n,i,s):function(e,t,n,i,r,o){let s=t,a=t,l=t,c=0;for(let u=t;u<n;u++)if(" "===e[u]?l=u+1:" "!==e[u+1]&&u+1!==n||(l=u+1),l>a){let t=wx(e,a,l,r);c+t>i&&(s<a&&(o.push(a),s=a,c=0),t>i&&(t=Ex(e,a,l,i,r,o),s=o[o.length-1])),a=l,c+=t}}(e,r,o,n,i,s),s}function Tx(e,t,n,i,r,o){let s=0,a=0;for(let o=t;o<n;o++){const t=e[o],n=i[t];n?(a||(a=n.layoutHeight),r[o]=s+n.layoutWidth/2,s+=n.layoutWidth):(rs.warn(`Missing character: ${t} (${t.codePointAt(0)})`)(),r[o]=s,s+=32)}o[0]=s,o[1]=a}class Ax{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}set(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const t=this._order.indexOf(e);t>=0&&this._order.splice(t,1)}_appendOrder(e){this._order.push(e)}}const Cx={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:function(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1};let Px=new Ax(3);function Ix(e,t){for(let n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function Mx(e,t,n,i){e.font=`${i} ${n}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}class Rx{constructor(){this.props={...Cx}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:t}=this.props;return(1.2*e+2*t)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const t=function(e,t){let n;n="string"==typeof t?new Set(Array.from(t)):new Set(t);const i=Px.get(e);if(!i)return n;for(const e in i.mapping)n.has(e)&&n.delete(e);return n}(this._key,this.props.characterSet),n=Px.get(this._key);if(n&&0===t.size)return void(this._atlas!==n&&(this._atlas=n));const i=this._generateFontAtlas(t,n);this._atlas=i,Px.set(this._key,i)}_generateFontAtlas(e,t){const{fontFamily:n,fontWeight:i,fontSize:r,buffer:o,sdf:s,radius:a,cutoff:l}=this.props;let c=t&&t.data;c||(c=document.createElement("canvas"),c.width=1024);const u=c.getContext("2d",{willReadFrequently:!0});Mx(u,n,r,i);const{mapping:h,canvasHeight:d,xOffset:p,yOffset:f}=function({characterSet:e,getFontWidth:t,fontHeight:n,buffer:i,maxCanvasWidth:r,mapping:o={},xOffset:s=0,yOffset:a=0}){let l=0,c=s;const u=n+2*i;for(const s of e)if(!o[s]){const e=t(s);c+e+2*i>r&&(c=0,l++),o[s]={x:c+i,y:a+l*u+i,width:e,height:u,layoutWidth:e,layoutHeight:n},c+=e+2*i}return{mapping:o,xOffset:c,yOffset:a+l*u,canvasHeight:(h=a+(l+1)*u,Math.pow(2,Math.ceil(Math.log2(h))))};var h}({getFontWidth:e=>u.measureText(e).width,fontHeight:1.2*r,buffer:o,characterSet:e,maxCanvasWidth:1024,...t&&{mapping:t.mapping,xOffset:t.xOffset,yOffset:t.yOffset}});if(c.height!==d){const e=u.getImageData(0,0,c.width,c.height);c.height=d,u.putImageData(e,0,0)}if(Mx(u,n,r,i),s){const t=new yx({fontSize:r,buffer:o,radius:a,cutoff:l,fontFamily:n,fontWeight:`${i}`});for(const n of e){const{data:e,width:i,height:o,glyphTop:s}=t.draw(n);h[n].width=i,h[n].layoutOffsetY=.9*r-s;const a=u.createImageData(i,o);Ix(e,a),u.putImageData(a,h[n].x,h[n].y)}}else for(const t of e)u.fillText(t,h[t].x,h[t].y+o+.9*r);return{xOffset:p,yOffset:f,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:e,fontWeight:t,fontSize:n,buffer:i,sdf:r,radius:o,cutoff:s}=this.props;return r?`${e} ${t} ${n} ${i} ${o} ${s}`:`${e} ${t} ${n} ${i}`}}const Ox={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class kx extends cb{static{this.defaultProps=Ox}static{this.layerName="TextBackgroundLayer"}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME text-background-layer-vertex-shader\nin vec2 positions;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceRects;\nin float instanceSizes;\nin float instanceAngles;\nin vec2 instancePixelOffsets;\nin float instanceLineWidths;\nin vec4 instanceFillColors;\nin vec4 instanceLineColors;\nin vec3 instancePickingColors;\nuniform bool billboard;\nuniform float opacity;\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec4 padding;\nuniform int sizeUnits;\nout vec4 vFillColor;\nout vec4 vLineColor;\nout float vLineWidth;\nout vec2 uv;\nout vec2 dimensions;\nvec2 rotate_by_angle(vec2 vertex, float angle) {\nfloat angle_radian = radians(angle);\nfloat cos_angle = cos(angle_radian);\nfloat sin_angle = sin(angle_radian);\nmat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\nreturn rotationMatrix * vertex;\n}\nvoid main(void) {\ngeometry.worldPosition = instancePositions;\ngeometry.uv = positions;\ngeometry.pickingColor = instancePickingColors;\nuv = positions;\nvLineWidth = instanceLineWidths;\nfloat sizePixels = clamp(\nproject_size_to_pixel(instanceSizes * sizeScale, sizeUnits),\nsizeMinPixels, sizeMaxPixels\n);\ndimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;\nvec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);\npixelOffset = rotate_by_angle(pixelOffset, instanceAngles);\npixelOffset += instancePixelOffsets;\npixelOffset.y *= -1.0;\nif (billboard)  {\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nvec3 offset = vec3(pixelOffset, 0.0);\nDECKGL_FILTER_SIZE(offset, geometry);\ngl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n} else {\nvec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\nDECKGL_FILTER_SIZE(offset_common, geometry);\ngl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nvFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\nDECKGL_FILTER_COLOR(vFillColor, geometry);\nvLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\nDECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME text-background-layer-fragment-shader\nprecision highp float;\nuniform bool stroked;\nin vec4 vFillColor;\nin vec4 vLineColor;\nin float vLineWidth;\nin vec2 uv;\nin vec2 dimensions;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = uv;\nvec2 pixelPosition = uv * dimensions;\nif (stroked) {\nfloat distToEdge = min(\nmin(pixelPosition.x, dimensions.x - pixelPosition.x),\nmin(pixelPosition.y, dimensions.y - pixelPosition.y)\n);\nfloat isBorder = smoothedge(distToEdge, vLineWidth);\nfragColor = mix(vFillColor, vLineColor, isBorder);\n} else {\nfragColor = vFillColor;\n}\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Zb,Jb]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:t}=e;t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:t,sizeScale:n,sizeUnits:i,sizeMinPixels:r,sizeMaxPixels:o,getLineWidth:s}=this.props;let{padding:a}=this.props;a.length<4&&(a=[a[0],a[1],a[0],a[1]]);const l=this.state.model;l.setUniforms(e),l.setUniforms({billboard:t,stroked:Boolean(s),padding:a,sizeUnits:Ra[i],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:o}),l.draw(this.context.renderPass)}_getModel(){return new cv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qb({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array([0,0,1,0,1,1,0,1])}}}),isInstanced:!0})}}const Lx={start:1,middle:0,end:-1},Dx={top:1,center:0,bottom:-1},Fx=[0,0,0,255],Nx={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Fx},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Cx.characterSet},fontFamily:Cx.fontFamily,fontWeight:Cx.fontWeight,lineHeight:1,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Fx},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:Fx},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Bx extends qb{constructor(){super(...arguments),this.getBoundingRect=(e,t)=>{let{size:[n,i]}=this.transformParagraph(e,t);const{fontSize:r}=this.state.fontAtlasManager.props;n/=r,i/=r;const{getTextAnchor:o,getAlignmentBaseline:s}=this.props;return[(Lx["function"==typeof o?o(e,t):o]-1)*n/2,(Dx["function"==typeof s?s(e,t):s]-1)*i/2,n,i]},this.getIconOffsets=(e,t)=>{const{getTextAnchor:n,getAlignmentBaseline:i}=this.props,{x:r,y:o,rowWidth:s,size:[a,l]}=this.transformParagraph(e,t),c=Lx["function"==typeof n?n(e,t):n],u=Dx["function"==typeof i?i(e,t):i],h=r.length,d=new Array(2*h);let p=0;for(let e=0;e<h;e++){const t=(1-c)*(a-s[e])/2;d[p++]=(c-1)*a/2+t+r[e],d[p++]=(u-1)*l/2+o[e]}return d}}static{this.defaultProps=Nx}static{this.layerName="TextLayer"}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Rx},this.props.maxWidth>0&&rs.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:t,oldProps:n,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||t.lineHeight!==n.lineHeight||t.wordBreak!==n.wordBreak||t.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:t,fontWeight:n}=this.props,{fontAtlasManager:i,characterSet:r}=this.state,o={...e,characterSet:r,fontFamily:t,fontWeight:n};if(!i.mapping)return i.setProps(o),!0;for(const e in o)if(o[e]!==i.props[e])return i.setProps(o),!0;return!1}_updateText(){const{data:e,characterSet:t}=this.props,n=e.attributes?.getText;let i,{getText:r}=this.props,o=e.startIndices;const s="auto"===t&&new Set;if(n&&o){const{texts:t,characterCount:a}=function({value:e,length:t,stride:n,offset:i,startIndices:r,characterSet:o}){const s=e.BYTES_PER_ELEMENT,a=n?n/s:1,l=i?i/s:0,c=r[t]||Math.ceil((e.length-l)/a),u=o&&new Set,h=new Array(t);let d=e;if(a>1||l>0){d=new(0,e.constructor)(c);for(let t=0;t<c;t++)d[t]=e[t*a+l]}for(let e=0;e<t;e++){const t=r[e],n=r[e+1]||c,i=d.subarray(t,n);h[e]=String.fromCodePoint.apply(null,i),u&&i.forEach(u.add,u)}if(u)for(const e of u)o.add(String.fromCodePoint(e));return{texts:h,characterCount:c}}({...ArrayBuffer.isView(n)?{value:n}:n,length:e.length,startIndices:o,characterSet:s});i=a,r=(e,{index:n})=>t[n]}else{const{iterable:t,objectInfo:n}=v_(e);o=[0],i=0;for(const e of t){n.index++;const t=Array.from(r(e,n)||"");s&&t.forEach(s.add,s),i+=t.length,o.push(i)}}this.setState({getText:r,startIndices:o,numInstances:i,characterSet:s||t})}transformParagraph(e,t){const{fontAtlasManager:n}=this.state,i=n.mapping,r=this.state.getText,{wordBreak:o,lineHeight:s,maxWidth:a}=this.props;return function(e,t,n,i,r){const o=Array.from(e),s=o.length,a=new Array(s),l=new Array(s),c=new Array(s),u=("break-word"===n||"break-all"===n)&&isFinite(i)&&i>0,h=[0,0],d=[0,0];let p=0,f=0,m=0;for(let e=0;e<=s;e++){const g=o[e];if("\n"!==g&&e!==s||(m=e),m>f){const e=u?Sx(o,n,i,r,f,m):xx;for(let n=0;n<=e.length;n++){const i=0===n?f:e[n-1],s=n<e.length?e[n]:m;Tx(o,i,s,r,a,d);for(let e=i;e<s;e++){const t=o[e],n=r[t]?.layoutOffsetY||0;l[e]=p+d[1]/2+n,c[e]=d[0]}p+=d[1]*t,h[0]=Math.max(h[0],d[0])}f=m}"\n"===g&&(a[f]=0,l[f]=0,c[f]=0,f++)}return h[1]=p,{x:a,y:l,rowWidth:c,size:h}}(r(e,t)||"",s,o,a*n.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:t,getText:n,fontAtlasManager:{scale:i,atlas:r,mapping:o},styleVersion:s}=this.state,{data:a,_dataDiff:l,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:f,getBorderColor:m,getBorderWidth:g,backgroundPadding:_,background:y,billboard:v,fontSettings:b,outlineWidth:x,outlineColor:w,sizeScale:E,sizeUnits:S,sizeMinPixels:T,sizeMaxPixels:A,transitions:C,updateTriggers:P}=this.props,I=this.getSubLayerClass("characters",gx),M=this.getSubLayerClass("background",kx);return[y&&new M({getFillColor:f,getLineColor:m,getLineWidth:g,padding:_,getPosition:c,getSize:h,getAngle:d,getPixelOffset:p,billboard:v,sizeScale:E,sizeUnits:S,sizeMinPixels:T,sizeMaxPixels:A,transitions:C&&{getPosition:C.getPosition,getAngle:C.getAngle,getSize:C.getSize,getFillColor:C.getBackgroundColor,getLineColor:C.getBorderColor,getLineWidth:C.getBorderWidth,getPixelOffset:C.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:P.getPosition,getAngle:P.getAngle,getSize:P.getSize,getFillColor:P.getBackgroundColor,getLineColor:P.getBorderColor,getLineWidth:P.getBorderWidth,getPixelOffset:P.getPixelOffset,getBoundingRect:{getText:P.getText,getTextAnchor:P.getTextAnchor,getAlignmentBaseline:P.getAlignmentBaseline,styleVersion:s}}}),{data:a.attributes&&a.attributes.background?{length:a.length,attributes:a.attributes.background}:a,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new I({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:Cx.smoothing,outlineWidth:x/(b.radius||Cx.radius),outlineColor:w,iconAtlas:r,iconMapping:o,getPosition:c,getColor:u,getSize:h,getAngle:d,getPixelOffset:p,billboard:v,sizeScale:E*i,sizeUnits:S,sizeMinPixels:T*i,sizeMaxPixels:A*i,transitions:C&&{getPosition:C.getPosition,getAngle:C.getAngle,getColor:C.getColor,getSize:C.getSize,getPixelOffset:C.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:P.getText,getPosition:P.getPosition,getAngle:P.getAngle,getColor:P.getColor,getSize:P.getSize,getPixelOffset:P.getPixelOffset,getIconOffsets:{getTextAnchor:P.getTextAnchor,getAlignmentBaseline:P.getAlignmentBaseline,styleVersion:s}}}),{data:a,_dataDiff:l,startIndices:e,numInstances:t,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(e){!function(e){rs.assert(Number.isFinite(e)&&e>=3,"Invalid cache limit"),Px=new Ax(e)}(e)}}class zx{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=os,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:n={},getGeometry:i,geometryBuffer:r,positionFormat:o,dataChanged:s,normalize:a=!0}=this.opts;if(this.data=t,this.getGeometry=i,this.positionSize=r&&r.size||("XY"===o?2:3),this.buffers=n,this.normalize=a,r&&(Ha(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(r),a||(n.vertexPositions=r)),this.geometryBuffer=n.vertexPositions,Array.isArray(s))for(const e of s)this._rebuildGeometry(e);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?x_(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:n,buffers:i,_attributeDefs:r,typedArrayManager:o}=this;for(const s in r)if(s in i)o.release(n[s]),n[s]=null;else{const i=r[s];i.copy=t,n[s]=o.allocate(n[s],e,i)}}_forEachGeometry(e,t,n){const{data:i,getGeometry:r}=this,{iterable:o,objectInfo:s}=v_(i,t,n);for(const t of o)s.index++,e(r?r(t,s):null,s.index)}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:n,instanceCount:i}=this;const{data:r,geometryBuffer:o}=this,{startRow:s=0,endRow:a=1/0}=e||{},l={};if(e||(t=[0],n=[0]),this.normalize||!o)this._forEachGeometry(((e,t)=>{const i=e&&this.normalizeGeometry(e);l[t]=i,n[t+1]=n[t]+(i?this.getGeometrySize(i):0)}),s,a),i=n[n.length-1];else if(n=r.startIndices,i=n[r.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof cp){const e=4*this.positionSize;i=i||o.byteLength/e}else if(o.buffer){const e=o.stride||4*this.positionSize;i=i||o.buffer.byteLength/e}else if(o.value){const e=o.value,t=o.stride/e.BYTES_PER_ELEMENT||this.positionSize;i=i||e.length/t}this._allocate(i,Boolean(e)),this.indexStarts=t,this.vertexStarts=n,this.instanceCount=i;const c={};this._forEachGeometry(((e,r)=>{const o=l[r]||e;c.vertexStart=n[r],c.indexStart=t[r];const s=r<n.length-1?n[r+1]:i;c.geometrySize=s-n[r],c.geometryIndex=r,this.updateGeometryAttributes(o,c)}),s,a),this.vertexCount=t[t.length-1]}}function jx(e,t,n={}){const i=function(e,t={}){return Math.sign(function(e,t={}){const{start:n=0,end:i=e.length,plane:r="xy"}=t,o=t.size||2;let s=0;const a=Ux[r[0]],l=Ux[r[1]];for(let t=n,r=i-o;t<i;t+=o)s+=(e[t+a]-e[r+a])*(e[t+l]+e[r+l]),r=t;return s/2}(e,t))}(e,n);return i!==t&&(function(e,t){const{start:n=0,end:i=e.length,size:r=2}=t,o=(i-n)/r,s=Math.floor(o/2);for(let t=0;t<s;++t){const i=n+t*r,s=n+(o-1-t)*r;for(let t=0;t<r;++t){const n=e[i+t];e[i+t]=e[s+t],e[s+t]=n}}}(e,n),!0)}const Ux={x:0,y:1,z:2};function Vx(e,t,n,i,r=[]){let o,s;if(8&n)o=(i[3]-e[1])/(t[1]-e[1]),s=3;else if(4&n)o=(i[1]-e[1])/(t[1]-e[1]),s=1;else if(2&n)o=(i[2]-e[0])/(t[0]-e[0]),s=2;else{if(!(1&n))return null;o=(i[0]-e[0])/(t[0]-e[0]),s=0}for(let n=0;n<e.length;n++)r[n]=(1&s)===n?i[s]:o*(t[n]-e[n])+e[n];return r}function Gx(e,t){let n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}function $x(e,t){const n=t.length,i=e.length;if(i>0){let r=!0;for(let o=0;o<n;o++)if(e[i-n+o]!==t[o]){r=!1;break}if(r)return!1}for(let r=0;r<n;r++)e[i+r]=t[r];return!0}function Wx(e,t){const n=t.length;for(let i=0;i<n;i++)e[i]=t[i]}function Hx(e,t,n,i,r=[]){const o=i+t*n;for(let t=0;t<n;t++)r[t]=e[o+t];return r}function qx(e,t){const{size:n=2,broken:i=!1,gridResolution:r=10,gridOffset:o=[0,0],startIndex:s=0,endIndex:a=e.length}=t||{},l=(a-s)/n;let c=[];const u=[c],h=Hx(e,0,n,s);let d,p;const f=Kx(h,r,o,[]),m=[];$x(c,h);for(let t=1;t<l;t++){for(d=Hx(e,t,n,s,d),p=Gx(d,f);p;){Vx(h,d,p,f,m);const e=Gx(m,f);e&&(Vx(h,m,e,f,m),p=e),$x(c,m),Wx(h,m),Jx(f,r,p),i&&c.length>n&&(c=[],u.push(c),$x(c,h)),p=Gx(d,f)}$x(c,d),Wx(h,d)}return i?u:u[0]}const Xx=0;function Zx(e,t=null,n){if(!e.length)return[];const{size:i=2,gridResolution:r=10,gridOffset:o=[0,0],edgeTypes:s=!1}=n||{},a=[],l=[{pos:e,types:s?new Array(e.length/i).fill(1):null,holes:t||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:e,types:t,holes:n}=l.shift();Qx(e,i,n[0]||e.length,c),u=Kx(c[0],r,o,u);const h=Gx(c[1],u);if(h){let r=Yx(e,t,i,0,n[0]||e.length,u,h);const o={pos:r[0].pos,types:r[0].types,holes:[]},a={pos:r[1].pos,types:r[1].types,holes:[]};l.push(o,a);for(let l=0;l<n.length;l++)r=Yx(e,t,i,n[l],n[l+1]||e.length,u,h),r[0]&&(o.holes.push(o.pos.length),o.pos=ew(o.pos,r[0].pos),s&&(o.types=ew(o.types,r[0].types))),r[1]&&(a.holes.push(a.pos.length),a.pos=ew(a.pos,r[1].pos),s&&(a.types=ew(a.types,r[1].types)))}else{const i={positions:e};s&&(i.edgeTypes=t),n.length&&(i.holeIndices=n),a.push(i)}}return a}function Yx(e,t,n,i,r,o,s){const a=(r-i)/n,l=[],c=[],u=[],h=[],d=[];let p,f,m;const g=Hx(e,a-1,n,i);let _=Math.sign(8&s?g[1]-o[3]:g[0]-o[2]),y=t&&t[a-1],v=0,b=0;for(let r=0;r<a;r++)p=Hx(e,r,n,i,p),f=Math.sign(8&s?p[1]-o[3]:p[0]-o[2]),m=t&&t[i/n+r],f&&_&&_!==f&&(Vx(g,p,s,o,d),$x(l,d)&&u.push(y),$x(c,d)&&h.push(y)),f<=0?($x(l,p)&&u.push(m),v-=f):u.length&&(u[u.length-1]=Xx),f>=0?($x(c,p)&&h.push(m),b+=f):h.length&&(h[h.length-1]=Xx),Wx(g,p),_=f,y=m;return[v?{pos:l,types:t&&u}:null,b?{pos:c,types:t&&h}:null]}function Kx(e,t,n,i){const r=Math.floor((e[0]-n[0])/t)*t+n[0],o=Math.floor((e[1]-n[1])/t)*t+n[1];return i[0]=r,i[1]=o,i[2]=r+t,i[3]=o+t,i}function Jx(e,t,n){8&n?(e[1]+=t,e[3]+=t):4&n?(e[1]-=t,e[3]-=t):2&n?(e[0]+=t,e[2]+=t):1&n&&(e[0]-=t,e[2]-=t)}function Qx(e,t,n,i){let r=1/0,o=-1/0,s=1/0,a=-1/0;for(let i=0;i<n;i+=t){const t=e[i],n=e[i+1];r=t<r?t:r,o=t>o?t:o,s=n<s?n:s,a=n>a?n:a}return i[0][0]=r,i[0][1]=s,i[1][0]=o,i[1][1]=a,i}function ew(e,t){for(let n=0;n<t.length;n++)e.push(t[n]);return e}function tw(e,t,n,i){let r=-1,o=-1;for(let s=n+1;s<i;s+=t){const t=Math.abs(e[s]);t>r&&(r=t,o=s-1)}return o}function nw(e,t,n,i,r=85.051129){const o=e[n],s=e[i-t];if(Math.abs(o-s)>180){const i=Hx(e,0,t,n);i[0]+=360*Math.round((s-o)/360),$x(e,i),i[1]=Math.sign(i[1])*r,$x(e,i),i[0]=o,$x(e,i)}}function iw(e,t,n,i){let r,o=e[0];for(let s=n;s<i;s+=t){r=e[s];const t=r-o;(t>180||t<-180)&&(r-=360*Math.round(t/360)),e[s]=o=r}}function rw(e,t){let n;const i=e.length/t;for(let r=0;r<i&&(n=e[r*t],(n+180)%360==0);r++);const r=360*-Math.round(n/360);if(0!==r)for(let n=0;n<i;n++)e[n*t]+=r}class ow extends zx{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?function(e,t,n,i){let r;if(Array.isArray(e[0])){const n=e.length*t;r=new Array(n);for(let n=0;n<e.length;n++)for(let i=0;i<t;i++)r[n*t+i]=e[n][i]||0}else r=e;return n?qx(r,{size:t,gridResolution:n}):i?function(e,t){const{size:n=2,startIndex:i=0,endIndex:r=e.length,normalize:o=!0}=t||{},s=e.slice(i,r);iw(s,n,0,r-i);const a=qx(s,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(o)for(const e of a)rw(e,n);return a}(r,{size:t}):r}(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(sw(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(0!==t.geometrySize)if(e&&sw(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const n=this.attributes.segmentTypes,i=!!e&&this.isClosed(e),{vertexStart:r,geometrySize:o}=t;n.fill(0,r,r+o),i?(n[r]=4,n[r+o-2]=4):(n[r]+=1,n[r+o-2]+=2),n[r+o-1]=4}_updatePositions(e,t){const{positions:n}=this.attributes;if(!n||!e)return;const{vertexStart:i,geometrySize:r}=t,o=new Array(3);for(let t=i,s=0;s<r;t++,s++)this.getPointOnPath(e,s,o),n[3*t]=o[0],n[3*t+1]=o[1],n[3*t+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,n=[]){const{positionSize:i}=this;t*i>=e.length&&(t+=1-e.length/i);const r=t*i;return n[0]=e[r],n[1]=e[r+1],n[2]=3===i&&e[r+2]||0,n}isClosed(e){if(!this.normalize)return Boolean(this.opts.loop);const{positionSize:t}=this,n=e.length-t;return e[0]===e[n]&&e[1]===e[n+1]&&(2===t||e[2]===e[n+2])}}function sw(e){return Array.isArray(e[0])}const aw=[0,0,0,255],lw={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:aw},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},cw={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class uw extends cb{static{this.defaultProps=lw}static{this.layerName="PathLayer"}getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME path-layer-vertex-shader\nin vec2 positions;\nin float instanceTypes;\nin vec3 instanceStartPositions;\nin vec3 instanceEndPositions;\nin vec3 instanceLeftPositions;\nin vec3 instanceRightPositions;\nin vec3 instanceLeftPositions64Low;\nin vec3 instanceStartPositions64Low;\nin vec3 instanceEndPositions64Low;\nin vec3 instanceRightPositions64Low;\nin float instanceStrokeWidths;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float capType;\nuniform float miterLimit;\nuniform bool billboard;\nuniform int widthUnits;\nuniform float opacity;\nout vec4 vColor;\nout vec2 vCornerOffset;\nout float vMiterLength;\nout vec2 vPathPosition;\nout float vPathLength;\nout float vJointType;\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\nfloat flipIfTrue(bool flag) {\nreturn -(float(flag) * 2. - 1.);\n}\nvec3 getLineJoinOffset(\nvec3 prevPoint, vec3 currPoint, vec3 nextPoint,\nvec2 width\n) {\nbool isEnd = positions.x > 0.0;\nfloat sideOfPath = positions.y;\nfloat isJoint = float(sideOfPath == 0.0);\nvec3 deltaA3 = (currPoint - prevPoint);\nvec3 deltaB3 = (nextPoint - currPoint);\nmat3 rotationMatrix;\nbool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);\nif (needsRotation) {\ndeltaA3 = deltaA3 * rotationMatrix;\ndeltaB3 = deltaB3 * rotationMatrix;\n}\nvec2 deltaA = deltaA3.xy / width;\nvec2 deltaB = deltaB3.xy / width;\nfloat lenA = length(deltaA);\nfloat lenB = length(deltaB);\nvec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\nvec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\nvec2 perpA = vec2(-dirA.y, dirA.x);\nvec2 perpB = vec2(-dirB.y, dirB.x);\nvec2 tangent = dirA + dirB;\ntangent = length(tangent) > 0. ? normalize(tangent) : perpA;\nvec2 miterVec = vec2(-tangent.y, tangent.x);\nvec2 dir = isEnd ? dirA : dirB;\nvec2 perp = isEnd ? perpA : perpB;\nfloat L = isEnd ? lenA : lenB;\nfloat sinHalfA = abs(dot(miterVec, perp));\nfloat cosHalfA = abs(dot(dirA, miterVec));\nfloat turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);\nfloat cornerPosition = sideOfPath * turnDirection;\nfloat miterSize = 1.0 / max(sinHalfA, EPSILON);\nmiterSize = mix(\nmin(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),\nmiterSize,\nstep(0.0, cornerPosition)\n);\nvec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))\n* (sideOfPath + isJoint * turnDirection);\nbool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));\nbool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));\nbool isCap = isStartCap || isEndCap;\nif (isCap) {\noffsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);\nvJointType = capType;\n} else {\nvJointType = jointType;\n}\nvPathLength = L;\nvCornerOffset = offsetVec;\nvMiterLength = dot(vCornerOffset, miterVec * turnDirection);\nvMiterLength = isCap ? isJoint : vMiterLength;\nvec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);\nvPathPosition = vec2(\ndot(offsetFromStartOfPath, perp),\ndot(offsetFromStartOfPath, dir)\n);\ngeometry.uv = vPathPosition;\nfloat isValid = step(instanceTypes, 3.5);\nvec3 offset = vec3(offsetVec * width * isValid, 0.0);\nif (needsRotation) {\noffset = rotationMatrix * offset;\n}\nreturn offset;\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\nif (position.w < EPSILON) {\nfloat r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\nposition = refPosition + (position - refPosition) * r;\n}\n}\nvoid main() {\ngeometry.pickingColor = instancePickingColors;\nvColor = vec4(instanceColors.rgb, instanceColors.a * opacity);\nfloat isEnd = positions.x;\nvec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\nvec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);\nvec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\nvec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);\nvec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\nvec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);\ngeometry.worldPosition = currPosition;\nvec2 widthPixels = vec2(clamp(\nproject_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),\nwidthMinPixels, widthMaxPixels) / 2.0);\nvec3 width;\nif (billboard) {\nvec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);\nvec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);\nvec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);\nclipLine(prevPositionScreen, currPositionScreen);\nclipLine(nextPositionScreen, currPositionScreen);\nclipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\nwidth = vec3(widthPixels, 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(\nprevPositionScreen.xyz / prevPositionScreen.w,\ncurrPositionScreen.xyz / currPositionScreen.w,\nnextPositionScreen.xyz / nextPositionScreen.w,\nproject_pixel_size_to_clipspace(width.xy)\n);\nDECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);\ngl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);\n} else {\nprevPosition = project_position(prevPosition, prevPosition64Low);\ncurrPosition = project_position(currPosition, currPosition64Low);\nnextPosition = project_position(nextPosition, nextPosition64Low);\nwidth = vec3(project_pixel_size(widthPixels), 0.0);\nDECKGL_FILTER_SIZE(width, geometry);\nvec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);\ngeometry.position = vec4(currPosition + offset, 1.0);\ngl_Position = project_common_position_to_clipspace(geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME path-layer-fragment-shader\nprecision highp float;\nuniform float miterLimit;\nin vec4 vColor;\nin vec2 vCornerOffset;\nin float vMiterLength;\nin vec2 vPathPosition;\nin float vPathLength;\nin float vJointType;\nout vec4 fragColor;\nvoid main(void) {\ngeometry.uv = vPathPosition;\nif (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {\nif (vJointType > 0.5 && length(vCornerOffset) > 1.0) {\ndiscard;\n}\nif (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {\ndiscard;\n}\n}\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[Zb,Jb]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const e=!0;this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:cw,accessor:"getPath",update:this.calculatePositions,noAlloc:e,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:e},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:cw,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:cw,defaultValue:aw},instancePickingColors:{size:4,type:"uint8",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}}),this.setState({pathTesselator:new ow({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:n}=e,i=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:e}=this.state,r=t.data.attributes||{};e.updateGeometry({data:t.data,geometryBuffer:r.getPath,buffers:r,normalize:!t._pathType,loop:"loop"===t._pathType,getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:e.instanceCount,startIndices:e.vertexStarts}),n.dataChanged||i.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:n,billboard:i,miterLimit:r,widthUnits:o,widthScale:s,widthMinPixels:a,widthMaxPixels:l}=this.props,c=this.state.model;c.setUniforms(e),c.setUniforms({jointType:Number(t),capType:Number(n),billboard:i,widthUnits:Ra[o],widthScale:s,miterLimit:r,widthMinPixels:a,widthMaxPixels:l}),c.draw(this.context.renderPass)}_getModel(){return new cv(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Qb({topology:"triangle-list",attributes:{indices:new Uint16Array([0,1,2,1,4,2,1,3,4,3,5,4]),positions:{value:new Float32Array([0,0,0,-1,0,1,1,-1,1,1,1,0]),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}const hw="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\nvec3 color;\n};\nstruct PointLight {\nvec3 color;\nvec3 position;\nvec3 attenuation;\n};\nstruct DirectionalLight {\nvec3 color;\nvec3 direction;\n};\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\nuniform bool lighting_uEnabled;\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\nreturn pointLight.attenuation.x\n+ pointLight.attenuation.y * distance\n+ pointLight.attenuation.z * distance * distance;\n}\n#endif\n",dw={lightSources:{}};function pw(e={}){const{color:t=[0,0,0],intensity:n=1}=e;return t.map((e=>e*n/255))}const fw={name:"lights",vs:hw,fs:hw,getUniforms:function e(t=dw){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:i}=t.lightSources||{};return e||n&&n.length>0||i&&i.length>0?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const i={};return i["lighting_uAmbientLight.color"]=e?pw(e):[0,0,0],t.forEach(((e,t)=>{i[`lighting_uPointLight[${t}].color`]=pw(e),i[`lighting_uPointLight[${t}].position`]=e.position,i[`lighting_uPointLight[${t}].attenuation`]=e.attenuation||[1,0,0]})),i.lighting_uPointLightCount=t.length,n.forEach(((e,t)=>{i[`lighting_uDirectionalLight[${t}].color`]=pw(e),i[`lighting_uDirectionalLight[${t}].direction`]=e.direction})),i.lighting_uDirectionalLightCount=n.length,i}({ambientLight:e,pointLights:n,directionalLights:i}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const e of t.lights||[])switch(e.type){case"ambient":n.ambientLight=e;break;case"directional":n.directionalLights?.push(e);break;case"point":n.pointLights?.push(e)}return e({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}},mw={};const gw={name:"gouraud-lighting",dependencies:[fw],vs:"uniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\nvec3 halfway_direction = normalize(light_direction + view_direction);\nfloat lambertian = dot(light_direction, normal_worldspace);\nfloat specular = 0.0;\nif (lambertian > 0.0) {\nfloat specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\nspecular = pow(specular_angle, lighting_uShininess);\n}\nlambertian = max(lambertian, 0.0);\nreturn (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\nvec3 lightColor = surfaceColor;\nif (lighting_uEnabled) {\nvec3 view_direction = normalize(cameraPosition - position_worldspace);\nlightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uPointLightCount) {\nbreak;\n}\nPointLight pointLight = lighting_uPointLight[i];\nvec3 light_position_worldspace = pointLight.position;\nvec3 light_direction = normalize(light_position_worldspace - position_worldspace);\nlightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n}\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uDirectionalLightCount) {\nbreak;\n}\nDirectionalLight directionalLight = lighting_uDirectionalLight[i];\nlightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n}\n}\nreturn lightColor;\n}\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\nvec3 lightColor = vec3(0, 0, 0);\nvec3 surfaceColor = vec3(0, 0, 0);\nif (lighting_uEnabled) {\nvec3 view_direction = normalize(cameraPosition - position_worldspace);\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uPointLightCount) {\nbreak;\n}\nPointLight pointLight = lighting_uPointLight[i];\nvec3 light_position_worldspace = pointLight.position;\nvec3 light_direction = normalize(light_position_worldspace - position_worldspace);\nlightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n}\nfor (int i = 0; i < MAX_LIGHTS; i++) {\nif (i >= lighting_uDirectionalLightCount) {\nbreak;\n}\nDirectionalLight directionalLight = lighting_uDirectionalLight[i];\nlightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n}\n}\nreturn lightColor;\n}\n",defines:{LIGHTING_VERTEX:1},getUniforms:function(e=mw){if(!("material"in e))return{};const{material:t}=e;return t?function(e){const{ambient:t=.35,diffuse:n=.6,shininess:i=32,specularColor:r=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:n,lighting_uShininess:i,lighting_uSpecularColor:r.map((e=>e/255))}}(t):{lighting_uEnabled:!1}}};var _w=d(5230);const yw={isClosed:!0};function vw(e){return"positions"in e?e.positions:e}function bw(e){return"holeIndices"in e?e.holeIndices:null}function xw(e,t,n,i,r){let o=t;const s=n.length;for(let t=0;t<s;t++)for(let r=0;r<i;r++)e[o++]=n[t][r]||0;if(!function(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}(n))for(let t=0;t<i;t++)e[o++]=n[0][t]||0;return yw.start=t,yw.end=o,yw.size=i,jx(e,r,yw),o}function ww(e,t,n,i,r=0,o,s){const a=(o=o||n.length)-r;if(a<=0)return t;let l=t;for(let t=0;t<a;t++)e[l++]=n[r+t];if(!function(e,t,n,i){for(let r=0;r<t;r++)if(e[n+r]!==e[i-t+r])return!1;return!0}(n,i,r,o))for(let t=0;t<i;t++)e[l++]=n[r+t];return yw.start=t,yw.end=l,yw.size=i,jx(e,s,yw),l}function Ew(e,t){!function(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}(e);const n=[],i=[];if("positions"in e){const{positions:r,holeIndices:o}=e;if(o){let e=0;for(let s=0;s<=o.length;s++)e=ww(n,e,r,t,o[s-1],o[s],0===s?1:-1),i.push(e);return i.pop(),{positions:n,holeIndices:i}}e=r}if(!function(e){return Array.isArray(e[0])}(e))return ww(n,0,e,t,0,n.length,1),n;if(!function(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}(e)){let r=0;for(const[o,s]of e.entries())r=xw(n,r,s,t,0===o?1:-1),i.push(r);return i.pop(),{positions:n,holeIndices:i}}return xw(n,0,e,t,1),n}function Sw(e,t,n){const i=e.length/3;let r=0;for(let o=0;o<i;o++){const s=(o+1)%i;r+=e[3*o+t]*e[3*s+n],r-=e[3*s+t]*e[3*o+n]}return Math.abs(r/2)}function Tw(e,t,n,i){const r=e.length/3;for(let o=0;o<r;o++){const r=3*o,s=e[r+0],a=e[r+1],l=e[r+2];e[r+t]=s,e[r+n]=a,e[r+i]=l}}class Aw extends zx{constructor(e){const{fp64:t,IndexType:n=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:t?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(e){const{attributes:t}=this;return"indices"===e?t.indices&&t.indices.subarray(0,this.vertexCount):t[e]}updateGeometry(e){super.updateGeometry(e);const t=this.buffers.indices;if(t)this.vertexCount=(t.value||t).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const t=Ew(e,this.positionSize);return this.opts.resolution?Zx(vw(t),bw(t),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?function(e,t=null,n){const{size:i=2,normalize:r=!0,edgeTypes:o=!1}=n||{};t=t||[];const s=[],a=[];let l=0,c=0;for(let r=0;r<=t.length;r++){const o=t[r]||e.length,u=c,h=tw(e,i,l,o);for(let t=h;t<o;t++)s[c++]=e[t];for(let t=l;t<h;t++)s[c++]=e[t];iw(s,i,u,c),nw(s,i,u,c,n?.maxLatitude),l=o,a[r]=c}a.pop();const u=Zx(s,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:o});if(r)for(const e of u)rw(e.positions,i);return u}(vw(t),bw(t),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):t}return e}getGeometrySize(e){if(Cw(e)){let t=0;for(const n of e)t+=this.getGeometrySize(n);return t}return vw(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,t){if(e&&Cw(e))for(const n of e){const e=this.getGeometrySize(n);t.geometrySize=e,this.updateGeometryAttributes(n,t),t.vertexStart+=e,t.indexStart=this.indexStarts[t.geometryIndex+1]}else{const n=e;this._updateIndices(n,t),this._updatePositions(n,t),this._updateVertexValid(n,t)}}_updateIndices(e,{geometryIndex:t,vertexStart:n,indexStart:i}){const{attributes:r,indexStarts:o,typedArrayManager:s}=this;let a=r.indices;if(!a||!e)return;let l=i;const c=function(e,t,n,i){let r=bw(e);r&&(r=r.map((e=>e/t)));let o=vw(e);const s=i&&3===t;if(n){const e=o.length;o=o.slice();const i=[];for(let r=0;r<e;r+=t){i[0]=o[r],i[1]=o[r+1],s&&(i[2]=o[r+2]);const e=n(i);o[r]=e[0],o[r+1]=e[1],s&&(o[r+2]=e[2])}}if(s){const e=Sw(o,0,1),t=Sw(o,0,2),i=Sw(o,1,2);if(!e&&!t&&!i)return[];e>t&&e>i||(t>i?(n||(o=o.slice()),Tw(o,0,2,1)):(n||(o=o.slice()),Tw(o,2,0,1)))}return _w(o,r,t)}(e,this.positionSize,this.opts.preproject,this.opts.full3d);a=s.allocate(a,i+c.length,{copy:!0});for(let e=0;e<c.length;e++)a[l++]=c[e]+n;o[t+1]=i+c.length,r.indices=a}_updatePositions(e,{vertexStart:t,geometrySize:n}){const{attributes:{positions:i},positionSize:r}=this;if(!i||!e)return;const o=vw(e);for(let e=t,s=0;s<n;e++,s++){const t=o[s*r],n=o[s*r+1],a=r>2?o[s*r+2]:0;i[3*e]=t,i[3*e+1]=n,i[3*e+2]=a}}_updateVertexValid(e,{vertexStart:t,geometrySize:n}){const{positionSize:i}=this,r=this.attributes.vertexValid,o=e&&bw(e);if(e&&e.edgeTypes?r.set(e.edgeTypes,t):r.fill(1,t,t+n),o)for(let e=0;e<o.length;e++)r[t+o[e]/i-1]=0;r[t+n-1]=0}}function Cw(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const Pw="uniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\nin vec4 fillColors;\nin vec4 lineColors;\nin vec3 pickingColors;\nout vec4 vColor;\nstruct PolygonProps {\nvec3 positions;\nvec3 positions64Low;\nvec3 normal;\nfloat elevations;\n};\nvec3 project_offset_normal(vec3 vector) {\nif (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\nproject_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {\nreturn normalize(vector * project_uCommonUnitsPerWorldUnit);\n}\nreturn project_normal(vector);\n}\nvoid calculatePosition(PolygonProps props) {\nvec3 pos = props.positions;\nvec3 pos64Low = props.positions64Low;\nvec3 normal = props.normal;\nvec4 colors = isWireframe ? lineColors : fillColors;\ngeometry.worldPosition = props.positions;\ngeometry.pickingColor = pickingColors;\nif (extruded) {\npos.z += props.elevations * elevationScale;\n}\ngl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);\nDECKGL_FILTER_GL_POSITION(gl_Position, geometry);\nif (extruded) {\n#ifdef IS_SIDE_VERTEX\nnormal = project_offset_normal(normal);\n#else\nnormal = project_normal(normal);\n#endif\ngeometry.normal = normal;\nvec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\nvColor = vec4(lightColor, colors.a * opacity);\n} else {\nvColor = vec4(colors.rgb, colors.a * opacity);\n}\nDECKGL_FILTER_COLOR(vColor, geometry);\n}\n",Iw=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader\nin vec3 vertexPositions;\nin vec3 vertexPositions64Low;\nin float elevations;\n${Pw}\nvoid main(void) {\nPolygonProps props;\nprops.positions = vertexPositions;\nprops.positions64Low = vertexPositions64Low;\nprops.elevations = elevations;\nprops.normal = vec3(0.0, 0.0, 1.0);\ncalculatePosition(props);\n}\n`,Mw=`#version 300 es\n#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\nin vec2 positions;\nin vec3 vertexPositions;\nin vec3 nextVertexPositions;\nin vec3 vertexPositions64Low;\nin vec3 nextVertexPositions64Low;\nin float elevations;\nin float instanceVertexValid;\n${Pw}\nvoid main(void) {\nif(instanceVertexValid < 0.5){\ngl_Position = vec4(0.);\nreturn;\n}\nPolygonProps props;\nvec3 pos;\nvec3 pos64Low;\nvec3 nextPos;\nvec3 nextPos64Low;\n#if RING_WINDING_ORDER_CW == 1\npos = vertexPositions;\npos64Low = vertexPositions64Low;\nnextPos = nextVertexPositions;\nnextPos64Low = nextVertexPositions64Low;\n#else\npos = nextVertexPositions;\npos64Low = nextVertexPositions64Low;\nnextPos = vertexPositions;\nnextPos64Low = vertexPositions64Low;\n#endif\nprops.positions = mix(pos, nextPos, positions.x);\nprops.positions64Low = mix(pos64Low, nextPos64Low, positions.x);\nprops.normal = vec3(\npos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),\nnextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),\n0.0);\nprops.elevations = elevations * positions.y;\ncalculatePosition(props);\n}\n`,Rw=[0,0,0,255],Ow={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Rw},getLineColor:{type:"accessor",value:Rw},material:!0},kw={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class Lw extends cb{static{this.defaultProps=Ow}static{this.layerName="SolidPolygonLayer"}getShaders(e){return super.getShaders({vs:"top"===e?Iw:Mw,fs:"#version 300 es\n#define SHADER_NAME solid-polygon-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\ngeometry.uv = vec2(0.);\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",defines:{RING_WINDING_ORDER_CW:this.props._normalize||"CCW"!==this.props._windingOrder?1:0},modules:[Zb,gw,Jb]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:t}=this.props;const{_full3d:n}=this.props;let i;e.isGeospatial&&t===Ia.DEFAULT&&(t=Ia.LNGLAT),t===Ia.LNGLAT&&(i=n?e.projectPosition.bind(e):e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Aw({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const r=this.getAttributeManager(),o=!0;r.remove(["instancePickingColors"]),r.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:kw,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:kw,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:kw,accessor:"getFillColor",defaultValue:Rw},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:kw,accessor:"getLineColor",defaultValue:Rw},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(e,{index:t,target:n})=>this.encodePickingColor(e&&e.__source?e.__source.index:t,n)}})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n}=t,i=this.props.data;return i[0]&&i[0].__source&&(t.object=i.find((e=>e.__source.index===n))),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let n=0;n<t.length;n++)t[n].__source.index===e&&this._disablePickingIndex(n);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:t,filled:n,wireframe:i,elevationScale:r}=this.props,{topModel:o,sideModel:s,wireframeModel:a,polygonTesselator:l}=this.state,c={...e,extruded:Boolean(t),elevationScale:r};a&&i&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(c),a.draw(this.context.renderPass)),s&&n&&(s.setInstanceCount(l.instanceCount-1),s.setUniforms(c),s.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(l.vertexCount),o.setUniforms(c),o.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:t,oldProps:n,changeFlags:i}=e,r=this.getAttributeManager();(i.extensionsChanged||t.filled!==n.filled||t.extruded!==n.extruded)&&(this.state.models?.forEach((e=>e.destroy())),this.setState(this._getModels()),r.invalidateAll())}updateGeometry({props:e,oldProps:t,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:t}=this.state,i=e.data.attributes||{};t.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:i.getPolygon,buffers:i,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:e._full3d}),this.setState({numInstances:t.instanceCount,startIndices:t.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:t,extruded:n}=this.props;let i,r,o;if(t){const t=this.getShaders("top");t.defines.NON_INSTANCED_MODEL=1;const n=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new cv(this.context.device,{...t,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:n,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const t=this.getAttributeManager().getBufferLayouts({isInstanced:!0});r=new cv(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:t,uniforms:{isWireframe:!1},geometry:new Qb({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new cv(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:t,uniforms:{isWireframe:!0},geometry:new Qb({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[r,o,i].filter(Boolean),topModel:i,sideModel:r,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:t}=this.state;e.startIndices=t.indexStarts,e.value=t.get("indices")}calculatePositions(e){const{polygonTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}const Dw={circle:{type:dx,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:cx,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Bx,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Fw={type:uw,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Nw={type:Lw,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Bw({type:e,props:t}){const n={};for(const i in t)n[i]=e.defaultProps[t[i]];return n}function zw(e,t){const{transitions:n,updateTriggers:i}=e.props,r={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const o in t){const s=t[o];let a=e.props[o];o.startsWith("get")&&(a=e.getSubLayerAccessor(a),r.updateTriggers[s]=i[o],n&&(r.transitions[s]=n[o])),r[s]=a}return r}function jw(e,t,n={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:o=e.length}=n;for(let n=r;n<o;n++){const r=e[n],{geometry:o}=r;if(o)if("GeometryCollection"===o.type){rs.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");const{geometries:e}=o;for(let o=0;o<e.length;o++)Uw(e[o],i,t,r,n)}else Uw(o,i,t,r,n)}return i}function Uw(e,t,n,i,r){const{type:o,coordinates:s}=e,{pointFeatures:a,lineFeatures:l,polygonFeatures:c,polygonOutlineFeatures:u}=t;if(function(e,t){let n=Vw[e];for(rs.assert(n,`Unknown GeoJSON type ${e}`);t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(o,s))switch(o){case"Point":a.push(n({geometry:e},i,r));break;case"MultiPoint":s.forEach((e=>{a.push(n({geometry:{type:"Point",coordinates:e}},i,r))}));break;case"LineString":l.push(n({geometry:e},i,r));break;case"MultiLineString":s.forEach((e=>{l.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"Polygon":c.push(n({geometry:e},i,r)),s.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}));break;case"MultiPolygon":s.forEach((e=>{c.push(n({geometry:{type:"Polygon",coordinates:e}},i,r)),e.forEach((e=>{u.push(n({geometry:{type:"LineString",coordinates:e}},i,r))}))}))}else rs.warn(`${o} coordinates are malformed`)()}const Vw={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Gw(e){return e.geometry.coordinates}const $w=["points","linestrings","polygons"],Ww={...Bw(Dw.circle),...Bw(Dw.icon),...Bw(Dw.text),...Bw(Fw),...Bw(Nw),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Hw extends qb{static{this.layerName="GeoJsonLayer"}static{this.defaultProps=Ww}initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:t}){if(!t.dataChanged)return;const{data:n}=this.props,i=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:t}):this._updateStateJSON({props:e,changeFlags:t})}_updateStateBinary({props:e,changeFlags:t}){const n=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:r,polygons:o}=e,s=function(e,t){const n={points:null,lines:null,polygons:null};for(const i in n){const r=e[i].globalFeatureIds.value;n[i]=new Uint8ClampedArray(3*r.length);const o=[];for(let e=0;e<r.length;e++)t(r[e],o),n[i][3*e+0]=o[0],n[i][3*e+1]=o[1],n[i][3*e+2]=o[2]}return n}(e,t);return n.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:s.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:3,value:s.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines._pathType="open",n.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygons._normalize=!1,o.triangles&&(n.polygons.data.attributes.indices=o.triangles.value),n.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:s.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},n.polygonsOutline._pathType="open",n}(e.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:e,changeFlags:t}){const n=function(e){if(Array.isArray(e))return e;switch(rs.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return rs.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(e.data),i=this.getSubLayerRow.bind(this);let r={};const o={};if(Array.isArray(t.dataChanged)){const e=this.state.features;for(const t in e)r[t]=e[t].slice(),o[t]=[];for(const s of t.dataChanged){const t=jw(n,i,s);for(const n in e)o[n].push(Xb({data:r[n],getIndex:e=>e.__source.index,dataRange:s,replace:t[n]}))}}else r=jw(n,i);const s=function(e,t){const n={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:r,polygonFeatures:o,polygonOutlineFeatures:s}=e;return n.points.data=i,n.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),n.points.getPosition=Gw,n.lines.data=r,n.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),n.lines.getPath=Gw,n.polygons.data=o,n.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),n.polygons.getPolygon=Gw,n.polygonsOutline.data=s,n.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),n.polygonsOutline.getPath=Gw,n}(r,o);this.setState({features:r,featuresDiff:o,layerProps:s})}getPickingInfo(e){const t=super.getPickingInfo(e),{index:n,sourceLayer:i}=t;return t.featureType=$w.find((e=>i.id.startsWith(`${this.id}-${e}-`))),n>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(t.index=this.props.data.points.globalFeatureIds.value[n]),t}_updateAutoHighlight(e){const t=`${this.id}-points-`,n="points"===e.featureType;for(const i of this.getSubLayers())i.id.startsWith(t)===n&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:t}=this.props,{layerProps:n}=this.state,i="polygons-fill",r=this.shouldRenderSubLayer(i,n.polygons?.data)&&this.getSubLayerClass(i,Nw.type);if(r){const o=zw(this,Nw.props),s=e&&t;return s||delete o.getLineColor,o.updateTriggers.lineColors=s,new r(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:t}=this.props,{layerProps:n}=this.state,i="polygons-stroke",r="linestrings",o=!e&&t&&this.shouldRenderSubLayer(i,n.polygonsOutline?.data)&&this.getSubLayerClass(i,Fw.type),s=this.shouldRenderSubLayer(r,n.lines?.data)&&this.getSubLayerClass(r,Fw.type);if(o||s){const e=zw(this,Fw.props);return[o&&new o(e,this.getSubLayerProps({id:i,updateTriggers:e.updateTriggers}),n.polygonsOutline),s&&new s(e,this.getSubLayerProps({id:r,updateTriggers:e.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:t,binary:n}=this.state;let{highlightedObjectIndex:i}=this.props;!n&&Number.isFinite(i)&&(i=t.points.data.findIndex((e=>e.__source.index===i)));const r=new Set(e.split("+")),o=[];for(const e of r){const r=`points-${e}`,s=Dw[e],a=s&&this.shouldRenderSubLayer(r,t.points?.data)&&this.getSubLayerClass(r,s.type);if(a){const l=zw(this,s.props);let c=t.points;if("text"===e&&n){const{instancePickingColors:e,...t}=c.data.attributes;c={...c,data:{...c.data,attributes:t}}}o.push(new a(l,this.getSubLayerProps({id:r,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),c))}}return o}renderLayers(){const{extruded:e}=this.props,t=this._renderPolygonLayer();return[!e&&t,this._renderLineLayers(),this._renderPointLayers(),e&&t]}getSubLayerAccessor(e){const{binary:t}=this.state;return t&&"function"==typeof e?(t,n)=>{const{data:i,index:r}=n,o=function(e,t){if(!e)return null;const n="startIndices"in e?e.startIndices[t]:t,i=e.featureIds.value[n];return-1!==n?function(e,t,n){const i={properties:{...e.properties[t]}};for(const t in e.numericProps)i.properties[t]=e.numericProps[t].value[n];return i}(e,i,n):null}(i,r);return e(o,n)}:super.getSubLayerAccessor(e)}}class qw{static{this.defaultProps={}}static{this.extensionName="LayerExtension"}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e||this.constructor===e.constructor&&Do(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:t}=e.constructor,n={updateTriggers:{}};for(const e in t)if(e in this.props){const i=t[e],r=this.props[e];n[e]=r,i&&"accessor"===i.type&&(n.updateTriggers[e]=this.props.updateTriggers[e],"function"==typeof r&&(n[e]=this.getSubLayerAccessor(r)))}return n}initializeState(e,t){}updateState(e,t){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,t){}finalizeState(e,t){}}const Xw={inject:{"vs:#decl":"\nin vec2 instanceDashArrays;\nin float instanceDashOffsets;\nout vec2 vDashArray;\nout float vDashOffset;\n","vs:#main-end":"\nvDashArray = instanceDashArrays;\nvDashOffset = instanceDashOffsets / width.x;\n","fs:#decl":"\nuniform float dashAlignMode;\nuniform float capType;\nuniform bool dashGapPickable;\nin vec2 vDashArray;\nin float vDashOffset;\n","fs:#main-start":"\nfloat solidLength = vDashArray.x;\nfloat gapLength = vDashArray.y;\nfloat unitLength = solidLength + gapLength;\nfloat offset;\nif (unitLength > 0.0) {\nif (dashAlignMode == 0.0) {\noffset = vDashOffset;\n} else {\nunitLength = vPathLength / round(vPathLength / unitLength);\noffset = solidLength / 2.0;\n}\nfloat unitOffset = mod(vPathPosition.y + offset, unitLength);\nif (gapLength > 0.0 && unitOffset > solidLength) {\nif (capType <= 0.5) {\nif (!(dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n} else {\nfloat distToEnd = length(vec2(\nmin(unitOffset - solidLength, unitLength - unitOffset),\nvPathPosition.x\n));\nif (distToEnd > 1.0) {\nif (!(dashGapPickable && bool(picking.isActive))) {\ndiscard;\n}\n}\n}\n}\n}\n"}},Zw={inject:{"vs:#decl":"\nin float instanceOffsets;\n","vs:DECKGL_FILTER_SIZE":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nsize *= offsetWidth;\n","vs:#main-end":"\nfloat offsetWidth = abs(instanceOffsets * 2.0) + 1.0;\nfloat offsetDir = sign(instanceOffsets);\nvPathPosition.x = (vPathPosition.x + offsetDir) * offsetWidth - offsetDir;\nvPathPosition.y *= offsetWidth;\nvPathLength *= offsetWidth;\n","fs:#main-start":"\nfloat isInside;\nisInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);\nif (isInside == 0.0) {\ndiscard;\n}\n"}},Yw={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1};class Kw extends qw{static{this.defaultProps=Yw}static{this.extensionName="PathStyleExtension"}constructor({dash:e=!1,offset:t=!1,highPrecisionDash:n=!1}={}){super({dash:e||n,offset:t,highPrecisionDash:n})}isEnabled(e){return"pathTesselator"in e.state}getShaders(e){if(!e.isEnabled(this))return null;let t={};return e.opts.dash&&(t=Bv(t,Xw)),e.opts.offset&&(t=Bv(t,Zw)),t}initializeState(e,t){const n=this.getAttributeManager();n&&t.isEnabled(this)&&(t.opts.dash&&n.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"},instanceDashOffsets:t.opts.highPrecisionDash?{size:1,accessor:"getPath",transform:t.getDashOffsets.bind(this)}:{size:1,update:e=>{e.constant=!0,e.value=[0]}}}),t.opts.offset&&n.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}updateState(e,t){if(!t.isEnabled(this))return;const n={};t.opts.dash&&(n.dashAlignMode=this.props.dashJustified?1:0,n.dashGapPickable=Boolean(this.props.dashGapPickable)),this.state.model?.setUniforms(n)}getDashOffsets(e){const t=[0],n="XY"===this.props.positionFormat?2:3,i=Array.isArray(e[0]),r=i?e.length:e.length/n;let o,s;for(let a=0;a<r-1;a++)o=i?e[a]:e.slice(a*n,a*n+n),o=this.projectPosition(o),a>0&&(t[a]=t[a-1]+xs(s,o)),s=o;return t[r-1]=0,t}}function Jw(e){const{onHover:t,highlightColor:n,getSelFeature:i,data:r,type:o,theme2:s,time:a}=e;return new uw({id:ne.Path+"-"+o,data:r,autoHighlight:!0,highlightColor:n,pickable:!["par-path-extension","par-path-line"].includes(o),widthMinPixels:1,capRounded:!0,jointRounded:!0,getPath:e=>{switch(o){case"par-path-extension":case"par-path-line":return e[0];default:return e.geometry.coordinates}},getDashArray:"par-path-extension"===o?[5,8]:null,dashJustified:!0,dashGapPickable:!0,extensions:[new Kw({dash:!0})],getColor:e=>{let t;switch(o){case"par-path-extension":case"par-path-line":t=s.isDark?function(e){if(!e)return`rgba(${[100,100,0,1].join(", ")})`;const t=e.match(/\d+(\.\d+)?/g);3===t.length&&t.push("1");const n=t.map(((e,t)=>3===t?Math.min(Number(e),1):Math.min(Number(e)+45,255)));return`rgba(${n.join(", ")})`}(e[1]):function(e){if(!e)return`rgba(${[100,100,0,1].join(", ")})`;const t=e.match(/\d+(\.\d+)?/g);3===t.length&&t.push("1");const n=t.map(((e,t)=>3===t?Math.min(Number(e),1):Math.max(Number(e)-45,0)));return`rgba(${n.join(", ")})`}(e[1]);break;default:const{threshold:n}=e.properties;t=n.color}return ue(t)},widthScale:1.1,getWidth:e=>{switch(o){case"par-path-extension":case"par-path-line":return 3*e[2];default:var t,n,i;return null!==(i=null==e||null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth)&&void 0!==i?i:1}},onHover:t})}const Qw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class eE{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,n]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const i=n>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const r=Qw[15&n];if(!r)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[s]=new Uint32Array(e,4,1);return new eE(s,o,r,e)}constructor(e,t=64,n=Float64Array,i){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const r=Qw.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,s=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-s%8)%8;if(r<0)throw new Error(`Unexpected typed array class: ${n}.`);i&&i instanceof ArrayBuffer?(this.data=i,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+s+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+s+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+r]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return tE(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:o,nodeSize:s}=this,a=[0,r.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,h=a.pop()||0;if(u-h<=s){for(let s=h;s<=u;s++){const a=o[2*s],c=o[2*s+1];a>=e&&a<=n&&c>=t&&c<=i&&l.push(r[s])}continue}const d=h+u>>1,p=o[2*d],f=o[2*d+1];p>=e&&p<=n&&f>=t&&f<=i&&l.push(r[d]),(0===c?e<=p:t<=f)&&(a.push(h),a.push(d-1),a.push(1-c)),(0===c?n>=p:i>=f)&&(a.push(d+1),a.push(u),a.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:r,nodeSize:o}=this,s=[0,i.length-1,0],a=[],l=n*n;for(;s.length;){const c=s.pop()||0,u=s.pop()||0,h=s.pop()||0;if(u-h<=o){for(let n=h;n<=u;n++)oE(r[2*n],r[2*n+1],e,t)<=l&&a.push(i[n]);continue}const d=h+u>>1,p=r[2*d],f=r[2*d+1];oE(p,f,e,t)<=l&&a.push(i[d]),(0===c?e-n<=p:t-n<=f)&&(s.push(h),s.push(d-1),s.push(1-c)),(0===c?e+n>=p:t+n>=f)&&(s.push(d+1),s.push(u),s.push(1-c))}return a}}function tE(e,t,n,i,r,o){if(r-i<=n)return;const s=i+r>>1;nE(e,t,s,i,r,o),tE(e,t,n,i,s-1,1-o),tE(e,t,n,s+1,r,1-o)}function nE(e,t,n,i,r,o){for(;r>i;){if(r-i>600){const s=r-i+1,a=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(s-c)/s)*(a-s/2<0?-1:1);nE(e,t,n,Math.max(i,Math.floor(n-a*c/s+u)),Math.min(r,Math.floor(n+(s-a)*c/s+u)),o)}const s=t[2*n+o];let a=i,l=r;for(iE(e,t,i,n),t[2*r+o]>s&&iE(e,t,i,r);a<l;){for(iE(e,t,a,l),a++,l--;t[2*a+o]<s;)a++;for(;t[2*l+o]>s;)l--}t[2*i+o]===s?iE(e,t,i,l):(l++,iE(e,t,l,r)),l<=n&&(i=l+1),n<=l&&(r=l-1)}}function iE(e,t,n,i){rE(e,n,i),rE(t,2*n,2*i),rE(t,2*n+1,2*i+1)}function rE(e,t,n){const i=e[t];e[t]=e[n],e[n]=i}function oE(e,t,n,i){const r=e-n,o=t-i;return r*r+o*o}const sE={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},aE=Math.fround||(lE=new Float32Array(1),e=>(lE[0]=+e,lE[0]));var lE;const cE=3,uE=5,hE=6;class dE{constructor(e){this.options=Object.assign(Object.create(sE),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:n,maxZoom:i}=this.options;t&&console.time("total time");const r=`prepare ${e.length} points`;t&&console.time(r),this.points=e;const o=[];for(let t=0;t<e.length;t++){const n=e[t];if(!n.geometry)continue;const[i,r]=n.geometry.coordinates,s=aE(mE(i)),a=aE(gE(r));o.push(s,a,1/0,t,-1,1),this.options.reduce&&o.push(0)}let s=this.trees[i+1]=this._createTree(o);t&&console.timeEnd(r);for(let e=i;e>=n;e--){const n=+Date.now();s=this.trees[e]=this._createTree(this._cluster(s,e)),t&&console.log("z%d: %d clusters in %dms",e,s.numItems,+Date.now()-n)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let r=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,r=180;else if(n>r){const e=this.getClusters([n,i,180,o],t),s=this.getClusters([-180,i,r,o],t);return e.concat(s)}const s=this.trees[this._limitZoom(t)],a=s.range(mE(n),gE(o),mE(r),gE(i)),l=s.data,c=[];for(const e of a){const t=this.stride*e;c.push(l[t+uE]>1?pE(l,t,this.clusterProps):this.points[l[t+cE]])}return c}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",r=this.trees[n];if(!r)throw new Error(i);const o=r.data;if(t*this.stride>=o.length)throw new Error(i);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=o[t*this.stride],l=o[t*this.stride+1],c=r.within(a,l,s),u=[];for(const t of c){const n=t*this.stride;o[n+4]===e&&u.push(o[n+uE]>1?pE(o,n,this.clusterProps):this.points[o[n+cE]])}if(0===u.length)throw new Error(i);return u}getLeaves(e,t,n){t=t||10,n=n||0;const i=[];return this._appendLeaves(i,e,t,n,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],r=Math.pow(2,e),{extent:o,radius:s}=this.options,a=s/o,l=(n-a)/r,c=(n+1+a)/r,u={features:[]};return this._addTileFeatures(i.range((t-a)/r,l,(t+1+a)/r,c),i.data,t,n,r,u),0===t&&this._addTileFeatures(i.range(1-a/r,l,1,c),i.data,r,n,r,u),t===r-1&&this._addTileFeatures(i.range(0,l,a/r,c),i.data,-1,n,r,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,r){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?r+o.point_count<=i?r+=o.point_count:r=this._appendLeaves(e,o.cluster_id,n,i,r):r<i?r++:e.push(t),e.length===n)break}return r}_createTree(e){const t=new eE(e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let n=0;n<e.length;n+=this.stride)t.add(e[n],e[n+1]);return t.finish(),t.data=e,t}_addTileFeatures(e,t,n,i,r,o){for(const s of e){const e=s*this.stride,a=t[e+uE]>1;let l,c,u;if(a)l=fE(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const n=this.points[t[e+cE]];l=n.properties;const[i,r]=n.geometry.coordinates;c=mE(i),u=gE(r)}const h={type:1,geometry:[[Math.round(this.options.extent*(c*r-n)),Math.round(this.options.extent*(u*r-i))]],tags:l};let d;d=a||this.options.generateId?t[e+cE]:this.points[t[e+cE]].id,void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:n,extent:i,reduce:r,minPoints:o}=this.options,s=n/(i*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let n=0;n<a.length;n+=c){if(a[n+2]<=t)continue;a[n+2]=t;const i=a[n],u=a[n+1],h=e.within(a[n],a[n+1],s),d=a[n+uE];let p=d;for(const e of h){const n=e*c;a[n+2]>t&&(p+=a[n+uE])}if(p>d&&p>=o){let e,o=i*d,s=u*d,f=-1;const m=(n/c<<5)+(t+1)+this.points.length;for(const i of h){const l=i*c;if(a[l+2]<=t)continue;a[l+2]=t;const u=a[l+uE];o+=a[l]*u,s+=a[l+1]*u,a[l+4]=m,r&&(e||(e=this._map(a,n,!0),f=this.clusterProps.length,this.clusterProps.push(e)),r(e,this._map(a,l)))}a[n+4]=m,l.push(o/p,s/p,1/0,m,-1,p),r&&l.push(f)}else{for(let e=0;e<c;e++)l.push(a[n+e]);if(p>1)for(const e of h){const n=e*c;if(!(a[n+2]<=t)){a[n+2]=t;for(let e=0;e<c;e++)l.push(a[n+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,n){if(e[t+uE]>1){const i=this.clusterProps[e[t+hE]];return n?Object.assign({},i):i}const i=this.points[e[t+cE]].properties,r=this.options.map(i);return n&&r===i?Object.assign({},r):r}}function pE(e,t,n){return{type:"Feature",id:e[t+cE],properties:fE(e,t,n),geometry:{type:"Point",coordinates:[_E(e[t]),yE(e[t+1])]}}}function fE(e,t,n){const i=e[t+uE],r=i>=1e4?`${Math.round(i/1e3)}k`:i>=1e3?Math.round(i/100)/10+"k":i,o=e[t+hE],s=-1===o?{}:Object.assign({},n[o]);return Object.assign(s,{cluster:!0,cluster_id:e[t+cE],point_count:i,point_count_abbreviated:r})}function mE(e){return e/360+.5}function gE(e){const t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function _E(e){return 360*(e-.5)}function yE(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function vE(e){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function bE({colorCounts:e,annotStateCounts:t,allTotal:n,allStTotal:i}){const r="rgb(230,230,230, 0.95)",o=[],s=[];let a=0,l=0;const c=i,u=Object.values(e),h=Object.keys(e);u.length&&u.forEach(((e,t)=>{s.push(a),a+=e.count})),c&&(t[r]={count:n,label:"Unknown"});const d=[],p=[];[r,J.Alerting,J.Pending,J.Normal].forEach((e=>{const n=t[e];void 0!==n&&(d.push(n),p.push(e))})),c&&d.forEach(((e,t)=>{o.push(l),l+=e.count}));const f=a>=1e3?70:a>=100?42:a>=10?34:30,m=a>=1e3?100:a>=100?64:a>=10?48:36,g=Math.round(.73*m);let _=2*m;_=1===a?3*_:_;let y=`\n  <svg width="${_}" height="${_}" stroke-width="1" viewBox="0 0 ${_} ${_}" \n  xmlns="http://www.w3.org/2000/svg"\n  text-anchor="middle" style="font: ${f}px arial; font-weight: lighter; display: block">`;y+=`<defs>\n            <mask id="donutMask">\n              <circle cx="${m}" cy="${m}" r="${g}" fill="white"/>\n            </mask>\n          </defs>`;let v=0;for(let e=0;e<u.length;e++){const t=v+u[e].count/a*360;y+=xE(v/360,t/360,m,g,h[e]),v=t}y+=`<circle cx="${1===a?3*m:m}" cy="${1===a?3*m:m}" r="${1===a?1.35*g:g}" fill="${r}"  />`;let b=m-g,x=b;for(let e=0;e<o.length;e++){const t=d[e].count/l*(_-2*b);y+=`<rect x="0" y="${x}" width="${_}" height="${t}" fill="${p[e]}" mask="url(#donutMask)"/>`,x+=t}return y+=`<text dominant-baseline="central" transform="translate(${m}, ${m})" >\n    ${n+i===1?"":n+i}\n    </text>`,y+="</svg>",y}function xE(e,t,n,i,r){t-e==1&&(t-=1e-5);const o=2*Math.PI*(e-.25),s=2*Math.PI*(t-.25),a=Math.cos(o),l=Math.sin(o),c=Math.cos(s),u=Math.sin(s),h=t-e>.5?1:0;return`<path d="M ${n+i*a} ${n+i*l} L ${n+n*a} ${n+n*l} A ${n} ${n} 0 ${h} 1 ${n+n*c} ${n+n*u} L ${n+i*c} ${n+i*u} A ${i} ${i} 0 ${h} 0 ${n+i*a} ${n+i*l}" fill="${r}" />`}const wE="\nuniform bool filter_useSoftMargin;\nuniform bool filter_enabled;\nuniform bool filter_transformSize;\nuniform ivec4 filter_categoryBitMask;\n#ifdef DATAFILTER_TYPE\nuniform DATAFILTER_TYPE filter_min;\nuniform DATAFILTER_TYPE filter_softMin;\nuniform DATAFILTER_TYPE filter_softMax;\nuniform DATAFILTER_TYPE filter_max;\nin DATAFILTER_TYPE filterValues;\n#ifdef DATAFILTER_DOUBLE\nin DATAFILTER_TYPE filterValues64Low;\nuniform DATAFILTER_TYPE filter_min64High;\nuniform DATAFILTER_TYPE filter_max64High;\n#endif\n#endif\n#ifdef DATACATEGORY_TYPE\nin DATACATEGORY_TYPE filterCategoryValues;\n#endif\nout float dataFilter_value;\nfloat dataFilter_reduceValue(float value) {\nreturn value;\n}\nfloat dataFilter_reduceValue(vec2 value) {\nreturn min(value.x, value.y);\n}\nfloat dataFilter_reduceValue(vec3 value) {\nreturn min(min(value.x, value.y), value.z);\n}\nfloat dataFilter_reduceValue(vec4 value) {\nreturn min(min(value.x, value.y), min(value.z, value.w));\n}\n#ifdef DATAFILTER_TYPE\nvoid dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {\nif (filter_useSoftMargin) {\nDATAFILTER_TYPE leftInRange = mix(\nsmoothstep(filter_min, filter_softMin, valueFromMin),\nstep(filter_min, valueFromMin),\nstep(filter_softMin, filter_min)\n);\nDATAFILTER_TYPE rightInRange = mix(\n1.0 - smoothstep(filter_softMax, filter_max, valueFromMax),\nstep(valueFromMax, filter_max),\nstep(filter_max, filter_softMax)\n);\ndataFilter_value = dataFilter_reduceValue(leftInRange * rightInRange);\n} else {\ndataFilter_value = dataFilter_reduceValue(\nstep(filter_min, valueFromMin) * step(valueFromMax, filter_max)\n);\n}\n}\n#endif\n#ifdef DATACATEGORY_TYPE\nvoid dataFilter_setCategoryValue(DATACATEGORY_TYPE category) {\n#if DATACATEGORY_CHANNELS == 1\nint dataFilter_masks = filter_categoryBitMask[int(category / 32.0)];\n#elif DATACATEGORY_CHANNELS == 2\nivec2 dataFilter_masks = ivec2(\nfilter_categoryBitMask[int(category.x / 32.0)],\nfilter_categoryBitMask[int(category.y / 32.0) + 2]\n);\n#elif DATACATEGORY_CHANNELS == 3\nivec3 dataFilter_masks = filter_categoryBitMask.xyz;\n#else\nivec4 dataFilter_masks = filter_categoryBitMask;\n#endif\nDATACATEGORY_TYPE dataFilter_bits = DATACATEGORY_TYPE(dataFilter_masks) / pow(DATACATEGORY_TYPE(2.0), mod(category, 32.0));\ndataFilter_bits = mod(floor(dataFilter_bits), 2.0);\n#if DATACATEGORY_CHANNELS == 1\nif(dataFilter_bits == 0.0) dataFilter_value = 0.0;\n#else\nif(any(equal(dataFilter_bits, DATACATEGORY_TYPE(0.0)))) dataFilter_value = 0.0;\n#endif\n}\n#endif\n",EE="\nuniform bool filter_transformColor;\nin float dataFilter_value;\n";function SE(e){if(!e||!("extensions"in e))return{};const{filterRange:t=[-1,1],filterEnabled:n=!0,filterTransformSize:i=!0,filterTransformColor:r=!0}=e,o=e.filterSoftRange||t;return{...Number.isFinite(t[0])?{filter_min:t[0],filter_softMin:o[0],filter_softMax:o[1],filter_max:t[1]}:{filter_min:t.map((e=>e[0])),filter_softMin:o.map((e=>e[0])),filter_softMax:o.map((e=>e[1])),filter_max:t.map((e=>e[1]))},filter_enabled:n,filter_useSoftMargin:Boolean(e.filterSoftRange),filter_transformSize:n&&i,filter_transformColor:n&&r}}const TE={"vs:#main-start":"\ndataFilter_value = 1.0;\nif (filter_enabled) {\n#ifdef DATAFILTER_TYPE\n#ifdef DATAFILTER_DOUBLE\ndataFilter_setValue(\nfilterValues - filter_min64High + filterValues64Low,\nfilterValues - filter_max64High + filterValues64Low\n);\n#else\ndataFilter_setValue(filterValues, filterValues);\n#endif\n#endif\n#ifdef DATACATEGORY_TYPE\ndataFilter_setCategoryValue(filterCategoryValues);\n#endif\n}\n","vs:#main-end":"\nif (dataFilter_value == 0.0) {\ngl_Position = vec4(0.);\n}\n","vs:DECKGL_FILTER_SIZE":"\nif (filter_transformSize) {\nsize = size * dataFilter_value;\n}\n","fs:DECKGL_FILTER_COLOR":"\nif (dataFilter_value == 0.0) discard;\nif (filter_transformColor) {\ncolor.a *= dataFilter_value;\n}\n"},AE={name:"data-filter",vs:wE,fs:EE,inject:TE,getUniforms:SE},CE={name:"data-filter-fp64",vs:wE,fs:EE,inject:TE,getUniforms:function(e){if(!e||!("extensions"in e))return{};const t=SE(e);if(Number.isFinite(t.filter_min)){const e=Math.fround(t.filter_min);t.filter_min-=e,t.filter_softMin-=e,t.filter_min64High=e;const n=Math.fround(t.filter_max);t.filter_max-=n,t.filter_softMax-=n,t.filter_max64High=n}else{const e=t.filter_min.map(Math.fround);t.filter_min=t.filter_min.map(((t,n)=>t-e[n])),t.filter_softMin=t.filter_softMin.map(((t,n)=>t-e[n])),t.filter_min64High=e;const n=t.filter_max.map(Math.fround);t.filter_max=t.filter_max.map(((e,t)=>e-n[t])),t.filter_softMax=t.filter_softMax.map(((e,t)=>e-n[t])),t.filter_max64High=n}return t}},PE=["float32-renderable-webgl","texture-blend-float-webgl"],IE={blend:!0,blendFunc:[1,1,1,1],blendEquation:[32774,32774],depthTest:!1},ME={getFilterValue:{type:"accessor",value:0},getFilterCategory:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterCategories:[0],filterTransformSize:!0,filterTransformColor:!0},RE={categorySize:0,filterSize:1,fp64:!1,countItems:!1},OE={1:"float",2:"vec2",3:"vec3",4:"vec4"};class kE extends qw{static{this.defaultProps=ME}static{this.extensionName="DataFilterExtension"}constructor(e={}){super({...RE,...e})}getShaders(e){const{categorySize:t,filterSize:n,fp64:i}=e.opts,r={};return t&&(r.DATACATEGORY_TYPE=OE[t],r.DATACATEGORY_CHANNELS=t),n&&(r.DATAFILTER_TYPE=OE[n],r.DATAFILTER_DOUBLE=Boolean(i)),{modules:[i?CE:AE],defines:r}}initializeState(e,t){const n=this.getAttributeManager(),{categorySize:i,filterSize:r,fp64:o}=t.opts;n&&(r&&n.add({filterValues:{size:r,type:o?"float64":"float32",stepMode:"dynamic",accessor:"getFilterValue"}}),i&&n.add({filterCategoryValues:{size:i,stepMode:"dynamic",accessor:"getFilterCategory",transform:1===i?e=>t._getCategoryKey.call(this,e,0):e=>e.map(((e,n)=>t._getCategoryKey.call(this,e,n)))}}));const{device:s}=this.context;if(n&&t.opts.countItems){const e=function(e){return PE.every((t=>e.features.has(t)))}(s);n.add({filterIndices:{size:e?1:2,vertexOffset:1,type:"unorm8",accessor:(t,{index:n})=>{const i=t&&t.__source?t.__source.index:n;return e?(i+1)%255:[(i+1)%255,Math.floor(i/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});const i=function(e,t){return t?e.createFramebuffer({width:1,height:1,colorAttachments:[e.createTexture({format:"rgba32float",type:5126,mipmaps:!1})]}):e.createFramebuffer({width:256,height:64,colorAttachments:[e.createTexture({format:"rgba8unorm",type:5126,mipmaps:!1})]})}(s,e),r=function(e,t,n){return t.defines.NON_INSTANCED_MODEL=1,n&&(t.defines.FLOAT_TARGET=1),new cv(e,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,drawMode:0,vs:"#version 300 es\n#define SHADER_NAME data-filter-vertex-shader\n\n#ifdef FLOAT_TARGET\n  in float filterIndices;\n  in float filterPrevIndices;\n#else\n  in vec2 filterIndices;\n  in vec2 filterPrevIndices;\n#endif\n\nout vec4 vColor;\nconst float component = 1.0 / 255.0;\n\nvoid main() {\n  #ifdef FLOAT_TARGET\n    dataFilter_value *= float(filterIndices != filterPrevIndices);\n    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n    vColor = vec4(0.0, 0.0, 0.0, 1.0);\n  #else\n    // Float texture is not supported: pack result into 4 channels x 256 px x 64px\n    dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);\n    float col = filterIndices.x;\n    float row = filterIndices.y * 4.0;\n    float channel = floor(row);\n    row = fract(row);\n    vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));\n    gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);\n  #endif\n  gl_PointSize = 1.0;\n}\n",fs:"#version 300 es\n#define SHADER_NAME data-filter-fragment-shader\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main() {\n  if (dataFilter_value < 0.5) {\n    discard;\n  }\n  fragColor = vColor;\n}\n",...t})}(s,t.getShaders.call(this,t),e);this.setState({filterFBO:i,filterModel:r})}}updateState({props:e,oldProps:t,changeFlags:n},i){const r=this.getAttributeManager(),{categorySize:o}=i.opts;if(this.state.filterModel){const n=r.attributes.filterValues?.needsUpdate()||r.attributes.filterCategoryValues?.needsUpdate()||e.filterEnabled!==t.filterEnabled||e.filterRange!==t.filterRange||e.filterSoftRange!==t.filterSoftRange||e.filterCategories!==t.filterCategories;n&&this.setState({filterNeedsUpdate:n})}if(r?.attributes.filterCategoryValues){const i=r.attributes.filterCategoryValues.needsUpdate()||!Do(e.filterCategories,t.filterCategories,2);i&&this.setState({categoryBitMaskNeedsUpdate:i}),n.dataChanged&&(this.setState({categoryMap:Array(o).fill(0).map((()=>({})))}),r.attributes.filterCategoryValues.setNeedsUpdate("categoryMap"))}}draw(e,t){const n=this.state.filterFBO,i=this.state.filterModel,r=this.state.filterNeedsUpdate,o=this.state.categoryBitMaskNeedsUpdate,{onFilteredItemsChange:s}=this.props;if(o&&t._updateCategoryBitMask.call(this,e,t),r&&s&&i){const{attributes:{filterValues:t,filterCategoryValues:r,filterIndices:o}}=this.getAttributeManager();i.setVertexCount(this.getNumInstances()),this.context.device.clearWebGL({framebuffer:n,color:[0,0,0,0]}),i.updateModuleSettings(e.moduleParameters),i.setAttributes({...t?.getValue(),...r?.getValue(),...o?.getValue()}),i.setUniforms(e.uniforms),i.device.withParametersWebGL({framebuffer:n,...IE,viewport:[0,0,n.width,n.height]},(()=>{i.draw(this.context.renderPass)}));const a=i.device.readPixelsToArrayWebGL(n);let l=0;for(let e=0;e<a.length;e++)l+=a[e];s({id:this.id,count:l}),this.state.filterNeedsUpdate=!1}}finalizeState(){const e=this.state.filterFBO,t=this.state.filterModel;e?.destroy(),t?.destroy()}_updateCategoryBitMask(e,t){const{categorySize:n}=t.opts,{filterCategories:i}=this.props,r=new Uint32Array([0,0,0,0]),o=1===n?[i]:i,s=1===n?128:2===n?64:32;for(let e=0;e<o.length;e++){const n=o[e];for(const i of n){const n=t._getCategoryKey.call(this,i,e);n<s?r[e*(s/32)+Math.floor(n/32)]+=Math.pow(2,n%32):rs.warn(`Exceeded maximum number of categories (${s})`)()}}e.uniforms.filter_categoryBitMask=r,this.state.categoryBitMaskNeedsUpdate=!1}_getCategoryKey(e,t){const n=this.state.categoryMap[t];return e in n||(n[e]=Object.keys(n).length),n[e]}}function LE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class DE extends qb{shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:n}){const i=n.dataChanged||e.sizeScale!==t.sizeScale||e.maxZoom!==t.maxZoom;if(i){const t=new dE({maxZoom:e.maxZoom,radius:e.sizeScale*Math.sqrt(2)});t.load(e.data),this.setState({index:t})}const r=Math.floor(this.context.viewport.zoom+1);(i||r!==this.state.z)&&this.setState({data:this.state.index.getClusters([-180,-85,180,85],r),z:r})}getPickingInfo({info:e,mode:t}){const n=e.object;if(n){var i;const e=null===(i=n.properties)||void 0===i?void 0:i.cluster_id;e&&(n.properties.expZoom=this.state.index.getClusterExpansionZoom(e))}return e}renderLayers(){var e,t;const n=[];null===(e=this.legendItems)||void 0===e||e.forEach((e=>{e.disabled||n.push(e.label)}));const{data:i}=this.state;var r;return new cx(this.getSubLayerProps({id:ne.Points,data:i,updateTriggers:{getIcon:this.time},getFilterValue:e=>e.properties.cluster?1:0,filterRange:[1,1],selectedFeatureIndexes:null!==(r=null===(t=this.getSelectedFeIndexes)||void 0===t?void 0:t.get(ne.Points))&&void 0!==r?r:[],getPosition:e=>e.geometry.coordinates,getIcon:e=>{const t={},i={};let r=e.properties.cluster?this.state.index.getLeaves(e.properties.cluster_id,"infinity"):"";if(Array.isArray(r)){e.properties.objects=r;let o=0,s=0;if(r.forEach((e=>{var r,a;const{color:l,label:c}=null===(r=e.properties)||void 0===r?void 0:r.threshold;if(n.length&&!n.includes(c))return;const{all_annots:u}=e.properties;if(u&&!(null===(a=this.legendItems.at(-1))||void 0===a?void 0:a.disabled)){var h;const e=ce(u,this.time),t=null==e||null===(h=e[0])||void 0===h?void 0:h.newState,n=Object.keys(J).find((e=>null==t?void 0:t.startsWith(e)));if(n){const e=J[n];i[e]=i[e]?{count:i[e].count+1,label:n}:{count:1,label:n},s+=1}else o+=1}else o+=1;t[l]=t[l]?{count:t[l].count+1,label:t[l].label}:{count:1,label:c}})),e.properties.colorCounts=t,e.properties.annotStateCounts=i,o>1)return{url:vE(bE({colorCounts:t,annotStateCounts:i,allTotal:o,allStTotal:s})),width:128,height:128}}return{url:vE('<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1">  \n</svg>'),width:1,height:1,id:"blank"}},iconSizeScale:1,getSize:e=>{var t;const n=this.selectedIp===(null===(t=e.properties)||void 0===t?void 0:t.locName),{cluster:i,threshold:r}=e.properties;if(i)return 45;{const{iconSize:e}=r;return e?n?1.5*e:e:30}},iconSizeUnits:"pixels",parameters:{depthTest:!1},extensions:[new kE({filterSize:1})],pickable:this.pickable,autoHighlight:!1}))}constructor(e){var t,n;super(e),LE(this,"selectedIp",void 0),LE(this,"pickable",void 0),LE(this,"getisShowPoints",void 0),LE(this,"getSelectedFeIndexes",void 0),LE(this,"time",void 0),LE(this,"cluster_id",void 0),LE(this,"id",void 0),LE(this,"legendItems",void 0),this.onHover=t=>{var n,i;return t.object?(t.object.properties.cluster_id!==(null===(i=e.hoverCluster)||void 0===i||null===(n=i.object)||void 0===n?void 0:n.cluster_id)&&e.setHoverCluster(t),e.setClosedHint(!1),e.setHoverInfo(t),!0):(e.setHoverInfo({}),!1)},this.cluster_id=null===(n=e.hoverCluster)||void 0===n||null===(t=n.object)||void 0===t?void 0:t.cluster_id,this.id=e.id,this.selectedIp=e.getSelectedIp,this.pickable=e.pickable,this.legendItems=e.legendItems,this.time=e.time}}function FE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const NE=e=>{var{children:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["children"]);return o().createElement("label",{style:{marginRight:"1em",marginTop:"0.5em"}},o().createElement(ml.Checkbox,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){FE(e,t,n[t])}))}return e}({style:{padding:0}},n)),t)};var BE=d(6089);const zE=e=>({checkBoxes:BE.css`
      color: ${e.colors.text}; 
      display: inline-block;      
      //font-Size: 12;
      //font-Style: italic;
      //padding-left: 5px;
       pointer-events: all;
      //margin: 1em 0em;
      //marginLeft: 1em;    
    `}),jE=Rl((()=>{const e=(0,ml.useStyles2)(zE),{pointStore:t,lineStore:n,replaceVariables:i}=xR(),{toggleShowSVG:s,toggleShowPoints:a,getisShowSVG:l,setMode:c,getisShowPoints:u,getisOffset:h,toggleOffset:d,setSelectedIp:p,setTooltipObject:f}=t,{getDirection:m,setDirection:g}=n,{isShowLines:_,toggleShowLines:y}=xR().lineStore,[v,b]=(0,r.useState)(!1),[x,w]=(0,r.useState)(!1);return["target","source"].includes(i("$locRole")),o().createElement(o().Fragment,null,o().createElement("div",{className:e.checkBoxes},o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,null,o().createElement(NE,{disabled:v,checked:u,title:"nodes",onChange:()=>{a(!u)}}," nodes")),o().createElement(ml.InlineField,null,o().createElement(NE,{checked:_,title:"edges",onChange:()=>{y(!_)}}," edges")),o().createElement(ml.InlineField,null,o().createElement(NE,{checked:l,title:"svg",onChange:()=>{s(!l)}}," svg")),o().createElement(ml.InlineField,null,o().createElement(NE,{checked:!h,title:"stat2 no offset",onChange:()=>{c("view"),d(!h)}}," stat2")))))}));var UE=d(8531);function VE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const GE={},$E="public/gazetteer/countries.json";function WE(e){return HE.apply(this,arguments)}function HE(){var e;return e=function*(e){e||(e=$E);let t=GE[e];if(!t){try{t=function(e,t){if(Array.isArray(t)){const n=t[0];if(n.latitude&&n.longitude&&(n.key||n.keys))return function(e,t){let n=0;const i=new Map;for(const e of t){const t={coords:[e.longitude,e.latitude]};if(e.name&&(i.set(e.name,t),i.set(e.name.toUpperCase(),t),t.props={name:e.name}),e.key&&(i.set(e.key,t),i.set(e.key.toUpperCase(),t)),e.keys)for(const n of e.keys)i.set(n,t),i.set(n.toUpperCase(),t);n++}return{path:e,find:e=>{let t=i.get(e);return t||(t=i.get(e.toUpperCase())),t},count:n,examples:e=>{const t=[];if(i.size<1)t.push("no values found");else for(const n of i.keys())if(t.push(n),t.length>=e)break;return t}}}(e,t)}return{path:e,error:"Unable to parse locations",find:e=>{},examples:e=>[]}}(e,yield(0,UE.getBackendSrv)().get(e))}catch(n){console.warn("Error loading placename lookup",e,n),t={path:e,error:"Error loading URL",find:e=>{},examples:e=>[]}}GE[e]=t}return t},HE=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){VE(o,i,r,s,a,"next",e)}function a(e){VE(o,i,r,s,a,"throw",e)}s(void 0)}))},HE.apply(this,arguments)}function qE(e){if(!(null==e?void 0:e.length))return;const t=[16,8,4,2,1];let n=!0;const i=[],r=[];let o;i[0]=-90,i[1]=90,r[0]=-180,r[1]=180,e.split("").forEach((e=>{o="0123456789bcdefghjkmnpqrstuvwxyz".indexOf(e),t.forEach((e=>{(function(e,t,n){t&n?e[0]=(e[0]+e[1])/2:e[1]=(e[0]+e[1])/2})(n?r:i,o,e),n=!n}))}));const s=(i[0]+i[1])/2;return[(r[0]+r[1])/2,s]}function XE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ZE;!function(e){e.Geojson="geojson",e.Auto="auto",e.Geohash="geohash",e.Coords="coords",e.Lookup="lookup"}(ZE||(ZE={}));const YE=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){XE(e,t,n[t])}))}return e}({},ZE);function KE(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function JE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QE(e){return t=>{for(const n of t.fields)if(e(n,t,[]))return n}}function eS(e){return n=>{for(const i of n.fields){if(e.has(i.name.toLowerCase()))return i;const r=(0,t.getFieldDisplayName)(i,n);if(e.has(r))return i}}}const tS={mode:YE.Auto,geojson:eS(new Set(["location","geojson"])),geohash:eS(new Set(["geohash"])),latitude:eS(new Set(["latitude","lat"])),longitude:eS(new Set(["longitude","lon","lng"])),h3:eS(new Set(["h3"])),wkt:eS(new Set(["wkt"])),lookup:eS(new Set(["lookup"]))};function nS(e){return iS.apply(this,arguments)}function iS(){var e;return e=function*(e){var n;const i=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){JE(e,t,n[t])}))}return e}({},tS),{mode:null!==(n=null==e?void 0:e.mode)&&void 0!==n?n:YE.Auto});switch(i.mode){case YE.Geohash:(null==e?void 0:e.geohash)&&(i.geohash=QE((0,t.getFieldMatcher)({id:t.FieldMatcherID.byName,options:e.geohash})));break;case YE.Lookup:(null==e?void 0:e.lookup)&&(i.lookup=QE((0,t.getFieldMatcher)({id:t.FieldMatcherID.byName,options:e.lookup}))),i.gazetteer=yield WE(null==e?void 0:e.gazetteer);break;case YE.Coords:(null==e?void 0:e.latitude)&&(i.latitude=QE((0,t.getFieldMatcher)({id:t.FieldMatcherID.byName,options:e.latitude}))),(null==e?void 0:e.longitude)&&(i.longitude=QE((0,t.getFieldMatcher)({id:t.FieldMatcherID.byName,options:e.longitude})));break;case YE.Geojson:(null==e?void 0:e.geojson)&&(i.geojson=QE((0,t.getFieldMatcher)({id:t.FieldMatcherID.byName,options:e.geojson})))}return i},iS=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){KE(o,i,r,s,a,"next",e)}function a(e){KE(o,i,r,s,a,"throw",e)}s(void 0)}))},iS.apply(this,arguments)}function rS(e,t){const n={points:[]};if(!(null==e?void 0:e.length))return n;const i=function(e,t){var n;const i={mode:null!==(n=t.mode)&&void 0!==n?n:YE.Auto};if(i.mode===YE.Auto){if(i.geojson=t.geojson(e),i.geojson)return i.mode=YE.Geojson,i;if(i.latitude=t.latitude(e),i.longitude=t.longitude(e),i.latitude&&i.longitude)return i.mode=YE.Coords,i;if(i.geohash=t.geohash(e),i.geohash)return i.mode=YE.Geohash,i;if(i.lookup=t.geohash(e),i.lookup)return i.mode=YE.Lookup,i}switch(i.mode){case YE.Geojson:i.geojson=t.geojson(e);break;case YE.Coords:i.latitude=t.latitude(e),i.longitude=t.longitude(e);break;case YE.Geohash:i.geohash=t.geohash(e);break;case YE.Lookup:i.lookup=t.lookup(e)}return i}(e,t);switch(i.mode){case YE.Geojson:i.geojson?n.points=function(e){const t=e.values.length,n=new Array(t);for(let t=0;t<e.values.length;t++)if(e.values[t]){const i=JSON.parse(e.values[t]);i&&(n[t]={type:i.type,coordinates:i.coordinates})}return n}(i.geojson):n.warning="Missing GeoJson fields";break;case YE.Coords:i.latitude&&i.longitude?n.points=function(e,t){const n=t.values.length,i=new Array(n);for(let r=0;r<n;r++)i[r]={type:"Point",coordinates:[e.values[r],t.values[r]]};return i}(i.longitude,i.latitude):n.warning="Missing latitude/longitude fields";break;case YE.Geohash:i.geohash?n.points=function(e){const t=e.values.length,n=new Array(t);for(let i=0;i<t;i++){const t=qE(e.values[i]);t&&(n[i]={type:"Point",coordinates:t})}return n}(i.geohash):n.warning="Missing geohash field";break;case YE.Lookup:i.lookup?t.gazetteer?n.points=function(e,t){const n=t.values.length,i=new Array(n);for(let r=0;r<n;r++){const n=e.find(t.values[r]);(null==n?void 0:n.coords)&&(i[r]={type:"Point",coordinates:null==n?void 0:n.coords})}return i}(t.gazetteer,i.lookup):n.warning="Gazetteer not found":n.warning="Missing lookup field";break;case YE.Auto:n.warning="Unable to find location fields"}return n}var oS=d(3241),sS=d.n(oS);function aS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class lS extends r.PureComponent{componentDidMount(){this.setState({text:isNaN(this.props.value)?"":`${this.props.value}`})}componentDidUpdate(e){if(this.props.value!==e.value){const e=isNaN(this.props.value)?"":`${this.props.value}`;e!==this.state.text&&this.setState({text:e})}}renderInput(){return o().createElement(ml.Input,{type:"number",ref:this.inputRef,min:this.props.min,max:this.props.max,step:this.props.step,autoFocus:this.props.autoFocus,value:this.state.text,onChange:this.onChange,onBlur:this.updateValue,onKeyPress:this.onKeyPress,placeholder:this.props.placeholder,disabled:this.props.fieldDisabled,width:this.props.width,suffix:this.props.suffix})}render(){const{inputCorrected:e}=this.state;if(e){let t="",{min:n,max:i}=this.props;return null==i?null!=n&&(t=`< ${n}`):t=null!=n?`${n} < > ${i}`:`> ${i}`,o().createElement(ml.Field,{invalid:e,error:`Out of range ${t}`,validationMessageHorizontalOverflow:!0,style:{direction:"rtl"}},this.renderInput())}return this.renderInput()}constructor(...e){super(...e),aS(this,"state",{text:"",inputCorrected:!1}),aS(this,"inputRef",o().createRef()),aS(this,"updateValue",(()=>{var e;const t=null===(e=this.inputRef.current)||void 0===e?void 0:e.value;let n=!1,i="";const r=this.props.min,o=this.props.max;let s=""!==t?Number(t):void 0;s&&!Number.isNaN(s)&&(null!=r&&s<r?(i=r.toString(),n=!0):null!=o&&s>o?(i=o.toString(),n=!0):i=null!=t?t:"",this.setState({text:i,inputCorrected:n})),n&&this.updateValueDebounced(),Number.isNaN(s)||s===this.props.value||this.props.onChange(s)})),aS(this,"updateValueDebounced",(0,oS.debounce)(this.updateValue,500)),aS(this,"onChange",(e=>{this.setState({text:e.currentTarget.value}),this.updateValueDebounced()})),aS(this,"onKeyPress",(e=>{"Enter"===e.key&&this.updateValue()}))}}const cS=({value:e,onChange:t,item:n})=>{const{settings:i}=n,s=(0,r.useCallback)((e=>{t((null==i?void 0:i.integer)&&void 0!==e?Math.floor(e):e)}),[t,null==i?void 0:i.integer]);return o().createElement(lS,{value:e,min:null==i?void 0:i.min,max:null==i?void 0:i.max,step:null==i?void 0:i.step,placeholder:null==i?void 0:i.placeholder,onChange:s})};var uS=d(9089);function hS(e){return hS="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hS(e)}function dS(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=hS(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!=hS(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==hS(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function fS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pS(Object(n),!0).forEach((function(t){dS(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function gS(e,t){if(e){if("string"==typeof e)return mS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mS(e,t):void 0}}function _S(e){return function(e){if(Array.isArray(e))return mS(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||gS(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||gS(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vS=d(4452),bS=d.n(vS);function xS(e){var t=r.useRef();t.current=e;var n=r.useCallback((function(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(i))}),[]);return n}var wS="undefined"!=typeof window&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,ES=function(e,t){!function(e,t){var n=r.useRef(!0);wS((function(){return e(n.current)}),t),wS((function(){return n.current=!1,function(){n.current=!0}}),[])}((function(t){if(!t)return e()}),t)};function SS(e){var t=r.useRef(!1),n=yS(r.useState(e),2),i=n[0],o=n[1];return r.useEffect((function(){return t.current=!1,function(){t.current=!0}}),[]),[i,function(e,n){n&&t.current||o(e)}]}function TS(e){return void 0!==e}var AS={},CS=[];function PS(e,t){}function IS(e,t){}function MS(e,t,n){t||AS[n]||(e(!1,n),AS[n]=!0)}function RS(e,t){MS(PS,e,t)}RS.preMessage=function(e){CS.push(e)},RS.resetWarned=function(){AS={}},RS.noteOnce=function(e,t){MS(IS,e,t)};const OS=RS,kS=r.createContext({min:0,max:0,direction:"ltr",step:1,includedStart:0,includedEnd:0,tabIndex:0,keyboard:!0,styles:{},classNames:{}});function LS(){return LS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},LS.apply(this,arguments)}function DS(e,t){if(null==e)return{};var n={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}function FS(e,t){if(null==e)return{};var n,i,r=DS(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var NS={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=NS.F1&&t<=NS.F12)return!1;switch(t){case NS.ALT:case NS.CAPS_LOCK:case NS.CONTEXT_MENU:case NS.CTRL:case NS.DOWN:case NS.END:case NS.ESC:case NS.HOME:case NS.INSERT:case NS.LEFT:case NS.MAC_FF_META:case NS.META:case NS.NUMLOCK:case NS.NUM_CENTER:case NS.PAGE_DOWN:case NS.PAGE_UP:case NS.PAUSE:case NS.PRINT_SCREEN:case NS.RIGHT:case NS.SHIFT:case NS.UP:case NS.WIN_KEY:case NS.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=NS.ZERO&&e<=NS.NINE)return!0;if(e>=NS.NUM_ZERO&&e<=NS.NUM_MULTIPLY)return!0;if(e>=NS.A&&e<=NS.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case NS.SPACE:case NS.QUESTION_MARK:case NS.NUM_PLUS:case NS.NUM_MINUS:case NS.NUM_PERIOD:case NS.NUM_DIVISION:case NS.SEMICOLON:case NS.DASH:case NS.EQUALS:case NS.COMMA:case NS.PERIOD:case NS.SLASH:case NS.APOSTROPHE:case NS.SINGLE_QUOTE:case NS.OPEN_SQUARE_BRACKET:case NS.BACKSLASH:case NS.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};const BS=NS;function zS(e,t,n){return(e-t)/(n-t)}function jS(e,t,n,i){var r=zS(t,n,i),o={};switch(e){case"rtl":o.right="".concat(100*r,"%"),o.transform="translateX(50%)";break;case"btt":o.bottom="".concat(100*r,"%"),o.transform="translateY(50%)";break;case"ttb":o.top="".concat(100*r,"%"),o.transform="translateY(-50%)";break;default:o.left="".concat(100*r,"%"),o.transform="translateX(-50%)"}return o}function US(e,t){return Array.isArray(e)?e[t]:e}var VS=["prefixCls","value","valueIndex","onStartMove","style","render","dragging","onOffsetChange","onChangeComplete"];const GS=r.forwardRef((function(e,t){var n,i,o=e.prefixCls,s=e.value,a=e.valueIndex,l=e.onStartMove,c=e.style,u=e.render,h=e.dragging,d=e.onOffsetChange,p=e.onChangeComplete,f=FS(e,VS),m=r.useContext(kS),g=m.min,_=m.max,y=m.direction,v=m.disabled,b=m.keyboard,x=m.range,w=m.tabIndex,E=m.ariaLabelForHandle,S=m.ariaLabelledByForHandle,T=m.ariaValueTextFormatterForHandle,A=m.styles,C=m.classNames,P="".concat(o,"-handle"),I=function(e){v||l(e,a)},M=jS(y,s,g,_),R=r.createElement("div",LS({ref:t,className:bS()(P,(n={},dS(n,"".concat(P,"-").concat(a+1),x),dS(n,"".concat(P,"-dragging"),h),n),C.handle),style:fS(fS(fS({},M),c),A.handle),onMouseDown:I,onTouchStart:I,onKeyDown:function(e){if(!v&&b){var t=null;switch(e.which||e.keyCode){case BS.LEFT:t="ltr"===y||"btt"===y?-1:1;break;case BS.RIGHT:t="ltr"===y||"btt"===y?1:-1;break;case BS.UP:t="ttb"!==y?1:-1;break;case BS.DOWN:t="ttb"!==y?-1:1;break;case BS.HOME:t="min";break;case BS.END:t="max";break;case BS.PAGE_UP:t=2;break;case BS.PAGE_DOWN:t=-2}null!==t&&(e.preventDefault(),d(t,a))}},onKeyUp:function(e){switch(e.which||e.keyCode){case BS.LEFT:case BS.RIGHT:case BS.UP:case BS.DOWN:case BS.HOME:case BS.END:case BS.PAGE_UP:case BS.PAGE_DOWN:null==p||p()}},tabIndex:v?null:US(w,a),role:"slider","aria-valuemin":g,"aria-valuemax":_,"aria-valuenow":s,"aria-disabled":v,"aria-label":US(E,a),"aria-labelledby":US(S,a),"aria-valuetext":null===(i=US(T,a))||void 0===i?void 0:i(s),"aria-orientation":"ltr"===y||"rtl"===y?"horizontal":"vertical"},f));return u&&(R=u(R,{index:a,prefixCls:o,value:s,dragging:h})),R}));var $S=["prefixCls","style","onStartMove","onOffsetChange","values","handleRender","draggingIndex"],WS=r.forwardRef((function(e,t){var n=e.prefixCls,i=e.style,o=e.onStartMove,s=e.onOffsetChange,a=e.values,l=e.handleRender,c=e.draggingIndex,u=FS(e,$S),h=r.useRef({});return r.useImperativeHandle(t,(function(){return{focus:function(e){var t;null===(t=h.current[e])||void 0===t||t.focus()}}})),r.createElement(r.Fragment,null,a.map((function(e,t){return r.createElement(GS,LS({ref:function(e){e?h.current[t]=e:delete h.current[t]},dragging:c===t,prefixCls:n,style:US(i,t),key:t,value:e,valueIndex:t,onStartMove:o,onOffsetChange:s,render:l},u))})))}));const HS=WS;function qS(e){var t="touches"in e?e.touches[0]:e;return{pageX:t.pageX,pageY:t.pageY}}function XS(e){var t=e.prefixCls,n=e.style,i=e.children,o=e.value,s=e.onClick,a=r.useContext(kS),l=a.min,c=a.max,u=a.direction,h=a.includedStart,d=a.includedEnd,p=a.included,f="".concat(t,"-text"),m=jS(u,o,l,c);return r.createElement("span",{className:bS()(f,dS({},"".concat(f,"-active"),p&&h<=o&&o<=d)),style:fS(fS({},m),n),onMouseDown:function(e){e.stopPropagation()},onClick:function(){s(o)}},i)}function ZS(e){var t=e.prefixCls,n=e.marks,i=e.onClick,o="".concat(t,"-mark");return n.length?r.createElement("div",{className:o},n.map((function(e){var t=e.value,n=e.style,s=e.label;return r.createElement(XS,{key:t,prefixCls:o,style:n,value:t,onClick:i},s)}))):null}function YS(e){var t=e.prefixCls,n=e.value,i=e.style,o=e.activeStyle,s=r.useContext(kS),a=s.min,l=s.max,c=s.direction,u=s.included,h=s.includedStart,d=s.includedEnd,p="".concat(t,"-dot"),f=u&&h<=n&&n<=d,m=fS(fS({},jS(c,n,a,l)),"function"==typeof i?i(n):i);return f&&(m=fS(fS({},m),"function"==typeof o?o(n):o)),r.createElement("span",{className:bS()(p,dS({},"".concat(p,"-active"),f)),style:m})}function KS(e){var t=e.prefixCls,n=e.marks,i=e.dots,o=e.style,s=e.activeStyle,a=r.useContext(kS),l=a.min,c=a.max,u=a.step,h=r.useMemo((function(){var e=new Set;if(n.forEach((function(t){e.add(t.value)})),i&&null!==u)for(var t=l;t<=c;)e.add(t),t+=u;return Array.from(e)}),[l,c,u,i,n]);return r.createElement("div",{className:"".concat(t,"-step")},h.map((function(e){return r.createElement(YS,{prefixCls:t,key:e,value:e,style:o,activeStyle:s})})))}function JS(e){var t,n=e.prefixCls,i=e.style,o=e.start,s=e.end,a=e.index,l=e.onStartMove,c=e.replaceCls,u=r.useContext(kS),h=u.direction,d=u.min,p=u.max,f=u.disabled,m=u.range,g=u.classNames,_="".concat(n,"-track"),y=zS(o,d,p),v=zS(s,d,p),b=function(e){!f&&l&&l(e,-1)},x={};switch(h){case"rtl":x.right="".concat(100*y,"%"),x.width="".concat(100*v-100*y,"%");break;case"btt":x.bottom="".concat(100*y,"%"),x.height="".concat(100*v-100*y,"%");break;case"ttb":x.top="".concat(100*y,"%"),x.height="".concat(100*v-100*y,"%");break;default:x.left="".concat(100*y,"%"),x.width="".concat(100*v-100*y,"%")}var w=c||bS()(_,(dS(t={},"".concat(_,"-").concat(a+1),null!==a&&m),dS(t,"".concat(n,"-track-draggable"),l),t),g.track);return r.createElement("div",{className:w,style:fS(fS({},x),i),onMouseDown:b,onTouchStart:b})}function QS(e){var t=e.prefixCls,n=e.style,i=e.values,o=e.startPoint,s=e.onStartMove,a=r.useContext(kS),l=a.included,c=a.range,u=a.min,h=a.styles,d=a.classNames,p=r.useMemo((function(){if(!c){if(0===i.length)return[];var e=null!=o?o:u,t=i[0];return[{start:Math.min(e,t),end:Math.max(e,t)}]}for(var n=[],r=0;r<i.length-1;r+=1)n.push({start:i[r],end:i[r+1]});return n}),[i,c,o,u]),f=null;return(d.tracks||h.tracks)&&(f=r.createElement(JS,{index:null,prefixCls:t,start:p[0].start,end:p[p.length-1].end,replaceCls:bS()(d.tracks,"".concat(t,"-tracks")),style:h.tracks})),l?r.createElement(r.Fragment,null,f,p.map((function(e,i){var o=e.start,a=e.end;return r.createElement(JS,{index:i,prefixCls:t,style:fS(fS({},US(n,i)),h.track),start:o,end:a,key:i,onStartMove:s})}))):null}var eT=r.forwardRef((function(e,t){var n,i=e.prefixCls,o=void 0===i?"rc-slider":i,s=e.className,a=e.style,l=e.classNames,c=e.styles,u=e.disabled,h=void 0!==u&&u,d=e.keyboard,p=void 0===d||d,f=e.autoFocus,m=e.onFocus,g=e.onBlur,_=e.min,y=void 0===_?0:_,v=e.max,b=void 0===v?100:v,x=e.step,w=void 0===x?1:x,E=e.value,S=e.defaultValue,T=e.range,A=e.count,C=e.onChange,P=e.onBeforeChange,I=e.onAfterChange,M=e.onChangeComplete,R=e.allowCross,O=void 0===R||R,k=e.pushable,L=void 0!==k&&k,D=e.draggableTrack,F=e.reverse,N=e.vertical,B=e.included,z=void 0===B||B,j=e.startPoint,U=e.trackStyle,V=e.handleStyle,G=e.railStyle,$=e.dotStyle,W=e.activeDotStyle,H=e.marks,q=e.dots,X=e.handleRender,Z=e.tabIndex,Y=void 0===Z?0:Z,K=e.ariaLabelForHandle,J=e.ariaLabelledByForHandle,Q=e.ariaValueTextFormatterForHandle,ee=r.useRef(),te=r.useRef(),ne=r.useMemo((function(){return N?F?"ttb":"btt":F?"rtl":"ltr"}),[F,N]),ie=r.useMemo((function(){return isFinite(y)?y:0}),[y]),re=r.useMemo((function(){return isFinite(b)?b:100}),[b]),oe=r.useMemo((function(){return null!==w&&w<=0?1:w}),[w]),se=r.useMemo((function(){return"boolean"==typeof L?!!L&&oe:L>=0&&L}),[L,oe]),ae=r.useMemo((function(){return Object.keys(H||{}).map((function(e){var t=H[e],n={value:Number(e)};return t&&"object"===hS(t)&&!r.isValidElement(t)&&("label"in t||"style"in t)?(n.style=t.style,n.label=t.label):n.label=t,n})).filter((function(e){var t=e.label;return t||"number"==typeof t})).sort((function(e,t){return e.value-t.value}))}),[H]),le=function(e,t,n,i,o,s){var a=r.useCallback((function(n){var i=isFinite(n);return i=Math.min(t,n),Math.max(e,i)}),[e,t]),l=r.useCallback((function(i){if(null!==n){var r=e+Math.round((a(i)-e)/n)*n,o=function(e){return(String(e).split(".")[1]||"").length},s=Math.max(o(n),o(t),o(e)),l=Number(r.toFixed(s));return e<=l&&l<=t?l:null}return null}),[n,e,t,a]),c=r.useCallback((function(r){var o=a(r),s=i.map((function(e){return e.value}));null!==n&&s.push(l(r)),s.push(e,t);var c=s[0],u=t-e;return s.forEach((function(e){var t=Math.abs(o-e);t<=u&&(c=e,u=t)})),c}),[e,t,i,n,a,l]),u=function r(o,s,a){var c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit";if("number"==typeof s){var u,h=o[a],d=h+s,p=[];i.forEach((function(e){p.push(e.value)})),p.push(e,t),p.push(l(h));var f=s>0?1:-1;"unit"===c?p.push(l(h+f*n)):p.push(l(d)),p=p.filter((function(e){return null!==e})).filter((function(e){return s<0?e<=h:e>=h})),"unit"===c&&(p=p.filter((function(e){return e!==h})));var m="unit"===c?h:d;u=p[0];var g=Math.abs(u-m);if(p.forEach((function(e){var t=Math.abs(e-m);t<g&&(u=e,g=t)})),void 0===u)return s<0?e:t;if("dist"===c)return u;if(Math.abs(s)>1){var _=_S(o);return _[a]=u,r(_,s-f,a,c)}return u}return"min"===s?e:"max"===s?t:void 0},h=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",r=e[n],o=u(e,t,n,i);return{value:o,changed:o!==r}},d=function(e){return null===s&&0===e||"number"==typeof s&&e<s};return[c,function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unit",r=e.map(c),a=r[n],l=u(r,t,n,i);if(r[n]=l,!1===o){var p=s||0;n>0&&r[n-1]!==a&&(r[n]=Math.max(r[n],r[n-1]+p)),n<r.length-1&&r[n+1]!==a&&(r[n]=Math.min(r[n],r[n+1]-p))}else if("number"==typeof s||null===s){for(var f=n+1;f<r.length;f+=1)for(var m=!0;d(r[f]-r[f-1])&&m;){var g=h(r,1,f);r[f]=g.value,m=g.changed}for(var _=n;_>0;_-=1)for(var y=!0;d(r[_]-r[_-1])&&y;){var v=h(r,-1,_-1);r[_-1]=v.value,y=v.changed}for(var b=r.length-1;b>0;b-=1)for(var x=!0;d(r[b]-r[b-1])&&x;){var w=h(r,-1,b-1);r[b-1]=w.value,x=w.changed}for(var E=0;E<r.length-1;E+=1)for(var S=!0;d(r[E+1]-r[E])&&S;){var T=h(r,1,E+1);r[E+1]=T.value,S=T.changed}}return{value:r[n],values:r}}]}(ie,re,oe,ae,O,se),ce=yS(le,2),ue=ce[0],he=ce[1],de=function(e,t){var n=t||{},i=n.defaultValue,r=n.value,o=n.onChange,s=n.postState,a=yS(SS((function(){return TS(r)?r:TS(i)?"function"==typeof i?i():i:"function"==typeof e?e():e})),2),l=a[0],c=a[1],u=void 0!==r?r:l,h=s?s(u):u,d=xS(o),p=yS(SS([u]),2),f=p[0],m=p[1];return ES((function(){var e=f[0];l!==e&&d(l,e)}),[f]),ES((function(){TS(r)||c(r)}),[r]),[h,xS((function(e,t){c(e,t),m([u],t)}))]}(S,{value:E}),pe=yS(de,2),fe=pe[0],me=pe[1],ge=r.useMemo((function(){var e=null==fe?[]:Array.isArray(fe)?fe:[fe],t=yS(e,1)[0],n=null===fe?[]:[void 0===t?ie:t];if(T){if(n=_S(e),A||void 0===fe){var i=A>=0?A+1:2;for(n=n.slice(0,i);n.length<i;){var r;n.push(null!==(r=n[n.length-1])&&void 0!==r?r:ie)}}n.sort((function(e,t){return e-t}))}return n.forEach((function(e,t){n[t]=ue(e)})),n}),[fe,T,ie,A,ue]),_e=r.useRef(ge);_e.current=ge;var ye=function(e){return T?e:e[0]},ve=function(e){var t=_S(e).sort((function(e,t){return e-t}));C&&!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=new Set;return function e(t,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=i.has(t);if(OS(!s,"Warning: There may be circular references"),s)return!1;if(t===r)return!0;if(n&&o>1)return!1;i.add(t);var a=o+1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var l=0;l<t.length;l++)if(!e(t[l],r[l],a))return!1;return!0}if(t&&r&&"object"===hS(t)&&"object"===hS(r)){var c=Object.keys(t);return c.length===Object.keys(r).length&&c.every((function(n){return e(t[n],r[n],a)}))}return!1}(e,t)}(t,_e.current,!0)&&C(ye(t)),me(t)},be=function(){null==I||I(ye(_e.current)),OS(!I,"[rc-slider] `onAfterChange` is deprecated. Please use `onChangeComplete` instead."),null==M||M(ye(_e.current))},xe=function(e,t,n,i,o,s,a,l,c){var u=yS(r.useState(null),2),h=u[0],d=u[1],p=yS(r.useState(-1),2),f=p[0],m=p[1],g=yS(r.useState(n),2),_=g[0],y=g[1],v=yS(r.useState(n),2),b=v[0],x=v[1],w=r.useRef(null),E=r.useRef(null);r.useEffect((function(){-1===f&&y(n)}),[n,f]),r.useEffect((function(){return function(){document.removeEventListener("mousemove",w.current),document.removeEventListener("mouseup",E.current),document.removeEventListener("touchmove",w.current),document.removeEventListener("touchend",E.current)}}),[]);var S=function(e,t){_.some((function(t,n){return t!==e[n]}))&&(void 0!==t&&d(t),y(e),a(e))},T=function(e,t){if(-1===e){var n=b[0],r=b[b.length-1],a=i-n,l=o-r,u=t*(o-i);u=Math.max(u,a),u=Math.min(u,l);var h=s(n+u);u=h-n;var d=b.map((function(e){return e+u}));S(d)}else{var p=(o-i)*t,f=_S(_);f[e]=b[e];var m=c(f,p,e,"dist");S(m.values,m.value)}},A=r.useRef(T);A.current=T;var C=r.useMemo((function(){var e=_S(n).sort((function(e,t){return e-t})),t=_S(_).sort((function(e,t){return e-t}));return e.every((function(e,n){return e===t[n]}))?_:n}),[n,_]);return[f,h,C,function(i,r,o){i.stopPropagation();var s=o||n,a=s[r];m(r),d(a),x(s);var c=qS(i),u=c.pageX,h=c.pageY,p=function(n){n.preventDefault();var i,o=qS(n),s=o.pageX,a=o.pageY,l=s-u,c=a-h,d=e.current.getBoundingClientRect(),p=d.width,f=d.height;switch(t){case"btt":i=-c/f;break;case"ttb":i=c/f;break;case"rtl":i=-l/p;break;default:i=l/p}A.current(r,i)},f=function e(t){t.preventDefault(),document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",p),document.removeEventListener("touchend",e),document.removeEventListener("touchmove",p),w.current=null,E.current=null,m(-1),l()};document.addEventListener("mouseup",f),document.addEventListener("mousemove",p),document.addEventListener("touchend",f),document.addEventListener("touchmove",p),w.current=p,E.current=f}]}(te,ne,ge,ie,re,ue,ve,be,he),we=yS(xe,4),Ee=we[0],Se=we[1],Te=we[2],Ae=we[3],Ce=function(e,t){if(!h){var n=0,i=re-ie;ge.forEach((function(t,r){var o=Math.abs(e-t);o<=i&&(i=o,n=r)}));var r=_S(ge);r[n]=e,T&&!ge.length&&void 0===A&&r.push(e),null==P||P(ye(r)),ve(r),t&&Ae(t,n,r)}},Pe=yS(r.useState(null),2),Ie=Pe[0],Me=Pe[1];r.useEffect((function(){if(null!==Ie){var e=ge.indexOf(Ie);e>=0&&ee.current.focus(e)}Me(null)}),[Ie]);var Re=r.useMemo((function(){return(!D||null!==oe)&&D}),[D,oe]),Oe=function(e,t){Ae(e,t),null==P||P(ye(_e.current))},ke=-1!==Ee;r.useEffect((function(){if(!ke){var e=ge.lastIndexOf(Se);ee.current.focus(e)}}),[ke]);var Le=r.useMemo((function(){return _S(Te).sort((function(e,t){return e-t}))}),[Te]),De=yS(r.useMemo((function(){return T?[Le[0],Le[Le.length-1]]:[ie,Le[0]]}),[Le,T,ie]),2),Fe=De[0],Ne=De[1];r.useImperativeHandle(t,(function(){return{focus:function(){ee.current.focus(0)},blur:function(){var e=document.activeElement;te.current.contains(e)&&(null==e||e.blur())}}})),r.useEffect((function(){f&&ee.current.focus(0)}),[]);var Be=r.useMemo((function(){return{min:ie,max:re,direction:ne,disabled:h,keyboard:p,step:oe,included:z,includedStart:Fe,includedEnd:Ne,range:T,tabIndex:Y,ariaLabelForHandle:K,ariaLabelledByForHandle:J,ariaValueTextFormatterForHandle:Q,styles:c||{},classNames:l||{}}}),[ie,re,ne,h,p,oe,z,Fe,Ne,T,Y,K,J,Q,c,l]);return r.createElement(kS.Provider,{value:Be},r.createElement("div",{ref:te,className:bS()(o,s,(n={},dS(n,"".concat(o,"-disabled"),h),dS(n,"".concat(o,"-vertical"),N),dS(n,"".concat(o,"-horizontal"),!N),dS(n,"".concat(o,"-with-marks"),ae.length),n)),style:a,onMouseDown:function(e){e.preventDefault();var t,n=te.current.getBoundingClientRect(),i=n.width,r=n.height,o=n.left,s=n.top,a=n.bottom,l=n.right,c=e.clientX,u=e.clientY;switch(ne){case"btt":t=(a-u)/r;break;case"ttb":t=(u-s)/r;break;case"rtl":t=(l-c)/i;break;default:t=(c-o)/i}Ce(ue(ie+t*(re-ie)),e)}},r.createElement("div",{className:bS()("".concat(o,"-rail"),null==l?void 0:l.rail),style:fS(fS({},G),null==c?void 0:c.rail)}),r.createElement(QS,{prefixCls:o,style:U,values:Le,startPoint:j,onStartMove:Re?Oe:null}),r.createElement(KS,{prefixCls:o,marks:ae,dots:q,style:$,activeStyle:W}),r.createElement(HS,{ref:ee,prefixCls:o,style:V,values:Te,draggingIndex:Ee,onStartMove:Oe,onOffsetChange:function(e,t){if(!h){var n=he(ge,e,t);null==P||P(ye(ge)),ve(n.values),Me(n.value)}},onFocus:m,onBlur:g,handleRender:X,onChangeComplete:be}),r.createElement(ZS,{prefixCls:o,marks:ae,onClick:Ce})))}));const tT=eT,nT=({value:e,onChange:t,item:n})=>{const i=(0,r.useRef)(null),{settings:s}=n,a=(null==s?void 0:s.min)||0,l=(null==s?void 0:s.max)||100,c=null==s?void 0:s.step,u=(null==s?void 0:s.marks)||{[a]:a,[l]:l},h=null==s?void 0:s.included,d=null==s?void 0:s.ariaLabelForHandle,p=(0,ml.useTheme2)(),[f,m]=(0,r.useState)(null!=e?e:a),[g,_]=(0,r.useState)(75);(0,r.useEffect)((()=>{null!=e&&e!==f&&m(e)}),[e,f]),(0,r.useEffect)((()=>{const e=getComputedStyle(i.current),t=e.getPropertyValue("font-weight")||"normal",n=e.getPropertyValue("font-size")||"16px",r=e.getPropertyValue("font-family")||"Arial",o=Math.max((l+(c||0)).toString().length,(l-(c||0)).toString().length)+4,s=function(e,t){const n=document.createElement("canvas").getContext("2d");return n?(n.font=t,n.measureText(e).width):null}("0".repeat(o),`${t} ${n} ${r}`);s&&_(s+16)}),[l,c]);const y=(0,r.useCallback)((e=>{const n="number"==typeof e?e:e[0];m(n),t&&t(n)}),[m,t]),v=(0,r.useCallback)((e=>{let n=e;!Number.isNaN(n)&&n||(n=0),m(n),t&&t(n)}),[t]),b=((e,t,n=!1)=>{const{spacing:i}=e,r=e.colors.border.strong,o=e.colors.primary.main,s=e.colors.primary.main,a=`box-shadow: 0px 0px 0px 6px ${e.colors.primary.transparent}`;return{container:(0,BE.css)({width:"100%",margin:t?"inherit":i(1,3,1,1),paddingBottom:t&&n?e.spacing(1):"inherit",height:t?"auto":"100%"}),slider:BE.css`
      .rc-slider {
        display: flex;
        flex-grow: 1;
        margin-left: 7px; // half the size of the handle to align handle to the left on 0 value
      }
      .rc-slider-mark {
        top: ${e.spacing(1.75)};
      }
      .rc-slider-mark-text {
        color: ${e.colors.text.disabled};
        font-size: ${e.typography.bodySmall.fontSize};
      }
      .rc-slider-mark-text-active {
        color: ${e.colors.text.primary};
      }
      .rc-slider-handle {
        border: none;
        background-color: ${s};
        box-shadow: ${e.shadows.z1};
        cursor: pointer;
        opacity: 1;
      }

      .rc-slider-handle:hover,
      .rc-slider-handle:active,
      .rc-slider-handle-click-focused:focus {
        ${a};
      }

      // The triple class names is needed because that's the specificity used in the source css :(
      .rc-slider-handle-dragging.rc-slider-handle-dragging.rc-slider-handle-dragging,
      .rc-slider-handle:focus-visible {
        box-shadow: 0 0 0 5px ${e.colors.text.primary};
      }

      .rc-slider-dot,
      .rc-slider-dot-active {
        background-color: ${e.colors.text.primary};
        border-color: ${e.colors.text.primary};
      }

      .rc-slider-track {
        background-color: ${o};
      }
      .rc-slider-rail {
        background-color: ${r};
        cursor: pointer;
      }
    `,tooltip:uS.css`
      body {
        .rc-slider-tooltip {
          cursor: grab;
          user-select: none;
          z-index: ${e.zIndex.tooltip};
        }

        .rc-slider-tooltip-inner {
          color: ${e.colors.text.primary};
          background-color: transparent !important;
          border-radius: 0;
          box-shadow: none;
        }

        .rc-slider-tooltip-placement-top .rc-slider-tooltip-arrow {
          display: none;
        }

        .rc-slider-tooltip-placement-top {
          padding: 0;
        }
      }
    `,sliderInput:(0,BE.css)({display:"flex",flexDirection:"row",alignItems:"center",width:"100%"}),sliderInputVertical:(0,BE.css)({flexDirection:"column",height:"100%",".rc-slider":{margin:0,order:2}}),sliderInputField:(0,BE.css)({marginLeft:e.spacing(3),width:"60px",input:{textAlign:"center"}}),sliderInputFieldVertical:(0,BE.css)({margin:`0 0 ${e.spacing(3)} 0`,order:1})}})(p,!0,Boolean(u)),x=iT(p,g);return o().createElement("div",{className:(0,BE.cx)(b.container,b.slider)},o().createElement(uS.Global,{styles:b.slider}),o().createElement("div",{className:(0,BE.cx)(b.sliderInput)},o().createElement(tT,{min:a,max:l,step:c,defaultValue:e,value:f,onChange:y,vertical:!1,reverse:!1,ariaLabelForHandle:d,marks:u,included:h}),o().createElement("span",{className:x.numberInputWrapper,ref:i},o().createElement(lS,{value:f,onChange:v,max:l,min:a,step:c}))))},iT=(e,t)=>({numberInputWrapper:(0,BE.css)({marginLeft:e.spacing(3),maxHeight:"32px",maxWidth:t,minWidth:t,overflow:"visible",width:"100%"})});function rT(e){return(0,ml.getFieldTypeIconName)(null==e?void 0:e.type)}var oT;function sT(e,n){return(0,r.useMemo)((()=>function(e,n){const i={display:new Set,raw:new Set,fields:new Map};for(const r of e)for(const o of r.fields){if(n&&!n(o))continue;const s=(0,t.getFieldDisplayName)(o,r,e);i.display.add(s),i.fields.set(s,o),o.name&&s!==o.name&&(i.raw.add(o.name),i.fields.set(o.name,o))}return i}(e,n)),[e,n])}function aT(e,t,n,i,o){return(0,r.useMemo)((()=>{let r=!1;const s=[];if(n&&s.push(n),"only"===o)for(const n of e.raw)r||n!==t||(r=!0),s.push({value:n,label:`${n} (base field name)`});else{for(const n of e.display){r||n!==t||(r=!0);const o=e.fields.get(n);i&&i!==(null==o?void 0:o.type)||s.push({value:n,label:n,icon:o?rT(o):void 0})}if("exclude"!==o)for(const n of e.raw)e.display.has(n)||(r||n!==t||(r=!0),s.push({value:n,label:`${n} (base field name)`}))}return t&&!r&&s.push({value:t,label:`${t} (not found)`}),s}),[e,t,n,i,o])}function lT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cT(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){lT(e,t,n[t])}))}return e}function uT(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}!function(e){e.IncludeAll="all",e.ExcludeBaseNames="exclude",e.OnlyBaseNames="only"}(oT||(oT={}));const hT={label:"Fixed color",value:"_____fixed_____"},dT=e=>{var t,n,i,s;const{value:a,context:l,onChange:c,item:u}=e,h="dark-green",d=(0,ml.useStyles2)(pT),p=null==a?void 0:a.field,f=a&&Boolean(!p)&&(null==a?void 0:a.fixed),m=aT(sT(l.data),p,hT,null===(t=u.settings)||void 0===t?void 0:t.filteredFieldType,null===(n=u.settings)||void 0===n?void 0:n.baseNameMode),g=(0,r.useCallback)((e=>{if(!e)return void c(void 0);const t=e.value;if(t&&t!==hT.value)c(uT(cT({},a),{field:t}));else{var n;const e=null!==(n=null==a?void 0:a.fixed)&&void 0!==n?n:h;c(uT(cT({},a),{field:void 0,fixed:e}))}}),[c,a]),_=(0,r.useCallback)((e=>{c({field:void 0,fixed:null!=e?e:h})}),[c]),y=f?hT:m.find((e=>e.value===p));return o().createElement(o().Fragment,null,o().createElement("div",{className:d.container},o().createElement(ml.Select,{value:y,options:m,onChange:g,noOptionsMessage:"No fields found",isClearable:null===(i=u.settings)||void 0===i?void 0:i.isClearable,placeholder:null===(s=u.settings)||void 0===s?void 0:s.placeholder}),f&&o().createElement("div",{className:d.picker},o().createElement(ml.ColorPicker,{color:null==a?void 0:a.fixed,onChange:_,enableNamedColors:!0}))))},pT=e=>({container:BE.css`
    display: flex;
    flex-wrap: nowrap;
    justify-content: flex-end;
    align-items: center;
  `,picker:BE.css`
    padding-left: 8px;
  `});var fT=(e=>(e.Linear="linear",e.Quad="quad",e))(fT||{}),mT=(e=>(e.Clamped="clamped",e.Mod="mod",e))(mT||{}),gT=(e=>(e.Field="field",e.Fixed="fixed",e.Template="template",e))(gT||{}),_T=(e=>(e.Field="field",e.Fixed="fixed",e.Mapping="mapping",e))(_T||{});const yT=Object.freeze({fixed:"",mode:gT.Field,field:""});var vT,bT,xT,wT;function ET(e,n){const i=function(e,n,i){if(n&&(null==e?void 0:e.length))for(let i=0;i<n.fields.length;i++){const r=n.fields[i];if(e===r.name)return i;if(e===(0,t.getFieldDisplayName)(r,n,undefined))return i}}(n,e);return null==i?void 0:e.fields[i]}function ST(e){var n;const i=null===(n=e.state)||void 0===n?void 0:n.calcs;if(i){const e=i[t.ReducerID.lastNotNull];if(null!=e)return e}const r=e.values;let o=r.length-1;for(;o>=0;){const e=r[o--];if(null!=e)return e}}function TT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function AT(e,n,i){return function(e,n,i){var r;if(!e){var o,s;const e=i.visualization.getColorByName(null!==(s=n.fixed)&&void 0!==s?s:"grey");return{isAssumed:Boolean(null===(o=n.field)||void 0===o?void 0:o.length)||!n.fixed,fixed:e,value:()=>e,get:t=>e}}const a=(0,t.getFieldColorModeForField)(e);if(a.isByValue||(null===(r=e.config.mappings)||void 0===r?void 0:r.length)){const n=(0,t.getFieldConfigWithMinMax)(e,!0);n!==e.config&&(e=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){TT(e,t,n[t])}))}return e}({},e),{config:n}),e.state=void 0);const r=(0,t.getDisplayProcessor)({field:e,theme:i}),o=e=>{var t;return null!==(t=r(e).color)&&void 0!==t?t:"#ccc"};return{field:e,get:t=>o(e.values[t]),value:()=>o(ST(e))}}const l=a.getCalculator(e,i)(0,0);return{fixed:l,value:()=>l,get:e=>l,field:e}}(ET(e,n.field),n,i)}function CT(e,n){return function(e,n,i){if(!e){var r,o;const e=null!==(o=n.fixed)&&void 0!==o?o:0;return{isAssumed:Boolean(null===(r=n.field)||void 0===r?void 0:r.length)||!n.fixed,fixed:e,value:()=>e,get:()=>e}}const s=(0,t.getMinMaxAndDelta)(e),a=n.max-n.min;if(e.values.length<1||a<=0||s.delta<=0)return{fixed:n.min,value:()=>n.min,get:()=>n.min};let l=e=>n.min+e*a;if(void 0===fT.Quad){const e=Math.PI*Math.pow(n.max/2,2),t=Math.PI*Math.pow(n.min/2,2),i=e-t;l=e=>{let n=t+i*e;return 2*Math.sqrt(n/Math.PI)}}const c=t=>{const n=e.values[t];let i=0;return n!==-1/0&&(i=(n-s.min)/s.delta),i>1?i=1:i<0&&(i=0),l(i)};return{get:c,value:()=>c(ST(e)),field:e}}(ET(e,null==n?void 0:n.field),n)}function PT(e){return e||(e={min:0,max:1}),null==e.min&&(e.min=0),null==e.max&&(e.max=1),e}function IT(e,n){const i=n.field?ET(e,n.field):null==e?void 0:e.fields.find((e=>e.type===t.FieldType.string));return function(e,n){let i=n.fixed;var r;const o=null!==(r=n.mode)&&void 0!==r?r:gT.Fixed;if(o===gT.Fixed)return{isAssumed:!Boolean(i),fixed:i,value:()=>i,get:e=>i};if(o===gT.Template){const t=e=>`TEMPLATE[${n.fixed} // ${e}]`;return e?{field:e,get:n=>t(e.values[n]),value:()=>t(ST(e))}:(i=t(""),{isAssumed:!0,fixed:i,value:()=>i,get:e=>i})}if(!e)return{isAssumed:!0,fixed:i,value:()=>i,get:e=>i};let s=n=>(0,t.formattedValueToString)(e.display(n));return{field:e,get:t=>s(e.values[t]),value:()=>s(ST(e))}}(i,n)}function MT(e){return e?e.indexOf(":/")>0?window.__grafana_public_path__:e.startsWith(vT.Custom)?e:"public/plugins/vaduga-mapgl-panel/img/icons/"+e+".svg":""}!function(e){e.Cisco="img/icons/cisco",e.Networking="img/icons/networking",e.Databases="img/icons/databases",e.Custom="public/img/icons/mapgl",e.BG="public/img/bg"}(vT||(vT={})),function(e){e.Icon="icon",e.Image="image"}(bT||(bT={})),function(e){e.Folder="folder",e.URL="url",e.Upload="upload"}(xT||(xT={})),function(e){e.SMALL="small",e.NORMAL="normal"}(wT||(wT={}));var RT=e=>"string"!=typeof e?{}:e.split(/ ?; ?/).reduce(((e,t)=>{const[n,i]=t.split(/ ?: ?/).map(((e,t)=>0===t?e.replace(/\s+/g,""):e.trim()));if(n&&i){const t=n.replace(/(\w)-(\w)/g,((e,t,n)=>`${t}${n.toUpperCase()}`));let r=i.trim();Number.isNaN(Number(i))||(r=Number(i)),e[n.startsWith("-")?n:t]=r}return e}),{}),OT=["br","col","colgroup","dl","hr","iframe","img","input","link","menuitem","meta","ol","param","select","table","tbody","tfoot","thead","tr","ul","wbr"],kT={"accept-charset":"acceptCharset",acceptcharset:"acceptCharset",accesskey:"accessKey",allowfullscreen:"allowFullScreen",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",cellpadding:"cellPadding",cellspacing:"cellSpacing",charset:"charSet",class:"className",classid:"classID",classname:"className",colspan:"colSpan",contenteditable:"contentEditable",contextmenu:"contextMenu",controlslist:"controlsList",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",datetime:"dateTime",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",enctype:"encType",for:"htmlFor",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",innerhtml:"innerHTML",inputmode:"inputMode",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",marginwidth:"marginWidth",marginheight:"marginHeight",maxlength:"maxLength",mediagroup:"mediaGroup",minlength:"minLength",nomodule:"noModule",novalidate:"noValidate",playsinline:"playsInline",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rowspan:"rowSpan",spellcheck:"spellCheck",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",tabindex:"tabIndex",typemustmatch:"typeMustMatch",usemap:"useMap",accentheight:"accentHeight","accent-height":"accentHeight",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",arabicform:"arabicForm","arabic-form":"arabicForm",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",diffuseconstant:"diffuseConstant",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",edgemode:"edgeMode",enablebackground:"enableBackground","enable-background":"enableBackground",externalresourcesrequired:"externalResourcesRequired",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",imagerendering:"imageRendering","image-rendering":"imageRendering",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",numoctaves:"numOctaves",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",specularconstant:"specularConstant",specularexponent:"specularExponent",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",vmathematical:"vMathematical","v-mathematical":"vMathematical",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",ychannelselector:"yChannelSelector",zoomandpan:"zoomAndPan",onblur:"onBlur",onchange:"onChange",onclick:"onClick",oncontextmenu:"onContextMenu",ondoubleclick:"onDoubleClick",ondrag:"onDrag",ondragend:"onDragEnd",ondragenter:"onDragEnter",ondragexit:"onDragExit",ondragleave:"onDragLeave",ondragover:"onDragOver",ondragstart:"onDragStart",ondrop:"onDrop",onerror:"onError",onfocus:"onFocus",oninput:"onInput",oninvalid:"onInvalid",onkeydown:"onKeyDown",onkeypress:"onKeyPress",onkeyup:"onKeyUp",onload:"onLoad",onmousedown:"onMouseDown",onmouseenter:"onMouseEnter",onmouseleave:"onMouseLeave",onmousemove:"onMouseMove",onmouseout:"onMouseOut",onmouseover:"onMouseOver",onmouseup:"onMouseUp",onscroll:"onScroll",onsubmit:"onSubmit",ontouchcancel:"onTouchCancel",ontouchend:"onTouchEnd",ontouchmove:"onTouchMove",ontouchstart:"onTouchStart",onwheel:"onWheel"};function LT(e,t,n){const i=[...e].map(((e,i)=>DT(e,{...n,index:i,level:t+1}))).filter(Boolean);return i.length?i:null}function DT(e,t={}){if(!(e&&e instanceof Node))return null;const{actions:n=[],index:i=0,level:o=0,randomKey:s}=t;let a=e,l=`${o}-${i}`;const c=[];return s&&0===o&&(l=`${function(e=6){let t="";for(let n=e;n>0;--n)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.round(61*Math.random())];return t}()}-${l}`),Array.isArray(n)&&n.forEach((t=>{t.condition(a,l,o)&&("function"==typeof t.pre&&(a=t.pre(a,l,o),a instanceof Node||(a=e)),"function"==typeof t.post&&c.push(t.post(a,l,o)))})),c.length?c:function(e,t){const{key:n,level:i,...o}=t;switch(e.nodeType){case 1:return r.createElement((s=e.nodeName,/[a-z]+[A-Z]+[a-z]+/.test(s)?s:s.toLowerCase()),function(e,t){const n={key:t};if(e instanceof Element){const t=e.getAttribute("class");t&&(n.className=t),[...e.attributes].forEach((e=>{switch(e.name){case"class":break;case"style":n[e.name]=RT(e.value);break;case"allowfullscreen":case"allowpaymentrequest":case"async":case"autofocus":case"autoplay":case"checked":case"controls":case"default":case"defer":case"disabled":case"formnovalidate":case"hidden":case"ismap":case"itemscope":case"loop":case"multiple":case"muted":case"nomodule":case"novalidate":case"open":case"readonly":case"required":case"reversed":case"selected":case"typemustmatch":n[kT[e.name]||e.name]=!0;break;default:n[kT[e.name]||e.name]=e.value}}))}return n}(e,n),LT(e.childNodes,i,o));case 3:{const t=e.nodeValue?.toString()??"";if(!o.allowWhiteSpaces&&/^\s+$/.test(t)&&!/[\u00A0\u202F]/.test(t))return null;if(!e.parentNode)return t;const n=e.parentNode.nodeName.toLowerCase();return OT.includes(n)?(/\S/.test(t)&&console.warn(`A textNode is not allowed inside '${n}'. Your text "${t}" will be ignored`),null):t}case 8:default:return null;case 11:return LT(e.childNodes,i,t)}var s}(a,{key:l,level:o,...t})}function FT(e,t={}){return"string"==typeof e?function(e,t={}){if(!e||"string"!=typeof e)return null;const{includeAllNodes:n=!1,nodeOnly:i=!1,selector:r="body > *",type:o="text/html"}=t;try{const s=(new DOMParser).parseFromString(e,o);if(n){const{childNodes:e}=s.body;return i?e:[...e].map((e=>DT(e,t)))}const a=s.querySelector(r)||s.body.childNodes[0];if(!(a instanceof Node))throw new TypeError("Error parsing input");return i?a:DT(a,t)}catch(e){}return null}(e,t):e instanceof Node?DT(e,t):null}var NT=d(2540),BT=Object.defineProperty,zT=(e,t,n)=>(((e,t,n)=>{t in e?BT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n),jT="react-inlinesvg",UT={IDLE:"idle",LOADING:"loading",LOADED:"loaded",FAILED:"failed",READY:"ready",UNSUPPORTED:"unsupported"};function VT(){return!("undefined"==typeof window||!window.document||!window.document.createElement)}async function GT(e,t){const n=await fetch(e,t),i=n.headers.get("content-type"),[r]=(i??"").split(/ ?; ?/);if(n.status>299)throw new Error("Not found");if(!["image/svg+xml","text/plain"].some((e=>r.includes(e))))throw new Error(`Content type isn't valid: ${r}`);return n.text()}function $T(e=1){return new Promise((t=>{setTimeout(t,1e3*e)}))}var WT,HT=class{constructor(){zT(this,"cacheApi"),zT(this,"cacheStore"),zT(this,"subscribers",[]),zT(this,"isReady",!1),this.cacheStore=new Map;let e=jT,t=!1;VT()&&(e=window.REACT_INLINESVG_CACHE_NAME??jT,t=!!window.REACT_INLINESVG_PERSISTENT_CACHE&&"caches"in window),t?caches.open(e).then((e=>{this.cacheApi=e,this.isReady=!0,this.subscribers.forEach((e=>e()))})).catch((e=>{this.isReady=!0,console.error(`Failed to open cache: ${e.message}`)})):this.isReady=!0}onReady(e){this.isReady?e():this.subscribers.push(e)}async get(e,t){return await(this.cacheApi?this.fetchAndAddToPersistentCache(e,t):this.fetchAndAddToInternalCache(e,t)),this.cacheStore.get(e)?.content??""}set(e,t){this.cacheStore.set(e,t)}isCached(e){return this.cacheStore.get(e)?.status===UT.LOADED}async fetchAndAddToInternalCache(e,t){const n=this.cacheStore.get(e);if(n?.status!==UT.LOADING){if(!n?.content){this.cacheStore.set(e,{content:"",status:UT.LOADING});try{const n=await GT(e,t);this.cacheStore.set(e,{content:n,status:UT.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:UT.FAILED}),t}}}else await this.handleLoading(e,(async()=>{this.cacheStore.set(e,{content:"",status:UT.IDLE}),await this.fetchAndAddToInternalCache(e,t)}))}async fetchAndAddToPersistentCache(e,t){const n=this.cacheStore.get(e);if(n?.status===UT.LOADED)return;if(n?.status===UT.LOADING)return void await this.handleLoading(e,(async()=>{this.cacheStore.set(e,{content:"",status:UT.IDLE}),await this.fetchAndAddToPersistentCache(e,t)}));this.cacheStore.set(e,{content:"",status:UT.LOADING});const i=await(this.cacheApi?.match(e));if(i){const t=await i.text();this.cacheStore.set(e,{content:t,status:UT.LOADED})}else try{await(this.cacheApi?.add(new Request(e,t)));const n=await(this.cacheApi?.match(e)),i=await(n?.text())??"";this.cacheStore.set(e,{content:i,status:UT.LOADED})}catch(t){throw this.cacheStore.set(e,{content:"",status:UT.FAILED}),t}}async handleLoading(e,t){let n=0;for(;this.cacheStore.get(e)?.status===UT.LOADING&&n<10;)await $T(.1),n+=1;n>=10&&await t()}keys(){return[...this.cacheStore.keys()]}data(){return[...this.cacheStore.entries()].map((([e,t])=>({[e]:t})))}async delete(e){this.cacheApi&&await this.cacheApi.delete(e),this.cacheStore.delete(e)}async clear(){if(this.cacheApi){const e=await this.cacheApi.keys();for(const t of e)await this.cacheApi.delete(t)}this.cacheStore.clear()}};function qT(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e})),t.current}function XT(e){const{baseURL:t,content:n,description:i,handleError:r,hash:o,preProcessor:s,title:a,uniquifyIDs:l=!1}=e;try{const e=function(e,t){return t?t(e):e}(n,s),r=FT(e,{nodeOnly:!0});if(!(r&&r instanceof SVGSVGElement))throw new Error("Could not convert the src to a DOM Node");const c=ZT(r,{baseURL:t,hash:o,uniquifyIDs:l});if(i){const e=c.querySelector("desc");e?.parentNode&&e.parentNode.removeChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","desc");t.innerHTML=i,c.prepend(t)}if(void 0!==a){const e=c.querySelector("title");if(e?.parentNode&&e.parentNode.removeChild(e),a){const e=document.createElementNS("http://www.w3.org/2000/svg","title");e.innerHTML=a,c.prepend(e)}}return c}catch(e){return r(e)}}function ZT(e,t){const{baseURL:n="",hash:i,uniquifyIDs:r}=t,o=["id","href","xlink:href","xlink:role","xlink:arcrole"],s=["href","xlink:href"];return r?([...e.children].forEach((e=>{if(e.attributes?.length){const t=Object.values(e.attributes).map((e=>{const t=e,r=/url\((.*?)\)/.exec(e.value);return r?.[1]&&(t.value=e.value.replace(r[0],`url(${n}${r[1]}__${i})`)),t}));o.forEach((e=>{const n=t.find((t=>t.name===e));n&&!((e,t)=>s.includes(e)&&!!t&&!t.includes("#"))(e,n.value)&&(n.value=`${n.value}__${i}`)}))}return e.children.length?ZT(e,t):e})),e):e}function YT(e){const{cacheRequests:t=!0,children:n=null,description:i,fetchOptions:o,innerRef:s,loader:a=null,onError:l,onLoad:c,src:u,title:h,uniqueHash:d}=e,[p,f]=(0,r.useReducer)(((e,t)=>({...e,...t})),{content:"",element:null,isCached:t&&WT.isCached(e.src),status:UT.IDLE}),{content:m,element:g,isCached:_,status:y}=p,v=qT(e),b=qT(p),x=(0,r.useRef)(d??function(e){const t="abcdefghijklmnopqrstuvwxyz",n=`${t}${t.toUpperCase()}1234567890`;let i="";for(let e=0;e<8;e++)i+=(r=n)[Math.floor(Math.random()*r.length)];var r;return i}()),w=(0,r.useRef)(!1),E=(0,r.useRef)(!1),S=(0,r.useCallback)((e=>{w.current&&(f({status:"Browser does not support SVG"===e.message?UT.UNSUPPORTED:UT.FAILED}),l?.(e))}),[l]),T=(0,r.useCallback)(((e,t=!1)=>{w.current&&f({content:e,isCached:t,status:UT.LOADED})}),[]),A=(0,r.useCallback)((async()=>{const e=await GT(u,o);T(e)}),[o,T,u]),C=(0,r.useCallback)((()=>{try{const t=FT(XT({...e,handleError:S,hash:x.current,content:m}));if(!t||!(0,r.isValidElement)(t))throw new Error("Could not convert the src to a React element");f({element:t,status:UT.READY})}catch(e){S(new Error(e.message))}}),[m,S,e]),P=(0,r.useCallback)((async()=>{const e=/^data:image\/svg[^,]*?(;base64)?,(.*)/u.exec(u);let n;if(e?n=e[1]?window.atob(e[2]):decodeURIComponent(e[2]):u.includes("<svg")&&(n=u),n)T(n);else try{if(t){const e=await WT.get(u,o);T(e,!0)}else await A()}catch(e){S(e)}}),[t,A,o,S,T,u]),I=(0,r.useCallback)((async()=>{w.current&&f({content:"",element:null,isCached:!1,status:UT.LOADING})}),[]);(0,r.useEffect)((()=>{if(w.current=!0,!VT()||E.current)return()=>{};try{if(y===UT.IDLE){if(!function(){if(!document)return!1;const e=document.createElement("div");e.innerHTML="<svg />";const t=e.firstChild;return!!t&&"http://www.w3.org/2000/svg"===t.namespaceURI}()||"undefined"==typeof window||null===window)throw new Error("Browser does not support SVG");if(!u)throw new Error("Missing src");I()}}catch(e){S(e)}return E.current=!0,()=>{w.current=!1}}),[]),(0,r.useEffect)((()=>{if(VT()&&v)if(v.src!==u){if(!u)return void S(new Error("Missing src"));I()}else v.title===h&&v.description===i||C()}),[i,C,S,I,v,u,h]),(0,r.useEffect)((()=>{b&&(b.status!==UT.LOADING&&y===UT.LOADING&&P(),b.status!==UT.LOADED&&y===UT.LOADED&&C(),b.status!==UT.READY&&y===UT.READY&&c?.(u,_))}),[P,C,_,c,b,u,y]);const M=function(e,...t){const n={};for(const i in e)({}).hasOwnProperty.call(e,i)&&(t.includes(i)||(n[i]=e[i]));return n}(e,"baseURL","cacheRequests","children","description","fetchOptions","innerRef","loader","onError","onLoad","preProcessor","src","title","uniqueHash","uniquifyIDs");return VT()?g?(0,r.cloneElement)(g,{ref:s,...M}):[UT.UNSUPPORTED,UT.FAILED].includes(y)?n:a:a}function KT(e){WT||(WT=new HT);const{loader:t}=e,n=(0,r.useRef)(!1),[i,o]=(0,r.useState)(WT.isReady);return(0,r.useEffect)((()=>{n.current||(WT.onReady((()=>{o(!0)})),n.current=!0)}),[]),i?(0,NT.jsx)(YT,{...e}):t}const JT={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let QT;const eA=new Uint8Array(16);function tA(){if(!QT&&(QT="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!QT))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return QT(eA)}const nA=[];for(let e=0;e<256;++e)nA.push((e+256).toString(16).slice(1));const iA=function(e,t,n){if(JT.randomUUID&&!t&&!e)return JT.randomUUID();const i=(e=e||{}).random||(e.rng||tA)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return nA[e[t+0]]+nA[e[t+1]]+nA[e[t+2]]+nA[e[t+3]]+"-"+nA[e[t+4]]+nA[e[t+5]]+"-"+nA[e[t+6]]+nA[e[t+7]]+"-"+nA[e[t+8]]+nA[e[t+9]]+"-"+nA[e[t+10]]+nA[e[t+11]]+nA[e[t+12]]+nA[e[t+13]]+nA[e[t+14]]+nA[e[t+15]]}(i)};function rA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const oA=e=>{const{cleanStyle:t}=e,n=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["cleanStyle"]);return o().createElement(KT,function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){rA(e,t,n[t])}))}return e}({},n),{cacheRequests:!0,preProcessor:aA}))};let sA=new Map;function aA(e){let n=sA.get(e);if(!n){const{svgText:i}=ge(e,!0);n=t.textUtil.sanitizeSVGContent(i),n.indexOf('<style type="text/css">')>-1&&(n=(e=>{let t=(e=>{var t;return null===(t=e.match(new RegExp("<svg.*id\\s*=\\s*(['\"])(.*?)\\1")))||void 0===t?void 0:t[2]})(e);if(!t){t=`x${iA()}`;const n=e.indexOf("<svg")+5;e=e.substring(0,n)+`id="${t}" `+e.substring(n)}let n=(e=>{const t=e.match(new RegExp('<style type="text/css">([\\s\\S]*?)<\\/style>'));return t?t[0]:null})(e);if(n){let i=n.replace(/(#(.*?))?\./g,`#${t} .`);e=e.replace(n,i)}return e})(n)),sA.set(e,n)}return n}const lA={prefix:String(Math.round(1e10*Math.random())),current:0},cA=r.createContext(lA),uA=r.createContext(!1);let hA=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),dA=new WeakMap;const pA="function"==typeof r.useId?function(e){let t=r.useId(),[n]=(0,r.useState)("function"==typeof r.useSyncExternalStore?r.useSyncExternalStore(gA,fA,mA):(0,r.useContext)(uA));return e||`${n?"react-aria":`react-aria${lA.prefix}`}-${t}`}:function(e){let t=(0,r.useContext)(cA);t!==lA||hA||console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server.");let n=function(e=!1){let t=(0,r.useContext)(cA),n=(0,r.useRef)(null);if(null===n.current&&!e){var i,o;let e=null===(o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)||void 0===o||null===(i=o.ReactCurrentOwner)||void 0===i?void 0:i.current;if(e){let n=dA.get(e);null==n?dA.set(e,{id:t.current,state:e.memoizedState}):e.memoizedState!==n.state&&(t.current=n.id,dA.delete(e))}n.current=++t.current}return n.current}(!!e),i=`react-aria${t.prefix}`;return e||`${i}-${n}`};function fA(){return!1}function mA(){return!0}function gA(e){return()=>{}}const _A="undefined"!=typeof document?r.useLayoutEffect:()=>{};function yA(e){const t=(0,r.useRef)(null);return _A((()=>{t.current=e}),[e]),(0,r.useCallback)(((...e)=>{const n=t.current;return null==n?void 0:n(...e)}),[])}let vA=Boolean("undefined"!=typeof window&&window.document&&window.document.createElement),bA=new Map;function xA(e=[]){let t=function(e){let[t,n]=(0,r.useState)(e),i=(0,r.useRef)(null),o=pA(t),s=(0,r.useCallback)((e=>{i.current=e}),[]);return vA&&bA.set(o,s),_A((()=>{let e=o;return()=>{bA.delete(e)}}),[o]),(0,r.useEffect)((()=>{let e=i.current;e&&(i.current=null,n(e))})),o}(),[n,i]=function(e){let[t,n]=(0,r.useState)(e),i=(0,r.useRef)(null),o=yA((()=>{if(!i.current)return;let e=i.current.next();e.done?i.current=null:t===e.value?o():n(e.value)}));_A((()=>{i.current&&o()}));let s=yA((e=>{i.current=e(t),o()}));return[t,s]}(t),o=(0,r.useCallback)((()=>{i((function*(){yield t,yield document.getElementById(t)?t:void 0}))}),[t,i]);return _A(o,[t,o,...e]),n}const wA=e=>{var t;return null!==(t=null==e?void 0:e.ownerDocument)&&void 0!==t?t:document},EA=e=>e&&"window"in e&&e.window===e?e:wA(e).defaultView||window,SA=new Set(["id"]),TA=new Set(["aria-label","aria-labelledby","aria-describedby","aria-details"]),AA=new Set(["href","target","rel","download","ping","referrerPolicy"]),CA=/^(data-.*)$/;function PA(e,t={}){let{labelable:n,isLink:i,propNames:r}=t,o={};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(SA.has(t)||n&&TA.has(t)||i&&AA.has(t)||(null==r?void 0:r.has(t))||CA.test(t))&&(o[t]=e[t]);return o}function IA(e){if(function(){if(null==MA){MA=!1;try{document.createElement("div").focus({get preventScroll(){return MA=!0,!0}})}catch(e){}}return MA}())e.focus({preventScroll:!0});else{let t=function(e){let t=e.parentNode,n=[],i=document.scrollingElement||document.documentElement;for(;t instanceof HTMLElement&&t!==i;)(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth)&&n.push({element:t,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft}),t=t.parentNode;return i instanceof HTMLElement&&n.push({element:i,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}),n}(e);e.focus(),function(e){for(let{element:t,scrollTop:n,scrollLeft:i}of e)t.scrollTop=n,t.scrollLeft=i}(t)}}let MA=null;let RA=new Map,OA=new Set;function kA(){if("undefined"==typeof window)return;function e(e){return"propertyName"in e}let t=n=>{if(!e(n)||!n.target)return;let i=RA.get(n.target);if(i&&(i.delete(n.propertyName),0===i.size&&(n.target.removeEventListener("transitioncancel",t),RA.delete(n.target)),0===RA.size)){for(let e of OA)e();OA.clear()}};document.body.addEventListener("transitionrun",(n=>{if(!e(n)||!n.target)return;let i=RA.get(n.target);i||(i=new Set,RA.set(n.target,i),n.target.addEventListener("transitioncancel",t,{once:!0})),i.add(n.propertyName)})),document.body.addEventListener("transitionend",t)}function LA(){return e=/^Mac/i,"undefined"!=typeof window&&null!=window.navigator&&e.test((null===(t=window.navigator.userAgentData)||void 0===t?void 0:t.platform)||window.navigator.platform);var e,t}function DA(e){return!(0!==e.mozInputSource||!e.isTrusted)||(t=/Android/i,"undefined"!=typeof window&&null!=window.navigator&&((null===(n=window.navigator.userAgentData)||void 0===n?void 0:n.brands.some((e=>t.test(e.brand))))||t.test(window.navigator.userAgent))&&e.pointerType?"click"===e.type&&1===e.buttons:0===e.detail&&!e.pointerType);var t,n}"undefined"!=typeof document&&("loading"!==document.readyState?kA():document.addEventListener("DOMContentLoaded",kA)),"undefined"!=typeof document&&window.visualViewport,new Map;const FA=e=>{var t;return null!==(t=null==e?void 0:e.ownerDocument)&&void 0!==t?t:document},NA=e=>e&&"window"in e&&e.window===e?e:FA(e).defaultView||window;let BA=null,zA=new Set,jA=new Map,UA=!1,VA=!1;function GA(e,t){for(let n of zA)n(e,t)}function $A(e){UA=!0,function(e){return!(e.metaKey||!LA()&&e.altKey||e.ctrlKey||"Control"===e.key||"Shift"===e.key||"Meta"===e.key)}(e)&&(BA="keyboard",GA("keyboard",e))}function WA(e){BA="pointer","mousedown"!==e.type&&"pointerdown"!==e.type||(UA=!0,GA("pointer",e))}function HA(e){DA(e)&&(UA=!0,BA="virtual")}function qA(e){e.target!==window&&e.target!==document&&(UA||VA||(BA="virtual",GA("virtual",e)),UA=!1,VA=!1)}function XA(){UA=!1,VA=!0}function ZA(e){if("undefined"==typeof window||jA.get(NA(e)))return;const t=NA(e),n=FA(e);let i=t.HTMLElement.prototype.focus;t.HTMLElement.prototype.focus=function(){UA=!0,i.apply(this,arguments)},n.addEventListener("keydown",$A,!0),n.addEventListener("keyup",$A,!0),n.addEventListener("click",HA,!0),t.addEventListener("focus",qA,!0),t.addEventListener("blur",XA,!1),"undefined"!=typeof PointerEvent?(n.addEventListener("pointerdown",WA,!0),n.addEventListener("pointermove",WA,!0),n.addEventListener("pointerup",WA,!0)):(n.addEventListener("mousedown",WA,!0),n.addEventListener("mousemove",WA,!0),n.addEventListener("mouseup",WA,!0)),t.addEventListener("beforeunload",(()=>{YA(e)}),{once:!0}),jA.set(t,{focus:i})}const YA=(e,t)=>{const n=NA(e),i=FA(e);t&&i.removeEventListener("DOMContentLoaded",t),jA.has(n)&&(n.HTMLElement.prototype.focus=jA.get(n).focus,i.removeEventListener("keydown",$A,!0),i.removeEventListener("keyup",$A,!0),i.removeEventListener("click",HA,!0),n.removeEventListener("focus",qA,!0),n.removeEventListener("blur",XA,!1),"undefined"!=typeof PointerEvent?(i.removeEventListener("pointerdown",WA,!0),i.removeEventListener("pointermove",WA,!0),i.removeEventListener("pointerup",WA,!0)):(i.removeEventListener("mousedown",WA,!0),i.removeEventListener("mousemove",WA,!0),i.removeEventListener("mouseup",WA,!0)),jA.delete(n))};function KA(e){const t=wA(e);if("virtual"===BA){let i=t.activeElement;n=()=>{t.activeElement===i&&e.isConnected&&IA(e)},requestAnimationFrame((()=>{0===RA.size?n():OA.add(n)}))}else IA(e);var n}function JA(e,t){return"#comment"!==e.nodeName&&function(e){const t=EA(e);if(!(e instanceof t.HTMLElement||e instanceof t.SVGElement))return!1;let{display:n,visibility:i}=e.style,r="none"!==n&&"hidden"!==i&&"collapse"!==i;if(r){const{getComputedStyle:t}=e.ownerDocument.defaultView;let{display:n,visibility:i}=t(e);r="none"!==n&&"hidden"!==i&&"collapse"!==i}return r}(e)&&function(e,t){return!e.hasAttribute("hidden")&&("DETAILS"!==e.nodeName||!t||"SUMMARY"===t.nodeName||e.hasAttribute("open"))}(e,t)&&(!e.parentElement||JA(e.parentElement,e))}"undefined"!=typeof document&&function(e){const t=FA(e);let n;"loading"!==t.readyState?ZA(e):(n=()=>{ZA(e)},t.addEventListener("DOMContentLoaded",n))}(),new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);const QA=r.createContext(null);let eC=null;function tC(e){let{children:t,contain:n,restoreFocus:i,autoFocus:o}=e,s=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)([]),{parentNode:c}=(0,r.useContext)(QA)||{},u=(0,r.useMemo)((()=>new mC({scopeRef:l})),[l]);_A((()=>{let e=c||gC.root;if(gC.getTreeNode(e.scopeRef)&&eC&&!uC(eC,e.scopeRef)){let t=gC.getTreeNode(eC);t&&(e=t)}e.addChild(u),gC.addNode(u)}),[u,c]),_A((()=>{let e=gC.getTreeNode(l);e&&(e.contain=!!n)}),[n]),_A((()=>{var e;let t=null===(e=s.current)||void 0===e?void 0:e.nextSibling,n=[];for(;t&&t!==a.current;)n.push(t),t=t.nextSibling;l.current=n}),[t]),function(e,t,n){_A((()=>{if(t||n)return;let i=e.current;const r=wA(i?i[0]:void 0);let o=t=>{let n=t.target;lC(n,e.current)?eC=e:aC(n)||(eC=null)};return r.addEventListener("focusin",o,!1),null==i||i.forEach((e=>e.addEventListener("focusin",o,!1))),()=>{r.removeEventListener("focusin",o,!1),null==i||i.forEach((e=>e.removeEventListener("focusin",o,!1)))}}),[e,t,n])}(l,i,n),function(e,t){let n=(0,r.useRef)(),i=(0,r.useRef)();_A((()=>{let r=e.current;if(!t)return void(i.current&&(cancelAnimationFrame(i.current),i.current=void 0));const o=wA(r?r[0]:void 0);let s=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!sC(e))return;let n=o.activeElement,i=e.current;if(!i||!lC(n,i))return;let r=pC(oC(i),{tabbable:!0},i);if(!n)return;r.currentNode=n;let s=t.shiftKey?r.previousNode():r.nextNode();s||(r.currentNode=t.shiftKey?i[i.length-1].nextElementSibling:i[0].previousElementSibling,s=t.shiftKey?r.previousNode():r.nextNode()),t.preventDefault(),s&&hC(s,!0)},a=t=>{eC&&!uC(eC,e)||!lC(t.target,e.current)?sC(e)&&!cC(t.target,e)?n.current?n.current.focus():eC&&eC.current&&dC(eC.current):sC(e)&&(n.current=t.target):(eC=e,n.current=t.target)},l=t=>{i.current&&cancelAnimationFrame(i.current),i.current=requestAnimationFrame((()=>{var i;o.activeElement&&sC(e)&&!cC(o.activeElement,e)&&(eC=e,o.body.contains(t.target)?(n.current=t.target,null===(i=n.current)||void 0===i||i.focus()):eC.current&&dC(eC.current))}))};return o.addEventListener("keydown",s,!1),o.addEventListener("focusin",a,!1),null==r||r.forEach((e=>e.addEventListener("focusin",a,!1))),null==r||r.forEach((e=>e.addEventListener("focusout",l,!1))),()=>{o.removeEventListener("keydown",s,!1),o.removeEventListener("focusin",a,!1),null==r||r.forEach((e=>e.removeEventListener("focusin",a,!1))),null==r||r.forEach((e=>e.removeEventListener("focusout",l,!1)))}}),[e,t]),_A((()=>()=>{i.current&&cancelAnimationFrame(i.current)}),[i])}(l,n),function(e,t,n){const i=(0,r.useRef)("undefined"!=typeof document?wA(e.current?e.current[0]:void 0).activeElement:null);_A((()=>{let i=e.current;const r=wA(i?i[0]:void 0);if(!t||n)return;let o=()=>{eC&&!uC(eC,e)||!lC(r.activeElement,e.current)||(eC=e)};return r.addEventListener("focusin",o,!1),null==i||i.forEach((e=>e.addEventListener("focusin",o,!1))),()=>{r.removeEventListener("focusin",o,!1),null==i||i.forEach((e=>e.removeEventListener("focusin",o,!1)))}}),[e,n]),_A((()=>{const i=wA(e.current?e.current[0]:void 0);if(!t)return;let r=t=>{if("Tab"!==t.key||t.altKey||t.ctrlKey||t.metaKey||!sC(e))return;let n=i.activeElement;if(!lC(n,e.current))return;let r=gC.getTreeNode(e);if(!r)return;let o=r.nodeToRestore,s=pC(i.body,{tabbable:!0});s.currentNode=n;let a=t.shiftKey?s.previousNode():s.nextNode();if(o&&i.body.contains(o)&&o!==i.body||(o=void 0,r.nodeToRestore=void 0),(!a||!lC(a,e.current))&&o){s.currentNode=o;do{a=t.shiftKey?s.previousNode():s.nextNode()}while(lC(a,e.current));t.preventDefault(),t.stopPropagation(),a?hC(a,!0):aC(o)?hC(o,!0):n.blur()}};return n||i.addEventListener("keydown",r,!0),()=>{n||i.removeEventListener("keydown",r,!0)}}),[e,t,n]),_A((()=>{const n=wA(e.current?e.current[0]:void 0);if(!t)return;let r=gC.getTreeNode(e);var o;return r?(r.nodeToRestore=null!==(o=i.current)&&void 0!==o?o:void 0,()=>{let i=gC.getTreeNode(e);if(!i)return;let r=i.nodeToRestore;if(t&&r&&(lC(n.activeElement,e.current)||n.activeElement===n.body&&function(e){let t=gC.getTreeNode(eC);for(;t&&t.scopeRef!==e;){if(t.nodeToRestore)return!1;t=t.parent}return(null==t?void 0:t.scopeRef)===e}(e))){let t=gC.clone();requestAnimationFrame((()=>{if(n.activeElement===n.body){let n=t.getTreeNode(e);for(;n;){if(n.nodeToRestore&&n.nodeToRestore.isConnected)return void hC(n.nodeToRestore);n=n.parent}for(n=t.getTreeNode(e);n;){if(n.scopeRef&&n.scopeRef.current&&gC.getTreeNode(n.scopeRef))return void dC(n.scopeRef.current,!0);n=n.parent}}}))}}):void 0}),[e,t])}(l,i,n),function(e,t){const n=r.useRef(t);(0,r.useEffect)((()=>{n.current&&(eC=e,!lC(wA(e.current?e.current[0]:void 0).activeElement,eC.current)&&e.current&&dC(e.current)),n.current=!1}),[e])}(l,o),(0,r.useEffect)((()=>{const e=wA(l.current?l.current[0]:void 0).activeElement;let t=null;if(lC(e,l.current)){for(let n of gC.traverse())n.scopeRef&&lC(e,n.scopeRef.current)&&(t=n);t===gC.getTreeNode(l)&&(eC=t.scopeRef)}}),[l]),_A((()=>()=>{var e,t,n;let i=null!==(n=null===(t=gC.getTreeNode(l))||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null;l!==eC&&!uC(l,eC)||i&&!gC.getTreeNode(i)||(eC=i),gC.removeTreeNode(l)}),[l]);let h=(0,r.useMemo)((()=>function(e){return{focusNext(t={}){let n=e.current,{from:i,tabbable:r,wrap:o,accept:s}=t,a=i||wA(n[0]).activeElement,l=n[0].previousElementSibling,c=pC(oC(n),{tabbable:r,accept:s},n);c.currentNode=lC(a,n)?a:l;let u=c.nextNode();return!u&&o&&(c.currentNode=l,u=c.nextNode()),u&&hC(u,!0),u},focusPrevious(t={}){let n=e.current,{from:i,tabbable:r,wrap:o,accept:s}=t,a=i||wA(n[0]).activeElement,l=n[n.length-1].nextElementSibling,c=pC(oC(n),{tabbable:r,accept:s},n);c.currentNode=lC(a,n)?a:l;let u=c.previousNode();return!u&&o&&(c.currentNode=l,u=c.previousNode()),u&&hC(u,!0),u},focusFirst(t={}){let n=e.current,{tabbable:i,accept:r}=t,o=pC(oC(n),{tabbable:i,accept:r},n);o.currentNode=n[0].previousElementSibling;let s=o.nextNode();return s&&hC(s,!0),s},focusLast(t={}){let n=e.current,{tabbable:i,accept:r}=t,o=pC(oC(n),{tabbable:i,accept:r},n);o.currentNode=n[n.length-1].nextElementSibling;let s=o.previousNode();return s&&hC(s,!0),s}}}(l)),[]),d=(0,r.useMemo)((()=>({focusManager:h,parentNode:u})),[u,h]);return r.createElement(QA.Provider,{value:d},r.createElement("span",{"data-focus-scope-start":!0,hidden:!0,ref:s}),t,r.createElement("span",{"data-focus-scope-end":!0,hidden:!0,ref:a}))}const nC=["input:not([disabled]):not([type=hidden])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]"],iC=nC.join(":not([hidden]),")+",[tabindex]:not([disabled]):not([hidden])";nC.push('[tabindex]:not([tabindex="-1"]):not([disabled])');const rC=nC.join(':not([hidden]):not([tabindex="-1"]),');function oC(e){return e[0].parentElement}function sC(e){let t=gC.getTreeNode(eC);for(;t&&t.scopeRef!==e;){if(t.contain)return!1;t=t.parent}return!0}function aC(e){return cC(e)}function lC(e,t){return!!e&&!!t&&t.some((t=>t.contains(e)))}function cC(e,t=null){if(e instanceof Element&&e.closest("[data-react-aria-top-layer]"))return!0;for(let{scopeRef:n}of gC.traverse(gC.getTreeNode(t)))if(n&&lC(e,n.current))return!0;return!1}function uC(e,t){var n;let i=null===(n=gC.getTreeNode(t))||void 0===n?void 0:n.parent;for(;i;){if(i.scopeRef===e)return!0;i=i.parent}return!1}function hC(e,t=!1){if(null==e||t){if(null!=e)try{e.focus()}catch(e){}}else try{KA(e)}catch(e){}}function dC(e,t=!0){let n=e[0].previousElementSibling,i=oC(e),r=pC(i,{tabbable:t},e);r.currentNode=n;let o=r.nextNode();t&&!o&&(i=oC(e),r=pC(i,{tabbable:!1},e),r.currentNode=n,o=r.nextNode()),hC(o)}function pC(e,t,n){let i=(null==t?void 0:t.tabbable)?rC:iC,r=wA(e).createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode(e){var r;return(null==t||null===(r=t.from)||void 0===r?void 0:r.contains(e))?NodeFilter.FILTER_REJECT:!e.matches(i)||!JA(e)||n&&!lC(e,n)||(null==t?void 0:t.accept)&&!t.accept(e)?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT}});return(null==t?void 0:t.from)&&(r.currentNode=t.from),r}class fC{get size(){return this.fastMap.size}getTreeNode(e){return this.fastMap.get(e)}addTreeNode(e,t,n){let i=this.fastMap.get(null!=t?t:null);if(!i)return;let r=new mC({scopeRef:e});i.addChild(r),r.parent=i,this.fastMap.set(e,r),n&&(r.nodeToRestore=n)}addNode(e){this.fastMap.set(e.scopeRef,e)}removeTreeNode(e){if(null===e)return;let t=this.fastMap.get(e);if(!t)return;let n=t.parent;for(let e of this.traverse())e!==t&&t.nodeToRestore&&e.nodeToRestore&&t.scopeRef&&t.scopeRef.current&&lC(e.nodeToRestore,t.scopeRef.current)&&(e.nodeToRestore=t.nodeToRestore);let i=t.children;n&&(n.removeChild(t),i.size>0&&i.forEach((e=>n&&n.addChild(e)))),this.fastMap.delete(t.scopeRef)}*traverse(e=this.root){if(null!=e.scopeRef&&(yield e),e.children.size>0)for(let t of e.children)yield*this.traverse(t)}clone(){var e;let t=new fC;var n;for(let i of this.traverse())t.addTreeNode(i.scopeRef,null!==(n=null===(e=i.parent)||void 0===e?void 0:e.scopeRef)&&void 0!==n?n:null,i.nodeToRestore);return t}constructor(){this.fastMap=new Map,this.root=new mC({scopeRef:null}),this.fastMap.set(null,this.root)}}class mC{addChild(e){this.children.add(e),e.parent=this}removeChild(e){this.children.delete(e),e.parent=void 0}constructor(e){this.children=new Set,this.contain=!1,this.scopeRef=e.scopeRef}}let gC=new fC;const _C="undefined"!=typeof document?r.useLayoutEffect:()=>{};function yC(e){const t=(0,r.useRef)(null);return _C((()=>{t.current=e}),[e]),(0,r.useCallback)(((...e)=>{const n=t.current;return null==n?void 0:n(...e)}),[])}function vC(e,t){if(e.button>0)return!1;if(e.target){const t=e.target.ownerDocument;if(!t||!t.documentElement.contains(e.target))return!1;if(e.target.closest("[data-react-aria-top-layer]"))return!1}return t.current&&!t.current.contains(e.target)}class bC{isDefaultPrevented(){return this.nativeEvent.defaultPrevented}preventDefault(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()}stopPropagation(){this.nativeEvent.stopPropagation(),this.isPropagationStopped=()=>!0}isPropagationStopped(){return!1}persist(){}constructor(e,t){this.nativeEvent=t,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget,this.bubbles=t.bubbles,this.cancelable=t.cancelable,this.defaultPrevented=t.defaultPrevented,this.eventPhase=t.eventPhase,this.isTrusted=t.isTrusted,this.timeStamp=t.timeStamp,this.type=e}}function xC(e){let{isDisabled:t,onBlurWithin:n,onFocusWithin:i,onFocusWithinChange:o}=e,s=(0,r.useRef)({isFocusWithin:!1}),a=(0,r.useCallback)((e=>{s.current.isFocusWithin&&!e.currentTarget.contains(e.relatedTarget)&&(s.current.isFocusWithin=!1,n&&n(e),o&&o(!1))}),[n,o,s]),l=function(e){let t=(0,r.useRef)({isFocused:!1,observer:null});_C((()=>{const e=t.current;return()=>{e.observer&&(e.observer.disconnect(),e.observer=null)}}),[]);let n=yC((t=>{null==e||e(t)}));return(0,r.useCallback)((e=>{if(e.target instanceof HTMLButtonElement||e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||e.target instanceof HTMLSelectElement){t.current.isFocused=!0;let i=e.target,r=e=>{t.current.isFocused=!1,i.disabled&&n(new bC("blur",e)),t.current.observer&&(t.current.observer.disconnect(),t.current.observer=null)};i.addEventListener("focusout",r,{once:!0}),t.current.observer=new MutationObserver((()=>{if(t.current.isFocused&&i.disabled){var e;null===(e=t.current.observer)||void 0===e||e.disconnect();let n=i===document.activeElement?null:document.activeElement;i.dispatchEvent(new FocusEvent("blur",{relatedTarget:n})),i.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:n}))}})),t.current.observer.observe(i,{attributes:!0,attributeFilter:["disabled"]})}}),[n])}(a),c=(0,r.useCallback)((e=>{s.current.isFocusWithin||document.activeElement!==e.target||(i&&i(e),o&&o(!0),s.current.isFocusWithin=!0,l(e))}),[i,o,l]);return t?{focusWithinProps:{onFocus:void 0,onBlur:void 0}}:{focusWithinProps:{onFocus:c,onBlur:a}}}"undefined"!=typeof document&&window.visualViewport,new WeakMap,"undefined"!=typeof document&&window.visualViewport;const wC=[];function EC(e,t){let{onClose:n,shouldCloseOnBlur:i,isOpen:o,isDismissable:s=!1,isKeyboardDismissDisabled:a=!1,shouldCloseOnInteractOutside:l}=e;(0,r.useEffect)((()=>(o&&wC.push(t),()=>{let e=wC.indexOf(t);e>=0&&wC.splice(e,1)})),[o,t]);let c=()=>{wC[wC.length-1]===t&&n&&n()};!function(e){let{ref:t,onInteractOutside:n,isDisabled:i,onInteractOutsideStart:o}=e,s=(0,r.useRef)({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),a=yC((e=>{n&&vC(e,t)&&(o&&o(e),s.current.isPointerDown=!0)})),l=yC((e=>{n&&n(e)}));(0,r.useEffect)((()=>{let e=s.current;if(i)return;const n=t.current,r=FA(n);if("undefined"!=typeof PointerEvent){let n=n=>{e.isPointerDown&&vC(n,t)&&l(n),e.isPointerDown=!1};return r.addEventListener("pointerdown",a,!0),r.addEventListener("pointerup",n,!0),()=>{r.removeEventListener("pointerdown",a,!0),r.removeEventListener("pointerup",n,!0)}}{let n=n=>{e.ignoreEmulatedMouseEvents?e.ignoreEmulatedMouseEvents=!1:e.isPointerDown&&vC(n,t)&&l(n),e.isPointerDown=!1},i=n=>{e.ignoreEmulatedMouseEvents=!0,e.isPointerDown&&vC(n,t)&&l(n),e.isPointerDown=!1};return r.addEventListener("mousedown",a,!0),r.addEventListener("mouseup",n,!0),r.addEventListener("touchstart",a,!0),r.addEventListener("touchend",i,!0),()=>{r.removeEventListener("mousedown",a,!0),r.removeEventListener("mouseup",n,!0),r.removeEventListener("touchstart",a,!0),r.removeEventListener("touchend",i,!0)}}}),[t,i,a,l])}({ref:t,onInteractOutside:s&&o?e=>{l&&!l(e.target)||(wC[wC.length-1]===t&&(e.stopPropagation(),e.preventDefault()),c())}:null,onInteractOutsideStart:e=>{l&&!l(e.target)||wC[wC.length-1]===t&&(e.stopPropagation(),e.preventDefault())}});let{focusWithinProps:u}=xC({isDisabled:!i,onBlurWithin:e=>{e.relatedTarget&&!cC(e.relatedTarget,eC)&&(l&&!l(e.relatedTarget)||n())}});return{overlayProps:{onKeyDown:e=>{"Escape"!==e.key||a||(e.stopPropagation(),e.preventDefault(),c())},...u},underlayProps:{onPointerDown:e=>{e.target===e.currentTarget&&e.preventDefault()}}}}"undefined"!=typeof document&&window.visualViewport,new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]),new WeakMap;const SC=r.createContext(null);var TC,AC;Boolean((null===(AC=UE.config.panels)||void 0===AC||null===(TC=AC.debug)||void 0===TC?void 0:TC.state)===t.PluginState.alpha);const CC=e=>{const{newValue:t,setNewValue:n,mediaType:i}=e,r=(0,ml.useStyles2)(PC),s=MT(t);let a=null==t?void 0:t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));return a.length>20&&(a=a.substring(0,20)+"..."),o().createElement(o().Fragment,null,o().createElement(ml.Field,null,o().createElement(ml.Input,{onChange:e=>n(e.currentTarget.value),value:t})),o().createElement("div",{className:r.iconContainer},o().createElement(ml.Field,{label:"Preview"},o().createElement("div",{className:r.iconPreview},i===bT.Icon&&o().createElement(oA,{src:s,className:r.img}),i===bT.Image&&t&&o().createElement("img",{src:s,alt:"Preview of the selected URL",className:r.img}))),o().createElement(ml.Label,null,a)))},PC=e=>({iconContainer:BE.css`
    display: flex;
    flex-direction: column;
    width: 80%;
    align-items: center;
    align-self: center;
  `,iconPreview:BE.css`
    width: 238px;
    height: 198px;
    border: 1px solid ${e.colors.border.medium};
    display: flex;
    align-items: center;
    justify-content: center;
  `,img:BE.css`
    width: 147px;
    height: 147px;
    fill: ${e.colors.text.primary};
  `});function IC({secondaryText:e="Drag and drop here or browse"}){const t=(0,ml.useStyles2)(RC);return o().createElement("div",{className:t.iconWrapper},o().createElement("small",{className:t.small},e),o().createElement(ml.Button,{type:"button",icon:"upload"},"Upload"))}const MC=({mediaType:e,setFormData:t,setUpload:n,error:i})=>{const s=(0,ml.useStyles2)(RC),[a,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),h=()=>o().createElement(ml.Field,{label:"Preview"},o().createElement("div",{className:s.iconPreview},e===bT.Icon&&o().createElement(oA,{src:c,className:s.img}),e===bT.Image&&o().createElement("img",{src:c,alt:"Preview of the uploaded file",className:s.img}))),d="icon"===e?{"image/*":[".svg",".xml"]}:{"image/*":[".jpeg",".png",".gif",".webp"]};return o().createElement(ml.FileDropzone,{readAs:"readAsBinaryString",onFileRemove:e=>{fetch(`/api/storage/delete/upload/${e.file.name}`,{method:"DELETE"}).catch((e=>console.error("cannot delete file",e)))},options:{accept:d,multiple:!1,onDrop:e=>{let i=new FormData;i.append("file",e[0]),u(URL.createObjectURL(e[0])),l(!0),t(i),n(!0)}}},""!==i.message&&a?o().createElement("p",null,i.message):a?o().createElement(h,null):o().createElement(IC,null))};function RC(e,t){return{container:BE.css`
      display: flex;
      flex-direction: column;
      width: 100%;
    `,dropzone:BE.css`
      display: flex;
      flex: 1;
      flex-direction: column;
      align-items: center;
      padding: ${e.spacing(6)};
      border-radius: 2px;
      border: 2px dashed ${e.colors.border.medium};
      background-color: ${t?e.colors.background.secondary:e.colors.background.primary};
      cursor: pointer;
    `,iconWrapper:BE.css`
      display: flex;
      flex-direction: column;
      align-items: center;
    `,acceptMargin:BE.css`
      margin: ${e.spacing(2,0,1)};
    `,small:BE.css`
      color: ${e.colors.text.secondary};
      margin-bottom: ${e.spacing(2)};
    `,iconContainer:BE.css`
      display: flex;
      flex-direction: column;
      width: 80%;
      align-items: center;
      align-self: center;
    `,iconPreview:BE.css`
      width: 238px;
      height: 198px;
      border: 1px solid ${e.colors.border.medium};
      display: flex;
      align-items: center;
      justify-content: center;
    `,img:BE.css`
      width: 147px;
      height: 147px;
      fill: ${e.colors.text.primary};
    `}}let OC;OC="undefined"!=typeof window?window:"undefined"!=typeof self?self:d.g;let kC=null,LC=null;const DC=OC.clearTimeout,FC=OC.setTimeout,NC=OC.cancelAnimationFrame||OC.mozCancelAnimationFrame||OC.webkitCancelAnimationFrame,BC=OC.requestAnimationFrame||OC.mozRequestAnimationFrame||OC.webkitRequestAnimationFrame;null==NC||null==BC?(kC=DC,LC=function(e){return FC(e,20)}):(kC=function([e,t]){NC(e),DC(t)},LC=function(e){const t=BC((function(){DC(n),e()})),n=FC((function(){NC(t),e()}),20);return[t,n]});class zC extends r.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:e,disableWidth:t,onResize:n}=this.props;if(this._parentNode){const i=window.getComputedStyle(this._parentNode)||{},r=parseFloat(i.paddingLeft||"0"),o=parseFloat(i.paddingRight||"0"),s=parseFloat(i.paddingTop||"0"),a=parseFloat(i.paddingBottom||"0"),l=this._parentNode.getBoundingClientRect(),c=l.height-s-a,u=l.width-r-o,h=this._parentNode.offsetHeight-s-a,d=this._parentNode.offsetWidth-r-o;(e||this.state.height===h&&this.state.scaledHeight===c)&&(t||this.state.width===d&&this.state.scaledWidth===u)||(this.setState({height:h,width:d,scaledHeight:c,scaledWidth:u}),"function"==typeof n&&n({height:h,scaledHeight:c,scaledWidth:u,width:d}))}},this._setRef=e=>{this._autoSizer=e}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(null!=t&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;null!=n?(this._resizeObserver=new n((()=>{this._timeoutId=setTimeout(this._onResize,0)})),this._resizeObserver.observe(t)):(this._detectElementResize=function(e){let t,n,i,r,o,s,a;const l="undefined"!=typeof document&&document.attachEvent;if(!l){s=function(e){const t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},o=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},a=function(e){if(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)return;const t=this;s(this),this.__resizeRAF__&&kC(this.__resizeRAF__),this.__resizeRAF__=LC((function(){o(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))};let e=!1,l="";i="animationstart";const c="Webkit Moz O ms".split(" ");let u="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),h="";{const t=document.createElement("fakeelement");if(void 0!==t.style.animationName&&(e=!0),!1===e)for(let n=0;n<c.length;n++)if(void 0!==t.style[c[n]+"AnimationName"]){h=c[n],l="-"+h.toLowerCase()+"-",i=u[n],e=!0;break}}n="resizeanim",t="@"+l+"keyframes "+n+" { from { opacity: 0; } to { opacity: 0; } } ",r=l+"animation: 1ms "+n+"; "}return{addResizeListener:function(o,c){if(l)o.attachEvent("onresize",c);else{if(!o.__resizeTriggers__){const l=o.ownerDocument,c=OC.getComputedStyle(o);c&&"static"===c.position&&(o.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){const i=(t||"")+".resize-triggers { "+(r||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',o=n.head||n.getElementsByTagName("head")[0],s=n.createElement("style");s.id="detectElementResize",s.type="text/css",null!=e&&s.setAttribute("nonce",e),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(n.createTextNode(i)),o.appendChild(s)}}(l),o.__resizeLast__={},o.__resizeListeners__=[],(o.__resizeTriggers__=l.createElement("div")).className="resize-triggers";const u=l.createElement("div");u.className="expand-trigger",u.appendChild(l.createElement("div"));const h=l.createElement("div");h.className="contract-trigger",o.__resizeTriggers__.appendChild(u),o.__resizeTriggers__.appendChild(h),o.appendChild(o.__resizeTriggers__),s(o),o.addEventListener("scroll",a,!0),i&&(o.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&s(o)},o.__resizeTriggers__.addEventListener(i,o.__resizeTriggers__.__animationListener__))}o.__resizeListeners__.push(c)}},removeResizeListener:function(e,t){if(l)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",a,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(i,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),null!==this._timeoutId&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:i=!1,disableWidth:o=!1,doNotBailOutOnEmptyChildren:s=!1,nonce:a,onResize:l,style:c={},tagName:u="div",...h}=this.props,{height:d,scaledHeight:p,scaledWidth:f,width:m}=this.state,g={overflow:"visible"},_={};let y=!1;return i||(0===d&&(y=!0),g.height=0,_.height=d,_.scaledHeight=p),o||(0===m&&(y=!0),g.width=0,_.width=m,_.scaledWidth=f),s&&(y=!1),(0,r.createElement)(u,{ref:this._setRef,style:{...g,...c},...h},!y&&e(_))}}function jC(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UC(e,t){return UC=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},UC(e,t)}var VC=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function GC(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!((i=e[n])===(r=t[n])||VC(i)&&VC(r)))return!1;var i,r;return!0}const $C=function(e,t){var n;void 0===t&&(t=GC);var i,r=[],o=!1;return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return o&&n===this&&t(s,r)||(i=e.apply(this,s),o=!0,n=this,r=s),i}};var WC="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function HC(e){cancelAnimationFrame(e.id)}var qC=-1;var XC=null;function ZC(e){if(void 0===e&&(e=!1),null===XC||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",n.direction="rtl";var i=document.createElement("div"),r=i.style;return r.width="100px",r.height="100px",t.appendChild(i),document.body.appendChild(t),t.scrollLeft>0?XC="positive-descending":(t.scrollLeft=1,XC=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),XC}return XC}var YC=function(e){var t=e.columnIndex;return e.data,e.rowIndex+":"+t};function KC(e){var t,n=e.getColumnOffset,i=e.getColumnStartIndexForOffset,o=e.getColumnStopIndexForStartIndex,s=e.getColumnWidth,a=e.getEstimatedTotalHeight,l=e.getEstimatedTotalWidth,c=e.getOffsetForColumnAndAlignment,u=e.getOffsetForRowAndAlignment,h=e.getRowHeight,d=e.getRowOffset,p=e.getRowStartIndexForOffset,f=e.getRowStopIndexForStartIndex,m=e.initInstanceProps,g=e.shouldResetStyleCacheOnItemSizeChange,_=e.validateProps;return(t=function(e){function t(t){var i;return(i=e.call(this,t)||this)._instanceProps=m(i.props,jC(i)),i._resetIsScrollingTimeoutId=null,i._outerRef=void 0,i.state={instance:jC(i),isScrolling:!1,horizontalScrollDirection:"forward",scrollLeft:"number"==typeof i.props.initialScrollLeft?i.props.initialScrollLeft:0,scrollTop:"number"==typeof i.props.initialScrollTop?i.props.initialScrollTop:0,scrollUpdateWasRequested:!1,verticalScrollDirection:"forward"},i._callOnItemsRendered=void 0,i._callOnItemsRendered=$C((function(e,t,n,r,o,s,a,l){return i.props.onItemsRendered({overscanColumnStartIndex:e,overscanColumnStopIndex:t,overscanRowStartIndex:n,overscanRowStopIndex:r,visibleColumnStartIndex:o,visibleColumnStopIndex:s,visibleRowStartIndex:a,visibleRowStopIndex:l})})),i._callOnScroll=void 0,i._callOnScroll=$C((function(e,t,n,r,o){return i.props.onScroll({horizontalScrollDirection:n,scrollLeft:e,scrollTop:t,verticalScrollDirection:r,scrollUpdateWasRequested:o})})),i._getItemStyle=void 0,i._getItemStyle=function(e,t){var r,o=i.props,a=o.columnWidth,l=o.direction,c=o.rowHeight,u=i._getItemStyleCache(g&&a,g&&l,g&&c),p=e+":"+t;if(u.hasOwnProperty(p))r=u[p];else{var f=n(i.props,t,i._instanceProps),m="rtl"===l;u[p]=r={position:"absolute",left:m?void 0:f,right:m?f:void 0,top:d(i.props,e,i._instanceProps),height:h(i.props,e,i._instanceProps),width:s(i.props,t,i._instanceProps)}}return r},i._getItemStyleCache=void 0,i._getItemStyleCache=$C((function(e,t,n){return{}})),i._onScroll=function(e){var t=e.currentTarget,n=t.clientHeight,r=t.clientWidth,o=t.scrollLeft,s=t.scrollTop,a=t.scrollHeight,l=t.scrollWidth;i.setState((function(e){if(e.scrollLeft===o&&e.scrollTop===s)return null;var t=i.props.direction,c=o;if("rtl"===t)switch(ZC()){case"negative":c=-o;break;case"positive-descending":c=l-r-o}c=Math.max(0,Math.min(c,l-r));var u=Math.max(0,Math.min(s,a-n));return{isScrolling:!0,horizontalScrollDirection:e.scrollLeft<o?"forward":"backward",scrollLeft:c,scrollTop:u,verticalScrollDirection:e.scrollTop<s?"forward":"backward",scrollUpdateWasRequested:!1}}),i._resetIsScrollingDebounced)},i._outerRefSetter=function(e){var t=i.props.outerRef;i._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},i._resetIsScrollingDebounced=function(){var e,t,n,r;null!==i._resetIsScrollingTimeoutId&&HC(i._resetIsScrollingTimeoutId),i._resetIsScrollingTimeoutId=(e=i._resetIsScrolling,t=150,n=WC(),r={id:requestAnimationFrame((function i(){WC()-n>=t?e.call(null):r.id=requestAnimationFrame(i)}))})},i._resetIsScrolling=function(){i._resetIsScrollingTimeoutId=null,i.setState({isScrolling:!1},(function(){i._getItemStyleCache(-1)}))},i}var y,v;v=e,(y=t).prototype=Object.create(v.prototype),y.prototype.constructor=y,UC(y,v),t.getDerivedStateFromProps=function(e,t){return JC(e,t),_(e),null};var b=t.prototype;return b.scrollTo=function(e){var t=e.scrollLeft,n=e.scrollTop;void 0!==t&&(t=Math.max(0,t)),void 0!==n&&(n=Math.max(0,n)),this.setState((function(e){return void 0===t&&(t=e.scrollLeft),void 0===n&&(n=e.scrollTop),e.scrollLeft===t&&e.scrollTop===n?null:{horizontalScrollDirection:e.scrollLeft<t?"forward":"backward",scrollLeft:t,scrollTop:n,scrollUpdateWasRequested:!0,verticalScrollDirection:e.scrollTop<n?"forward":"backward"}}),this._resetIsScrollingDebounced)},b.scrollToItem=function(e){var t=e.align,n=void 0===t?"auto":t,i=e.columnIndex,r=e.rowIndex,o=this.props,s=o.columnCount,h=o.height,d=o.rowCount,p=o.width,f=this.state,m=f.scrollLeft,g=f.scrollTop,_=function(e){if(void 0===e&&(e=!1),-1===qC||e){var t=document.createElement("div"),n=t.style;n.width="50px",n.height="50px",n.overflow="scroll",document.body.appendChild(t),qC=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return qC}();void 0!==i&&(i=Math.max(0,Math.min(i,s-1))),void 0!==r&&(r=Math.max(0,Math.min(r,d-1)));var y=a(this.props,this._instanceProps),v=l(this.props,this._instanceProps)>p?_:0,b=y>h?_:0;this.scrollTo({scrollLeft:void 0!==i?c(this.props,i,n,m,this._instanceProps,b):m,scrollTop:void 0!==r?u(this.props,r,n,g,this._instanceProps,v):g})},b.componentDidMount=function(){var e=this.props,t=e.initialScrollLeft,n=e.initialScrollTop;if(null!=this._outerRef){var i=this._outerRef;"number"==typeof t&&(i.scrollLeft=t),"number"==typeof n&&(i.scrollTop=n)}this._callPropsCallbacks()},b.componentDidUpdate=function(){var e=this.props.direction,t=this.state,n=t.scrollLeft,i=t.scrollTop;if(t.scrollUpdateWasRequested&&null!=this._outerRef){var r=this._outerRef;if("rtl"===e)switch(ZC()){case"negative":r.scrollLeft=-n;break;case"positive-ascending":r.scrollLeft=n;break;default:var o=r.clientWidth,s=r.scrollWidth;r.scrollLeft=s-o-n}else r.scrollLeft=Math.max(0,n);r.scrollTop=Math.max(0,i)}this._callPropsCallbacks()},b.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&HC(this._resetIsScrollingTimeoutId)},b.render=function(){var e=this.props,t=e.children,n=e.className,i=e.columnCount,o=e.direction,s=e.height,c=e.innerRef,u=e.innerElementType,h=e.innerTagName,d=e.itemData,p=e.itemKey,f=void 0===p?YC:p,m=e.outerElementType,g=e.outerTagName,_=e.rowCount,y=e.style,v=e.useIsScrolling,b=e.width,x=this.state.isScrolling,w=this._getHorizontalRangeToRender(),E=w[0],S=w[1],T=this._getVerticalRangeToRender(),A=T[0],C=T[1],P=[];if(i>0&&_)for(var I=A;I<=C;I++)for(var M=E;M<=S;M++)P.push((0,r.createElement)(t,{columnIndex:M,data:d,isScrolling:v?x:void 0,key:f({columnIndex:M,data:d,rowIndex:I}),rowIndex:I,style:this._getItemStyle(I,M)}));var R=a(this.props,this._instanceProps),O=l(this.props,this._instanceProps);return(0,r.createElement)(m||g||"div",{className:n,onScroll:this._onScroll,ref:this._outerRefSetter,style:LS({position:"relative",height:s,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:o},y)},(0,r.createElement)(u||h||"div",{children:P,ref:c,style:{height:R,pointerEvents:x?"none":void 0,width:O}}))},b._callPropsCallbacks=function(){var e=this.props,t=e.columnCount,n=e.onItemsRendered,i=e.onScroll,r=e.rowCount;if("function"==typeof n&&t>0&&r>0){var o=this._getHorizontalRangeToRender(),s=o[0],a=o[1],l=o[2],c=o[3],u=this._getVerticalRangeToRender(),h=u[0],d=u[1],p=u[2],f=u[3];this._callOnItemsRendered(s,a,h,d,l,c,p,f)}if("function"==typeof i){var m=this.state,g=m.horizontalScrollDirection,_=m.scrollLeft,y=m.scrollTop,v=m.scrollUpdateWasRequested,b=m.verticalScrollDirection;this._callOnScroll(_,y,g,b,v)}},b._getHorizontalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanColumnCount,r=e.overscanColumnsCount,s=e.overscanCount,a=e.rowCount,l=this.state,c=l.horizontalScrollDirection,u=l.isScrolling,h=l.scrollLeft,d=n||r||s||1;if(0===t||0===a)return[0,0,0,0];var p=i(this.props,h,this._instanceProps),f=o(this.props,p,h,this._instanceProps),m=u&&"backward"!==c?1:Math.max(1,d),g=u&&"forward"!==c?1:Math.max(1,d);return[Math.max(0,p-m),Math.max(0,Math.min(t-1,f+g)),p,f]},b._getVerticalRangeToRender=function(){var e=this.props,t=e.columnCount,n=e.overscanCount,i=e.overscanRowCount,r=e.overscanRowsCount,o=e.rowCount,s=this.state,a=s.isScrolling,l=s.verticalScrollDirection,c=s.scrollTop,u=i||r||n||1;if(0===t||0===o)return[0,0,0,0];var h=p(this.props,c,this._instanceProps),d=f(this.props,h,c,this._instanceProps),m=a&&"backward"!==l?1:Math.max(1,u),g=a&&"forward"!==l?1:Math.max(1,u);return[Math.max(0,h-m),Math.max(0,Math.min(o-1,d+g)),h,d]},t}(r.PureComponent)).defaultProps={direction:"ltr",itemData:void 0,useIsScrolling:!1},t}var JC=function(e,t){e.children,e.direction,e.height,e.innerTagName,e.outerTagName,e.overscanColumnsCount,e.overscanCount,e.overscanRowsCount,e.width,t.instance},QC=KC({getColumnOffset:function(e,t){return t*e.columnWidth},getColumnWidth:function(e,t){return e.columnWidth},getRowOffset:function(e,t){return t*e.rowHeight},getRowHeight:function(e,t){return e.rowHeight},getEstimatedTotalHeight:function(e){var t=e.rowCount;return e.rowHeight*t},getEstimatedTotalWidth:function(e){var t=e.columnCount;return e.columnWidth*t},getOffsetForColumnAndAlignment:function(e,t,n,i,r,o){var s=e.columnCount,a=e.columnWidth,l=e.width,c=Math.max(0,s*a-l),u=Math.min(c,t*a),h=Math.max(0,t*a-l+o+a);switch("smart"===n&&(n=i>=h-l&&i<=u+l?"auto":"center"),n){case"start":return u;case"end":return h;case"center":var d=Math.round(h+(u-h)/2);return d<Math.ceil(l/2)?0:d>c+Math.floor(l/2)?c:d;default:return i>=h&&i<=u?i:h>u||i<h?h:u}},getOffsetForRowAndAlignment:function(e,t,n,i,r,o){var s=e.rowHeight,a=e.height,l=e.rowCount,c=Math.max(0,l*s-a),u=Math.min(c,t*s),h=Math.max(0,t*s-a+o+s);switch("smart"===n&&(n=i>=h-a&&i<=u+a?"auto":"center"),n){case"start":return u;case"end":return h;case"center":var d=Math.round(h+(u-h)/2);return d<Math.ceil(a/2)?0:d>c+Math.floor(a/2)?c:d;default:return i>=h&&i<=u?i:h>u||i<h?h:u}},getColumnStartIndexForOffset:function(e,t){var n=e.columnWidth,i=e.columnCount;return Math.max(0,Math.min(i-1,Math.floor(t/n)))},getColumnStopIndexForStartIndex:function(e,t,n){var i=e.columnWidth,r=e.columnCount,o=e.width,s=t*i,a=Math.ceil((o+n-s)/i);return Math.max(0,Math.min(r-1,t+a-1))},getRowStartIndexForOffset:function(e,t){var n=e.rowHeight,i=e.rowCount;return Math.max(0,Math.min(i-1,Math.floor(t/n)))},getRowStopIndexForStartIndex:function(e,t,n){var i=e.rowHeight,r=e.rowCount,o=e.height,s=t*i,a=Math.ceil((o+n-s)/i);return Math.max(0,Math.min(r-1,t+a-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.columnWidth,e.rowHeight}});function eP(e,t){for(var n in e)if(!(n in t))return!0;for(var i in t)if(e[i]!==t[i])return!0;return!1}var tP=["style"],nP=["style"];function iP(e,t){var n=e.style,i=DS(e,tP),r=t.style,o=DS(t,nP);return!eP(n,r)&&!eP(i,o)}const rP=(0,r.memo)((function(e){const{columnIndex:t,rowIndex:n,style:i,data:r}=e,{cards:s,columnCount:a,onChange:l,selected:c}=r,u=s[t+n*a],h=(0,ml.useStyles2)(sP);return o().createElement("div",{style:i},u&&o().createElement("div",{key:u.value,className:c===u.value?(0,BE.cx)(h.card,h.selected):h.card,onClick:()=>l(u.value),onKeyDown:e=>{"Enter"===e.key&&l(u.value)},role:"button",tabIndex:0},u.imgUrl.endsWith(".svg")?o().createElement(oA,{src:u.imgUrl,className:h.img}):o().createElement("img",{src:u.imgUrl,alt:"",className:h.img}),o().createElement("h6",{className:h.text},u.label)))}),iP),oP=e=>{const{onChange:t,cards:n,value:i}=e,r=(0,ml.useStyles2)(sP);return o().createElement(zC,{defaultWidth:680},(({width:e,height:s})=>{const a=Math.floor(e/90),l=Math.ceil(n.length/a);return o().createElement(QC,{width:e,height:s,columnCount:a,columnWidth:90,rowCount:l,rowHeight:90,itemData:{cards:n,columnCount:a,onChange:t,selected:i},className:r.grid},rP)}))},sP=e=>({card:BE.css`
    display: inline-block;
    width: 90px;
    height: 90px;
    margin: 0.75rem;
    margin-left: 15px;
    text-align: center;
    cursor: pointer;
    position: relative;
    background-color: transparent;
    border: 1px solid transparent;
    border-radius: 8px;
    padding-top: 6px;
    :hover {
      border-color: ${e.colors.action.hover};
      box-shadow: ${e.shadows.z2};
    }
  `,selected:BE.css`
    border: 2px solid ${e.colors.primary.main};
    :hover {
      border-color: ${e.colors.primary.main};
    }
  `,img:BE.css`
    width: 40px;
    height: 40px;
    object-fit: cover;
    vertical-align: middle;
    fill: ${e.colors.text.primary};
  `,text:BE.css`
    color: ${e.colors.text.primary};
    white-space: nowrap;
    font-size: 12px;
    text-overflow: ellipsis;
    display: block;
    overflow: hidden;
  `,grid:BE.css`
    border: 1px solid ${e.colors.border.medium};
  `}),aP=["100baset-hub","10700","10ge-fcoe","15200","3x74-floor-cluster-control","6700-series","7500ars7513","accesspoint","ace","acs","adm","androgenous-person","antenna","asa-5500","asic-processor","asr-1000-series","ata","atm-3800","atm-fast-gigabit","atm-router","atm-switch","atm-tag-switch-router","avs","axp","bbsm","branch-office","breakout-box","bridge","broadcast-router","bts-10200","cable-modem","callmanager","car","carrier-routing-system","cddi-fddi","cdm","cell-phone","centri-firewall","cisco-1000","cisco-ca","cisco-file-engine","cisco-hub","cisco-security","cisco-unified-presence-server","cisco-unity-express","cisco-works","class-4-5-switch","cloud","communications-server","congtent-switch-module","contact-center","content-acquirer","content-engine-cache-director","content-service-router","content-service-switch-1100","content-switch","content-transformation-engine-","cs-mars","csm-s","csu-dsu","cube","detector","director-class-fibre-channel-di","directory-server","diskette","distributed-director","dot-dot","dpt","dslam","dual-mode","dwdm-filter","end-office","fax","fc-storage","fddi-ring","fibre-channel-disk-subsystem","fibre-channel-fabric-switch","file-cabinet","file-server","fileserver","firewall-service-module-fwsm","firewall","front-end-processor","gatekeeper","general-appliance","generic-building","generic-gateway","generic-processor","generic-softswitch","gigabit-switch-atm-tag-router","government-building","ground-terminal","guard","h323","handheld","hootphone","host","hp-mini","hub","iad-router","ibm-mainframe","ibm-mini-as400","ibm-tower","icm","ics","intelliswitch-stack","internet-streamer","ios-firewall","ios-slb","ip-communicator","ip-dsl","ip-phone","ip-telephony-router","ip","iptc","iptv-content-manager","iptv-server","iscsi-router","isdn-switch","itp","jbod","key","keys","lan-to-lan","laptop","layer-2-remote-switch","layer-3-switch","lightweight-ap","localdirector","lock","longreach-cpe","mac-woman","macintosh","man-woman","mas-gateway","mau","mcu","mdu","me1100","mediator","meetingplace","mesh-ap","metro-1500","mgx-8000-multiservice-switch","microphone","microwebserver","mini-vax","mobile-access-ip-phone","mobile-access-router","mobile-streamer","modem","moh-server","mse","multi-fabric-server-switch","multilayer-remote-switch","multiswitch-device","mux","mxe","nac-appliance","nce-router","nce","netflow-router","netranger","netsonar","network-management","network-security","nexus-1000","nexus-2000-fabric-extender","nexus-5000","nexus-7000","octel","ons15500","optical-amplifier","optical-services-router","optical-transport","pad-x28","pad","page-icon","pbx-switch","pbx","pc-adapter-card","pc-man","pc-routercard","pc-sosftware","pc-video","pc","pda","phone-fax","phone","pix-firewall","pmc","printer","programmable-switch","protocol-translator","pxf","radio-tower","ratemux","relational-database","repeater","rf-modem","route-switch-processor","router-firewall","router-in-building","router-with-silicon-switch","router","rpsrps","running-man","safeharbor-icon","sattelite-dish","sattelite","scanner","server-switch","server-with-router","service-control","service-module","service-router","services","set-top-box","simultlayer-switch","sip-proxy-server","sitting-woman","small-business","small-hub","softphone","softswitch-pgw-mgc","software-based-server","space-router","speaker","ssc","ssl-terminator","standard-host","standing-man","standing-woman","stb","storage-router","storge-server","stp","streamer","sun-workstation","supercomputer","svx","system-controller","tablet","tape-array","tdm-router","telecommuter-house-pc","telecommuter-house","telecommuter-icon","token","tp-mcu","transpath","truck","turret","tv","ubr910","umg-series","unity-server","universal-gateway","university","upc","ups","vault","video-camera","vip","virtual-layer-switch","virtual-switch-controller-vsc3","voice-atm-switch","voice-commserver","voice-router","voice-switch","vpn-concentrator","vpn-gateway","vss","wae","wavelength-router","web-browser","web-cluster","wi-fi-tag","wireless-location-appliance","wireless-router","wireless-transport","wireless","wirelss-bridge","wism","wlan-controller","workgroup-director","workgroup-switch","workstation","www-server"],lP=["a-b-switch","atm-switch-2","atm-switch","biometric-reader","bridge","data-pipe","building","camera","card-reader","cellphone","cloud","comm-link","copier","diagnostic-device","ethernet","external-hard-drive","external-media-drive","fax-machine","fiber-optic-2","fiber-optic","file-2","file-server","file","firewall","hub","keyboard","lock","mainframe","micro-webserver","modem","monitor","mouse","mpls-2","mpls","multi-function-machine","patch-panel","pbx","pc","phone","plotter","printer","project-screen-2","project-screen","projector-2","projector-3","projector","radio-tower","relational-database","repeater","ring-network","router","satellite-dish","satellite","scanner","server-2","server","smart-phone-2","smart-phone","standing-man","standing-woman","super-computer","switch","telephone","ups","user","video-camera","video-phone","virtual-server","voip-phone","web-service","wireless-access-point","wireless-router","working-person"],cP=["aerospike","airtable","apache-cassandra","apache-couchdb","apache-hadoop","apache-hbase","aws-dynamodb","aws-mobile-hub","aws-rds-relational-database-service","cloudera","couchbase","crateio","dat","database-labs","doctrine","flocker","google-firebase","ibm-cloudant","ibm-compose","influxdb","kinto","knexjs","leveldb","mariadb","memsql","mongodb-realm","mongodb","mysql","neo4j","nuodb","oracle","parse","percona","postgresql","pouchdb","prisma","pumpkindb","pusher","redis","redsmin","rethinkdb","riak","rocksdb","rxdb","scaledrone","sequelize","sqldep","sqlite"],uP="public/plugins/vaduga-mapgl-panel/img/icons/",hP=aP.map((e=>({label:e,value:`cisco/${e}`,search:e.toLowerCase(),imgUrl:uP+"cisco/"+e+".svg"}))),dP=lP.map((e=>({label:e,value:`networking/${e}`,search:e.toLowerCase(),imgUrl:uP+"networking/"+e+".svg"}))),pP=cP.map((e=>({label:e,value:`databases/${e}`,search:e.toLowerCase(),imgUrl:uP+"databases/"+e+".svg"}))),fP={[vT.Cisco]:hP,[vT.Networking]:dP,[vT.Databases]:pP},mP=e=>{const{value:t,mediaType:n,folderName:i,newValue:s,setNewValue:a,maxFiles:l}=e,c=(0,ml.useStyles2)(gP),u=(e=>e===bT.Icon?[vT.Networking,vT.Databases,vT.Cisco,vT.Custom]:[vT.BG])(n).map((e=>({label:e,value:e}))),[h,d]=(0,r.useState)(),[p,f]=(0,r.useState)(((e,t)=>{var n;return null!==(n=e.find((e=>{var n;const i=t.split("/").slice(0,-1).toString();return null==e||null===(n=e.value)||void 0===n?void 0:n.includes(i)})))&&void 0!==n?n:e[0]})(u,(null==t?void 0:t.length)?t:i)),[m,g]=(0,r.useState)([]),[_,y]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const e=null==p?void 0:p.value;if(e!==vT.Custom){if(e){const t=fP[e];g(t),y(t)}}else{const t=n===bT.Icon?e=>e.name.endsWith(".svg"):e=>e.name.endsWith(".png")||e.name.endsWith(".gif");(0,UE.getDataSourceSrv)().get("-- Grafana --").then((n=>{n.listFiles(e.replace(/^public\//,""),l).subscribe({next:n=>{const i=[];n.forEach((n=>{t(n);{const t=n.name.lastIndexOf(".");i.push({value:`${e}/${n.name}`,label:n.name,search:(t?n.name.substring(0,t):n.name).toLowerCase(),imgUrl:`${e}/${n.name}`})}})),g(i),y(i)}})}))}}),[n,p,l]),o().createElement(o().Fragment,null,o().createElement(ml.Field,null,o().createElement(ml.Select,{options:u,onChange:f,value:p,menuShouldPortal:!1})),o().createElement(ml.Field,null,o().createElement(ml.FilterInput,{value:null!=h?h:"",placeholder:"Search",onChange:e=>{var t;(t=e)?(t=t.toLowerCase(),y(m.filter((e=>e.search.includes(t))))):y(m),d(e)}})),_&&o().createElement("div",{className:c.cardsWrapper},o().createElement(oP,{cards:_,onChange:e=>a(e),value:s})))},gP=e=>({cardsWrapper:BE.css`
    height: 30vh;
    min-height: 50px;
    margin-top: 5px;
    max-width: 680px;
  `});function _P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const yP=e=>{const{value:t,onChange:n,mediaType:i,folderName:s,maxFiles:a}=e,l=(0,ml.useStyles2)(vP),c=()=>{n(t)},u=(0,r.createRef)(),{dialogProps:h}=function(e,t){let{role:n="dialog"}=e,i=xA();i=e["aria-label"]?void 0:i;let o=(0,r.useRef)(!1);return(0,r.useEffect)((()=>{if(t.current&&!t.current.contains(document.activeElement)){KA(t.current);let e=setTimeout((()=>{document.activeElement===t.current&&(o.current=!0,t.current&&(t.current.blur(),KA(t.current)),o.current=!1)}),500);return()=>{clearTimeout(e)}}}),[t]),function(){let e=(0,r.useContext)(SC),t=null==e?void 0:e.setContain;_A((()=>{null==t||t(!0)}),[t])}(),{dialogProps:{...PA(e,{labelable:!0}),role:n,tabIndex:-1,"aria-labelledby":e["aria-labelledby"]||i,onBlur:e=>{o.current&&e.stopPropagation()}},titleProps:{id:i}}}({},u),{overlayProps:d}=EC({onClose:c,isDismissable:!0,isOpen:!0},u),p=t&&t.includes("://"),[f,m]=(0,r.useState)(null!=t?t:""),[g,_]=(0,r.useState)(p?xT.URL:xT.Folder),[y,v]=(0,r.useState)(new FormData),[b,x]=(0,r.useState)(!1),[w,E]=(0,r.useState)({message:""}),S=e=>`${l.resourcePickerPopoverTab} ${g===e&&l.resourcePickerPopoverActiveTab}`,T=()=>o().createElement(o().Fragment,null,o().createElement(mP,{value:t,mediaType:i,folderName:s,newValue:f,setNewValue:m,maxFiles:a}));return o().createElement(tC,{contain:!0,autoFocus:!0,restoreFocus:!0},o().createElement("section",function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){_P(e,t,n[t])}))}return e}({ref:u},d,h),o().createElement("div",{className:l.resourcePickerPopover},o().createElement("div",{className:l.resourcePickerPopoverTabs},o().createElement("button",{className:S(xT.Folder),onClick:()=>_(xT.Folder)},"Folder"),o().createElement("button",{className:S(xT.URL),onClick:()=>_(xT.URL)},"URL")),o().createElement("div",{className:l.resourcePickerPopoverContent},(()=>{switch(g){case xT.Folder:return T();case xT.URL:return o().createElement(CC,{newValue:f,setNewValue:m,mediaType:i});case xT.Upload:return o().createElement(MC,{mediaType:i,setFormData:v,setUpload:x,newValue:f,error:w});default:return T()}})(),o().createElement("div",{className:l.buttonRow},o().createElement(ml.Button,{variant:"secondary",onClick:()=>c(),fill:"outline"},"Cancel"),o().createElement(ml.Button,{variant:f&&f!==t?"primary":"secondary",onClick:()=>{b?fetch("/api/storage/upload",{method:"POST",body:y}).then((e=>e.status>=400?void e.json().then((e=>E(e))):e.json())).then((e=>{(0,UE.getBackendSrv)().get(`api/storage/read/${e.path}`).then((()=>m(`${UE.config.appUrl}api/storage/read/${e.path}`))).then((()=>n(`${UE.config.appUrl}api/storage/read/${e.path}`)))})).catch((e=>console.error(e))):n(f)}},"Select"))))))},vP=e=>({resourcePickerPopover:BE.css`
    border-radius: ${e.shape.radius.default};
    box-shadow: ${e.shadows.z3};
    background: ${e.colors.background.primary};
    border: 1px solid ${e.colors.border.weak};
  `,resourcePickerPopoverTab:BE.css`
    width: 50%;
    text-align: center;
    padding: ${e.spacing(1,0)};
    background: ${e.colors.background.secondary};
    color: ${e.colors.text.secondary};
    font-size: ${e.typography.bodySmall.fontSize};
    cursor: pointer;
    border: none;

    &:focus:not(:focus-visible) {
      outline: none;
      box-shadow: none;
    }

    :focus-visible {
      position: relative;
    }
  `,resourcePickerPopoverActiveTab:BE.css`
    color: ${e.colors.text.primary};
    font-weight: ${e.typography.fontWeightMedium};
    background: ${e.colors.background.primary};
  `,resourcePickerPopoverContent:BE.css`
    width: 315px;
    font-size: ${e.typography.bodySmall.fontSize};
    min-height: 184px;
    padding: ${e.spacing(1)};
    display: flex;
    flex-direction: column;
  `,resourcePickerPopoverTabs:BE.css`
    display: flex;
    width: 100%;
    border-radius: ${e.shape.radius.default} ${e.shape.radius.default} 0 0;
  `,buttonRow:(0,BE.css)({display:"flex",justifyContent:"center",gap:e.spacing(2),padding:e.spacing(1)})});function bP(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){bP(e,t,n[t])}))}return e}const wP=e=>{const{value:t,src:n,name:i,placeholder:s,onChange:a,onClear:l,mediaType:c,folderName:u,size:h,color:d,maxFiles:p}=e,f=(0,ml.useStyles2)(SP),m=(0,ml.useTheme2)(),g=(0,r.createRef)(),_=o().createElement(yP,{onChange:a,value:t,mediaType:c,folderName:u,maxFiles:p});let y=n;!y&&t&&(y=MT(t));const v=d&&{fill:m.visualization.getColorByName(d)};return o().createElement(ml.PopoverController,{content:_},((e,r,a)=>o().createElement(o().Fragment,null,g.current&&o().createElement(ml.Popover,function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(xP({},a),{referenceElement:g.current,onMouseEnter:e,onKeyDown:e=>{((e,t)=>{"Tab"===e.key||e.altKey||e.ctrlKey||e.metaKey||(e.stopPropagation(),"Escape"===e.key&&t())})(e,r)}})),o().createElement("div",{ref:g,className:f.pointer,onClick:e,onKeyDown:t=>{"Enter"===t.key&&e()},role:"button",tabIndex:0},h===wT.SMALL&&(t&&y?o().createElement(oA,{src:y,className:f.icon,style:xP({},v)}):o().createElement(ml.LinkButton,{variant:"primary",fill:"text",size:"sm"},"Set icon")),h===wT.NORMAL&&o().createElement(ml.Input,{value:EP(n,i),placeholder:s,readOnly:!0,prefix:y&&o().createElement(oA,{cleanStyle:!0,src:y,className:f.icon,style:xP({},v)}),suffix:o().createElement(ml.Button,{icon:"times",variant:"secondary",fill:"text",size:"sm",onClick:l})})))))};function EP(e,t){if(e){var n;const e=null!==(n=null==t?void 0:t.lastIndexOf(".svg"))&&void 0!==n?n:0;if(e>0)return t.substring(0,e)}return t}const SP=e=>({pointer:BE.css`
    cursor: pointer;
    input[readonly] {
      cursor: pointer;
    }
  `,icon:BE.css`
    vertical-align: middle;
    display: inline-block;
    fill: currentColor;
    width: 25px;
  `}),TP=({value:e,onChange:t,context:n,item:i})=>{var s;const a=null!==(s=i.settings)&&void 0!==s?s:{},l=sT(n.data,null==a?void 0:a.filter),c=aT(l,e,void 0,void 0,a.baseNameMode),u=(0,r.useCallback)((e=>{if(!e||function(e,t){return!!e&&(t.display.has(e)||t.raw.has(e))}(e.value,l))return t(null==e?void 0:e.value)}),[l,t]),h=c.find((t=>t.value===e));var d;return o().createElement(o().Fragment,null,o().createElement(ml.Select,{value:h,placeholder:null!==(d=a.placeholderText)&&void 0!==d?d:"Select field",options:c,onChange:u,noOptionsMessage:a.noFieldsMessage,width:a.width,isClearable:!1!==a.isClearable}))};function AP(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){AP(e,t,n[t])}))}return e}function PP(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}_T.Fixed,_T.Field;const IP={settings:{}},MP=e=>{var t,n,i,s,a;const{value:l,context:c,onChange:u,item:h}=e,d=((0,r.useCallback)((e=>{u(PP(CP({},l),{mode:e}))}),[u,l]),(0,r.useCallback)(((e="")=>{u(PP(CP({},l),{field:e}))}),[u,l])),p=(0,r.useCallback)((e=>{u(PP(CP({},l),{fixed:null!=e?e:""}))}),[u,l]);var f;const m=null!==(f=null==l?void 0:l.mode)&&void 0!==f?f:_T.Fixed;var g;null===(t=h.settings)||void 0===t||t.showSourceRadio;const _=null!==(g=null===(n=h.settings)||void 0===n?void 0:n.resourceType)&&void 0!==g?g:bT.Icon;var y;const v=null!==(y=null===(i=h.settings)||void 0===i?void 0:i.folderName)&&void 0!==y?y:vT.Networking,b=null===(s=h.settings)||void 0===s?void 0:s.maxFiles;let x="";var w,E,S;return _===bT.Icon&&((null==l?void 0:l.fixed)?x=MT(l.fixed):(null===(w=h.settings)||void 0===w?void 0:w.placeholderValue)&&(x=MT(h.settings.placeholderValue))),o().createElement(o().Fragment,null,m!==_T.Fixed&&o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Field",labelWidth:9,grow:!0},o().createElement(o().Fragment,null,o().createElement(TP,{context:c,value:null!==(E=l.field)&&void 0!==E?E:"",onChange:d,item:IP})))),m===_T.Fixed&&o().createElement(wP,{onChange:p,onClear:e=>{e.stopPropagation(),u({mode:_T.Fixed,fixed:"",field:""})},value:null==l?void 0:l.fixed,src:x,placeholder:null===(a=h.settings)||void 0===a?void 0:a.placeholderText,name:null!==(S=RP(null==l?void 0:l.fixed))&&void 0!==S?S:"",mediaType:_,folderName:v,size:wT.NORMAL,maxFiles:b}),m===_T.Mapping&&o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Mappings",labelWidth:9,grow:!0},o().createElement("div",null,"TODO mappings editor!"))))};function RP(e){if(!e)return;const t=e.lastIndexOf("/");return t>0?e.substring(t+1):e}function OP(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){OP(e,t,n[t])}))}return e}function LP(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const DP={label:"Fixed value",value:"_____fixed_____"},FP=e=>{const{value:t,context:n,onChange:i,item:s}=e,{settings:a}=s,l=(0,ml.useStyles2)(NP),c=null==t?void 0:t.field,u=Boolean(!c),h=aT(sT(n.data),c,DP,null==a?void 0:a.filteredFieldType),d=(0,r.useMemo)((()=>PT(a)),[a]),p=(0,r.useCallback)((e=>{i(function(e,t){let{min:n,max:i}=PT(t);if(e||(e={}),null==e.max&&(e.max=i),null==e.min&&(e.min=n),e.min>e.max){const t=e.max;e.max=e.min,e.min=t}return e.min<n&&(e.min=n),e.max>i&&(e.max=i),null==e.fixed&&(e.fixed=e.min+(e.max-e.min)/2),e.field||(e.fixed>i?e.fixed=i:e.fixed<n&&(e.fixed=n)),e}(e,d))}),[i,d]),f=(0,r.useCallback)((e=>{const n=e.value;p(LP(kP({},t),n&&n!==DP.value?{field:n}:{field:void 0}))}),[p,t]),m=(0,r.useCallback)((e=>{void 0!==e&&p(LP(kP({},t),{min:e}))}),[p,t]),g=(0,r.useCallback)((e=>{void 0!==e&&p(LP(kP({},t),{max:e}))}),[p,t]),_=(0,r.useCallback)((e=>{void 0!==e&&p(LP(kP({},t),{fixed:e}))}),[p,t]),y=null!=t?t:{},v=u?DP:h.find((e=>e.value===c));return o().createElement(o().Fragment,null,o().createElement("div",null,o().createElement(ml.Select,{value:v,options:h,onChange:f,noOptionsMessage:"No fields found"})),o().createElement("div",{className:l.range},u&&o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Value",labelWidth:8,grow:!0},o().createElement(lS,LP(kP({value:y.fixed},d),{onChange:_})))),!u&&!d.hideRange&&o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Min",labelWidth:8,grow:!0},o().createElement(lS,LP(kP({value:y.min},d),{onChange:m})))),o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Max",labelWidth:8,grow:!0},o().createElement(lS,LP(kP({value:y.max},d),{onChange:g})))))))},NP=e=>({range:BE.css`
    padding-top: 8px;
  `});mT.Mod,mT.Clamped;const BP=({value:e,onChange:t,item:n,suffix:i})=>{var s,a,l,c;const u=(null===(s=n.settings)||void 0===s?void 0:s.useTextarea)?ml.TextArea:ml.Input,h=(0,r.useCallback)((i=>{let r=null!=e?e:"";var o;"key"in i&&("Enter"!==i.key||(null===(o=n.settings)||void 0===o?void 0:o.useTextarea))||(r=i.currentTarget.value.trim()),r!==e&&t(""===r?void 0:r)}),[e,null===(a=n.settings)||void 0===a?void 0:a.useTextarea,t]);return o().createElement(u,{placeholder:null===(l=n.settings)||void 0===l?void 0:l.placeholder,defaultValue:e||"",rows:(null===(c=n.settings)||void 0===c?void 0:c.useTextarea)&&n.settings.rows||5,onBlur:h,onKeyDown:h,suffix:i})};function zP(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){zP(e,t,n[t])}))}return e}function UP(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const VP=[{label:"Fixed",value:gT.Fixed,description:"Fixed value"},{label:"Field",value:gT.Field,description:"Display field value"}],GP={settings:{}},$P={settings:{}},WP=({value:e,context:t,onChange:n})=>{const i=(0,r.useCallback)((t=>{n(UP(jP({},e),{mode:t}))}),[n,e]),s=(0,r.useCallback)((t=>{n(UP(jP({},e),{field:t}))}),[n,e]),a=(0,r.useCallback)(((t="")=>{n(UP(jP({},e),{fixed:t}))}),[n,e]);var l;const c=null!==(l=null==e?void 0:e.mode)&&void 0!==l?l:gT.Fixed;var u;return o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Source",labelWidth:9,grow:!0},o().createElement(ml.RadioButtonGroup,{value:c,options:VP,onChange:i,fullWidth:!0}))),c!==gT.Fixed&&o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Field",labelWidth:9,grow:!0},o().createElement(TP,{context:t,value:null!==(u=e.field)&&void 0!==u?u:"",onChange:s,item:GP}))),c===gT.Fixed&&o().createElement(ml.InlineFieldRow,{key:null==e?void 0:e.fixed},o().createElement(ml.InlineField,{label:"Value",labelWidth:9,grow:!0},o().createElement(BP,{context:t,value:null==e?void 0:e.fixed,onChange:a,item:$P,suffix:(null==e?void 0:e.fixed)&&o().createElement(ml.Button,{icon:"times",variant:"secondary",fill:"text",size:"sm",onClick:()=>{a("")}})}))),c===gT.Template&&o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Template",labelWidth:9,grow:!0},o().createElement(BP,{context:t,value:null==e?void 0:e.fixed,onChange:a,item:$P}))))};var HP;!function(e){e.Point="point",e.Line="line",e.Polygon="polygon",e.Any="*any*"}(HP||(HP={}));const qP=Object.freeze({size:{fixed:10,min:10,max:30},color:{fixed:"dark-green"},opacity:.4,textConfig:{fontSize:14}});function XP(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function ZP(e){var t,n;const i=null==e?void 0:e.text;return!!(i&&(i.mode===gT.Fixed&&(null===(t=i.fixed)||void 0===t?void 0:t.length)||i.mode===gT.Field&&(null===(n=i.field)||void 0===n?void 0:n.length)))}function YP(e){return KP.apply(this,arguments)}function KP(){var e;return e=function*(e){var t,n,i,r,o,s;e||(e=qP);const a=ZP(e),l={};var c,u,h,d;const p={config:e,hasText:a,fields:l,base:{color:UE.config.theme2.visualization.getColorByName(null!==(c=null===(t=e.color)||void 0===t?void 0:t.fixed)&&void 0!==c?c:qP.color.fixed),opacity:null!==(u=e.opacity)&&void 0!==u?u:qP.opacity,lineWidth:null!==(h=e.lineWidth)&&void 0!==h?h:1,size:null!==(d=null===(n=e.size)||void 0===n?void 0:n.fixed)&&void 0!==d?d:qP.size.fixed}};var f,m,g,_;return(null===(r=e.color)||void 0===r||null===(i=r.field)||void 0===i?void 0:i.length)&&(l.color=e.color.field),(null===(s=e.size)||void 0===s||null===(o=s.field)||void 0===o?void 0:o.length)&&(l.size=e.size.field),a&&(p.base.text=null===(f=e.text)||void 0===f?void 0:f.fixed,p.base.textConfig=null!==(_=e.textConfig)&&void 0!==_?_:qP.textConfig,(null===(g=e.text)||void 0===g||null===(m=g.field)||void 0===m?void 0:m.length)&&(l.text=e.text.field)),Object.keys(l).length||(p.fields=void 0),p},KP=function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){XP(o,i,r,s,a,"next",e)}function a(e){XP(o,i,r,s,a,"throw",e)}s(void 0)}))},KP.apply(this,arguments)}function JP(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function QP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){JP(e,t,n[t])}))}return e}function eI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const tI=e=>{var t;const{value:n,onChange:i,item:s}=e,{isAuxLayer:a}=s.settings,l=(0,r.useMemo)((()=>{var t;return null===(t=s.settings)||void 0===t||t.frameMatcher,e.context}),[e.context,s.settings]),c=s.settings,u=e=>{i(eI(QP({},n),{color:e}))},h=e=>{i(eI(QP({},n),{opacity:e}))},d=ZP(n);var p,f,m,g,_,y,v,b;return(null==c?void 0:c.simpleFixedValues)?o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Color",labelWidth:10},o().createElement(ml.InlineLabel,{width:4},o().createElement(ml.ColorPicker,{color:null!==(f=null==n||null===(p=n.color)||void 0===p?void 0:p.fixed)&&void 0!==f?f:qP.color.fixed,onChange:e=>{u({fixed:e})}})))),o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Opacity",labelWidth:10,grow:!0},o().createElement(nT,{value:null!==(m=null==n?void 0:n.opacity)&&void 0!==m?m:qP.opacity,context:l,onChange:h,item:{settings:{min:0,max:1,step:.1}}})))):o().createElement(o().Fragment,null,!a&&o().createElement(ml.Field,{label:"Circle size"},o().createElement(FP,{value:null!==(g=null==n?void 0:n.size)&&void 0!==g?g:qP.size,context:l,onChange:e=>{i(eI(QP({},n),{size:e}))},item:{settings:{min:1,max:500,filteredFieldType:"number"}}})),o().createElement(ml.Field,{label:a?"Fill color":"Circle color"},o().createElement(dT,{value:null!==(_=null==n?void 0:n.color)&&void 0!==_?_:qP.color,context:l,onChange:u,item:{settings:{filteredFieldType:"number"}}})),o().createElement(ml.Field,{label:"Fill opacity"},o().createElement(nT,{value:null!==(y=null==n?void 0:n.opacity)&&void 0!==y?y:qP.opacity,context:l,onChange:h,item:{settings:{min:0,max:1,step:.1}}})),!a&&o().createElement(ml.Field,{label:"Text label"},o().createElement(WP,{value:null!==(v=null==n?void 0:n.text)&&void 0!==v?v:yT,context:l,onChange:e=>{i(eI(QP({},n),{text:e}))},item:{}})),d&&o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.Field,{label:"Font size"},o().createElement(cS,{value:null!==(b=null==n||null===(t=n.textConfig)||void 0===t?void 0:t.fontSize)&&void 0!==b?b:qP.textConfig.fontSize,context:l,onChange:e=>{i(eI(QP({},n),{textConfig:eI(QP({},n.textConfig),{fontSize:e})}))},item:{}})))))};function nI(e,t,n,i){const r={};var o,s;if(i&&Object.keys(i).length)r.color=AT(e,null!==(o=i.color)&&void 0!==o?o:qP.color,n),r.size=CT(e,null!==(s=i.size)&&void 0!==s?s:qP.size),i.text&&(i.text.field||i.text.fixed)&&(r.text=IT(e,i.text));else if(t.fields){var a,l;t.fields.color&&(r.color=AT(e,null!==(a=t.config.color)&&void 0!==a?a:qP.color,n)),t.fields.size&&(r.size=CT(e,null!==(l=t.config.size)&&void 0!==l?l:qP.size)),t.fields.text&&(r.text=IT(e,t.config.text))}return r}function iI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rI(e,n){if(n.every((t=>{const n=t.name;return e.hasOwnProperty(n)}))){if(n.every((n=>{const i=n.name;let r=[];r=n.type===t.FieldType.number?n.value.split(",").map((e=>parseInt(e,10))):n.value.split(",").map((e=>e.trim()));const o=e[i];return r.includes(o)})))return n.length}return-1}const oI=(e,t)=>t.map((t=>function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){iI(e,t,n[t])}))}return e}({},t),{overrides:rI(e,t.overrides)}))).filter((e=>-1!==e.overrides));function sI(e,t=[],n="cisco/atm-switch",i=20,r=-5){var o;const s=oI(e,t).sort(((e,t)=>t.overrides-e.overrides));let a=n,l=i,c=r;if(!t.length||!s.length)return{iconName:n,iconSize:i,iconVOffset:r};if(s[0]&&!(null==s||null===(o=s[0])||void 0===o?void 0:o.overrides)){const e=t.find((e=>0===e.overrides.length));return e?{iconName:e.iconName,iconSize:e.iconSize,iconVOffset:e.iconVOffset}:{iconName:n,iconSize:i,iconVOffset:r}}const u=s[0];return a=u.iconName,l=u.iconSize,c=u.iconVOffset,{iconName:a,iconSize:l,iconVOffset:c}}function aI(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function lI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){lI(e,t,n[t])}))}return e}function uI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const hI={startId:0,direction:"target",vertices:{},searchProperties:[],show:!0,style:qP,jitterPoints:!1},dI=ne.Points,pI={isShowBW:!1,throughputField:void 0,bandField:void 0,type:dI,name:"new data",config:hI,location:{mode:YE.Auto}};let fI;const mI={id:dI,name:"Markers and clusters",description:"nodes and edges from query",isBaseMap:!1,showLocation:!0,pointsUp:(gI=function*(e,n,i){var r;const o=cI({},hI,n.config),s=yield nS(null==n?void 0:n.location);if(!e.series.length)return[];const a=n.locField,l=n.parField,c=n.edgeLabelField,u=n.isShowBW,h=n.bandField,d=n.throughputField,p=n.isShowTooltip,f=n.aggrTypeField,m=n.displayProperties;fI=n.searchProperties;const g=o.jitterPoints,_=o.startId,y=o.direction,v=o.vertices,b=o.locLabelName,x=o.svgIconRules,w=o.thresholds,E=dI,S=yield YP(o.style),T={};b&&(null===(r=e.annotations)||void 0===r?void 0:r.length)&&e.annotations[0].fields.length&&e.annotations.forEach((e=>{new t.DataFrameView(e).toArray().forEach((e=>{var t,n;(null==e?void 0:e.text)&&(e.labels=function(e){const t=e.match(/(\w+)\s*=\s*(\w+)/g);if(!t)return null;const n={};return t.forEach((e=>{const[t,i,r]=e.match(/(\w+)\s*=\s*(\w+)/);n[i]=r})),n}(null==e?void 0:e.text));const i=null===(t=e.labels)||void 0===t?void 0:t.alertname,r=null===(n=e.labels)||void 0===n?void 0:n[b];if(i){const t=T[i];if(t){const n=t.get(r);n?n.push(e):t.set(r,[e])}else{const t=new Map;t.set(e.labels[b],[e]),T[i]=t}}}))}));const A=new Map;for(const r of e.series){var C,P;if(S.dims=nI(r,S,i),!r.refId||n.query&&n.query.options===r.refId||(null===(C=r.meta)||void 0===C?void 0:C.transformations)&&(null===(P=r.meta.transformations)||void 0===P?void 0:P.length)>0){const e=rS(r,s);e.warning;const o=e.points;if(!o)return console.log("no coords"),[];const b=new t.DataFrameView(r).toArray(),C=[];let P=0;return o.forEach(((e,t)=>{var r,o,s,I;const{type:M,coordinates:R}=e,O=b[t],k=a&&O[a];if(!k)return;const L=c,D=n.bandNumber,F=h&&O[h],N=d&&O[d],B={type:"Point",coordinates:R.slice()},z=de(l&&O[l]);let j;const U=p&&m&&(null==m?void 0:m.length)?[...m,"ack","msg","all_annots"]:["ack","msg"],V=cI({},S.base),G=S.dims,$=null===(o=S.config)||void 0===o||null===(r=o.color)||void 0===r?void 0:r.field,W=$?O[$]:void 0;G&&(G.color&&(V.color=G.color.get(t)),G.size&&(V.size=G.size.get(t)),G.text&&(V.text=G.text.get(t)));const H=null===(I=S.config)||void 0===I||null===(s=I.color)||void 0===s?void 0:s.fixed;V.fixedColor=H;const q=H&&i.visualization.getColorByName(H),X=q?he(q):void 0;if(!k||v.hasOwnProperty(k)&&"source"!==y){const e=[a,l,"locName","sources","geojson","longitude","latitude","$streamId","$time","colType"];j=Object.fromEntries(Object.entries(cI(uI(cI({},O),{metric:W}),N&&{bandNumber:D,bandWidth:F,throughput:N})).filter((([t])=>!e.includes(t))))}else{var Z;const e=_+P;if(!(null===(Z=v[k])||void 0===Z?void 0:Z.ptId)){if(v[k]=uI(cI({},v[k]),{ptId:e,tarCoords:R.slice()}),g&&2===(null==R?void 0:R.length)){const[e,t]=R,n=`${e},${t}`;A.has(n)||A.set(n,[]),A.get(n).push({idx:_+P,longitude:e,latitude:t})}let t,n=[];Object.keys(T).forEach((e=>{const t=T[e].get(k);(null==t?void 0:t.length)&&n.push(t)})),n.length&&(t=n);const i=cI(uI(cI(uI(cI({},O),{locName:k,edgeField:L,style:V}),u&&N&&{bandNumber:D,bandWidth:F,throughput:N}),{aggrType:f&&O[f],all_annots:t,colType:E}),p&&{isShowTooltip:p},U&&{displayProps:U}),r=Xr(i,W,w,X),o=sI(i,x),s={id:_+P,type:"Feature",geometry:B,properties:uI(cI({},i),{threshold:cI({},r,o)})};C.push(s),P++}}if(Array.isArray(z)&&Array.isArray(z[0]))for(let e=0;e<z.length;e++){const t=yI(z,0,e,k);t.length&&vI(v,t,y,j)}else if(z){const e=yI(z,0,null,k);if(e.filter((e=>e&&("string"==typeof e||Array.isArray(e)))).length<2)return;vI(v,e,y,j)}})),g&&A.forEach((e=>{const t=e.length;if(t>1){let n=0,i=1;e.forEach((({idx:e,longitude:r,latitude:o},s)=>{var a;if(e&&"Point"===(null===(a=C[e])||void 0===a?void 0:a.geometry.type)){const s=C[e].geometry;s.coordinates[0]=r+5e-5*Math.cos(n),s.coordinates[1]=o+5e-5*Math.sin(n),n=2*Math.PI*i/(t+1),i+=1}}))}})),C}}return[]},_I=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=gI.apply(e,t);function o(e){aI(r,n,i,o,s,"next",e)}function s(e){aI(r,n,i,o,s,"throw",e)}o(void 0)}))},function(e,t,n){return _I.apply(this,arguments)}),registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:tI,settings:{displayRotation:!0},defaultValue:hI.style}).addBooleanSwitch({path:"config.jitterPoints",name:"Jitter points",description:"Jitter points with same coordinates around each other",defaultValue:hI.jitterPoints})},defaultOptions:hI};var gI,_I;function yI(e,t,n,i){if(!Array.isArray(e))return"string"==typeof e?[i,e]:[];const r=Array.isArray(e[n])?e[n]:e;return Array.isArray(r)&&"string"==typeof r[0]||!Array.isArray(r[0])&&"string"==typeof r?Array.isArray(r)&&1===r.length?[i,r[0]]:r[0]!==i?[i,...r]:r:[]}function vI(e,t,n,i){var r;const o=t[0],s=t.at(-1),a="source"===n,l=a?s:o,c=a?o:s,u=a?t.slice().reverse():t,h=null===(r=e[l])||void 0===r?void 0:r.sources;var d,p;h?h[c]?(null==h||null===(d=h[c])||void 0===d?void 0:d.lineExtraProps)&&(h[c]=uI(cI({},h[c]),{lineExtraProps:cI({},null===(p=h[c])||void 0===p?void 0:p.lineExtraProps,Object.fromEntries(Object.entries(i||{}).filter((([e,t])=>null!=t&&""!==t))))})):h[c]=cI({parPath:u},i?{lineExtraProps:i}:{}):e[l]=uI(cI({},e[l]),{sources:{[c]:{parPath:u}}})}const bI=Rl((e=>{var{selectHandler:t,total:n,wait:i=300,value:s="",placeholder:a="Search",aggrTypesOnly:l=!1,noAggrTypes:c=!1,isMainLocSearch:u=!1}=e;!function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}}(e,["selectHandler","total","wait","value","placeholder","aggrTypesOnly","noAggrTypes","isMainLocSearch"]),(0,ml.useStyles2)(xI);const{pointStore:h,viewStore:d}=xR(),{switchMap:p,getSelectedIp:f}=h,{setViewState:m}=d,g=(0,r.useMemo)((()=>p?Array.from(p,(([e,t])=>{const n=[fI].filter((e=>null==e?void 0:e.length)).reduce(((e,t)=>e.concat(t)),[]),i=(n&&n.length?n:[]).map((e=>t.properties[e])).join(" "),r=fe(null==t?void 0:t.geometry);return{label:`${e} ${i}`,value:e,color:t.properties.iconColor,coord:r,aggrType:t.properties.aggrType}})):[]),[n]),_=l?g.filter((e=>te.includes(null==e?void 0:e.aggrType))):c?g.filter((e=>!te.includes(null==e?void 0:e.aggrType))):g,y=`Search: ${n}`,v=u?f:s;return o().createElement(ml.Select,{virtualized:!0,options:_,isSearchable:!0,value:""!==v?v:null,placeholder:y,onChange:e=>{t(e.value,null,!0,!0)}})})),xI=e=>({});function wI(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function EI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const SI=e=>({inlineRow:BE.css`
      display: flex;
      align-items: center;
      pointer-events: all;
    `,myMenu:BE.css`
    color: grey;    
    font-size: 0.9em;
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    z-index: 9;
    top: ${e.spacing(1)};
    left: ${e.spacing(1)};
    width: auto;    
    // min-width: 15%;
    background: none;
    pointer-events: none;

     > div,button, ul, input, p  {    
     }
`,field:BE.css`
      margin-top: ${e.spacing(.1)};
      margin-right: ${e.spacing(1.5)};
    `}),TI=Rl((({setShowCenter:e,total:t})=>{const{pointStore:n,lineStore:i,viewStore:r,replaceVariables:s}=xR(),{getViewState:a,setViewState:l,getClusterMaxZoom:c,setClusterMaxZoom:u}=r,{switchMap:h,setSelectedIp:d,setTooltipObject:p,getSelectedIp:f}=n,{getDirection:m,setDirection:g}=i,_=["target","source"].includes(s("$locRole")),y=(0,ml.useStyles2)(SI),v=[];for(let e=18;e>=2;e--)v.push({label:e.toString(),value:e});const b=function(){var t=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){wI(o,i,r,s,a,"next",e)}function a(e){wI(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(t,n,i=!0,r=!0,o){t&&i?d(t,null):t&&!r||null==o||d(null,[o]);const s=null==h?void 0:h.get(t);if(r&&(s||n)){const t=fe(null==s?void 0:s.geometry);(n||t)&&(0,gl.flushSync)((()=>{var r,o;e(i),l(function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){EI(e,t,n[t])}))}return e}({},a),{longitude:n?n[0]:t[0],latitude:n?n[1]:t[1],transitionDuration:250,maxPitch:42.75,zoom:null!==(o=null==rR||null===(r=rR.transform)||void 0===r?void 0:r.zoom)&&void 0!==o?o:18}))}))}}));return function(e,n){return t.apply(this,arguments)}}();return o().createElement("div",{className:y.myMenu},o().createElement(ml.InlineFieldRow,{className:y.inlineRow},o().createElement(ml.InlineField,{className:y.field},o().createElement(bI,{aggrTypesOnly:!1,total:t,value:f,isMainLocSearch:!0,selectHandler:b})),o().createElement(ml.InlineField,{className:y.field},o().createElement(ml.Tooltip,{content:"cluster max zoom"},o().createElement("div",null,o().createElement(ml.Select,{onChange:e=>{e.value&&u(e.value)},value:c,options:v})))),o().createElement(ml.InlineField,{className:y.field},o().createElement(ml.Tooltip,{content:"swap tar-src"},o().createElement("div",null,o().createElement(ml.Switch,{value:"source"===m,title:"path reverse",onChange:()=>{d(""),p({}),g("target"===m?"source":"target"),_&&UE.locationService.partial({"var-locRole":"target"===m?"source":"target"},!0)}}))))),o().createElement(jE,null))}));function AI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function CI(e,t){return"object"==typeof e&&null!==e?o().createElement("ul",null,Object.entries(e).map((([n,i],r)=>o().createElement(o().Fragment,null,t&&"labels"===n?i&&Object.entries(i).map((([e,t],r)=>o().createElement("span",{key:`${n}-${r}`},`${e}: ${t}`,r!==Object.keys(i).length-1?", ":""))):Array.isArray(i)?i.map(((e,t)=>o().createElement("span",{key:t},`${t}: ${e}`,t!==i.length-1?", ":""))):o().createElement("span",null,`${n}: ${i}`),r!==Object.keys(e).length-1?", ":""))),o().createElement("br",null)," "):e}const PI=({parent:e,props:t,getSelectedIp:n,getDirection:i})=>o().createElement(ml.IconButton,{key:"setVars",variant:"primary",name:"graph-bar",size:"sm",tooltip:"set vars",tooltipPlacement:"left",onClick:()=>{!function({parent:e,props:t,getSelectedIp:n,getDirection:i}){const[r,o]="target"===i?[n,e]:[e,n];UE.locationService.partial({"var-target":null!=r?r:"","var-source":null!=o?o:""},!0)}({parent:e,props:t,getSelectedIp:n,getDirection:i})}});function II({object:e,time:n,timeZone:i,pinned:r=!1,getSelectedIp:s="",setSelectedIp:a,getDirection:l,setTooltipObject:c,setClosedHint:u}){var h,d,p;const f=null!==(p=null!==(d=null==e?void 0:e.properties)&&void 0!==d?d:e)&&void 0!==p?p:{};let m=null==f?void 0:f.displayProps;const g=Array.isArray(m)?m.reduce(((e,t)=>(f.hasOwnProperty(t)&&(Array.isArray(f[t])?e[t]=f[t].map((e=>e)):e[t]=f[t]),e)),{}):f;let _;if(g.hasOwnProperty("all_annots")){const e=ce(g.all_annots,n),i=[];(null==e?void 0:e.length)&&(null==e||e.forEach((e=>{if(!e)return;const{labels:n,newState:r,timeEnd:o}=e,{grafana_folder:s}=n,a=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(n,["grafana_folder"]),l=e.timeEnd,c={};l&&(c.timeF=(0,t.dateTime)(l).format("YYYY-MM-DD HH:mm:ss"));const u=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){AI(e,t,n[t])}))}return e}({labels:a,newState:r,timeEnd:o},c);i.push(u)})),_=i),delete g.all_annots}const y=f.ptId&&Array.isArray(f.parPath)&&f.parPath.length?[null===(h=f.parPath)||void 0===h?void 0:h.at(-1)]:f.sources&&Object.keys(f.sources),v=null==y?void 0:y.map(((e,t)=>o().createElement("li",{key:""+t},r&&o().createElement(PI,{parent:e,props:f,getSelectedIp:s,getDirection:l}),"target"===l?"src: ":"tar: ",o().createElement("a",{onClick:()=>{var t;return a(s,[null===(t=f.sources[e])||void 0===t?void 0:t.lineId])}},e))));return o().createElement(o().Fragment,null,o().createElement("ul",null,f.locName&&o().createElement("li",{key:"locName"},r&&o().createElement(o().Fragment,null,o().createElement(ml.IconButton,{key:"closeHint",variant:"destructive",name:"x",size:"sm",tooltip:"close",tooltipPlacement:"left",onClick:()=>{c({}),u(!0)}}),!(null==v?void 0:v.length)&&o().createElement(PI,{props:f,getSelectedIp:s,getDirection:l})),"target"===l?"tar: ":"src: ",o().createElement("a",{onClick:()=>a(s,null)},f.locName)),v,Object.entries(g).map((([e,t])=>o().createElement("li",{key:e},`${e}: ${CI(t,!1)}`))),(null==_?void 0:_.length)&&o().createElement(o().Fragment,null,o().createElement("li",{key:"ans"},_.map(((e,t)=>o().createElement("li",{key:t},CI(e,!0))))))))}const MI=({info:e,time:t,timeZone:n,isClosed:i=!1,setTooltipObject:r,setClosedHint:s,position:a=0})=>{var l,c,u;const h=(0,ml.useStyles2)((e=>({tooltip:BE.css`
      position: absolute;
      left: ${a-80}px;
      top: 150px;
      pointer-events: none;      
      text-align: left;
      user-select: text;
      cursor: text;      
      font-size: 1em;
      border-radius: 5px;
      border: ${e.isDark?"none":"solid #c7c3c3"};
      background: ${e.isDark?e.colors.background.primary:"#EAEAEA"}; 
      color: ${e.colors.getContrastText(e.colors.background.canvas)}; 
      min-width: 25px;
      max-width: 400px;
      //overflow-y: hidden;
      margin: 5px;
      padding: 8px;
      z-index: 3;
      opacity: 0.95;
      ul {
      list-style-type: none }
    `,turnOnEvents:BE.css`
 position: absolute;
      left: ${a-80}px;
      top: 150px;
      text-align: left;
      user-select: text;
      cursor: text;      
      font-size: 1em;
      border-radius: 5px;
      border: ${e.isDark?"none":"solid #c7c3c3"};
      background: ${e.isDark?e.colors.background.primary:"#EAEAEA"}; 
      color: ${e.colors.getContrastText(e.colors.background.canvas)}; 
      min-width: 25px;
      max-width: 400px;
      //overflow-y: hidden;
      margin: 5px;
      padding: 8px;
      z-index: 10;
      opacity: 0.95;
      ul {
      list-style-type: none }
        pointer-events: all`}))),{pointStore:d,lineStore:p}=xR(),{getMode:f,getTooltipObject:m,getSelectedIp:g,setSelectedIp:_,getSelIds:y}=d,{getDirection:v}=p;if(!Object.entries(e).length)return null;const{x:b=-3e3,y:x=-3e3,object:w}=e;if(!w){if(i||"modify"===f)return null;const{x:e=-3e3,y:a=-3e3,object:l}=m;return o().createElement("div",{className:h.turnOnEvents,style:{left:e,top:a}},II({object:l,time:t,timeZone:n,pinned:!0,getSelectedIp:g,setSelectedIp:_,getDirection:v,setTooltipObject:r,setClosedHint:s}))}if(!(null==w?void 0:w.isShowTooltip)&&!(null==w||null===(l=w.properties)||void 0===l?void 0:l.isShowTooltip)&&!(null==w||null===(c=w.properties)||void 0===c?void 0:c.cluster))return null;if(null==w||null===(u=w.properties)||void 0===u?void 0:u.cluster){if(i)return null;const{colorCounts:e,annotStateCounts:t}=w.properties;if(e){const n=Object.entries(e).map((([e,t],n)=>o().createElement(o().Fragment,{key:e},n>0&&o().createElement("br",null),o().createElement("span",{style:{color:e,fontWeight:"bold"}},`${t.label?t.label:e}: ${t.count}`)))),i=[];[J.Alerting,J.Pending,J.Normal].forEach((e=>{if((null==t?void 0:t[e])&&Object.keys(null==t?void 0:t[e]).length){const n=t[e];i.push([e,n])}}));const r=i.map((([e,t],n)=>o().createElement(o().Fragment,{key:e},n>0&&o().createElement("br",null),o().createElement("span",{style:{color:e,fontWeight:"bold"}},`${t.label?t.label:e}: ${t.count}`))));return n.length?o().createElement("div",{className:h.tooltip,style:{left:b,top:x}},o().createElement("div",null,n),0!==(null==r?void 0:r.length)&&o().createElement("div",null,o().createElement("br",null),o().createElement("span",null,"States: "),o().createElement("br",null),r)):null}}var E;return"modify"===f&&(null===(E=w.properties)||void 0===E?void 0:E.guideType)?null:o().createElement("div",{className:h.tooltip,style:{left:b,top:x}},II({object:w,time:t,timeZone:n,pinned:!1,setTooltipObject:r,setClosedHint:s,getDirection:v,getSelectedIp:g,setSelectedIp:_}))};function RI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var OI;!function(e){e.Auto="auto",e.Light="light",e.Dark="dark"}(OI||(OI={}));const kI={theme:"auto",showLabels:!0},LI={id:"carto",name:"CARTO reference map",isBaseMap:!0,defaultOptions:kI,create:(e,t)=>({init:()=>{const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){RI(e,t,n[t])}))}return e}({},kI,e.config);let i=n.theme;return i&&"auto"!==i||(i=t.isDark?"dark":"light"),n.showLabels?i+="_all":i+="_nolabels",{version:8,sources:{carto:{type:"raster",tiles:[`https://basemaps.cartocdn.com/${i}/{z}/{x}/{y}.png`],tileSize:256,attribution:"© CARTO"}},layers:[{id:"carto",type:"raster",source:"carto",minzoom:0,maxzoom:20}]}}}),registerOptionsUI:e=>{e.addRadio({path:"config.theme",name:"Theme",settings:{options:[{value:"auto",label:"Auto",description:"Match grafana theme"},{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},defaultValue:kI.theme}).addBooleanSwitch({path:"config.showLabels",name:"Show labels",description:"",defaultValue:kI.showLabels})}},DI=[LI];var FI,NI;const BI=Boolean((null===(NI=UE.config.panels)||void 0===NI||null===(FI=NI.debug)||void 0===FI?void 0:FI.state)===t.PluginState.alpha);function zI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const jI="https://services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",UI={url:jI+"/tile/{z}/{y}/{x}",attribution:`Tiles © <a href="${jI}">ArcGIS</a>`},VI={id:"xyz",name:"XYZ Tile layer",isBaseMap:!0,create:(e,t)=>({init:()=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){zI(e,t,n[t])}))}return e}({},e.config);var n,i,r,o;return t.url||(t.url=UI.url,t.attribution=null!==(i=null!==(n=t.attribution)&&void 0!==n?n:UI.attribution)&&void 0!==i?i:""),t.attribution||(t.attribution=null!==(o=null!==(r=t.attribution)&&void 0!==r?r:UI.attribution)&&void 0!==o?o:""),{version:8,sources:{xyz:{type:"raster",tiles:[t.url],tileSize:256,attribution:t.attribution}},layers:[{id:"xyz",type:"raster",source:"xyz",minzoom:0,maxzoom:20}]}}}),registerOptionsUI:e=>{e.addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",settings:{placeholder:UI.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:UI.attribution}})}},GI=[VI];function $I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){$I(e,t,n[t])}))}return e}const HI="custom",qI="streets",XI=new t.Registry((()=>[{id:qI,name:"World Street Map",slug:"World_Street_Map"},{id:"world-imagery",name:"World Imagery",slug:"World_Imagery"},{id:"world-physical",name:"World Physical",slug:"World_Physical_Map"},{id:"topo",name:"Topographic",slug:"World_Topo_Map"},{id:"usa-topo",name:"USA Topographic",slug:"USA_Topo_Maps"},{id:"ocean",name:"World Ocean",slug:"Ocean/World_Ocean_Base"},{id:HI,name:"Custom MapServer",description:"Use a custom MapServer with pre-cached values",slug:""}])),ZI={id:"esri-xyz",name:"ArcGIS MapServer",isBaseMap:!0,create:(e,t)=>{const n=WI({},e.config);var i;const r=XI.getIfExists(null!==(i=n.server)&&void 0!==i?i:qI);if(r.id!==HI){const e="https://services.arcgisonline.com/ArcGIS/rest/services/";n.url=`${e}${r.slug}/MapServer/tile/{z}/{y}/{x}`,n.attribution=`Tiles © <a href="${e}${r.slug}/MapServer">ArcGIS</a>`}const o=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(WI({},e),{config:n});return VI.create&&VI.create(o,t)},registerOptionsUI:e=>{e.addSelect({path:"config.server",name:"Server instance",settings:{options:XI.selectOptions().options}}).addTextInput({path:"config.url",name:"URL template",description:"Must include {x}, {y} or {-y}, and {z} placeholders",defaultValue:UI.url,settings:{placeholder:UI.url},showIf:e=>{var t;return(null===(t=e.config)||void 0===t?void 0:t.server)===HI}}).addTextInput({path:"config.attribution",name:"Attribution",defaultValue:UI.attribution,settings:{placeholder:UI.attribution},showIf:e=>{var t;return(null===(t=e.config)||void 0===t?void 0:t.server)===HI}})},defaultOptions:{server:qI}};function YI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const KI="https://wms.wheregroup.com/tileserver/style/osm-liberty.json",JI={url:KI,attribution:`Tiles © <a href="${KI}">wheregroup.com</a>`},QI={id:"fromjson",name:"From .json",isBaseMap:!0,create:(e,t)=>({init:()=>{const t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){YI(e,t,n[t])}))}return e}({},e.config);var n;return t.url||(t.url=JI.url,t.attribution=null!==(n=t.attribution)&&void 0!==n?n:JI.attribution),t.url}}),registerOptionsUI:e=>{e.addTextInput({path:"config.url",name:"URL template",description:"Json file url",settings:{placeholder:JI.url}}).addTextInput({path:"config.attribution",name:"Attribution",settings:{placeholder:JI.attribution}})}},eM=[{id:"osm-standard",name:"Open Street Map",isBaseMap:!0,create:(e,t)=>({init:()=>({version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap Contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:20}]})})},...DI,ZI,...GI,QI];function tM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function nM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function iM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){nM(e,t,n[t])}))}return e}function rM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const oM={colIdx:0,startId:0,globalThresholdsConfig:[],style:qP},sM=ne.Polygons,aM=(YE.Auto,{id:sM,name:"Polygons layer",description:"GeoJson Polygons from query",isBaseMap:!1,showLocation:!0,pointsUp:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){tM(o,i,r,s,a,"next",e)}function a(e){tM(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(e,n,i){var r;const o=iM({},oM,n.config),s=yield nS(n.location);if(!e.series.length)return[];const a=n.locField,l=n.isShowTooltip,c=n.displayProperties,u=(o.colIdx,sM),h=yield YP(o.style),d=null==n||null===(r=n.config)||void 0===r?void 0:r.globalThresholdsConfig;for(const r of e.series)if(h.dims=nI(r,h,i),n.query&&n.query.options===r.refId){const e=rS(r,s);if(e.warning&&console.log("Could not find locations",e.warning),!e.points)return console.log("no coords"),[];const n=new t.DataFrameView(r).toArray(),p=e.points.map(((e,t)=>{var r,s;const p=n[t],f=l&&c&&(null==c?void 0:c.length)?[...c,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],m=iM({},h.base),g=h.dims,_=null===(s=h.config)||void 0===s||null===(r=s.color)||void 0===r?void 0:r.field,y=_?p[_]:void 0;var v,b;g&&(g.color&&(m.color=g.color.get(t)),g.size&&(m.size=g.size.get(t)),g.text&&(m.text=g.text.get(t)),m.fixedColor=null===(b=h.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=m.fixedColor,w=x&&i.visualization.getColorByName(x),E=w?he(w):void 0,S=Object.entries(p);var T;const A=S.length>0&&a?null!==(T=p[a])&&void 0!==T?T:S[0][1]:void 0,C=iM(rM(iM({},p),{locName:A,style:m,colType:u}),l&&{isShowTooltip:l},f&&{displayProps:f}),P=Xr(C,y,d,E);return{id:o.startId+t,type:"Polygon",geometry:e,properties:rM(iM({},C),{threshold:P})}}));return p}return[]}));return function(t,n,i){return e.apply(this,arguments)}}(),registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:tI,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:oM.style})},defaultOptions:oM});function lM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function cM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){cM(e,t,n[t])}))}return e}function hM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const dM={startId:0,colIdx:0,style:qP},pM=ne.GeoJson,fM=(YE.Auto,{id:pM,name:"GeoJson layer",description:"GeoJson features from file (url)",isBaseMap:!1,showLocation:!0,pointsUp:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){lM(o,i,r,s,a,"next",e)}function a(e){lM(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(e,t,n){var i;const r=uM({},dM,t.config);if(!e.series.length)return[];const o=t.geojsonLocName,s=(t.geojsonMetricName,t.isShowTooltip),a=t.geojsonDisplayProperties,l=(r.colIdx,pM),c=((null==t?void 0:t.geojsonColor)&&he(n.visualization.getColorByName(null==t?void 0:t.geojsonColor)),yield YP(r.style)),u=null==t||null===(i=t.config)||void 0===i?void 0:i.globalThresholdsConfig,h=null==t?void 0:t.geojsonurl;if(h){var d,p;let e=yield fetch(h,{method:"GET",headers:{"Content-Type":"application/json"}}).catch((e=>{console.log(e)}));if(!e)return[];let t=yield e.json();if(!(null==t||null===(d=t.features)||void 0===d?void 0:d.length))return console.log("no geodata"),[];c.dims=nI(void 0,c,n);const i=null==t||null===(p=t.features)||void 0===p?void 0:p.map(((e,t)=>{var i,h;const{geometry:d,properties:p}=e,f=s&&a&&(null==a?void 0:a.length)?[...a,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],m=uM({},c.base),g=c.dims,_=null===(h=c.config)||void 0===h||null===(i=h.color)||void 0===i?void 0:i.field,y=_?e[_]:void 0;var v,b;g&&(g.color&&(m.color=g.color.get(t)),g.size&&(m.size=g.size.get(t)),g.text&&(m.text=g.text.get(t)),m.fixedColor=null===(b=c.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=m.fixedColor,w=x&&n.visualization.getColorByName(x),E=w?he(w):void 0,S=(Object.entries(e),uM(hM(uM({},e),{locName:o?p[o]:void 0,style:m,colType:l}),s&&{isShowTooltip:s},f&&{displayProps:f})),T=Xr(S,y,u,E);return{id:r.startId+t,type:"Feature",geometry:d,properties:hM(uM({},S),{threshold:T})}}));return i}return[]}));return function(t,n,i){return e.apply(this,arguments)}}(),registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:tI,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:dM.style})},defaultOptions:dM});function mM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function gM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){gM(e,t,n[t])}))}return e}function yM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const vM={colIdx:0,startId:0,globalThresholdsConfig:[],style:qP},bM=ne.Path,xM=(YE.Auto,{id:bM,name:"Path layer",description:"GeoJson LineStrings from query",isBaseMap:!1,showLocation:!0,pointsUp:function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){mM(o,i,r,s,a,"next",e)}function a(e){mM(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(e,n,i){var r;const o=_M({},vM,n.config),s=yield nS(n.location);if(!e.series.length)return[];const a=n.locField,l=n.isShowTooltip,c=n.displayProperties,u=(o.colIdx,bM),h=yield YP(o.style),d=null==n||null===(r=n.config)||void 0===r?void 0:r.globalThresholdsConfig;for(const r of e.series)if(h.dims=nI(r,h,i),n.query&&n.query.options===r.refId){const e=rS(r,s);if(e.warning&&console.log("Could not find locations",e.warning),!e.points)return console.log("no coords"),[];const n=new t.DataFrameView(r).toArray(),p=e.points.map(((e,t)=>{var r,s;const p=n[t],f=l&&c&&(null==c?void 0:c.length)?[...c,"ack","msg","all_annots","liveStat"]:["ack","msg","all_annots","liveStat"],m=_M({},h.base),g=h.dims,_=null===(s=h.config)||void 0===s||null===(r=s.color)||void 0===r?void 0:r.field,y=_?p[_]:void 0;var v,b;g&&(g.color&&(m.color=g.color.get(t)),g.size&&(m.size=g.size.get(t)),g.text&&(m.text=g.text.get(t)),m.fixedColor=null===(b=h.config)||void 0===b||null===(v=b.color)||void 0===v?void 0:v.fixed);const x=m.fixedColor,w=x&&i.visualization.getColorByName(x),E=w?he(w):void 0,S=Object.entries(p);var T;const A=S.length>0&&a?null!==(T=p[a])&&void 0!==T?T:S[0][1]:void 0,C=_M(yM(_M({},p),{locName:A,style:m,colType:u}),l&&{isShowTooltip:l},f&&{displayProps:f}),P=Xr(C,y,d,E);return{id:o.startId+t,type:"LineString",geometry:e,properties:yM(_M({},C),{threshold:P})}}));return p}return[]}));return function(t,n,i){return e.apply(this,arguments)}}(),registerOptionsUI:e=>{e.addCustomEditor({id:"config.style",path:"config.style",name:"Primary metric styles",editor:tI,settings:{isAuxLayer:!0,displayRotation:!0},defaultValue:vM.style})},defaultOptions:vM}),wM=[mI,aM,xM,fM],EM={type:"default",config:{}},SM={id:EM.type,name:"Default base layer",isBaseMap:!0,create:(e,t)=>{var n;const i=null===UE.config||void 0===UE.config||null===(n=UE.config.geomapDefaultBaseLayerConfig)||void 0===n?void 0:n.type;if(i){const e=TM.getIfExists(i);if(console.log("create/?"),!e)throw new Error("Invalid basemap configuraiton on server");return e&&e.create?e.create(UE.config.geomapDefaultBaseLayerConfig,t):{}}return LI&&LI.create?LI.create(e,t):{}}},TM=new t.Registry((()=>[SM,...eM,...wM])),AM=({data:e,type:t="nums",dir:n="to"})=>{const i=["list1","list2"].includes(t);let r;switch(t){case"unames":case"nums":r="meters";break;default:r="pixels"}return new Bx({data:e,id:ne.Text+"-"+t,getText:e=>e.text,getPosition:e=>{switch(t){case"unames":return[e.coordinates[0],e.coordinates[1]+5e-5];case"nums":return[e.coordinates[0],e.coordinates[1]-5e-5];default:const[t,n]=e.coordinates;return[(t[0]+n[0])/2,(t[1]+n[1])/2]}},getAngle:e=>{var t;return null!==(t=e.angle)&&void 0!==t?t:0},getAlignmentBaseline:i?"to"===n?"top":"bottom":"center",getTextAnchor:i?"start":"middle",sizeUnits:r,getSize:e=>{switch(t){case"unames":return 5;case"nums":return 3;default:const t=e.fontSize;return null!=t?t:13}},getColor:e=>ue(e.color)})},CM=[0,0,0,255],PM={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:CM},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class IM extends qb{static{this.layerName="PolygonLayer"}static{this.defaultProps=PM}initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&rs.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),n=e.dataChanged.map((e=>Xb({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:n})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:n,positionFormat:i,_normalize:r}=this.props,o=[],s="XY"===i?2:3,{startRow:a,endRow:l}=e,{iterable:c,objectInfo:u}=v_(t,a,l);for(const e of c){u.index++;let t=n(e,u);r&&(t=Ew(t,s));const{holeIndices:i}=t,a=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const n=a.slice(i[t-1]||0,i[t]||a.length);o.push(this.getSubLayerRow({path:n},e,u.index))}else o.push(this.getSubLayerRow({path:a},e,u.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:n,filled:i,extruded:r,wireframe:o,_normalize:s,_windingOrder:a,elevationScale:l,transitions:c,positionFormat:u}=this.props,{lineWidthUnits:h,lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:f,lineJointRounded:m,lineMiterLimit:g,lineDashJustified:_}=this.props,{getFillColor:y,getLineColor:v,getLineWidth:b,getLineDashArray:x,getElevation:w,getPolygon:E,updateTriggers:S,material:T}=this.props,{paths:A,pathsDiff:C}=this.state,P=this.getSubLayerClass("fill",Lw),I=this.getSubLayerClass("stroke",uw),M=this.shouldRenderSubLayer("fill",A)&&new P({_dataDiff:t,extruded:r,elevationScale:l,filled:i,wireframe:o,_normalize:s,_windingOrder:a,getElevation:w,getFillColor:y,getLineColor:r&&o?v:CM,material:T,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:S&&{getPolygon:S.getPolygon,getElevation:S.getElevation,getFillColor:S.getFillColor,lineColors:r&&o,getLineColor:S.getLineColor}}),{data:e,positionFormat:u,getPolygon:E}),R=!r&&n&&this.shouldRenderSubLayer("stroke",A)&&new I({_dataDiff:C&&(()=>C),widthUnits:h,widthScale:d,widthMinPixels:p,widthMaxPixels:f,jointRounded:m,miterLimit:g,dashJustified:_,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(v),getWidth:this.getSubLayerAccessor(b),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:S&&{getWidth:S.getLineWidth,getColor:S.getLineColor,getDashArray:S.getLineDashArray}}),{data:A,positionFormat:u,getPath:e=>e.path});return[!r&&M,R,r&&M]}}function MM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function RM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){MM(e,t,n[t])}))}return e}function OM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const kM={marker:{x:0,y:0,width:128,height:128,mask:!0}},LM=e=>{const{data:t,getSelectedFeIndexes:n,highlightColor:i,onHover:r,iconMapping:o=kM,colType:s=ne.Polygons,getTooltipObject:a,setHoverInfo:l,setClosedHint:c,closedHint:u,hoverCluster:h,hoverInfo:d,setHoverCluster:p,setTooltipObject:f,theme2:m,isStatic:g}=e;var _;return new IM({highlightColor:i,pickable:!0,autoHighlight:s!==ne.Hull,id:g?s+"-"+g:s,iconMapping:o,data:t,onHover:e=>{var t,n;if(s!==ne.Hull)return r(e);if((null==a?void 0:a.object)&&Object.keys(null==a?void 0:a.object).length)return;if(!e.object)return void l({});const i=null!==(n=null==h?void 0:h.objects)&&void 0!==n?n:d.prevHullData,o=null==h||null===(t=h.object)||void 0===t?void 0:t.properties;if(o){const{cluster:t,colorCounts:n,annotStateCounts:i}=o;e.object.properties=OM(RM({},e.object.properties),{cluster:t,colorCounts:n,annotStateCounts:i,isHull:!0})}(0,gl.flushSync)((()=>{l(OM(RM({},e),{prevHullData:i})),u&&c(!1)}))},onClick:()=>{l({}),p(null),f({})},selectedFeatureIndexes:null!==(_=null==n?void 0:n[ne.Polygons])&&void 0!==_?_:[],getPolygon:e=>e.geometry.coordinates,getIcon:()=>"marker",filled:!0,stroked:s!==ne.Hull,getFillColor:e=>{var t,n;if(s===ne.Hull)return ue(m.isDark?"rgb(255, 215, 0, 0.2)":"rgb(66, 164, 245, 0.2)");const{threshold:i}=e.properties,{color:r}=i,o=null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.opacity,a=ue(r);return o&&(a[3]=Math.round(255*o)),a},extruded:!1,getLineColor:e=>{const{threshold:t}=e.properties,{color:n}=t;return ue(n)},getLineWidth:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth}})},DM={marker:{x:0,y:0,width:128,height:128,mask:!0}};var FM=d(5731);const NM=()=>{var e,t;const n=(0,ml.useStyles2)(BM),{pointStore:i,viewStore:r}=xR(),{getSelCoord:s}=i;function a(e){const t=document.getElementById(e);if(t){const e=document.createRange();e.selectNode(t);const n=window.getSelection();null==n||n.removeAllRanges(),null==n||n.addRange(e)}}const l=s.coordinates.length?s:{coordinates:[" "," "],type:"Point"};return o().createElement("div",{className:n.posTracker},o().createElement("div",null,o().createElement("span",{onDoubleClick:()=>a("coordinates")},o().createElement(FM.CopyToClipboard,{text:JSON.stringify(s)},o().createElement(ml.Icon,{name:"copy",size:"xs",title:"Copy GeoJSON"}))," ",o().createElement("span",{id:"coordinates"},"[",o().createElement("span",{onClick:()=>a("lon")},o().createElement("span",{id:"lon"},null===(e=l.coordinates)||void 0===e?void 0:e[0])),",",o().createElement("span",{onClick:()=>a("lat")},o().createElement("span",{id:"lat"},null==l||null===(t=l.coordinates)||void 0===t?void 0:t[1])),"]")," lon,lat")))},BM=e=>({posTracker:BE.css`
        //margin-bottom: 5px;        
        margin-right: ${e.spacing(1)};
          //position: absolute;
          z-index: 1;
          //bottom: ${e.spacing(.3)};
      font-size: x-small;
      // color: ${e.colors.getContrastText(e.colors.background.primary)};
      
        `}),zM={name:"collision",dependencies:[Ac],vs:"\nin float collisionPriorities;\nuniform sampler2D collision_texture;\nuniform bool collision_sort;\nuniform bool collision_enabled;\nvec2 collision_getCoords(vec4 position) {\nvec4 collision_clipspace = project_common_position_to_clipspace(position);\nreturn (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;\n}\nfloat collision_match(vec2 tex, vec3 pickingColor) {\nvec4 collision_pickingColor = texture(collision_texture, tex);\nfloat delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));\nfloat e = 0.001;\nreturn step(delta, e);\n}\nfloat collision_isVisible(vec2 texCoords, vec3 pickingColor) {\nif (!collision_enabled) {\nreturn 1.0;\n}\nconst int N = 2;\nfloat accumulator = 0.0;\nvec2 step = vec2(1.0 / project_uViewportSize);\nconst float floatN = float(N);\nvec2 delta = -floatN * step;\nfor(int i = -N; i <= N; i++) {\ndelta.x = -step.x * floatN;\nfor(int j = -N; j <= N; j++) {\naccumulator += collision_match(texCoords + delta, pickingColor);\ndelta.x += step.x;\n}\ndelta.y += step.y;\n}\nfloat W = 2.0 * floatN + 1.0;\nreturn pow(accumulator / (W * W), 2.2);\n}\n",inject:{"vs:#decl":"\nfloat collision_fade = 1.0;\n","vs:DECKGL_FILTER_GL_POSITION":"\nif (collision_sort) {\nfloat collisionPriority = collisionPriorities;\nposition.z = -0.001 * collisionPriority * position.w;\n}\nif (collision_enabled) {\nvec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));\nvec2 collision_texCoords = collision_getCoords(collision_common_position);\ncollision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);\nif (collision_fade < 0.0001) {\nposition = vec4(0.0, 0.0, 2.0, 1.0);\n}\n}\n","vs:DECKGL_FILTER_COLOR":"\ncolor.a *= collision_fade;\n"},getUniforms:(e,t)=>{if(!e||!("dummyCollisionMap"in e))return{};const{collisionFBO:n,drawToCollisionMap:i,dummyCollisionMap:r}=e;return{collision_sort:Boolean(i),collision_texture:!i&&n?n.colorAttachments[0]:r}}};class jM extends nd{renderCollisionMap(e,t){const n=[1,1,e.width-2,e.height-2];this.render({...t,clearColor:[0,0,0,0],scissorRect:n,target:e,pass:"collision"})}getLayerParameters(e,t,n){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}getModuleParameters(){return{drawToCollisionMap:!0,picking:{isActive:1,isAttribute:!1},lightSources:{}}}}class UM{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:t}=e;this.dummyCollisionMap=t.createTexture({width:1,height:1}),this.collisionFilterPass=new jM(t,{id:"default-collision-filter"})}preRender({effects:e,layers:t,layerFilter:n,viewports:i,onViewportActive:r,views:o,isPicking:s,preRenderStats:a={}}){const{device:l}=this.context;if(s)return;const c=t.filter((({props:{visible:e,collisionEnabled:t}})=>e&&t));if(0===c.length)return void(this.channels={});const u=e?.filter((e=>e.useInPicking&&a[e.id])),h=a["mask-effect"]?.didRender,d=this._groupByCollisionGroup(l,c),p=i[0],f=!this.lastViewport||!this.lastViewport.equals(p)||h;for(const e in d){const t=this.collisionFBOs[e],i=d[e],[s,a]=l.canvasContext.getPixelSize();t.resize({width:s/2,height:a/2}),this._render(i,{effects:u,layerFilter:n,onViewportActive:r,views:o,viewport:p,viewportChanged:f})}}_render(e,{effects:t,layerFilter:n,onViewportActive:i,views:r,viewport:o,viewportChanged:s}){const{collisionGroup:a}=e,l=this.channels[a];if(!l)return;const c=s||e===l||!Do(l.layers,e.layers,1)||e.layerBounds.some(((e,t)=>!hs(e,l.layerBounds[t])))||e.allLayersLoaded!==l.allLayersLoaded||e.layers.some((e=>e.props.transitions));if(this.channels[a]=e,c){this.lastViewport=o;const s=this.collisionFBOs[a];this.collisionFilterPass.renderCollisionMap(s,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:t,layerFilter:n,viewports:o?[o]:[],onViewportActive:i,views:r,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:s.device.canvasContext.getDevicePixelRatio()/2}})}}_groupByCollisionGroup(e,t){const n={};for(const e of t){const{collisionGroup:t}=e.props;let i=n[t];i||(i={collisionGroup:t,layers:[],layerBounds:[],allLayersLoaded:!0},n[t]=i),i.layers.push(e),i.layerBounds.push(e.getBounds()),e.isLoaded||(i.allLayersLoaded=!1)}for(const t of Object.keys(n))this.collisionFBOs[t]||this.createFBO(e,t),this.channels[t]||(this.channels[t]=n[t]);for(const e of Object.keys(this.collisionFBOs))n[e]||this.destroyFBO(e);return n}getModuleParameters(e){const{collisionGroup:t}=e.props,{collisionFBOs:n,dummyCollisionMap:i}=this;return{collisionFBO:n[t],dummyCollisionMap:i}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,t){const{width:n,height:i}=e.gl.canvas,r=e.createTexture({format:"rgba8unorm",width:n,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=e.createTexture({format:"depth16unorm",width:n,height:i,mipmaps:!1,dataFormat:6402,type:5125});this.collisionFBOs[t]=e.createFramebuffer({id:`collision-${t}`,width:n,height:i,colorAttachments:[r],depthStencilAttachment:o})}destroyFBO(e){const t=this.collisionFBOs[e];t.colorAttachments[0]?.destroy(),t.depthStencilAttachment?.destroy(),t.destroy(),delete this.collisionFBOs[e]}}const VM={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class GM extends qw{static{this.defaultProps=VM}static{this.extensionName="CollisionFilterExtension"}getShaders(){return{modules:[zM]}}draw({uniforms:e,context:t,moduleParameters:n}){const{collisionEnabled:i}=this.props,{collisionFBO:r,drawToCollisionMap:o}=n,s=i&&Boolean(r);e.collision_enabled=s,o&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,t){null!==this.getAttributeManager()&&(this.context.deck?._addDefaultEffect(new UM),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}const $M=({time:e})=>{const n=(0,ml.useStyles2)(WM),i=(0,t.dateTime)(e).format("YYYY-MM-DD HH:mm:ss");return o().createElement("div",{className:n.stateTime},"annots time: ",i)},WM=e=>({stateTime:BE.css`
        margin-bottom: 0px;
        margin-right: ${e.spacing(1)};
        z-index: 1;               
      font-size: x-small;
      //bottom: 5px;
      //right: 1%;
      //transform: translateX(100%);
    `});var HM=Object.defineProperty;function qM(e,t={}){const n=Y(e);return _([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}((e,t)=>{HM(e,"name",{value:"center",configurable:!0})})(qM);var XM=qM;function ZM(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function YM(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function KM(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){YM(e,t,n[t])}))}return e}function JM(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}class QM extends t.BusEventWithPayload{}YM(QM,"type","mapType");class eR extends t.BusEventWithPayload{}YM(eR,"type","mapView");class tR extends t.BusEventWithPayload{}YM(tR,"type","panel-edit-started");class nR extends t.BusEventWithPayload{}YM(nR,"type","panel-edit-finished");class iR extends t.BusEventWithPayload{}let rR,oR;YM(iR,"type","thresholdType");const sR=Rl((({options:t,data:n,width:i,height:s,eventBus:a})=>{var l,c,u;const{pointStore:h,lineStore:d,viewStore:p,replaceVariables:f}=xR();oR=t.globalThresholdsConfig;const m=t.svgIconsConfig,g=null===(l=t.common)||void 0===l?void 0:l.locLabelName,_=null===(c=t.common)||void 0===c?void 0:c.isShowLegend,y=(0,ml.useStyles2)(aR),v=(0,ml.useTheme2)(),{getPoints:b,getisOffset:x,getMode:w,setSelCoord:E,getComments:S,setAllComments:T,getSelectedIp:A,getSelFeature:C,getSelIds:P,switchMap:I,getisShowSVG:M,getSelectedFeIndexes:R,setSelectedIp:O,setTooltipObject:k,getTooltipObject:L,getisShowPoints:D,setSvgIcons:F,getSvgIcons:N,getAllFeatures:B,setAllFeatures:z}=h,{getViewState:U,setViewState:V,getClusterMaxZoom:G}=p,{getisShowLines:$,getEditableLines:W,getLineSwitchMap:H,getDirection:q,setDirection:X,setVertices:Z}=d,Y=(0,r.useRef)(null),ee=(0,r.useRef)(null),ie=(0,r.useRef)(null),[re,oe]=(0,r.useState)(L),[se,de]=(0,r.useState)(!1),[ge,_e]=(0,r.useState)(),[ye,be]=(0,r.useState)(!0),[xe,we]=(0,r.useState)(!!A),[Ee,Se]=(0,r.useState)(U),[Te,Ae]=(0,r.useState)(),[Ce,Pe]=(0,r.useState)([]),[Ie,Me]=(0,r.useState)({r:5}),[Re,Oe]=(0,r.useState)(),ke=f("$__timezone"),[Le,De]=(0,r.useState)(1e3*n.timeRange.to.unix()),[Fe,Ne]=(0,r.useState)(0),Be=!!(null===(u=n.annotations)||void 0===u?void 0:u.length),ze=(0,r.useMemo)((()=>{const e=[];return null==oR||oR.forEach(((t,n)=>e.push({color:t.color,label:t.label,yAxis:1,disabled:!1}))),e}),[]),[je,Ue]=(0,r.useState)(ze);(0,r.useEffect)((()=>{if(n.timeRange){var e;De(1e3*n.timeRange.to.unix());const t="annotations & alerts query (built-in)";if(Be&&(null==je||null===(e=je.at(-1))||void 0===e?void 0:e.label)!==t){const e={color:J.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};Ue((t=>[...t,e]))}}}),[n]),(0,r.useEffect)((()=>{const e=a.subscribe(eR,(e=>{Se(void 0),Ve(n)})),i=a.subscribe(QM,(e=>{t.basemap.type!==e.payload.mapType&&(Se(void 0),Ve(n))})),r=a.subscribe(iR,(e=>{var t;if(null===(t=e.payload)||void 0===t?void 0:t.thresholds){var n,i;const t=[];null===(n=e.payload.thresholds)||void 0===n||n.forEach(((e,n)=>t.push({color:e.color,label:e.label,yAxis:1,disabled:!1})));const r="annotations & alerts query (built-in)";if(Be&&(null==je||null===(i=je.at(-1))||void 0===i?void 0:i.label)!==r){const e={color:J.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};t.push(e)}Ue(t)}})),o=a.subscribe(iR,(e=>{var t;if(null===(t=e.payload)||void 0===t?void 0:t.thresholds){var n,i;const t=[];null===(n=e.payload.thresholds)||void 0===n||n.forEach(((e,n)=>t.push({color:e.color,label:e.label,yAxis:1,disabled:!1})));const r="annotations & alerts query (built-in)";if(Be&&(null==je||null===(i=je.at(-1))||void 0===i?void 0:i.label)!==r){const e={color:J.Alerting,label:"annotations & alerts query (built-in)",yAxis:1,disabled:!1};t.push(e)}Ue(t)}}));return()=>{e.unsubscribe(),i.unsubscribe(),r.unsubscribe(),o.unsubscribe()}}),[a]);const Ve=function(){var n=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){ZM(o,i,r,s,a,"next",e)}function a(e){ZM(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(n){{var r;const a=["target","source"].includes(f("$locRole"))?f("$locRole"):q,l={};for(const e in ne)Object.prototype.hasOwnProperty.call(ne,e)&&(l[ne[e]]=0);const c=[];let u;if((null==m?void 0:m.length)&&(u=yield function(e){return ve.apply(this,arguments)}(m)),u&&Object.keys(u).length&&F(u),(null==t||null===(r=t.dataLayers)||void 0===r?void 0:r.length)>0){const e={};for(let i=0;i<t.dataLayers.length;i++){const r=t.dataLayers[i],s=TM.getIfExists(r.type);var o;const u=JM(KM({},r),{config:JM(KM({},r.config),{globalThresholdsConfig:oR,startId:null!==(o=l[r.type])&&void 0!==o?o:0,vertices:e,direction:a,locLabelName:g,svgIconRules:m,thresholds:oR})}),h=(null==s?void 0:s.pointsUp)?yield s.pointsUp(n,u,v):null,d=Array.isArray(h)?h:[],p={colType:r.type,features:d,vertices:Object.keys(e).length?e:null};l[p.colType]=l[p.colType]+p.features.length,c.push(p)}}if(!Ee){const n=ER(t.view);let r,o,a;if(n.id===e.Auto){if((null==c?void 0:c.length)>0){const e=new Ba({width:i,height:s}),t=c.reduce(((e,t)=>e.concat(t.features)),[]).map((e=>({type:"Feature",geometry:{type:"Point",coordinates:fe(e.geometry)}}))).filter((e=>e));if(t.length>1){({longitude:r,latitude:o,zoom:a}=n);const[i,s,l,c]=K({type:"FeatureCollection",features:t}),u=[[i,s],[l,c]];i&&s&&l&&c&&({longitude:r,latitude:o,zoom:a}=e.fitBounds(u))}r||({longitude:r,latitude:o,zoom:a}=n)}}else({longitude:r,latitude:o,zoom:a}=n);void 0!==r&&void 0!==o?V(KM({},{longitude:r,latitude:o,zoom:a,maxPitch:42.75})):(Pe([]),Se(void 0)),wR(t.basemap,_e,!1,v)}let h=[],d={},p=[],_=[],y=[];c.forEach((e=>{switch(e.colType){case ne.Points:(null==e?void 0:e.features.length)&&(d=function(e,t){const n={};for(const t in e)e.hasOwnProperty(t)&&(n[t]=ae({},e[t]));for(const e in t)t.hasOwnProperty(e)&&(n[e]?(n[e].ptId=n[e].ptId||t[e].ptId,n[e].tarCoords=n[e].tarCoords||t[e].tarCoords,n[e].sources=ae({},n[e].sources,Object.entries(t[e].sources||{}).reduce(((t,[i,r])=>{var o,s;const a=(null===(s=n[e])||void 0===s||null===(o=s.sources)||void 0===o?void 0:o[i])||{};return t[i]=le(ae({},a,r),{lineExtraProps:ae({},a.lineExtraProps||{},r.lineExtraProps?Object.entries(r.lineExtraProps).reduce(((e,[t,n])=>(null!=n&&""!==n&&(e[t]=n),e)),{}):{})}),t}),{}))):n[e]=ae({},t[e]));return n}(d,null==e?void 0:e.vertices),h=h.concat(null==e?void 0:e.features),h=h.map((e=>{var t,n;const{locName:i}=e.properties,r=(null===(t=d[i])||void 0===t?void 0:t.sources)?KM({},null===(n=d[i])||void 0===n?void 0:n.sources):void 0;return JM(KM({},e),{properties:JM(KM({},e.properties),{sources:r&&Object.keys(r).length>0?r:void 0})})})));break;case ne.Polygons:(null==e?void 0:e.features.length)&&(p=p.concat(null==e?void 0:e.features));break;case ne.Path:(null==e?void 0:e.features.length)&&(_=_.concat(null==e?void 0:e.features));break;case ne.GeoJson:(null==e?void 0:e.features.length)&&(y=y.concat(null==e?void 0:e.features))}})),Z(d);const b=[],x=function(e){const t=[];for(const n in e){const i=e[n].sources;if(i)for(const e in i){const n=i[e].parPath;Array.isArray(n)&&n.forEach(((e,i)=>{if(Array.isArray(e)&&e.length>2){const r=e[3],o=e[4],[s,a,l]=[n[0],n.at(-1),i];void 0!==r&&t.push({text:r,iconColor:o,orderId:i,coords:e.slice(0,2),tar:s,src:a})}}))}}return t}(d);let w=0;null==x||x.forEach((e=>{const{text:t,iconColor:n,orderId:i,coords:r,tar:o,src:s}=e;if(o&&t&&i&&r){const e=n&&v.visualization.getColorByName(n);var a;b.push({type:"Feature",id:w,geometry:{type:"Point",coordinates:r},properties:{note:t,tIdx:i+1,tar:o,iconColor:(null==n?void 0:n.indexOf("rgb"))>-1?n:null!==(a=n&&he(e))&&void 0!==a?a:"rgb(78, 194, 252)",isShowTooltip:!0,displayProps:["note","tar","tIdx"]}}),w++}})),b&&T(b);const E=[h,p,_,y],S={};E.forEach(((e,t)=>{null!=e&&(S[["markers","polygons","path","geojson"][t]]=e)})),E.forEach((e=>{null!=e&&Object.assign(S,e)})),h&&Ne(h.length),z(S)}}));return function(e){return n.apply(this,arguments)}}();(0,r.useEffect)((()=>{var e,t,n;if((null==Re||null===(n=Re.object)||void 0===n||null===(t=n.properties)||void 0===t||null===(e=t.objects)||void 0===e?void 0:e.length)>2||re.prevHullData){var i,r,o;const e=null!==(o=null==Re||null===(r=Re.object)||void 0===r||null===(i=r.properties)||void 0===i?void 0:i.objects)&&void 0!==o?o:re.prevHullData,t=fl({type:"FeatureCollection",features:e});if(!t)return;const n=LM(JM(KM({},We),{colType:ne.Hull,data:[t]}));(0,gl.flushSync)((()=>{Pe((e=>{var t;let i=[...e];return"convex-hull"===(null==e||null===(t=e[0])||void 0===t?void 0:t.id)?i[0]=n:i=[n,...e],i}))}))}}),[Re]);const Ge=(0,r.useCallback)((()=>{var e;const t=ie;rR=(null===(e=t.current)||void 0===e?void 0:e.getMap)?t.current.getMap():null}),[]),$e={setSelCoord:E,setClosedHint:de,switchMap:I,getMode:w,setShowCenter:we,setCPlotCoords:Ae,setIsRenderNums:be,setTooltipObject:k,setSelectedIp:O,setLocalViewState:Se,setHoverCluster:Oe,setHoverInfo:oe},We={pickable:!0,autoHighlight:!0,highlightColor:ue(v.isDark?"rgb(255, 215, 0, 0.2)":"rgb(32, 82, 153, 0.2)"),onHover:oe,setShowCenter:we,getEditableLines:W,getSelectedFeIndexes:R,getPoints:b,getSelFeature:C,switchMap:I,getMode:w,getSelectedIp:A,setClosedHint:de,setSelectedIp:O,theme2:v,time:Le,options:t,setTooltipObject:k,getTooltipObject:L,setHoverInfo:oe,closedHint:se,hoverCluster:Re,hoverInfo:re,setHoverCluster:Oe,legendItems:je},He={getDirection:q,getisOffset:x,getComments:S,setTooltipObject:k,setCPlotCoords:Ae},qe={getSvgIcons:N,getisShowSVG:M,getisShowPoints:D},Xe=()=>{var e,t,n;let i,r,o,s,a,l,c,u;const h=[];let d=[];const p=[],f=[],m=[];if((null==Re||null===(n=Re.object)||void 0===n||null===(t=n.properties)||void 0===t||null===(e=t.objects)||void 0===e?void 0:e.length)>2||re.prevHullData){var g,_,y;const e=null!==(y=null==Re||null===(_=Re.object)||void 0===_||null===(g=_.properties)||void 0===g?void 0:g.objects)&&void 0!==y?y:re.prevHullData,t=fl({type:"FeatureCollection",features:e});if(t){const e=LM(JM(KM({},We),{colType:ne.Hull,isStatic:!0,data:[t]}));h.push(e)}}let b,w,E,T;if(B&&({markers:b,polygons:w,path:E,geojson:T}=B),(null==w?void 0:w.length)>0&&h.push(LM(JM(KM({},We),{data:w}))),(null==E?void 0:E.length)>0&&h.push(Jw(JM(KM({},We),{data:E,type:"path"}))),(null==T?void 0:T.length)>0){const e={type:"FeatureCollection",features:T};h.push((e=>{const{data:t,getSelectedIp:n,onHover:i,highlightColor:r}=e;return new Hw({id:ne.GeoJson,data:t,pickable:!0,onHover:i,autoHighlight:!0,highlightColor:r,stroked:!1,filled:!0,extruded:!0,pointType:"circle",lineWidthMinPixels:2,getFillColor:e=>{var t,n;const{threshold:i}=e.properties,{color:r}=i,o=null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.opacity,s=ue(r);return o&&(s[3]=Math.round(255*o)),s},getLineColor:e=>{const{threshold:t}=e.properties,{color:n}=t;return ue(n)},getPointRadius:100,getLineWidth:e=>{var t,n;return null==e||null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth},getElevation:30})})(JM(KM({},We),{data:e})))}if((null==b?void 0:b.length)>0||(null==h?void 0:h.length)>0){const e=H;if((null==C?void 0:C.properties.colType)===ne.Points){const t=P.map((e=>W[e])).filter((e=>e)),n=t.length>0&&pe({features:t,switchMap:I,lineSwitchMap:e,getisOffset:x,time:Le})[1];o=n&&(null==n?void 0:n.length)>0?Jw(JM(KM({},We),{data:n,type:"par-path-line"})):null;const i=n&&function({features:e,switchMap:t,lineSwitchMap:n,getisOffset:i,time:r}){let o,s=[];const a=[];return e.forEach(((e,l)=>{var c;if(e&&(null===(c=e.properties)||void 0===c?void 0:c.locName)){const{locName:l,parPath:c}=e.properties,u=null==c?void 0:c.at(-1);a.push(l);let h=n.get(u);if(!h)return;let d=h;for(;d;){const{locName:e}=d.properties;if(a.includes(e))break;a.push(e),o=pe({features:[d],switchMap:t,lineSwitchMap:n,getisOffset:i,time:r})[1]||void 0,(null==o?void 0:o.length)>0&&s.push(o);const{parPath:l}=null==d?void 0:d.properties;d=l&&(null==n?void 0:n.get(l.at(-1)))}}})),s.reduce(((e,t)=>e.concat(t)),[])}({features:t,switchMap:I,lineSwitchMap:e,getisOffset:x,time:Le});s=i&&(null==i?void 0:i.length)>0?Jw(JM(KM({},We),{data:i,type:"par-path-extension"})):null;const r=ye&&x&&function(e){if(!Array.isArray(e)||0===e.length)return[];const t=[];return e.forEach((e=>{if(!(null==e?void 0:e.properties))return;const n=null==e?void 0:e.properties.parPathCoords,i=Array.isArray(n)&&n.length>1?n:[],r=(null==i?void 0:i.length)>0?i.map(((e,t)=>({text:t+1+"",coordinates:e,color:"rgb(237, 71, 59)"}))):[];r&&t.push(r)})),t.reduce(((e,t)=>e.concat(t)),[])}(t);l=(null==r?void 0:r.length)>0?AM({data:r,type:"nums",dir:"to"}):null}const t=W.map((e=>function(e,t,n,i){var r,o,s,a;if(!e)return[];const{properties:l}=e,c=e.geometry,u=null==t?void 0:t.get(null===(r=l.parPath)||void 0===r?void 0:r.at(-1)),h=null==u?void 0:u.geometry;var d;const p=c&&c.coordinates&&c.coordinates.length>0&&null!==(d=c.coordinates[0][0])&&void 0!==d?d:null;var f;const m=h&&h.coordinates&&h.coordinates.length>0&&null!==(f=h.coordinates)&&void 0!==f?f:null;if(!p||!m)return[];const g=((e,t)=>{if(!e||!t)return 0;let n;const i=t[0]-t[0],r=t[1]-t[1],o=-e[0],s=i*-e[1]-r*o;return n=90-j(e,t),Math.abs(n)>90&&s>0&&(n+=180),n})(p,m);let _=null==l||null===(o=l.threshold)||void 0===o?void 0:o.color;const{bandNumber:y,bandWidth:v,throughput:b}=l;if((v||y)&&b){let e;v?e=b/v*100:y&&(e=b/y*100),_=me(e)}const{locName:x,edgeField:w}=e.properties;let E=e.properties[w];if("number"==typeof E){const{value:e,unit:t}=function(e){if("number"==typeof e){const t=e/1e3,n=t/1e3;let i;return i=n>=1?{value:n.toFixed(2),unit:" Mbps"}:t>=1?{value:t.toFixed(1),unit:" Kbps"}:{value:e,unit:" bps"},i}return console.error("Invalid input. Please provide a number."),null}(E);E=e+t}const S=null==l||null===(a=l.style)||void 0===a||null===(s=a.textConfig)||void 0===s?void 0:s.fontSize;return e&&E?{to:[{text:E+"\n",coordinates:[p,m],color:_,angle:g,fontSize:S}]}:{to:[]}}(e,I)));a=!x&&(null==t?void 0:t.length)>0?AM({data:t.reduce(((e,t)=>t.to?e.concat(t.to):e),[]),dir:"to",type:"list1"}):null;const n=W;if($&&(null==n?void 0:n.length)>0){const e={type:"FeatureCollection",features:n};i=(e=>{const{linesCollection:t,getSelectedFeIndexes:n,getEditableLines:i,getisOffset:r,onHover:o,pickable:s,autoHighlight:a,highlightColor:l,time:c,legendItems:u}=e;var h;const d=null!==(h=null==n?void 0:n.get(ne.Lines))&&void 0!==h?h:[],p=d.length>0,f=[...i];return(p?i[d[0]]:null)&&f.splice(d[0],1),new Hw({highlightColor:l,onHover:o,id:ne.Lines,data:t,selectedFeatureIndexes:d,getLineWidth:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.threshold)||void 0===t?void 0:t.lineWidth},getLineColor:e=>{var t,n;if(!r&&(null===(t=e.properties)||void 0===t?void 0:t.throughput)){let t;const{bandNumber:n,bandWidth:i,throughput:r}=e.properties;if(i||n){let e;i?e=r/i*100:n&&(e=r/n*100),t=me(e)}else t=me(101);return ue(t)}const{threshold:i,all_annots:o}=e.properties,{color:s}=i;if(o&&!(null==u||null===(n=u.at(-1))||void 0===n?void 0:n.disabled)){var a;const e=ce(o,c),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?J.Normal:"Alerting"===t?J.Alerting:J.Pending;return ue(n).slice(0,3)}return ue(s)},lineWidthScale:1,lineWidthMinPixels:.1,pickable:s,autoHighlight:a})})(JM(KM({},We,He),{linesCollection:e})),f.push(i)}let g,_=b,y=b;if(null==y?void 0:y.length){const e={type:"FeatureCollection",features:y};r=(e=>{const{featureCollection:t,getSelectedFeIndexes:n,getisShowSVG:i,getSvgIcons:r,getisShowPoints:o,getSelectedIp:s,pickable:a,time:l,onHover:c,highlightColor:u,options:h,theme2:d,legendItems:p}=e;var f;return new Hw({highlightColor:u,onHover:c,id:ne.Points,data:t,selectedFeatureIndexes:null!==(f=null==n?void 0:n.get(ne.Points))&&void 0!==f?f:[],parameters:{depthTest:!1},pointType:"circle+icon+text",updateTriggers:{getIcon:r},getText:e=>{var t,n;return null===(n=e.properties)||void 0===n||null===(t=n.style)||void 0===t?void 0:t.text},getTextPixelOffset:e=>[0,15],getTextColor:e=>{var t;const{threshold:n,cluster:i,all_annots:r}=e.properties;if(i)return[0,0,0];const{color:o}=n;if(r&&!(null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var s;const e=ce(r,l),t=null==e||null===(s=e[0])||void 0===s?void 0:s.newState,n=(null==t?void 0:t.startsWith("Normal"))?J.Normal:"Alerting"===t?J.Alerting:J.Pending;return ue(n)}return ue(o)},getTextSize:e=>{var t,n,i;const r=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n||null===(t=n.textConfig)||void 0===t?void 0:t.fontSize;return null!=r?r:12},getFillColor:e=>{var t,n,i;const{threshold:r,all_annots:o}=e.properties,{color:s}=r;if(o&&!(null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var a;const e=ce(o,l),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?J.Normal:"Alerting"===t?J.Alerting:J.Pending;return ue(n)}const c=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.opacity,u=ue(s);return c&&(u[3]=Math.round(255*c)),u},stroke:!0,getLineWidth:.5,getLineColor:e=>{var t,n,i;const{threshold:r,all_annots:o}=e.properties,{color:s}=r;if(o&&!(null==p||null===(t=p.at(-1))||void 0===t?void 0:t.disabled)){var a;const e=ce(o,l),t=null==e||null===(a=e[0])||void 0===a?void 0:a.newState,n=(null==t?void 0:t.startsWith("Normal"))?J.Normal:"Alerting"===t?J.Alerting:J.Pending;return ue(n).slice(0,3)}const c=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.opacity,u=ue(s);return c&&(u[3]=Math.round(255*c)),u},getPointRadius:e=>{var t,n,i;const r=s===(null===(t=e.properties)||void 0===t?void 0:t.locName),o=null===(i=e.properties)||void 0===i||null===(n=i.style)||void 0===n?void 0:n.size;return r?o/2*1.3:o/2},getIcon:e=>{const{threshold:t}=e.properties,{iconName:n}=t,i=r[n];if(i){const{svgText:e,width:t,height:r}=i;return{url:vE(e),width:t,height:r,id:n}}return{url:vE('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">  \n</svg>'),width:1,height:1,id:"blank"}},getIconPixelOffset:e=>{const{threshold:t,cluster:n}=e.properties;if(n)return[0,0];const{iconVOffset:i}=t;return[0,null!=i?i:0]},getIconSize:e=>{var t;const n=s===(null===(t=e.properties)||void 0===t?void 0:t.locName),{cluster:i,threshold:r}=e.properties;if(i)return 40;{const{iconSize:e}=r;return e?n?1.5*e:e:30}},iconSizeUnits:"pixels",getIconColor:e=>{const{threshold:t,cluster:n}=e.properties;if(n)return[0,0,0];const{color:i}=t;return ue(i)},_subLayerProps:{"points-text":{extensions:[new GM],collisionGroup:"text",collisionTestProps:{sizeScale:2.5}},"points-icon":{visible:i,extensions:[new GM],collisionGroup:"icons",collisionTestProps:{sizeScale:1.5}},"points-circle":{visible:o}},filled:!0,pickable:a,pickingDepth:0,autoHighlight:!0})})(JM(KM({},We,qe),{featureCollection:e})),p.push(r)}if((null==_?void 0:_.length)&&m.push(_),m.length&&(u=new DE(JM(KM({},We,qe),{getPosition:e=>e.coordinates,data:m.reduce(((e,t)=>e.concat(t)),[]),id:"icon-cluster",sizeScale:40,maxZoom:G,thresholds:[]}))),d=[...h,...f,...p],a&&d.push(a),o&&(d.unshift(o),d.push(s),d.push(l)),S&&(null==S?void 0:S.length)>0&&(c=(e=>{const{data:t,getSelectedFeIndexes:n,getisShowPoints:i,onHover:r,highlightColor:o,iconMapping:s=DM}=e;var a;return new cx({visible:i,highlightColor:o,onHover:r,id:ne.Icons,iconAtlas:"public/plugins/vaduga-mapgl-panel/img/37a766e00c9900c1c40d.png",iconMapping:s,data:t,selectedFeatureIndexes:null!==(a=null==n?void 0:n.get(ne.Icons))&&void 0!==a?a:[],getPosition:e=>e.geometry.coordinates,getIcon:()=>"marker",getColor:e=>{const{iconColor:t}=e.properties;return ue(t)},getSize:e=>5,sizeUnits:"meters",sizeScale:.4,sizeMinPixels:5,sizeMaxPixels:45,pickable:!0,autoHighlight:!0})})(JM(KM({},We,qe),{data:S,getSelectedFeIndexes:R,setClosedHint:de,setSelectedIp:O})),d.push(c)),xe&&Te&&C){const{longitude:e,latitude:t}=Te;g=new dx({id:"centerplot-layer",data:[{coordinates:[e,t]}],pickable:!1,opacity:.2,stroked:!1,filled:!0,radiusScale:5,radiusMinPixels:1,radiusMaxPixels:18,lineWidthMinPixels:1,getPosition:e=>e.coordinates,getRadius:e=>Math.sqrt(e.exits),getFillColor:e=>ue(v.isDark?"rgb(255, 221, 87, 0.9)":"rgb(32, 82, 153, 0.8)")}),d.push(g)}d.push(u)}Pe(d.filter((e=>null!=e)))};(0,r.useEffect)((()=>{U&&(Se(U),Ae(U))}),[U]),(0,r.useEffect)((()=>{var e,i,r;((null===(e=t.dataLayers)||void 0===e?void 0:e.some((e=>null==e?void 0:e.query)))||(null===(i=n.request)||void 0===i?void 0:i.targets))&&(null==n||null===(r=n.series)||void 0===r?void 0:r.length)&&(B&&Object.keys(B).length?Xe():Me((e=>KM({},e))))}),[je,N,L,G,P,U,Te,w,B,A,x,M,$,D]),(0,r.useEffect)((()=>{n&&n.series.length&&Ve(n)}),[Ie,q,n,i,s,t]);const Ze=(0,r.useMemo)((()=>o().createElement(TI,{total:Fe,setShowCenter:we})),[Fe]),Ye=(0,r.useCallback)(((e,t)=>{Ue((t=>null==t?void 0:t.map((t=>t!==e?t:JM(KM({},t),{disabled:!t.disabled})))))}),[]);return ge&&Ee?o().createElement("div",{className:y.container,ref:ee},o().createElement(_b,{widgets:[new No({id:"myfull",container:null!==(Ke=ee.current)&&void 0!==Ke?Ke:void 0,placement:"top-right",className:y.fullscreen}),new Ka({id:"compass",placement:"top-right",className:y.compass})],ref:Y,style:{pointerEvents:"all",inset:"0px",zIndex:"1"},layers:Ce,initialViewState:Ee,controller:{dragMode:"pan",doubleClickZoom:!1,scrollZoom:{smooth:!1,speed:.005},inertia:!0},onClick:(e,t)=>((e,t,n)=>{const{setSelCoord:i,setClosedHint:r,switchMap:o,getMode:s,setShowCenter:a,setCPlotCoords:l,setIsRenderNums:c,setTooltipObject:u,setSelectedIp:h,setLocalViewState:d,setHoverCluster:p,setHoverInfo:f}=n,m=e.coordinate;if(m){const[e,t]=m.map((e=>parseFloat(e.toFixed(6))));i({coordinates:[e,t],type:"Point"})}if(e.picked){var g;const{properties:t,id:n}=e.object,{locName:i,parPath:p}=t;if(i){var _,y;const{aggrType:d,colType:p}=t;r(!1);const f=null===(_=e.sourceLayer)||void 0===_?void 0:_.id,m=(null==f?void 0:f.startsWith("edit-lines"))?n:null,g=null==i?void 0:i.split(Q)[0],v=null==o||null===(y=o.get(g))||void 0===y?void 0:y.geometry,b=null==rR?void 0:rR.getZoom();if(v&&"modify"!==s){const[e,t]=null==v?void 0:v.coordinates;a(!0),l({longitude:e,latitude:t,zoom:b||18,maxPitch:42.75,bearing:0,pitch:0})}c(!te.includes(d)),u(e),h(i,m?[m]:null)}else if((null==t||null===(g=t.objects)||void 0===g?void 0:g.length)&&!(null==t?void 0:t.isHull)){const e={type:"FeatureCollection",features:t.objects},n=XM(e),[i,r]=n.geometry.coordinates;d({longitude:i,latitude:r,zoom:t.expZoom,transitionDuration:250,maxPitch:42.75,rnd:Math.random()})}}else p(null),f({}),a(!0),h(""),r(!0),u({})})(e,0,$e)},o().createElement(Hb,{onLoad:Ge,ref:ie,mapStyle:ge,attributionControl:!1},o().createElement(Wb,{style:{zIndex:"2",position:"absolute",top:0,right:v.spacing(1)}}))),o().createElement("div",{className:y.timeNcoords},o().createElement(NM,null),!!Be&&o().createElement($M,{time:Le})),o().createElement(MI,{time:Le,timeZone:ke,position:0,info:re,isClosed:se,setTooltipObject:k,setClosedHint:de}),_&&o().createElement("div",{className:y.legend},o().createElement(ml.VizLegend,{displayMode:ml.LegendDisplayMode.List,placement:"bottom",items:je,onLabelClick:Ye})),Ze):null;var Ke})),aR=e=>({page:BE.css`
          padding: ${e.spacing(3)};
          background-color: ${e.colors.background.secondary};
          display: flex;
          justify-content: center;
        `,container:BE.css`
            .maplibregl-ctrl-attrib-button {
                display: none;
            }
        `,yamap:BE.css`
          width: 100%;
          height: 100%;
          z-index: -1;
          position: absolute;
          isolation: isolate;
          inset: 0;
          overflow: hidden;
          pointer-events: none;
        `,geocoder:BE.css`
          display: flex;
          flex-direction: row-reverse;
          //width: 10%;
          position:absolute;
          right: ${e.spacing(1.7)};
          top: ${e.spacing(2)};
        `,textBox:BE.css`
          position: absolute;
          bottom: 0;
          left: 0;
          padding: 10px;
        `,fullscreen:BE.css`
          z-index: 2;
          position: absolute;
          top: ${e.spacing(5)};
          right: 0px;
          
          overflow: hidden;
          pointer-events: all;
        `,compass:BE.css`
          z-index: 2;
          position: absolute;
          top: ${e.spacing(10)};
          right: 0px;   
          overflow: hidden;
          pointer-events: all;
        `,legend:BE.css`
          z-index: 2;
            position: absolute;            
            bottom: 0;// ${e.spacing(3)};
            //left: ${e.spacing(10)};
            //width: 20%;
            padding-bottom: 5px;
            pointer-events: all;
            background: ${e.isDark?e.colors.background.secondary:"#EAEAEA"};
        `,timeNcoords:BE.css`            
            position: absolute;
            z-index: 1;
            font-size: small;
            bottom: 5px;
            right: 1%;                        
        `});function lR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){lR(e,t,n[t])}))}return e}function uR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function hR(e,t){if("string"==typeof e){var n;const i=null===(n=t.get(e))||void 0===n?void 0:n.properties.aggrType;return te.includes(i)}return!1}const dR=class{get getVertices(){return this.vertices}get getDirection(){return this.direction}get getEditableLines(){const{getPoints:e,switchMap:t,getisOffset:n,editCoords:i}=this.root.pointStore,{theme2:r}=this.root,o=[];let s=0;return this.vertices&&Object.keys(this.vertices).forEach(((a,l)=>{var c;const{ptId:u}=this.vertices[a],h=null==e?void 0:e[u];if(!(null==h?void 0:h.properties))return;const{sources:d}=null==h?void 0:h.properties;d&&(null===(c=Object.values(d))||void 0===c||c.forEach(((e,a)=>{var l,c;const{locName:p}=h.properties,f=null==e?void 0:e.lineExtraProps;let m;const g=null==f?void 0:f.metric;if(g){var _,y;const e=null===(y=h.properties)||void 0===y||null===(_=y.style)||void 0===_?void 0:_.fixedColor,t=e&&r.visualization.getColorByName(e),n=t?he(t):void 0;m=(0,oS.isNumber)(g)&&Xr(cR({},h.properties,f),g,oR,n)}const v=null===(l=e.parPath)||void 0===l?void 0:l.at(-1),b=null==e?void 0:e.parPath,x=v?null==t?void 0:t.get(v):null,w=h.geometry;let E;x&&(E=x.geometry);const S=h.properties.aggrType,T=Array.isArray(b)&&b.length>0?function(e,t){if(0===e.length)return[[]];const n=[];let i=[],r=hR(e[0],t);for(let o=0;o<e.length;o++){const s=e[o],a=hR(s,t);a&&r!==a&&i.length>0&&(i.push({item:s,gIdx:o}),n.push(i),i=[],r=!a),i.push({item:s,gIdx:o})}return i.length>0&&n.push(i),n}(b,t):[],A=S&&te.includes(S)?T:T.filter(((e,n)=>{const i=0!==n&&2===e.length&&hR(e[0].item,t)&&hR(e[e.length-1].item,t);return e.some((e=>"string"==typeof e.item)),!i})),C=n||S&&te.includes(S)?A.filter((e=>e.length>1)).map((e=>$r(e,t))):E?[[w.coordinates,E.coordinates]]:null;if(!C)return;const P=Array.isArray(b)&&(null==b?void 0:b.map(((e,t)=>({item:e,gIdx:t})))),I=P&&(null==P?void 0:P.length)?$r(P,t):[],M=(this.direction,p);o.push({id:s,type:"Feature",geometry:{type:"MultiLineString",coordinates:C},properties:uR(cR({},h.properties,f,m&&{threshold:m}),{locName:d&&1===Object.keys(d).length?M:M+Q+a,ptId:u,parPath:Array.isArray(b)?[...b]:null,parPathCoords:I,segrPathVisible:A.length>0?A:Array.isArray(b)?[[{item:p,gIdx:0},{item:b.at(-1),gIdx:1}]]:null})}),(null===(c=e.parPath)||void 0===c?void 0:c.length)&&i(h,s,ie.SetLineId,v),s++})))})),n?(o.forEach(((n,i)=>{var r,s,a;if(!n)return;const{locName:l,ptId:c,aggrType:u,parPath:h,isOffset:d}=n.properties,p=h?h[1]:null,f=h?h[length-2]:null,m=p?null==t||null===(r=t.get(p))||void 0===r?void 0:r.properties.aggrType:"",g=f?null==t||null===(s=t.get(f))||void 0===s?void 0:s.properties.aggrType:"",_=!!m&&te.includes(m);if(g&&te.includes(g),u&&te.includes(u))return;if(!_)return;const y=function({locName:e,lineFeatures:t,direction:n}){return t.length?t.filter((t=>{const{parPath:i}=t.properties;return(null==i?void 0:i.at("target"===n?-1:0))===e})):[]}({locName:c?null==e||null===(a=e[c])||void 0===a?void 0:a.properties.locName:null,lineFeatures:o,direction:this.direction});if((null==y?void 0:y.length)<1)return;let v=0;y.forEach(((e,i)=>{var r;const o=e.geometry.coordinates,s=e.properties.segrPathVisible,a=o.at("target"===this.direction?-1:0),{locName:c,parPath:u,aggrType:h}=e.properties;if(te.includes(h))return;const d="target"===this.direction?u.length-2:1,p=null==t||null===(r=t.get(u[d]))||void 0===r?void 0:r.properties.aggrType;if(!te.includes(p))return;const f=(null==n?void 0:n.geometry).coordinates;if(f&&(null==f?void 0:f.length)>0){const e=a[0],t=f[0].at("target"===this.direction?0:-1);if(e&&t&&c!==l){var m;const n=[e,t],r=y.length;.7*(i-Math.floor(r/2))==0&&v++;const o=.7*(i+v-Math.floor(r/2)),l=Ur(Gr()(n),o,{units:"meters"}),[c,h]=null==l||null===(m=l.geometry)||void 0===m?void 0:m.coordinates,d=(function(e,t){[(e[0]+t[0])/2,(e[1]+t[1])/2].map((e=>parseFloat(e.toFixed(6))))}(e,h),function(e,t){return[[(2*e[0]+t[0])/3,(2*e[1]+t[1])/3],[(e[0]+2*t[0])/3,(e[1]+2*t[1])/3]]}(c,h).map((e=>e.map((e=>parseFloat(e.toFixed(6))))))),p="target"===this.direction?a.length-1:1;a.splice(p,0,d[0],d[1]);const f="target"===this.direction?u.length-1:1;u.splice(f,0,d[0],d[1]);const g=s["target"===this.direction?s.length-1:0],_=g[0].gIdx,b=[d[0],d[1]].map(((e,t)=>({item:e,gIdx:_+1}))),x="target"===this.direction?g.length-1:1;g.splice(x,0,...b)}}}))})),o):o}get getLineSwitchMap(){const e=this.getEditableLines,t=[];return null==e||e.forEach((e=>{(null==e?void 0:e.properties)&&t.push([e.properties.locName,e])})),new Map(t)}get getisShowLines(){return this.isShowLines}constructor(e){lR(this,"root",void 0),lR(this,"isShowLines",!0),lR(this,"vertices",{}),lR(this,"direction","target"),lR(this,"setVertices",(e=>{this.vertices=e})),lR(this,"setDirection",(e=>{this.direction=e})),lR(this,"toggleShowLines",(e=>{this.isShowLines=e})),this.root=e;const t=["target","source"].includes(e.replaceVariables("$locRole"));this.direction=t?e.replaceVariables("$locRole"):"target",Pi(this)}};function pR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const fR=class{get getMode(){return this.mode}get getSvgIcons(){return this.svgIcons}get getSelCoord(){return this.selCoord}get getSelIds(){return this.selIds}get getSelFeature(){var e;return null===(e=this.switchMap)||void 0===e?void 0:e.get(this.selectedIp)}get getisOffset(){return this.isOffset}get getTooltipObject(){return this.tooltipObject}get getSelectedFeIndexes(){if(!this.getSelFeature)return null;const{id:e,properties:t}=this.getSelFeature,{colType:n,locName:i}=t,r=this.selIds,o=new Map;return n&&void 0!==e&&(o.set(n,[e]),n===ne.Points&&(null==r?void 0:r.length)&&o.set(ne.Lines,r)),o}get getisShowSVG(){return this.isShowSVG}get getisShowPoints(){return this.isShowPoints}get getComments(){return this.comments}get getAllFeatures(){return this.allFeatures}get getPoints(){var e,t;return null!==(t=null===(e=this.allFeatures)||void 0===e?void 0:e.markers)&&void 0!==t?t:[]}get getSelectedIp(){return this.selectedIp}get switchMap(){const{allFeatures:e}=this,t=e.markers,n=[];if(null==t||t.forEach((e=>{e&&e.properties&&n.push([e.properties.locName,e])})),0!==n.length)return new Map(n)}constructor(e){pR(this,"root",void 0),pR(this,"type","icons"),pR(this,"allFeatures",{}),pR(this,"comments",void 0),pR(this,"isShowSVG",!0),pR(this,"mode","view"),pR(this,"isShowPoints",!0),pR(this,"isOffset",!0),pR(this,"selectedIp",""),pR(this,"selIds",[]),pR(this,"selCoord",{coordinates:[],type:"Point"}),pR(this,"svgIcons",{}),pR(this,"tooltipObject",ee),pR(this,"setSvgIcons",(e=>{this.svgIcons=e})),pR(this,"setSelCoord",(e=>{this.selCoord=e})),pR(this,"setMode",(e=>{this.mode=e})),pR(this,"setSelIds",(e=>{this.selIds=e})),pR(this,"setAllComments",(e=>{this.comments=e})),pR(this,"setTooltipObject",(e=>{var t;this.tooltipObject=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){pR(e,t,n[t])}))}return e}({},e),{cluster:!1,object:null!==(t=e.object)&&void 0!==t?t:{}})})),pR(this,"toggleShowSVG",(e=>{this.isShowSVG=e})),pR(this,"toggleShowPoints",(e=>{this.isShowPoints=e})),pR(this,"toggleOffset",(e=>{this.isOffset=e})),pR(this,"setSelectedIp",((e,t=null)=>{var n;if(null!==e){var i;const t=null==e?void 0:e.split(Q),n=null==t?void 0:t[0];this.selectedIp=null!=n?n:"";const r=null===(i=this.getSelFeature)||void 0===i?void 0:i.geometry;r&&this.setSelCoord(r)}const r=null===(n=this.getSelFeature)||void 0===n?void 0:n.properties.sources;if(r&&Object.values(r).length){const n=null!==t?t:e?Object.values(r).map((e=>null==e?void 0:e.lineId)).filter((e=>void 0!==e)):[];this.setSelIds(n)}else this.setSelIds([])})),pR(this,"setAllFeatures",(e=>{this.allFeatures=e})),pR(this,"editCoords",Jn(((e,t,n,i)=>{var r;let o=null==e||null===(r=e.properties)||void 0===r?void 0:r.sources,s=i&&o&&o[i];n===ie.SetLineId&&s&&void 0!==t&&(s.lineId=t)}))),this.root=e;const t=e.replaceVariables("$stat"),n=parseInt(t,10);1!==n&&2!==n||(this.isOffset=1===n),Pi(this)}};function mR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const gR=class{get getClusterMaxZoom(){return this.clusterMaxZoom}get getViewState(){return this.viewState}constructor(e){mR(this,"root",void 0),mR(this,"viewState",void 0),mR(this,"clusterMaxZoom",16),mR(this,"setViewState",(e=>{this.viewState=e})),mR(this,"setClusterMaxZoom",(e=>{this.clusterMaxZoom=e})),this.root=e;const t=e.replaceVariables("$cluster_max_zoom"),n=parseInt(t,10);n>1&&n<19&&(this.clusterMaxZoom=n),Pi(this)}};function _R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const yR=class{constructor(e){_R(this,"lineStore",void 0),_R(this,"pointStore",void 0),_R(this,"viewStore",void 0),_R(this,"replaceVariables",void 0),_R(this,"theme2",void 0),this.replaceVariables=e.replaceVariables,this.theme2=e.theme2,this.lineStore=new dR(this),this.pointStore=new fR(this),this.viewStore=new gR(this)}},vR=(0,r.createContext)(void 0),bR=({children:e,props:t})=>{const n=new yR(t);return o().createElement(vR.Provider,{value:n},e)},xR=()=>{const e=(0,r.useContext)(vR);if(void 0===e)throw new Error("useRootStore must be used within RootStoreProvider");return e},wR=(e,t,n,i)=>{var r,o,s;(null==e?void 0:e.type)&&!UE.config.geomapDisableCustomBaseLayer||(e=EM);const a=null!==(s=null!==(o=TM.getIfExists(e.type))&&void 0!==o?o:SM)&&void 0!==s?s:{},l=a&&a.create?null==a?void 0:a.create(e,i):{};var c;t(null!==(c=null==l||null===(r=l.init)||void 0===r?void 0:r.call(l))&&void 0!==c?c:{})},ER=e=>{let t={id:e.id,longitude:0,latitude:0,zoom:1};const i=n.getIfExists(e.id);if(i){let n,l;var r,o,s,a;void 0===i.lat||4!==e.zoom?(n=[null!==(r=e.lon)&&void 0!==r?r:0,null!==(o=e.lat)&&void 0!==o?o:0],l=e.zoom):(n=[null!==(s=i.lon)&&void 0!==s?s:0,null!==(a=i.lat)&&void 0!==a?a:0],l=i.zoom),n&&(t.longitude=n[0],t.latitude=n[1]),l&&(t.zoom=l)}return t};function SR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function TR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){SR(e,t,n[t])}))}return e}const AR=({value:e,onChange:t,options:n})=>o().createElement(ml.Select,{width:"auto",isLoading:!1,value:e,onChange:e=>{t(null==e?void 0:e.value)},options:n}),CR=e=>{if((0,ml.useStyles2)(PR),e.context.data&&e.context.data.length>0){const t=e.context.data.flatMap((e=>e.fields)).map((e=>({label:e.name,value:e.name,type:e.type})));return o().createElement(o().Fragment,null,o().createElement(AR,{context:e.context,options:t,item:e.context.item,value:e.overrideField.name,onChange:n=>{"string"==typeof n&&e.nameTypeSetter(e.index,n,t.find((e=>e.value===n)).type)}}),o().createElement(ml.AutoSizeInput,{minWidth:10,disabled:!e.overrideField.name,onCommitChange:t=>{e.valueSetter(e.index,t.currentTarget.value)},defaultValue:e.overrideField.value,placeholder:"val1,val2..."}),o().createElement(ml.IconButton,{disabled:e.disabled,key:"deleteThresholdField",variant:"destructive",name:"x",tooltip:"remove threshold Field",onClick:()=>e.remover(e.index)}))}return o().createElement(ml.Select,{onChange:()=>{},disabled:!0})},PR=e=>({inputPrefix:BE.css`
      display: flex;
      align-items: center;
    `,colorPicker:BE.css`
      padding: 0 ${e.spacing(1)};
    `}),IR=be(.1,50,1,!0),MR=e=>{const n=(0,ml.useStyles2)(RR),[i,s]=(0,r.useState)((()=>{if(!e.threshold.overrides)return[];const t=[];return Object.values(e.threshold.overrides).forEach(((e,n)=>{t[n]={overrideField:e,order:n,ID:iA()}})),t})),a=t=>{s(t);const n=[];t.forEach((e=>{n.push(e.overrideField)})),e.overrideSetter(e.index,n)},l=(e,t,n)=>{i[e].overrideField.name=t,i[e].overrideField.type=n,a([...i])},c=(e,t)=>{i[e].overrideField.value=t,a([...i])},u=e=>{const t=[...i];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;a([...t])},[h,d]=(0,r.useState)((p=e.threshold.lineWidth,IR.keys(),p));var p;return o().createElement(ml.Input,{title:"metric threshold value",disabled:e.disabled,type:"number",step:"1.0",key:e.ID,onChange:t=>e.valueSetter(e.index,Number(t.currentTarget.value)),value:e.threshold.value,prefix:o().createElement("div",{className:n.inputPrefix},o().createElement(ml.Tooltip,{content:"stat1 color"},o().createElement("div",{className:n.colorPicker},o().createElement(ml.ColorPicker,{color:e.threshold.color,onChange:t=>{e.colorSetter(e.index,t)},enableNamedColors:!0}))),o().createElement("div",null,o().createElement(ml.Select,{title:"line width",disabled:e.disabled,menuShouldPortal:!0,value:h,onChange:t=>{const n="string"==typeof t.value?parseFloat(t.value):t.value;n&&(d(t),e.lineWidthSetter(e.index,n))},options:"number"==typeof h?IR.concat([{value:h,label:h.toString()}]):IR,allowCustomValue:!0,width:"auto"}))),suffix:o().createElement(o().Fragment,null,o().createElement(ml.AutoSizeInput,{title:"color label",disabled:!1,onCommitChange:t=>{e.labelSetter(e.index,t.currentTarget.value)},defaultValue:e.threshold.label,placeholder:"label"}),i&&i.map(((t,n)=>o().createElement(CR,{disabled:e.disabled||!1,key:`threshold-field-index-${t.ID}`,ID:t.ID,overrideField:t.overrideField,nameTypeSetter:l,valueSetter:c,remover:u,index:n,context:e.context}))),o().createElement(ml.IconButton,{disabled:e.disabled,key:"addThresholdField",variant:"primary",name:"plus",tooltip:"add override",onClick:()=>{const e=i.length,n={overrideField:{name:"",value:"",type:t.FieldType.string},order:e,ID:iA()};a([...i,n])}}),o().createElement(ml.IconButton,{disabled:e.disabled,key:"deleteThreshold",variant:"destructive",name:"trash-alt",tooltip:"delete threshold",onClick:()=>e.remover(e.index)}))})},RR=e=>({inputPrefix:BE.css`
      display: flex;
      align-items: center;
    `,colorPicker:BE.css`
      padding: 0 ${e.spacing(1)} 0 0;
    `}),OR=e=>{const{context:t}=e,n=t.eventBus,i=(0,ml.useStyles2)(kR),[s,a]=(0,r.useState)((()=>{if(!e.thresholds)return[];const t=[];return e.thresholds.forEach(((e,n)=>{t[n]={threshold:e,order:n,ID:iA()}})),t})),l=(0,ml.useTheme2)(),c=((0,ml.useTheme)(),t=>{a(t);const i=[];t.forEach((e=>{i.push(e.threshold)})),null==n||n.publish({type:"thresholdType",payload:{thresholds:i}}),e.setter(i)}),u=(e,t,n)=>{t&&(s[e].threshold.overrides=t,c([...s]))},h=(e,t)=>{s[e].threshold.value=Number(t);const n=[...s],i=(0,oS.orderBy)(n,["threshold.value"],["asc"]);c([...i])},d=(e,t)=>{let n=t;void 0!==l.visualization&&(n=l.visualization.getColorByName(t)),s[e].threshold.color=he(n),c([...s])},p=(e,t)=>{s[e].threshold.lineWidth=t,c([...s])},f=(e,t)=>{s[e].threshold.label=t,c([...s])},m=e=>{const t=[...s];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;c([...t])};return o().createElement(o().Fragment,null,o().createElement(ml.Button,{className:i.addBtn,disabled:e.disabled,fill:"solid",variant:"primary",icon:"plus",onClick:()=>{const e={threshold:{overrides:[],color:"rgba(154, 205, 50)",lineWidth:1,label:"",value:0},order:s.length,ID:iA()};c([...s,e])}},"Add Threshold"),s&&s.map(((t,n)=>o().createElement(MR,{disabled:e.disabled||!1,key:`threshold-item-index-${t.ID}`,ID:t.ID,threshold:t.threshold,colorSetter:d,lineWidthSetter:p,valueSetter:h,labelSetter:f,overrideSetter:u,remover:m,index:n,context:e.context}))))},kR=e=>({addBtn:BE.css`
      margin-bottom: ${e.spacing(1)};;      
    `}),LR=({context:e,onChange:t})=>{const[n,i]=(0,r.useState)(e.options.globalThresholdsConfig);return o().createElement(OR,{context:e,thresholds:n,setter:e=>{i(e),t(e)}})};var DR=function(){},FR="undefined"!=typeof window;const NR={RadioButton:{container:"data-testid radio-button"},Breadcrumbs:{breadcrumb:e=>`data-testid ${e} breadcrumb`},TimePicker:{openButton:"data-testid TimePicker Open Button",overlayContent:"data-testid TimePicker Overlay Content",fromField:"data-testid Time Range from field",toField:"data-testid Time Range to field",applyTimeRange:"data-testid TimePicker submit button",copyTimeRange:"data-testid TimePicker copy button",pasteTimeRange:"data-testid TimePicker paste button",calendar:{label:"data-testid Time Range calendar",openButton:"data-testid Open time range calendar",closeButton:"data-testid Close time range Calendar"},absoluteTimeRangeTitle:"data-testid-absolute-time-range-narrow"},DataSourcePermissions:{form:()=>'form[name="addPermission"]',roleType:"Role to add new permission to",rolePicker:"Built-in role picker",permissionLevel:"Permission Level"},DateTimePicker:{input:"data-testid date-time-input"},DataSource:{TestData:{QueryTab:{scenarioSelectContainer:"Test Data Query scenario select container",scenarioSelect:"Test Data Query scenario select",max:"TestData max",min:"TestData min",noise:"TestData noise",seriesCount:"TestData series count",spread:"TestData spread",startValue:"TestData start value",drop:"TestData drop values"}},DataSourceHttpSettings:{urlInput:"data-testid Datasource HTTP settings url"},Jaeger:{traceIDInput:"Trace ID"},Prometheus:{configPage:{connectionSettings:"Data source connection URL",manageAlerts:"prometheus-alerts-manager",scrapeInterval:"data-testid scrape interval",queryTimeout:"data-testid query timeout",defaultEditor:"data-testid default editor",disableMetricLookup:"disable-metric-lookup",prometheusType:"data-testid prometheus type",prometheusVersion:"data-testid prometheus version",cacheLevel:"data-testid cache level",incrementalQuerying:"prometheus-incremental-querying",queryOverlapWindow:"data-testid query overlap window",disableRecordingRules:"disable-recording-rules",customQueryParameters:"data-testid custom query parameters",httpMethod:"data-testid http method",exemplarsAddButton:"data-testid Add exemplar config button",internalLinkSwitch:"data-testid Internal link switch"},queryEditor:{explain:"data-testid prometheus explain switch wrapper",editorToggle:"data-testid QueryEditorModeToggle",options:"data-testid prometheus options",legend:"data-testid prometheus legend wrapper",format:"data-testid prometheus format",step:"prometheus-step",type:"data-testid prometheus type",exemplars:"prometheus-exemplars",builder:{metricSelect:"data-testid metric select",hints:"data-testid prometheus hints",metricsExplorer:"data-testid metrics explorer",queryAdvisor:"data-testid query advisor"},code:{queryField:"data-testid prometheus query field",metricsBrowser:{openButton:"data-testid open metrics browser",selectMetric:"data-testid select a metric",metricList:"data-testid metric list",labelNamesFilter:"data-testid label names filter",labelValuesFilter:"data-testid label values filter",useQuery:"data-testid use query",useAsRateQuery:"data-testid use as rate query",validateSelector:"data-testid validate selector",clear:"data-testid clear"}}},exemplarMarker:"data-testid Exemplar marker",variableQueryEditor:{queryType:"data-testid query type",labelnames:{metricRegex:"data-testid label names metric regex"},labelValues:{labelSelect:"data-testid label values label select"},metricNames:{metricRegex:"data-testid metric names metric regex"},varQueryResult:"data-testid variable query result",seriesQuery:"data-testid prometheus series query",classicQuery:"data-testid prometheus classic query"},annotations:{minStep:"prometheus-annotation-min-step",title:"data-testid prometheus annotation title",tags:"data-testid prometheus annotation tags",text:"data-testid prometheus annotation text",seriesValueAsTimestamp:"data-testid prometheus annotation series value as timestamp"}}},Menu:{MenuComponent:e=>`${e} menu`,MenuGroup:e=>`${e} menu group`,MenuItem:e=>`${e} menu item`,SubMenu:{container:"data-testid SubMenu container",icon:"data-testid SubMenu icon"}},Panels:{Panel:{title:e=>`data-testid Panel header ${e}`,headerItems:e=>`data-testid Panel header item ${e}`,menuItems:e=>`data-testid Panel menu item ${e}`,menu:e=>`data-testid Panel menu ${e}`,containerByTitle:e=>`${e} panel`,headerCornerInfo:e=>`Panel header ${e}`,status:e=>`data-testid Panel status ${e}`,loadingBar:()=>"Panel loading bar",HoverWidget:{container:"data-testid hover-header-container",dragIcon:"data-testid drag-icon"},PanelDataErrorMessage:"data-testid Panel data error message"},Visualization:{Graph:{container:"Graph container",VisualizationTab:{legendSection:"Legend section"},Legend:{legendItemAlias:e=>`gpl alias ${e}`,showLegendSwitch:"gpl show legend"},xAxis:{labels:()=>"div.flot-x-axis > div.flot-tick-label"}},BarGauge:{value:"Bar gauge value",valueV2:"data-testid Bar gauge value"},PieChart:{svgSlice:"data testid Pie Chart Slice"},Text:{container:()=>".markdown-html"},Table:{header:"table header",footer:"table-footer",body:"data-testid table body"}}},VizLegend:{seriesName:e=>`data-testid VizLegend series ${e}`},Drawer:{General:{title:e=>`Drawer title ${e}`,expand:"Drawer expand",contract:"Drawer contract",close:"data-testid Drawer close",rcContentWrapper:()=>".rc-drawer-content-wrapper",subtitle:"data-testid drawer subtitle"},DashboardSaveDrawer:{saveButton:"data-testid Save dashboard drawer button",saveAsButton:"data-testid Save as dashboard drawer button",saveAsTitleInput:"Save dashboard title field"}},PanelEditor:{General:{content:"Panel editor content"},OptionsPane:{content:"Panel editor option pane content",select:"Panel editor option pane select",fieldLabel:e=>`${e} field property editor`,fieldInput:e=>`data-testid Panel editor option pane field input ${e}`},DataPane:{content:"Panel editor data pane content"},applyButton:"data-testid Apply changes and go back to dashboard",toggleVizPicker:"data-testid toggle-viz-picker",toggleVizOptions:"data-testid toggle-viz-options",toggleTableView:"toggle-table-view",showZoomField:"Map controls Show zoom control field property editor",showAttributionField:"Map controls Show attribution field property editor",showScaleField:"Map controls Show scale field property editor",showMeasureField:"Map controls Show measure tools field property editor",showDebugField:"Map controls Show debug field property editor",measureButton:"show measure tools"},PanelInspector:{Data:{content:"Panel inspector Data content"},Stats:{content:"Panel inspector Stats content"},Json:{content:"Panel inspector Json content"},Query:{content:"Panel inspector Query content",refreshButton:"Panel inspector Query refresh button",jsonObjectKeys:()=>".json-formatter-key"}},Tab:{title:e=>`Tab ${e}`,active:()=>'[class*="-activeTabStyle"]'},RefreshPicker:{runButton:"RefreshPicker run button",intervalButton:"RefreshPicker interval button",runButtonV2:"data-testid RefreshPicker run button",intervalButtonV2:"data-testid RefreshPicker interval button"},QueryTab:{content:"Query editor tab content",queryInspectorButton:"Query inspector button",queryHistoryButton:"data-testid query-history-button",addQuery:"data-testid query-tab-add-query",queryGroupTopSection:"data-testid query group top section",addExpression:"data-testid query-tab-add-expression"},QueryHistory:{queryText:"Query text"},QueryEditorRows:{rows:"Query editor row"},QueryEditorRow:{actionButton:e=>`data-testid ${e}`,title:e=>`Query editor row title ${e}`,container:e=>`Query editor row ${e}`},AlertTab:{content:"data-testid Alert editor tab content"},AlertRules:{groupToggle:"data-testid group-collapse-toggle",toggle:"data-testid collapse-toggle",expandedContent:"data-testid expanded-content"},Alert:{alert:e=>`Alert ${e}`,alertV2:e=>`data-testid Alert ${e}`},TransformTab:{content:"data-testid Transform editor tab content",newTransform:e=>`data-testid New transform ${e}`,transformationEditor:e=>`data-testid Transformation editor ${e}`,transformationEditorDebugger:e=>`data-testid Transformation editor debugger ${e}`},Transforms:{card:e=>`data-testid New transform ${e}`,disableTransformationButton:"data-testid Disable transformation button",Reduce:{modeLabel:"data-testid Transform mode label",calculationsLabel:"data-testid Transform calculations label"},SpatialOperations:{actionLabel:"root Action field property editor",locationLabel:"root Location Mode field property editor",location:{autoOption:"Auto location option",coords:{option:"Coords location option",latitudeFieldLabel:"root Latitude field field property editor",longitudeFieldLabel:"root Longitude field field property editor"},geohash:{option:"Geohash location option",geohashFieldLabel:"root Geohash field field property editor"},lookup:{option:"Lookup location option",lookupFieldLabel:"root Lookup field field property editor",gazetteerFieldLabel:"root Gazetteer field property editor"}}},searchInput:"data-testid search transformations",noTransformationsMessage:"data-testid no transformations message",addTransformationButton:"data-testid add transformation button",removeAllTransformationsButton:"data-testid remove all transformations button"},NavBar:{Configuration:{button:"Configuration"},Toggle:{button:"data-testid Toggle menu"},Reporting:{button:"Reporting"}},NavMenu:{Menu:"data-testid navigation mega-menu",item:"data-testid Nav menu item"},NavToolbar:{container:"data-testid Nav toolbar",shareDashboard:"data-testid Share dashboard",markAsFavorite:"data-testid Mark as favorite",editDashboard:{editButton:"data-testid Edit dashboard button",saveButton:"data-testid Save dashboard button",exitButton:"data-testid Exit edit mode button",settingsButton:"data-testid Dashboard settings",addRowButton:"data-testid Add row button",addLibraryPanelButton:"data-testid Add a panel from the panel library button",addVisualizationButton:"data-testid Add new visualization menu item",pastePanelButton:"data-testid Paste panel button",discardChangesButton:"data-testid Discard changes button",discardLibraryPanelButton:"data-testid Discard library panel button",unlinkLibraryPanelButton:"data-testid Unlink library panel button",saveLibraryPanelButton:"data-testid Save library panel button",backToDashboardButton:"data-testid Back to dashboard button"}},PageToolbar:{container:()=>".page-toolbar",item:e=>`${e}`,itemButton:e=>`data-testid ${e}`},QueryEditorToolbarItem:{button:e=>`QueryEditor toolbar item button ${e}`},BackButton:{backArrow:"data-testid Go Back"},OptionsGroup:{group:e=>e?`Options group ${e}`:"Options group",toggle:e=>e?`Options group ${e} toggle`:"Options group toggle"},PluginVisualization:{item:e=>`Plugin visualization item ${e}`,current:()=>'[class*="-currentVisualizationItem"]'},Select:{option:"Select option",input:()=>'input[id*="time-options-input"]',singleValue:()=>'div[class*="-singleValue"]'},FieldConfigEditor:{content:"Field config editor content"},OverridesConfigEditor:{content:"Field overrides editor content"},FolderPicker:{container:"Folder picker select container",containerV2:"data-testid Folder picker select container",input:"data-testid folder-picker-input"},ReadonlyFolderPicker:{container:"data-testid Readonly folder picker select container"},DataSourcePicker:{container:"data-testid Data source picker select container",input:()=>'input[id="data-source-picker"]',inputV2:"data-testid Select a data source",dataSourceList:"data-testid Data source list dropdown",advancedModal:{dataSourceList:"data-testid Data source list",builtInDataSourceList:"data-testid Built in data source list"}},TimeZonePicker:{container:"Time zone picker select container",containerV2:"data-testid Time zone picker select container",changeTimeSettingsButton:"data-testid Time zone picker Change time settings button"},WeekStartPicker:{container:"Choose starting day of the week",containerV2:"data-testid Choose starting day of the week",placeholder:"Choose starting day of the week"},TraceViewer:{spanBar:"data-testid SpanBar--wrapper"},QueryField:{container:"data-testid Query field"},QueryBuilder:{queryPatterns:"data-testid Query patterns",labelSelect:"data-testid Select label",valueSelect:"data-testid Select value",matchOperatorSelect:"data-testid Select match operator"},ValuePicker:{button:e=>`data-testid Value picker button ${e}`,select:e=>`data-testid Value picker select ${e}`},Search:{section:"Search section",sectionV2:"data-testid Search section",items:"Search items",itemsV2:"data-testid Search items",cards:"data-testid Search cards",collapseFolder:e=>`data-testid Collapse folder ${e}`,expandFolder:e=>`data-testid Expand folder ${e}`,dashboardItem:e=>`${NR.Search.dashboardItems} ${e}`,dashboardCard:e=>`data-testid Search card ${e}`,folderHeader:e=>`data-testid Folder header ${e}`,folderContent:e=>`data-testid Folder content ${e}`,dashboardItems:"data-testid Dashboard search item"},DashboardLinks:{container:"data-testid Dashboard link container",dropDown:"data-testid Dashboard link dropdown",link:"data-testid Dashboard link"},LoadingIndicator:{icon:"data-testid Loading indicator"},CallToActionCard:{button:e=>`Call to action button ${e}`,buttonV2:e=>`data-testid Call to action button ${e}`},DataLinksContextMenu:{singleLink:"data-testid Data link"},CodeEditor:{container:"data-testid Code editor container"},DashboardImportPage:{textarea:"data-testid-import-dashboard-textarea",submit:"data-testid-load-dashboard"},ImportDashboardForm:{name:"data-testid-import-dashboard-title",submit:"data-testid-import-dashboard-submit"},PanelAlertTabContent:{content:"data-testid Unified alert editor tab content"},VisualizationPreview:{card:e=>`data-testid suggestion-${e}`},ColorSwatch:{name:"data-testid-colorswatch"},DashboardRow:{title:e=>`data-testid dashboard-row-title-${e}`},UserProfile:{profileSaveButton:"data-testid-user-profile-save",preferencesSaveButton:"data-testid-shared-prefs-save",orgsTable:"data-testid-user-orgs-table",sessionsTable:"data-testid-user-sessions-table",extensionPointTabs:"data-testid-extension-point-tabs",extensionPointTab:e=>`data-testid-extension-point-tab-${e}`},FileUpload:{inputField:"data-testid-file-upload-input-field",fileNameSpan:"data-testid-file-upload-file-name"},DebugOverlay:{wrapper:"debug-overlay"},OrgRolePicker:{input:"Role"},AnalyticsToolbarButton:{button:"Dashboard insights"},Variables:{variableOption:"data-testid variable-option"},Annotations:{annotationsTypeInput:"annotations-type-input",annotationsChoosePanelInput:"choose-panels-input",editor:{testButton:"data-testid annotations-test-button",resultContainer:"data-testid annotations-query-result-container"}},Tooltip:{container:"data-testid tooltip"},ReturnToPrevious:{buttonGroup:"data-testid dismissable button group",backButton:"data-testid back",dismissButton:"data-testid dismiss"},SQLQueryEditor:{selectColumn:"data-testid select-column",selectAggregation:"data-testid select-aggregation",selectAlias:"data-testid select-alias",filterConjunction:"data-testid filter-conjunction",filterField:"data-testid filter-field",filterOperator:"data-testid filter-operator",headerTableSelector:"data-testid header-table-selector",headerFilterSwitch:"data-testid header-filter-switch",headerGroupSwitch:"data-testid header-group-switch",headerOrderSwitch:"data-testid header-order-switch",headerPreviewSwitch:"data-testid header-preview-switch"}},BR={Login:{url:"/login",username:"data-testid Username input field",password:"data-testid Password input field",submit:"data-testid Login button",skip:"data-testid Skip change password button"},Home:{url:"/"},DataSource:{name:"data-testid Data source settings page name input field",delete:"Data source settings page Delete button",readOnly:"data-testid Data source settings page read only message",saveAndTest:"data-testid Data source settings page Save and Test button",alert:"data-testid Data source settings page Alert"},DataSources:{url:"/datasources",dataSources:e=>`Data source list item ${e}`},EditDataSource:{url:e=>`/datasources/edit/${e}`,settings:"Datasource settings page basic settings"},AddDataSource:{url:"/datasources/new",dataSourcePlugins:e=>`Data source plugin item ${e}`,dataSourcePluginsV2:e=>`Add new data source ${e}`},ConfirmModal:{delete:"data-testid Confirm Modal Danger Button"},AddDashboard:{url:"/dashboard/new",itemButton:e=>`data-testid ${e}`,addNewPanel:"Add new panel",addNewRow:"Add new row",addNewPanelLibrary:"Add new panel from panel library"},Dashboard:{url:e=>`/d/${e}`,DashNav:{nav:"Dashboard navigation",navV2:"data-testid Dashboard navigation",publicDashboardTag:"data-testid public dashboard tag",shareButton:"data-testid share-button",scrollContainer:"data-testid Dashboard canvas scroll container",playlistControls:{prev:"data-testid playlist previous dashboard button",stop:"data-testid playlist stop dashboard button",next:"data-testid playlist next dashboard button"}},SubMenu:{submenu:"Dashboard submenu",submenuItem:"data-testid template variable",submenuItemLabels:e=>`data-testid Dashboard template variables submenu Label ${e}`,submenuItemValueDropDownValueLinkTexts:e=>`data-testid Dashboard template variables Variable Value DropDown value link text ${e}`,submenuItemValueDropDownDropDown:"Variable options",submenuItemValueDropDownOptionTexts:e=>`data-testid Dashboard template variables Variable Value DropDown option text ${e}`,Annotations:{annotationsWrapper:"data-testid annotation-wrapper",annotationLabel:e=>`data-testid Dashboard annotations submenu Label ${e}`,annotationToggle:e=>`data-testid Dashboard annotations submenu Toggle ${e}`}},Settings:{Actions:{close:"data-testid dashboard-settings-close"},General:{deleteDashBoard:"Dashboard settings page delete dashboard button",sectionItems:e=>`Dashboard settings section item ${e}`,saveDashBoard:"Dashboard settings aside actions Save button",saveAsDashBoard:"Dashboard settings aside actions Save As button",timezone:"Time zone picker select container",title:"Tab General"},Annotations:{List:{addAnnotationCTA:NR.CallToActionCard.button("Add annotation query"),addAnnotationCTAV2:NR.CallToActionCard.buttonV2("Add annotation query"),annotations:"data-testid list-annotations"},Settings:{name:"Annotations settings name input"},NewAnnotation:{panelFilterSelect:"data-testid annotations-panel-filter",showInLabel:"show-in-label",previewInDashboard:"data-testid annotations-preview",delete:"data-testid annotations-delete",apply:"data-testid annotations-apply",enable:"data-testid annotation-enable",hide:"data-testid annotation-hide"}},Variables:{List:{addVariableCTA:NR.CallToActionCard.button("Add variable"),addVariableCTAV2:NR.CallToActionCard.buttonV2("Add variable"),newButton:"Variable editor New variable button",table:"Variable editor Table",tableRowNameFields:e=>`Variable editor Table Name field ${e}`,tableRowDefinitionFields:e=>`Variable editor Table Definition field ${e}`,tableRowArrowUpButtons:e=>`Variable editor Table ArrowUp button ${e}`,tableRowArrowDownButtons:e=>`Variable editor Table ArrowDown button ${e}`,tableRowDuplicateButtons:e=>`Variable editor Table Duplicate button ${e}`,tableRowRemoveButtons:e=>`Variable editor Table Remove button ${e}`},Edit:{General:{headerLink:"Variable editor Header link",modeLabelNew:"Variable editor Header mode New",modeLabelEdit:"Variable editor Header mode Edit",generalNameInput:"Variable editor Form Name field",generalNameInputV2:"data-testid Variable editor Form Name field",generalTypeSelect:"Variable editor Form Type select",generalTypeSelectV2:"data-testid Variable editor Form Type select",generalLabelInput:"Variable editor Form Label field",generalLabelInputV2:"data-testid Variable editor Form Label field",generalHideSelect:"Variable editor Form Hide select",generalHideSelectV2:"data-testid Variable editor Form Hide select",selectionOptionsMultiSwitch:"data-testid Variable editor Form Multi switch",selectionOptionsIncludeAllSwitch:"data-testid Variable editor Form IncludeAll switch",selectionOptionsCustomAllInput:"data-testid Variable editor Form IncludeAll field",previewOfValuesOption:"data-testid Variable editor Preview of Values option",submitButton:"data-testid Variable editor Run Query button",applyButton:"data-testid Variable editor Apply button"},QueryVariable:{queryOptionsDataSourceSelect:NR.DataSourcePicker.inputV2,queryOptionsRefreshSelect:"Variable editor Form Query Refresh select",queryOptionsRefreshSelectV2:"data-testid Variable editor Form Query Refresh select",queryOptionsRegExInput:"Variable editor Form Query RegEx field",queryOptionsRegExInputV2:"data-testid Variable editor Form Query RegEx field",queryOptionsSortSelect:"Variable editor Form Query Sort select",queryOptionsSortSelectV2:"data-testid Variable editor Form Query Sort select",queryOptionsQueryInput:"data-testid Variable editor Form Default Variable Query Editor textarea",valueGroupsTagsEnabledSwitch:"Variable editor Form Query UseTags switch",valueGroupsTagsTagsQueryInput:"Variable editor Form Query TagsQuery field",valueGroupsTagsTagsValuesQueryInput:"Variable editor Form Query TagsValuesQuery field"},ConstantVariable:{constantOptionsQueryInput:"Variable editor Form Constant Query field",constantOptionsQueryInputV2:"data-testid Variable editor Form Constant Query field"},DatasourceVariable:{datasourceSelect:"data-testid datasource variable datasource type"},TextBoxVariable:{textBoxOptionsQueryInput:"Variable editor Form TextBox Query field",textBoxOptionsQueryInputV2:"data-testid Variable editor Form TextBox Query field"},CustomVariable:{customValueInput:"data-testid custom-variable-input"},IntervalVariable:{intervalsValueInput:"data-testid interval variable intervals input",autoEnabledCheckbox:"data-testid interval variable auto value checkbox",stepCountIntervalSelect:"data-testid interval variable step count input",minIntervalInput:"data-testid interval variable mininum interval input"},GroupByVariable:{dataSourceSelect:NR.DataSourcePicker.inputV2,infoText:"data-testid group by variable info text",modeToggle:"data-testid group by variable mode toggle"},AdHocFiltersVariable:{datasourceSelect:NR.DataSourcePicker.inputV2,infoText:"data-testid ad-hoc filters variable info text",modeToggle:"data-testid ad-hoc filters variable mode toggle"}}}},Annotations:{marker:"data-testid annotation-marker"},Rows:{Repeated:{ConfigSection:{warningMessage:"data-testid Repeated rows warning message"}}}},Dashboards:{url:"/dashboards",dashboards:e=>`Dashboard search item ${e}`},SaveDashboardAsModal:{newName:"Save dashboard title field",save:"Save dashboard button"},SaveDashboardModal:{save:"Dashboard settings Save Dashboard Modal Save button",saveVariables:"Dashboard settings Save Dashboard Modal Save variables checkbox",saveTimerange:"Dashboard settings Save Dashboard Modal Save timerange checkbox",saveRefresh:"Dashboard settings Save Dashboard Modal Save refresh checkbox"},SharePanelModal:{linkToRenderedImage:"Link to rendered image"},ShareDashboardModal:{PublicDashboard:{Tab:"Tab Public dashboard",WillBePublicCheckbox:"data-testid public dashboard will be public checkbox",LimitedDSCheckbox:"data-testid public dashboard limited datasources checkbox",CostIncreaseCheckbox:"data-testid public dashboard cost may increase checkbox",PauseSwitch:"data-testid public dashboard pause switch",EnableAnnotationsSwitch:"data-testid public dashboard on off switch for annotations",CreateButton:"data-testid public dashboard create button",DeleteButton:"data-testid public dashboard delete button",CopyUrlInput:"data-testid public dashboard copy url input",CopyUrlButton:"data-testid public dashboard copy url button",SettingsDropdown:"data-testid public dashboard settings dropdown",TemplateVariablesWarningAlert:"data-testid public dashboard disabled template variables alert",UnsupportedDataSourcesWarningAlert:"data-testid public dashboard unsupported data sources alert",NoUpsertPermissionsWarningAlert:"data-testid public dashboard no upsert permissions alert",EnableTimeRangeSwitch:"data-testid public dashboard on off switch for time range",EmailSharingConfiguration:{Container:"data-testid email sharing config container",ShareType:"data-testid public dashboard share type",EmailSharingInput:"data-testid public dashboard email sharing input",EmailSharingInviteButton:"data-testid public dashboard email sharing invite button",EmailSharingList:"data-testid public dashboard email sharing list",DeleteEmail:"data-testid public dashboard delete email button",ReshareLink:"data-testid public dashboard reshare link button"}},PublicDashboardScene:{Tab:"Tab Public Dashboard"}},PublicDashboard:{page:"public-dashboard-page",NotAvailable:{container:"public-dashboard-not-available",title:"public-dashboard-title",pausedDescription:"public-dashboard-paused-description"},footer:"public-dashboard-footer"},PublicDashboardScene:{loadingPage:"public-dashboard-scene-loading-page",page:"public-dashboard-scene-page",controls:"public-dashboard-controls"},RequestViewAccess:{form:"request-view-access-form",recipientInput:"request-view-access-recipient-input",submitButton:"request-view-access-submit-button"},PublicDashboardConfirmAccess:{submitButton:"data-testid confirm-access-submit-button"},Explore:{url:"/explore",General:{container:"data-testid Explore",graph:"Explore Graph",table:"Explore Table",scrollView:"data-testid explorer scroll view"}},SoloPanel:{url:e=>`/d-solo/${e}`},PluginsList:{page:"Plugins list page",list:"Plugins list",listItem:"Plugins list item",signatureErrorNotice:"data-testid Unsigned plugins notice"},PluginPage:{page:"Plugin page",signatureInfo:"data-testid Plugin signature info",disabledInfo:"data-testid Plugin disabled info"},PlaylistForm:{name:"Playlist name",interval:"Playlist interval",itemDelete:"data-testid playlist-form-delete-item"},BrowseDashboards:{table:{body:"data-testid browse-dashboards-table",row:e=>`data-testid browse dashboards row ${e}`,checkbox:e=>`data-testid ${e} checkbox`},NewFolderForm:{form:"data-testid new folder form",nameInput:"data-testid new-folder-name-input",createButton:"data-testid new-folder-create-button"}},Search:{url:"/?search=openn",FolderView:{url:"/?search=open&layout=folders"}},PublicDashboards:{ListItem:{linkButton:"public-dashboard-link-button",configButton:"public-dashboard-configuration-button",trashcanButton:"public-dashboard-remove-button",pauseSwitch:"data-testid public dashboard pause switch"}},UserListPage:{tabs:{allUsers:"data-testid all-users-tab",orgUsers:"data-testid org-users-tab",anonUserDevices:"data-testid anon-user-devices-tab",publicDashboardsUsers:"data-testid public-dashboards-users-tab",users:"data-testid users-tab"},org:{url:"/org/users"},admin:{url:"/admin/users"},publicDashboards:{container:"data-testid public-dashboards-users-list"},UserListAdminPage:{container:"data-testid user-list-admin-page"},UsersListPage:{container:"data-testid users-list-page"},UserAnonListPage:{container:"data-testid user-anon-list-page"},UsersListPublicDashboardsPage:{container:"data-testid users-list-public-dashboards-page",DashboardsListModal:{listItem:e=>`data-testid dashboards-list-item-${e}`}}},ProfilePage:{url:"/profile"}},zR={pages:BR,components:NR},jR=o().memo((({id:e,title:t,children:n,forceOpen:i,isOpenDefault:s,renderTitle:a,className:l,itemsCount:c,isNested:u=!1})=>{const h=!1!==s,[d,p]=function(e,t,n){if(!FR)return[t,DR,DR];if(!e)throw new Error("useLocalStorage key may not be falsy");var i=n?n.raw?function(e){return e}:n.deserializer:JSON.parse,o=(0,r.useRef)((function(e){try{var r=n?n.raw?String:n.serializer:JSON.stringify,o=localStorage.getItem(e);return null!==o?i(o):(t&&localStorage.setItem(e,r(t)),t)}catch(e){return t}})),s=(0,r.useState)((function(){return o.current(e)})),a=s[0],l=s[1];(0,r.useLayoutEffect)((function(){return l(o.current(e))}),[e]);var c=(0,r.useCallback)((function(t){try{var r,o="function"==typeof t?t(a):t;if(void 0===o)return;r=n?n.raw?"string"==typeof o?o:JSON.stringify(o):n.serializer?n.serializer(o):JSON.stringify(o):JSON.stringify(o),localStorage.setItem(e,r),l(i(r))}catch(e){}}),[e,l]),u=(0,r.useCallback)((function(){try{localStorage.removeItem(e),l(void 0)}catch(e){}}),[e,l]);return[a,c,u]}(VR(e),{isExpanded:h});var f;const[m,g]=(0,r.useState)(null!==(f=null==d?void 0:d.isExpanded)&&void 0!==f?f:h),_=(0,ml.useStyles2)(UR);(0,r.useEffect)((()=>{!m&&i&&i>0&&g(!0)}),[i,m]);const y=(0,r.useCallback)((()=>{p({isExpanded:!m}),g(!m)}),[p,g,m]);a||(a=function(e){return e||void 0===c||0===c?t:o().createElement("span",null,t," ",o().createElement(ml.Counter,{value:c}))});const v=(0,BE.cx)({[_.box]:!0,[_.boxNestedExpanded]:u&&m},l,"options-group"),b=(0,BE.cx)(_.header,{[_.headerExpanded]:m,[_.headerNested]:u}),x=(0,BE.cx)(_.body,{[_.bodyNested]:u});return o().createElement("div",{className:v,"data-testid":"options-category","aria-label":zR.components.OptionsGroup.group(e)},o().createElement("div",{className:b,onClick:y,"aria-label":zR.components.OptionsGroup.toggle(e)},o().createElement("div",{className:(0,BE.cx)(_.toggle,"editor-options-group-toggle")},o().createElement(ml.Icon,{name:m?"angle-down":"angle-right"})),o().createElement("div",{className:_.title,role:"heading"},a(m))),m&&o().createElement("div",{className:x},n))}));jR.displayName="OptionsPaneCategory";const UR=e=>({box:BE.css`
      border-top: 1px solid ${e.colors.border.weak};
    `,boxNestedExpanded:BE.css`
      margin-bottom: ${e.spacing(2)};
    `,toggle:BE.css`
      color: ${e.colors.text.secondary};
      margin-right: ${e.spacing(1)};
    `,title:BE.css`
      flex-grow: 1;
      overflow: hidden;
    `,header:BE.css`
      display: flex;
      cursor: pointer;
      align-items: baseline;
      padding: ${e.spacing(1)};
      color: ${e.colors.text.primary};
      font-weight: ${e.typography.fontWeightMedium};

      &:hover {
        background: ${e.colors.emphasize(e.colors.background.primary,.03)};
      }
    `,headerExpanded:BE.css`
      color: ${e.colors.text.primary};
    `,headerNested:BE.css`
      padding: ${e.spacing(.5,0,.5,0)};
    `,body:BE.css`
      padding: ${e.spacing(1,2,1,4)};
    `,bodyNested:BE.css`
      position: relative;
      padding-right: 0;
      &:before {
        content: '';
        position: absolute;
        top: 0;
        left: 8px;
        width: 1px;
        height: 100%;
        background: ${e.colors.border.weak};
      }
    `}),VR=e=>`grafana.dashboard.editor.ui.optionGroup[${e}]`;function GR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class $R{addItem(e){return e.parent=this,this.items.push(e),this}addCategory(e){return e.props.isNested=!0,e.parent=this,this.categories.push(e),this}render(e){return this.props.customRender?this.props.customRender():o().createElement(jR,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){GR(e,t,n[t])}))}return e}({key:this.props.title},this.props),this.items.map((e=>e.render())),this.categories.map((e=>e.render())))}constructor(e){GR(this,"props",void 0),GR(this,"items",void 0),GR(this,"categories",void 0),GR(this,"parent",void 0),this.props=e,this.items=[],this.categories=[]}}function WR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function HR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){WR(e,t,n[t])}))}return e}function qR(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function XR(e,t,n){const i=Array.isArray(t)?t:t.split("."),r=i.shift();if(r.endsWith("]")){const t=r.lastIndexOf("["),o=+r.substring(t+1,r.length-1),s=r.substring(0,t);let a=e[s];const l=Array.isArray(a)?[...a]:[];return i.length&&(a=l[o],null!=a&&"object"==typeof a||(a={}),n=XR(a,i,n)),l[o]=n,qR(HR({},e),{[s]:l})}if(!i.length)return qR(HR({},e),{[r]:n});let o=e[r];return null!=o&&"object"==typeof o||(o={}),qR(HR({},e),{[r]:XR(o,i,n)})}var ZR=d(2341),YR=d.n(ZR);function KR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class JR{getLabel(e){const{title:t,description:n}=this.props;if(!e)return this.parent.props.title===t?null:t;const i=[];return this.parent.parent&&i.push(this.highlightWord(this.parent.parent.props.title,e)),this.parent.props.title!==t&&i.push(this.highlightWord(this.parent.props.title,e)),o().createElement(ml.Label,{description:n&&this.highlightWord(n,e),category:i},this.highlightWord(t,e))}highlightWord(e,t){return o().createElement(YR(),{textToHighlight:e,searchWords:[t],highlightClassName:"search-fragment-highlight"})}render(e){const{title:t,description:n,render:i,showIf:r,skipField:s}=this.props,a=`${this.parent.props.id} ${t}`;return r&&!r()?null:s?i():o().createElement(ml.Field,{label:this.getLabel(e),description:n,key:a,"aria-label":zR.components.PanelEditor.OptionsPane.fieldLabel(a)},i())}constructor(e){KR(this,"props",void 0),KR(this,"parent",void 0),this.props=e}}function QR(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const eO=[{label:"Countries",description:"Lookup countries by name, two letter code, or three leter code",value:$E},{label:"USA States",description:"Lookup states by name or 2 ",value:"public/gazetteer/usa-states.json"}],tO=({value:e,onChange:t,context:n})=>{const i=(0,ml.useStyles2)(nO),[s,a]=(0,r.useState)();(0,r.useEffect)((()=>{function t(){return t=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){QR(o,i,r,s,a,"next",e)}function a(e){QR(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(){const t=yield WE(e);a(t)})),t.apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e,a]);const{current:l,options:c}=(0,r.useMemo)((()=>{let e=[...eO],t=e.find((e=>e.value===(null==s?void 0:s.path)));return!t&&s&&(t={label:s.path,value:s.path},e.push(t)),{options:e,current:t}}),[s]);return o().createElement(o().Fragment,null,o().createElement(ml.Select,{menuShouldPortal:!0,value:l,options:c,onChange:e=>t(e.value),allowCustomValue:!0,formatCreateLabel:e=>`Load from URL: ${e}`}),s&&o().createElement(o().Fragment,null,s.error&&o().createElement(ml.Alert,{title:s.error,severity:"warning"}),s.count&&o().createElement("div",{className:i.keys},o().createElement("b",null,"(",s.count,")"),s.examples(10).map((e=>o().createElement("span",{key:e},e,",")))," ","&ellipsis;")))},nO=e=>({keys:BE.css`
      margin-top: 4px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;

      > span {
        margin-left: 4px;
      }
    `}),iO=({value:e,context:n,onChange:i,item:s})=>{const a=(0,r.useMemo)((()=>n.data.map((e=>({value:e.refId,label:`Query: ${e.refId} (size: ${e.length})`,description:e.fields.map((e=>(0,t.getFieldDisplayName)(e))).join(", ")})))),[n.data]),[l,c]=(0,r.useState)({refIds:[],value:void 0}),u=(0,r.useMemo)((()=>{var t;return null!==(t=a.find((t=>t.value===(null==e?void 0:e.options))))&&void 0!==t?t:((e,t,n)=>{if(n)return e.find((e=>!t.some((t=>e===t))))||void 0})(a,l.refIds,l.value)}),[e,a,l]),h=(0,r.useCallback)((e=>{i((null==e?void 0:e.value)?{id:t.FrameMatcherID.byRefId,options:e.value}:void 0)}),[i]);return a===l.refIds&&(null==u?void 0:u.value)===l.value||c({refIds:a,value:null==u?void 0:u.value}),o().createElement(ml.Select,{options:a,onChange:h,isClearable:!0,placeholder:"Change filter",value:u})};function rO(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}const oO=function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){rO(o,i,r,s,a,"next",e)}function a(e){rO(o,i,r,s,a,"throw",e)}s(void 0)}))}}((function*(e){const n=[];if(e&&e.data&&e.data.length>0&&e.options&&e.options.query&&e.options.query.options){const i=e.data;for(let r=0;r<i.length;r++)if(i[r].refId&&i[r].refId===e.options.query.options){const i=e.data[r];for(const r of i.fields){const o=(0,t.getFieldDisplayName)(r,i,e.data),s=r.name;n.push({value:s,label:o})}}}else if(e&&e.data&&e.data.length>0&&e.data[0]){const i=e.data;for(let r=0;r<i.length;r++){const i=e.data[r];for(const r of i.fields){const o=(0,t.getFieldDisplayName)(r,i,e.data),s=r.name;n.push({value:s,label:o})}}}return n}));return function(t){return e.apply(this,arguments)}}();function sO(e,t,n,i,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,r)}function aO(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){sO(o,i,r,s,a,"next",e)}function a(e){sO(o,i,r,s,a,"throw",e)}s(void 0)}))}}function lO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){lO(e,t,n[t])}))}return e}function uO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const hO=({options:e,eventBus:n,onChange:i,data:s,filter:a})=>{const l=(0,r.useMemo)((()=>TM.selectOptions((null==e?void 0:e.type)?[e.type]:[EM.type],a)),[null==e?void 0:e.type,a]),c=(0,r.useCallback)(aO((function*(){if(!(null==e?void 0:e.geojsonurl))return[];const t=null==e?void 0:e.geojsonurl;if(!t)return;let n=yield fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).catch((e=>{console.log(e)}));if(!n)return[];let i=yield n.json();return Object.keys(i.features[0].properties).map((e=>({value:e,label:e})))})),[null==e?void 0:e.geojsonurl]),u=(0,r.useMemo)((()=>{const n=TM.getIfExists(null==e?void 0:e.type);if(!n||!(n.registerOptionsUI||n.showLocation||n.showOpacity))return null;const i=new t.PanelOptionsEditorBuilder;return n.showLocation&&i.addTextInput({path:"name",name:"Layer name",settings:{}}).addTextInput({path:"geojsonurl",name:"GeoJson Url",description:"Url to a file with valid GeoJSON FeatureCollection object",settings:{},showIf:e=>e.type===ne.GeoJson}).addCustomEditor({id:"query",path:"query",name:"Data query",editor:iO,showIf:e=>e.type!==ne.GeoJson}).addRadio({path:"location.mode",name:"Location",description:"",defaultValue:YE.Auto,settings:{options:[{value:YE.Auto,label:"Auto"},{value:YE.Coords,label:"Coords"},{value:YE.Geojson,label:"Geojson"},{value:YE.Lookup,label:"Lookup"},{value:YE.Geohash,label:"Geohash"}]},showIf:e=>e.type!==ne.GeoJson}).addFieldNamePicker({path:"location.geojson",name:"Geojson field",showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Geojson}}).addFieldNamePicker({path:"location.longitude",name:"Longitude field",settings:{filter:e=>e.type===t.FieldType.number,noFieldsMessage:"No numeric fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Coords}}).addFieldNamePicker({path:"location.latitude",name:"Latitude field",settings:{filter:e=>e.type===t.FieldType.number,noFieldsMessage:"No numeric fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Coords}}).addFieldNamePicker({path:"location.geohash",name:"Geohash field",settings:{filter:e=>e.type===t.FieldType.string,noFieldsMessage:"No strings fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Geohash}}).addFieldNamePicker({path:"location.lookup",name:"Lookup field",settings:{filter:e=>e.type===t.FieldType.string,noFieldsMessage:"No strings fields found"},showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Lookup}}).addCustomEditor({id:"gazetteer",path:"location.gazetteer",name:"Gazetteer",editor:tO,showIf:e=>{var t;return(null===(t=e.location)||void 0===t?void 0:t.mode)===YE.Lookup}}).addFieldNamePicker({path:"locField",name:"Target name field",settings:{filter:e=>e.type===t.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>e.type!==ne.GeoJson}).addSelect({path:"geojsonLocName",name:"Location name GeoJson property",settings:{allowCustomValue:!0,options:[],placeholder:"GeoJson properties",getOptions:c},showIf:e=>e.type===ne.GeoJson,defaultValue:""}).addFieldNamePicker({path:"parField",name:"Source name / path to source field",description:"String or Array<String | [lon, lat]>",settings:{filter:e=>e.type===t.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>e.type===ne.Points}).addFieldNamePicker({path:"edgeLabelField",name:"Edge label field",description:"text is visible in stat2 mode",settings:{noFieldsMessage:"No fields found"},showIf:e=>e.type===ne.Points}).addBooleanSwitch({path:"isShowBW",name:"Show secondary metric",description:"experimental: display tput/band ratio with hardcoded color thresholds",defaultValue:!1,showIf:e=>e.type===ne.Points}).addNumberInput({path:"bandNumber",name:"Bandwidth #",description:"default bandwidth in bits/sec (SI) (bps).",showIf:e=>e.isShowBW}).addFieldNamePicker({path:"bandField",name:"Bandwidth field",description:"bandwidth in bits/sec (SI) (bps).",settings:{filter:e=>e.type===t.FieldType.number,noFieldsMessage:"No fields found"},showIf:e=>e.isShowBW}).addFieldNamePicker({path:"throughputField",name:"Throughput field",description:"throughput in bits/sec (SI) (bps).",settings:{filter:e=>e.type===t.FieldType.number,noFieldsMessage:"No fields found"},showIf:e=>e.isShowBW}).addSelect({path:"geojsonMetricName",name:"Metric name GeoJson property",description:"select Metric GeoJson property with numeric values",settings:{allowCustomValue:!0,options:[],placeholder:"GeoJson properties",getOptions:c},showIf:e=>e.type===ne.GeoJson}).addFieldNamePicker({path:"aggrTypeField",name:"Aggr type field",description:"flag some extra locations as 'node' or 'connector' to aggregate and offset links at endpoints",settings:{filter:e=>e.type===t.FieldType.string,noFieldsMessage:"No string fields found"},showIf:e=>"string"==typeof e.parField&&e.type===ne.Points}).addBooleanSwitch({path:"isShowTooltip",name:"Show tooltip",description:"applies to current layer",defaultValue:!0}).addMultiSelect({path:"displayProperties",name:"Tooltip properties",description:"applies to current layer",settings:{allowCustomValue:!1,options:[],placeholder:"All Properties",getOptions:oO},showIf:e=>e.type!==ne.GeoJson&&e.isShowTooltip,defaultValue:""}).addMultiSelect({path:"geojsonDisplayProperties",name:"Tooltip properties",description:"properties to be displayed from GeoJson file",settings:{allowCustomValue:!0,options:[],placeholder:"Properties",getOptions:c},showIf:e=>e.type===ne.GeoJson,defaultValue:""}).addMultiSelect({path:"searchProperties",name:"Search by",description:"extra fields to search by (save & reload)",settings:{allowCustomValue:!1,options:[],placeholder:"Search by location name",getOptions:oO},showIf:e=>e.type===ne.Points,defaultValue:""}),n.registerOptionsUI&&n.registerOptionsUI(i),i}),[null==e?void 0:e.type,c]),h=(0,r.useMemo)((()=>{const t=TM.getIfExists(null==e?void 0:e.type);if(!u||!t)return null;const n=new $R({id:"Layer config",title:"Layer config"}),r={data:s,options:e},a=uO(cO({},e),{type:t.id,config:cO({},t.defaultOptions,null==e?void 0:e.config)});return(!e||t.defaultOptions&&!e.config)&&i(a),function(e,t,n,i){for(const r of e){if(r.showIf&&!r.showIf(i.options,i.data))continue;const e=t(r.category),s=r.editor;e.addItem(new JR({title:r.name,description:r.description,render:function(){return o().createElement(s,{value:(0,oS.get)(i.options,r.path),onChange:e=>{n(r.path,e)},item:r,context:i})}}))}}(u.getRegistry().list(),(e=>n),((e,t)=>{i(XR(a,e,t))}),r),o().createElement(o().Fragment,null,o().createElement("br",null),n.items.map((e=>e.render())))}),[u,i,s,e]);return o().createElement("div",null,o().createElement(ml.Select,{menuShouldPortal:!0,options:l.options,value:l.current,onChange:t=>{null==n||n.publish({type:"mapType",payload:{type:t}});const r=TM.getIfExists(t.value);r?i(uO(cO({},e),{type:r.id,config:cO({},r.defaultOptions)})):console.warn("layer does not exist",t)}}),h)};function dO(e){return!!e.isBaseMap&&(e.state!==t.PluginState.alpha||BI)}const pO=({value:e,onChange:t,context:n})=>UE.config.geomapDisableCustomBaseLayer?o().createElement("div",null,"The base layer is configured by the server admin."):o().createElement(hO,{options:e,eventBus:n.eventBus,data:n.data,onChange:t,filter:dO});function fO(e){return!e.isBaseMap&&(e.state!==t.PluginState.alpha||BI)}const mO=({value:e,onChange:t,context:n})=>{const i=(0,ml.useStyles2)((e=>({collapsible:BE.css`
      margin-top: 5px;
      padding-left: 5px;    
      border-bottom: solid 0.001px;      
    `})));return o().createElement(o().Fragment,null,o().createElement("div",{className:"data-layer-add"},o().createElement(ml.ToolbarButton,{icon:"plus",tooltip:"add new layer",variant:"primary",key:"Add",onClick:()=>{let n=e?sS().cloneDeep(e):[];n.push(pI),t(n)}},"Add Layer")),(e||[]).map(((r,s)=>o().createElement(o().Fragment,null,o().createElement(ml.CollapsableSection,{className:i.collapsible,label:r.name?r.name+" layer":"unnamed layer",isOpen:!1},o().createElement(hO,{options:r||void 0,data:n.data,onChange:n=>{let i=e?sS().cloneDeep(e):[];i[s]=n,t(i)},filter:fO}),o().createElement("div",{className:"data-layer-remove"},o().createElement(ml.ToolbarButton,{icon:"trash-alt",tooltip:"delete",variant:"destructive",key:"Delete",onClick:n=>{(n=>{let i=e?sS().cloneDeep(e):[];i.splice(n,1),t(i)})(s)}},"Delete")))))))};function gO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class _O extends r.PureComponent{componentDidMount(){this.setState({text:isNaN(this.props.value)?"":`${this.props.value}`})}componentDidUpdate(e){if(this.props.value!==e.value){const e=isNaN(this.props.value)?"":`${this.props.value}`;e!==this.state.text&&this.setState({text:e})}}renderInput(){return o().createElement(ml.Input,{type:"number",ref:this.inputRef,min:this.props.min,max:this.props.max,step:this.props.step,autoFocus:this.props.autoFocus,value:this.state.text,onChange:this.onChange,onBlur:this.updateValue,onKeyPress:this.onKeyPress,placeholder:this.props.placeholder})}render(){const{inputCorrected:e}=this.state;if(e){let t="",{min:n,max:i}=this.props;return null==i?null!=n&&(t=`< ${n}`):t=null!=n?`${n} < > ${i}`:`> ${i}`,o().createElement(ml.Field,{invalid:e,error:`Out of range ${t}`,validationMessageHorizontalOverflow:!0,style:{direction:"rtl"}},this.renderInput())}return this.renderInput()}constructor(...e){super(...e),gO(this,"state",{text:"",inputCorrected:!1}),gO(this,"inputRef",o().createRef()),gO(this,"updateValue",(()=>{var e;let t;const n=null===(e=this.inputRef.current)||void 0===e?void 0:e.value;(null==n?void 0:n.length)&&(t=+n,isNaN(t))||(t!==this.props.value&&this.props.onChange(t),this.state.inputCorrected&&this.setState({inputCorrected:!1}))})),gO(this,"updateValueDebounced",(0,oS.debounce)(this.updateValue,500)),gO(this,"onChange",(e=>{let t,n=!1;const i=this.props.min,r=this.props.max,o=e.currentTarget.valueAsNumber;Number.isNaN(o)||(null!=i&&o<i?(t=i.toString(),n=!0):null!=r&&o>r?(t=r.toString(),n=!0):t=e.currentTarget.value),this.setState({text:t||"",inputCorrected:n}),this.updateValueDebounced()})),gO(this,"onKeyPress",(e=>{"Enter"===e.key&&this.updateValue()}))}}function yO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){yO(e,t,n[t])}))}return e}function bO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const xO=({value:t,onChange:i,context:s})=>{const a=(0,r.useCallback)((e=>{var t;null===(t=s.eventBus)||void 0===t||t.publish({type:"mapView",payload:"update"}),i(e)}),[i,s.eventBus]),l=(0,r.useMemo)((()=>{const e=[];return(null==t?void 0:t.id)?e.push(t.id):e.push(n.list()[0].id),n.selectOptions(e)}),[null==t?void 0:t.id]),c=(0,r.useCallback)((()=>{const n=rR;if(n){const i=n.getCenter(),r=n.getZoom();if(i&&r){const{lng:n,lat:o}=i;a(bO(vO({},t),{id:e.Coordinates,lon:+n.toFixed(6),lat:+o.toFixed(6),zoom:+r.toFixed(2)}))}}}),[t,a]),u=(0,r.useCallback)((i=>{const r=n.getIfExists(i.value);var o,s,l;r&&r.id!==e.Auto?a(bO(vO({},t),{id:r.id,lat:null!==(o=r.lat)&&void 0!==o?o:null==t?void 0:t.lat,lon:null!==(s=r.lon)&&void 0!==s?s:null==t?void 0:t.lon,zoom:null!==(l=r.zoom)&&void 0!==l?l:null==t?void 0:t.zoom})):r&&r.id===e.Auto&&a(bO(vO({},t),{id:r.id}))}),[t,a]);var h;return o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"View",labelWidth:10,grow:!0},o().createElement(ml.Select,{menuShouldPortal:!0,options:l.options,value:l.current,onChange:u}))),(null==t?void 0:t.id)===e.Coordinates&&o().createElement(o().Fragment,null,o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Latitude",labelWidth:10,grow:!0},o().createElement(_O,{value:t.lat,min:-90,max:90,step:.001,onChange:e=>{a(bO(vO({},t),{lat:e}))}}))),o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Longitude",labelWidth:10,grow:!0},o().createElement(_O,{value:t.lon,min:-180,max:180,step:.001,onChange:e=>{a(bO(vO({},t),{lon:e}))}})))),o().createElement(ml.InlineFieldRow,null,o().createElement(ml.InlineField,{label:"Zoom",labelWidth:10,grow:!0},o().createElement(_O,{value:null!==(h=null==t?void 0:t.zoom)&&void 0!==h?h:1,min:1,max:18,step:.01,onChange:e=>{a(bO(vO({},t),{zoom:e}))}}))),o().createElement(ml.InlineFieldRow,null,o().createElement(ml.Button,{variant:"secondary",size:"sm",fullWidth:!0,onClick:c},o().createElement("span",null,"Use current map settings"))))},wO=({value:e,onChange:t,options:n})=>o().createElement(ml.Select,{width:20,isLoading:!1,value:e,onChange:e=>{t(null==e?void 0:e.value)},options:n}),EO=e=>{const t=(0,ml.useStyles2)(SO);if(e.context.data&&e.context.data.length>0){const n=e.context.data.flatMap((e=>e.fields)).map((e=>({label:e.name,value:e.name,type:e.type})));return o().createElement(o().Fragment,null,o().createElement(ml.InlineField,{shrink:!0,label:"override "+(e.index+1)},o().createElement(wO,{context:e.context,options:n,item:e.context.item,value:e.overrideField.name,onChange:t=>{"string"==typeof t&&e.nameTypeSetter(e.index,t,n.find((e=>e.value===t)).type)}})),o().createElement(ml.InlineField,{label:"values"},o().createElement(ml.AutoSizeInput,{minWidth:10,onCommitChange:t=>{e.valueSetter(e.index,t.currentTarget.value)},defaultValue:e.overrideField.value,placeholder:"val1,val2..."})),o().createElement(ml.InlineField,{className:t.rmButton},o().createElement(ml.IconButton,{disabled:e.disabled,key:"deleteThresholdField",variant:"destructive",name:"x",tooltip:"rm override field",onClick:()=>e.remover(e.index)})))}return o().createElement(ml.Select,{onChange:()=>{},disabled:!0})},SO=e=>({colorPicker:BE.css`
      padding: 0 ${e.spacing(1)};
    `,rmButton:BE.css`
          align-items: center;
        `}),TO=be(10,150,5,!1),AO=(be(-20,20,5,!1),(e,n)=>{const i=(0,ml.useStyles2)(CO),[s,a]=(0,r.useState)((()=>{if(!e.rule.overrides)return[];const t=[];return Object.values(e.rule.overrides).forEach(((e,n)=>{t[n]={overrideField:e,order:n,ID:iA()}})),t})),l=(aP.map((e=>({label:e,value:"cisco/"+e}))),lP.map((e=>({label:e,value:"networking/"+e}))),cP.map((e=>({label:e,value:"databases/"+e}))),t=>{a(t);const n=[];t.forEach((e=>{n.push(e.overrideField)})),e.overrideSetter(e.index,n)}),c=(e,t,n)=>{s[e].overrideField.name=t,s[e].overrideField.type=n,l([...s])},u=(e,t)=>{s[e].overrideField.value=t,l([...s])},h=e=>{const t=[...s];let n=0;for(let i=0;i<t.length;i++)if(t[i].order===e){n=i;break}t.splice(n,1);for(let e=0;e<t.length;e++)t[e].order=e;l([...t])},[d,p]=(0,r.useState)(e.rule.iconRuleLabel),[f,m]=(0,r.useState)(e.rule.iconSize),[g,_]=(0,r.useState)(e.rule.iconVOffset),[y,v]=(0,r.useState)(e.rule.iconName);return o().createElement(ml.InlineFieldRow,{className:i.inlineRow},o().createElement(ml.InlineField,{shrink:!0,label:"label"},o().createElement(ml.AutoSizeInput,{key:e.index,defaultValue:d,placeholder:"rule label",onCommitChange:t=>{const{value:n}=t.currentTarget;p(n),e.iconLabelSetter(e.index,n)}})),o().createElement(ml.InlineField,{label:"size"},o().createElement(ml.Select,{disabled:e.disabled,menuShouldPortal:!0,value:f,onChange:t=>{const n="string"==typeof t.value?parseFloat(t.value):t.value;n&&(m(t),e.iconSizeSetter(e.index,n))},options:"number"==typeof f?TO.concat([{value:f,label:f.toString()}]):TO,allowCustomValue:!0})),o().createElement(ml.InlineField,{shrink:!0,label:"offset",className:i.voffset},o().createElement(ml.Input,{disabled:e.disabled,type:"number",step:"1.0",key:e.index,defaultValue:g,onChange:t=>{const{value:n}=t.currentTarget,i="string"==typeof n?parseFloat(n):n;"number"==typeof i&&(_(i),e.iconVOffsetSetter(e.index,i))}})),s&&s.map(((t,n)=>o().createElement(EO,{disabled:e.disabled||!1,key:`rule-field-index-${t.ID}`,ID:t.ID,overrideField:t.overrideField,nameTypeSetter:c,valueSetter:u,remover:h,index:n,context:e.context}))),o().createElement(ml.InlineField,{shrink:!0,label:"icon name"},o().createElement(MP,{value:{fixed:e.rule.iconName,mode:_T.Fixed},context:n,onChange:t=>{var n;t&&("custom_icon"===t.fixed?v(t.fixed):"string"==typeof(n=t.fixed)&&(e.iconNameSetter(e.index,n),v(n)))},item:{settings:{resourceType:bT.Icon,folderName:vT.Networking,placeholderText:"Select an icon",showSourceRadio:!1,maxFiles:2e3}}})),o().createElement(ml.InlineField,{className:i.addButton},o().createElement(ml.IconButton,{disabled:e.disabled,key:"addRuleField",variant:"primary",name:"plus",tooltip:"add override",onClick:()=>{const e=s.length,n={overrideField:{name:"",value:"",type:t.FieldType.string},order:e,ID:iA()};l([...s,n])}})))}),CO=e=>({ruleContainer:BE.css`
      display: flex;
      align-items: center;
      //flex: 1; // Use flex: 1 to distribute space equally among child elements
      justify-content: space-between;
    `,colorPicker:BE.css`
      padding: 0 ${e.spacing(1)};
    `,nodeSelect:BE.css`
      margin: 5px 0px;
    `,inlineField:BE.css`
      flex: 1 0 auto;
    `,inlineRow:BE.css`
      //display: flex;
      //align-items: center;
     margin-top: 10px;      
    `,voffset:BE.css`
      //display: inline-block; /* Ensures the field takes only the space it needs */
      width: 30%;
      flex-shrink: 1;
    `,addButton:BE.css`
      align-items: center;
    `}),PO=e=>{const[t,n]=(0,r.useState)((()=>{if(!e.rules)return[];const t=[];return e.rules.forEach(((e,n)=>{t[n]={rule:e,order:n,ID:iA()}})),t})),i=(0,ml.useTheme2)(),s=t=>{n(t);const i=[];t.forEach((e=>{i.push(e.rule)})),e.setter(i)},a=(e,n,i)=>{n&&(t[e].rule.overrides=n,s([...t]))},l=(e,n)=>{let r=n;void 0!==i.visualization&&(r=i.visualization.getColorByName(n)),t[e].rule.svgColor=he(r),s([...t])},c=(e,n)=>{t[e].rule.iconRuleLabel=n,s([...t])},u=(e,n)=>{t[e].rule.iconSize=n,s([...t])},h=e=>{t[e].rule.iconRuleCollapsed=!t[e].rule.iconRuleCollapsed,s([...t])},d=(e,n)=>{t[e].rule.iconVOffset=n,s([...t])},p=(e,n)=>{t[e].rule.iconName=n,s([...t])},f=e=>{const n=[...t];let i=0;for(let t=0;t<n.length;t++)if(n[t].order===e){i=t;break}n.splice(i,1);for(let e=0;e<n.length;e++)n[e].order=e;s([...n])};return o().createElement(o().Fragment,null,o().createElement(ml.Button,{disabled:e.disabled,fill:"solid",variant:"primary",icon:"plus",onClick:()=>{const e={rule:{overrides:[],iconRuleLabel:"new rule",iconRuleCollapsed:!0,iconSize:20,iconVOffset:-5,iconName:""},order:t.length,ID:iA()};s([...t,e])}},"Add icon rule"),t&&t.map(((t,n)=>{var i;return o().createElement(ml.CollapsableSection,{key:n,isOpen:t.rule.iconRuleCollapsed,label:o().createElement("span",null,n+1," ",null!==(i=t.rule.iconRuleLabel)&&void 0!==i?i:"rule",o().createElement(o().Fragment,null," "),o().createElement(ml.IconButton,{disabled:e.disabled,key:"deleteRule",variant:"secondary",name:"trash-alt",tooltip:"delete icon rule",onClick:e=>{f(n),e.stopPropagation()}})),onToggle:()=>h(n)},o().createElement(AO,{disabled:e.disabled||!1,key:`rule-item-index-${t.ID}`,ID:t.ID,rule:t.rule,colorSetter:l,iconLabelSetter:c,iconSizeSetter:u,iconVOffsetSetter:d,iconNameSetter:p,overrideSetter:a,remover:f,index:n,context:e.context}))})))},IO=({context:e,onChange:t})=>{const[n,i]=(0,r.useState)(e.options.svgIconsConfig);return o().createElement(o().Fragment,null,o().createElement(ml.Field,null,o().createElement(PO,{context:e,rules:n,setter:e=>{i(e),t(e)}})))},MO=new t.PanelPlugin((({options:e,data:t,width:n,height:i,replaceVariables:r,eventBus:s,onOptionsChange:a})=>{(null==e?void 0:e.dataLayer)&&!(null==e?void 0:e.dataLayers)&&(e.dataLayers=[e.dataLayer],e.dataLayer=null);const l=(0,ml.useTheme2)(),c=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n.push.apply(n,i)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}(TR({},(0,ml.usePanelContext)()),{onToggleSeriesVisibility:void 0,onSeriesColorChange:(t,n)=>{var i;const r=TR({},e);null===(i=r.globalThresholdsConfig)||void 0===i||i.forEach((e=>{if(e.label===t){const t=l.visualization.getColorByName(n);t&&(e.color=he(t))}})),null==s||s.publish({type:"thresholdType",payload:{thresholds:r.globalThresholdsConfig}}),a(r)}});return o().createElement(ml.PanelContextProvider,{value:c},o().createElement(bR,{props:{replaceVariables:r,theme2:l}},o().createElement(sR,{options:e,data:t,width:n,height:i,eventBus:s})))})).setNoPadding().setPanelOptions((e=>{e.addCustomEditor({category:["Map view"],id:"view",path:"view",name:"Initial view",description:"This location will show when the panel first loads",editor:xO,defaultValue:i}),e.addCustomEditor({category:["Base layer"],id:"basemap",path:"basemap",name:"Base layer",editor:pO,defaultValue:EM}),e.addCustomEditor({category:["Data layers"],id:"dataLayers",path:"dataLayers",name:"Data layers",editor:mO}),e.addTextInput({category:["Other settings"],path:"common.locLabelName",name:"Location name label in alert annotation",settings:{}}).addBooleanSwitch({category:["Other settings"],path:"common.isShowLegend",name:"Show legend",defaultValue:!0}).addCustomEditor({category:["Svg icons"],id:"svgIconsConfig",path:"svgIconsConfig",name:"Svg icons",editor:IO}).addCustomEditor({name:"Color and line-width thresholds",id:"globalThresholdsConfig",path:"globalThresholdsConfig",description:"for primary metric (stat1)",editor:LR,defaultValue:[],category:["Thresholds"]})})).setDataSupport({annotations:!0,alertStates:!0})})(),p})()));
//# sourceMappingURL=module.js.map